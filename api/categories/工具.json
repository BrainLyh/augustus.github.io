{"name":"工具","slug":"工具","count":1,"postlist":[{"title":"序列化与反序列化","slug":"使用Selenium-编写爬虫动态爬取网站设计文档","date":"2019-12-12T03:47:20.000Z","updated":"2020-07-26T03:59:38.681Z","comments":true,"path":"api/articles/使用Selenium-编写爬虫动态爬取网站设计文档.json","excerpt":"","keywords":null,"cover":"F:%5Call_kinds_file%5C%E8%AF%BE%E8%AE%BE%5C%E5%A4%A7%E4%B8%89%E4%B8%8B%5C%E6%96%87%E6%A1%A3%E5%9B%BE%E7%89%87%5C%E7%A0%94%E6%8B%9B%E7%BD%91%E9%A6%96%E9%A1%B5.png","content":"<h1 id=\"使用-Selenium-编写爬虫动态爬取网站\"><a href=\"#使用-Selenium-编写爬虫动态爬取网站\" class=\"headerlink\" title=\"使用 Selenium 编写爬虫动态爬取网站\"></a>使用 Selenium 编写爬虫动态爬取网站</h1><h2 id=\"Intro\"><a href=\"#Intro\" class=\"headerlink\" title=\"Intro\"></a>Intro</h2><p>传统的浏览器请求响应方式是：我们在一个网站上点击了一个请求资源的按钮，就会对服务器发起一次请求，然后响应再返回到浏览器。该请求是一个完整的 HTML 页面，因此当浏览器用到新的 HTML 页面重绘时，可能会看到闪烁，这一方面增加了服务器的压力，同时降低了用户的体验度。</p>\n<p>Web 2.0 很大程度上消除了这种看得见的交互。虽然仍有请求和相应，只不过都隐藏到了幕后，作为用户，体验更加舒适。</p>\n<p>如何实现呢？我们需要发送和请求的数据只包含我们需要的，而不是整个 HTML 页面。这种情况下 Ajax 允许在不更新整个 HTML 页面的情况下发送和接收数据。</p>\n<h2 id=\"如何爬取动态加载的资源？\"><a href=\"#如何爬取动态加载的资源？\" class=\"headerlink\" title=\"如何爬取动态加载的资源？\"></a>如何爬取动态加载的资源？</h2><p>这种方式方便了用户，可是对我们爬取网页内容缺造成了不便。</p>\n<p>相对于传统的静态页面，我们在爬取页面内容时只需要简单的获取整个 HTML 文本然后对其中的内容进行匹配、提取即可。</p>\n<p>对于采用动态记载内容的网站来说，我们查看网页源代码会发现许多我们需要的资源是需要加载请求才能从服务器返回的。</p>\n<h3 id=\"Selenium-amp-PhantomJS简介\"><a href=\"#Selenium-amp-PhantomJS简介\" class=\"headerlink\" title=\"Selenium &amp; PhantomJS简介\"></a>Selenium &amp; PhantomJS简介</h3><p>Selenium 是一个 Web 的自动化测试工具，最初是为了网站自动化测试开发的， Selenium 测试直接运行在浏览器中，就像真正的用户在操作一样。支持的浏览器包括IE（7, 8, 9, 10, 11），Mozilla Firefox，Safari，Google Chrome，Opera等。也包括 PhantomJS 。</p>\n<p>Selenium 可以根据我们的指令，让浏览器自动加载页面，获取需要的数据，甚至是页面截屏。<br>安装：<code>pip install selenium</code></p>\n<p>官方文档：<code>http://selenium-python.readthedocs.io/index.html</code></p>\n<p>PhantomJS 是一个基于 Webkit 的“无界面”( headless )浏览器，它会把网站加载到内存并执行页面上的 JavaScript，因为不会展示图形界面，所以运行起来比完整的浏览器要高效。</p>\n<p>如果我们把 Selenium 和 PhantomJS 结合在一起，就可以运行一个非常强大的网络爬虫了，这个爬虫可以处理 JavaScript、Cookie、headers，以及任何我们真实用户需要做的事情。</p>\n<p>官方文档：<code>http://phantomjs.org/documentation</code></p>\n<p>下载地址： <code>http://phantomjs.org/download.html</code></p>\n<p>手册：<code>https://phantomjs.org/quick-start.html</code></p>\n<p>我们可以通过下面的方式来获得一个 <strong>chromedriver</strong> 驱动的浏览器(<a href=\"https://sites.google.com/a/chromium.org/chromedriver/home\" target=\"_blank\" rel=\"noopener\">需要安装对应驱动</a>)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.chrome.options <span class=\"keyword\">import</span> Options</span><br><span class=\"line\">chrome_options = Options()</span><br><span class=\"line\">chrome_options.add_argument(<span class=\"string\">\"--headless\"</span>)</span><br><span class=\"line\">chrome_options.add_argument(<span class=\"string\">\"--disable-gpu\"</span>)</span><br><span class=\"line\">driver = webdriver.Chrome(executable_path=<span class=\"string\">\"./chromedriver.exe\"</span>, chrome_options=chrome_options)</span><br></pre></td></tr></table></figure>\n\n<p>当然你也可以使用 <strong>PhantomJS</strong> 但是存在的问题是由于两种驱动请求页面的方式不同，后者在页面没有完全记载时就会尝试早期请求，这常常会导致 <code>InvalidElementStateException</code> 错误，当然，我们可以在请求页面第一个元素之前就调用 <code>time</code> 函数，进行 <code>sleep(2)</code> 等待。</p>\n<p>除此之外，<strong>PhantomJS</strong> 也已经不再更新，这也驱使我们使用新的驱动程序。</p>\n<h3 id=\"简单使用\"><a href=\"#简单使用\" class=\"headerlink\" title=\"简单使用\"></a>简单使用</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导入 webdriver</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调用键盘按键操作时需要引入的Keys包</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调用环境变量指定的PhantomJS浏览器创建浏览器对象</span></span><br><span class=\"line\">driver = webdriver.PhantomJS()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果没有在环境变量指定PhantomJS位置</span></span><br><span class=\"line\"><span class=\"comment\"># driver = webdriver.PhantomJS(executable_path=\"./phantomjs\"))</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get方法会一直等到页面被完全加载，然后才会继续程序，通常测试会在这里选择 time.sleep(2)</span></span><br><span class=\"line\">driver.get(<span class=\"string\">\"http://www.baidu.com/\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取页面名为 wrapper的id标签的文本内容</span></span><br><span class=\"line\">data = driver.find_element_by_id(<span class=\"string\">\"wrapper\"</span>).text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打印页面标题 \"百度一下，你就知道\"</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> driver.title</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 生成当前页面快照并保存</span></span><br><span class=\"line\">driver.save_screenshot(<span class=\"string\">\"baidu.png\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># id=\"kw\"是百度搜索输入框，输入字符串\"长城\"</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"kw\"</span>).send_keys(<span class=\"string\">u\"长城\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># id=\"su\"是百度搜索按钮，click() 是模拟点击</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"su\"</span>).click()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ctrl+a 全选输入框内容</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"kw\"</span>).send_keys(Keys.CONTROL,<span class=\"string\">'a'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ctrl+x 剪切输入框内容</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"kw\"</span>).send_keys(Keys.CONTROL,<span class=\"string\">'x'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取href值</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">\"html/body/div/div[1]/div[2]/a[1]\"</span>).get_attribute(<span class=\"string\">'href'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 模拟Enter回车键，替代点击操作</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"su\"</span>).send_keys(Keys.RETURN)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 清除输入框内容</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">\"kw\"</span>).clear()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭当前页面，如果只有一个页面，会关闭浏览器</span></span><br><span class=\"line\"><span class=\"comment\"># driver.close()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭浏览器</span></span><br><span class=\"line\">driver.quit()</span><br></pre></td></tr></table></figure>\n\n<p>使用JS取得最大屏幕</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 接下来是全屏的关键，用js获取页面的宽高，如果有其他需要用js的部分也可以用这个方法</span></span><br><span class=\"line\">    width = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollWidth\"</span>)</span><br><span class=\"line\">    height = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollHeight\"</span>)</span><br><span class=\"line\">    print(width, height)</span><br><span class=\"line\">    <span class=\"comment\"># 窗口最大化</span></span><br><span class=\"line\">    driver.set_window_size(width, height)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"切换页面\"><a href=\"#切换页面\" class=\"headerlink\" title=\"切换页面\"></a>切换页面</h3><p>当有许多 Tab 时我们需要判断我们当前处于哪个页面，使用 <code>window_handles</code> 来操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Store the ID of the original window</span></span><br><span class=\"line\">original_window = driver.current_window_handle</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\"># Check we don't have other windows open already</span></span><br><span class=\"line\">   <span class=\"keyword\">assert</span> len(driver.window_handles) == <span class=\"number\">1</span></span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\"># Wait for the new window or tab</span></span><br><span class=\"line\">   wait.until(EC.number_of_windows_to_be(<span class=\"number\">2</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\"># Loop through until we find a new window handle</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> window_handle <span class=\"keyword\">in</span> driver.window_handles:</span><br><span class=\"line\">       <span class=\"keyword\">if</span> window_handle != original_window:</span><br><span class=\"line\">           driver.switch_to.window(window_handle)</span><br><span class=\"line\">           <span class=\"keyword\">break</span></span><br><span class=\"line\">           </span><br><span class=\"line\">   wait.until(EC.title_is(<span class=\"string\">\"title\"</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复选框选择\"><a href=\"#复选框选择\" class=\"headerlink\" title=\"复选框选择\"></a>复选框选择</h3><p>选择一个实际场景进行测试，<a href=\"https://yz.chsi.com.cn/zsml/zyfx_search.jsp\" target=\"_blank\" rel=\"noopener\">以研招网硕士专业目录为例</a> </p>\n<p><img src=\"F:%5Call_kinds_file%5C%E8%AF%BE%E8%AE%BE%5C%E5%A4%A7%E4%B8%89%E4%B8%8B%5C%E6%96%87%E6%A1%A3%E5%9B%BE%E7%89%87%5C%E7%A0%94%E6%8B%9B%E7%BD%91%E9%A6%96%E9%A1%B5.png\" alt=\"研招网首页\"></p>\n<p>这有一个 <code>select</code> 标签下的复选框，用常规的方法解析 <code>Xpath</code> 路径可以获取到想要的元素，但是没办法进行选择，这里采用 <code>Selenium</code> 提供的 <code>Select</code> 库进行选择，<a href=\"https://selenium-python-zh.readthedocs.io/en/latest/api.html\" target=\"_blank\" rel=\"noopener\">文档在这里</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 Select 处理下拉框的选项</span></span><br><span class=\"line\"><span class=\"comment\"># 先通过 Xpath 找到 select 标签，然后通过 value 找到对应值即可选择</span></span><br><span class=\"line\">Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='mldm']\"</span>)).select_by_value(<span class=\"string\">'zyxw'</span>)</span><br><span class=\"line\">Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='yjxkdm']\"</span>)).select_by_value(<span class=\"string\">\"0854\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样，我们就成功的选择到想要的元素，之后进行查询跳转即可。</p>\n<h2 id=\"爬虫设计\"><a href=\"#爬虫设计\" class=\"headerlink\" title=\"爬虫设计\"></a>爬虫设计</h2><p>我们将本次爬虫分为几大部分</p>\n<ol>\n<li>逻辑分析</li>\n<li>代码实现</li>\n<li>数据可视化</li>\n</ol>\n<h3 id=\"逻辑分析\"><a href=\"#逻辑分析\" class=\"headerlink\" title=\"逻辑分析\"></a>逻辑分析</h3><p>此次爬虫我们的设计目标是爬取研招网2020年的考研相关数据，我们需要先认为的对目标网站进行查询操作，明确操作流程之后，再进行下一步。</p>\n<ol>\n<li><strong>选择我们要使用的浏览器</strong>，进入查询网址，<a href=\"https://yz.chsi.com.cn/zsml/queryAction.do\" target=\"_blank\" rel=\"noopener\">研招网硕士专业目录查询</a></li>\n<li>打开研招网的硕士目录后需要先至少选择两项条件，且学科类别为必选项，<strong>选择好条件</strong>之后才能进行查询</li>\n</ol>\n<p><img src=\"F:%5Call_kinds_file%5C%E8%AF%BE%E8%AE%BE%5C%E5%A4%A7%E4%B8%89%E4%B8%8B%5C%E6%96%87%E6%A1%A3%E5%9B%BE%E7%89%87%5C%E7%A0%94%E6%8B%9B%E7%BD%91%E9%A6%96%E9%A1%B5.png\" alt=\"研招网首页\"></p>\n<ol start=\"2\">\n<li>我们以 专业学位、电子信息 为筛选条件，选择好条件后会<strong>进行一次页面跳转</strong>，进入包含所有符合我们选择条件的院校列表页面，可以看到，符合条件的院校非常多，有十几页的内容。</li>\n<li>对于这些院校，我们的关注点可能在于所在城市，以及所开设的研究方向等信息。我们选择一所院校进行点击之后，<strong>会打开一个新的窗口</strong> ，里面包含了该校在本学科类别下开设的所有研究方向与计划招收人数等信息，有些学校的研究方向非常多，可能会有十几页内容。</li>\n<li>查看完一个学校，<strong>记录我们需要的信息</strong>之后，我们可能会查看其他学校。于是，为了避免打开窗口过多，我们会<strong>关闭新打开的窗口</strong>，回到院校列表页面，重新打开一个学校的研究方向窗口。</li>\n<li>查询完成，<strong>关闭浏览器</strong>。</li>\n</ol>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><p>针对上文的逻辑分析，我们编写代码时也主要完成上述动作。</p>\n<ol>\n<li><p>选择浏览器，并进行配置</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置 driver</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_driver</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">    chrome_options = Options()</span><br><span class=\"line\">    chrome_options.add_argument(<span class=\"string\">\"--headless\"</span>) <span class=\"comment\"># 即所谓 无头 模式</span></span><br><span class=\"line\">    chrome_options.add_argument(<span class=\"string\">\"--disable-gpu\"</span>)</span><br><span class=\"line\">    driver = webdriver.Chrome(executable_path=<span class=\"string\">\"E:/Program Files/chromedriver_win32/chromedriver.exe\"</span>,</span><br><span class=\"line\">                              chrome_options=chrome_options)</span><br><span class=\"line\">    driver.get(url)</span><br><span class=\"line\">    driver = set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将设置屏幕大小独立出来，方便每次跳转完使用</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_height_width</span><span class=\"params\">(driver)</span>:</span> </span><br><span class=\"line\">    width = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollWidth\"</span>)</span><br><span class=\"line\">    height = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollHeight\"</span>)</span><br><span class=\"line\">    driver.set_window_size(width, height) <span class=\"comment\"># 将屏幕大小设置为最大，防止部分信息加载不完全</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> driver</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>条件选择与页面跳转</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 选择目标专业</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">select_major</span><span class=\"params\">(driver)</span>:</span></span><br><span class=\"line\">    original_window = driver.current_window_handle</span><br><span class=\"line\">    <span class=\"keyword\">assert</span> len(driver.window_handles) == <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># https://selenium-python-zh.readthedocs.io/en/latest/api.html</span></span><br><span class=\"line\">        <span class=\"comment\"># 使用 Select 处理下拉框的选项</span></span><br><span class=\"line\">        <span class=\"comment\"># 先通过 Xpath 找到 select 标签，然后通过 value 找到对应值即可选择</span></span><br><span class=\"line\">        Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='mldm']\"</span>)).select_by_value(<span class=\"string\">'zyxw'</span>) <span class=\"comment\"># 选择专业学位</span></span><br><span class=\"line\">        Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='yjxkdm']\"</span>)).select_by_value(<span class=\"string\">\"0854\"</span>) <span class=\"comment\"># 电子信息的专业代码</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"wrong \"</span> + str(e))</span><br><span class=\"line\"></span><br><span class=\"line\">    driver.find_element_by_xpath(<span class=\"string\">\"//input[@name='button']\"</span>).click() <span class=\"comment\"># 找到查询按钮进行点击</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 等待时间过长，超时</span></span><br><span class=\"line\">    <span class=\"comment\"># wait.until(EC.number_of_windows_to_be(2))</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\"># 判断当前页面</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> window_handle <span class=\"keyword\">in</span> driver.window_handles:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> window_handle != original_window:</span><br><span class=\"line\">            driver.switch_to.window(window_handle)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"comment\"># 成功跳转到目标网页</span></span><br><span class=\"line\">    driver = set_height_width(driver)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> driver</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>选取该页面上的所有院校</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获得当前条件下的所有高校名称,返回名称列表</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_school_name</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        name_list = []</span><br><span class=\"line\">        major_numbers_list = []</span><br><span class=\"line\">        number_list = []</span><br><span class=\"line\">        original_window = driver.current_window_handle</span><br><span class=\"line\">        flag = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(numbers)+<span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    school_name = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[1]//form[1]//a[1]\"</span>.format(line)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                    print(school_name)</span><br><span class=\"line\">                    name_list.append(school_name)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                    flag = <span class=\"literal\">False</span></span><br><span class=\"line\">                    print(<span class=\"string\">\"查找失败，请检查当前页面是否为空！\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> (pagenumber &lt; <span class=\"number\">7</span>):</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(numbers)+<span class=\"number\">1</span>):</span><br><span class=\"line\">                    school_name = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[1]//form[1]//a[1]\"</span>.format(line)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                    name_list.append(school_name)</span><br><span class=\"line\">                    print(school_name)</span><br><span class=\"line\"></span><br><span class=\"line\">                ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># print(name_list)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> name_list, major_numbers_list, number_list, flag</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"4\">\n<li><p>翻页处理</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果需要翻页就翻页</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">paging</span><span class=\"params\">(driver)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    css_selector_pages = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                         <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                         <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                         <span class=\"string\">\"div.zsml-row.clearfix div.zsml-page-box &gt; ul.ch-page\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ul = driver.find_element_by_css_selector(css_selector_pages)</span><br><span class=\"line\">    li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>) </span><br><span class=\"line\">    <span class=\"comment\"># print(len(li))</span></span><br><span class=\"line\">    <span class=\"comment\"># 第一页右下角的标签数量最大为10，小于10时没有 Go 输入跳转框</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(len(li) &lt; <span class=\"number\">10</span>):</span><br><span class=\"line\">        pagenumber = int(li[<span class=\"number\">-2</span>].text)</span><br><span class=\"line\">    <span class=\"comment\"># print(pagenumber)</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        pagenumber = int(li[<span class=\"number\">-3</span>].text)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pagenumber</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>获取研究方向等信息</p>\n<p>与院校列表页面不同，各个学校对应的研究方向的数量不同，存在研究方向页面数量不同的情况，这也造成了我们无法通过一种固定的方法来对所用的情况进行处理，于是，在这段代码里增加了数量判断。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_info</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 当前 Tab 里有多少个页面</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        majors = <span class=\"number\">0</span></span><br><span class=\"line\">        all_number = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 定位跳转</span></span><br><span class=\"line\">        css_selector_jumpto = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-row.clearfix \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-page-box ul.ch-page \"</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">            major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">            majors += len(major)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(<span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                    numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                    all_number += int(numbers)</span><br><span class=\"line\">                    print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(pagenumber &lt; <span class=\"number\">7</span> ):</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                            number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(</span><br><span class=\"line\">                                <span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                            numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                            print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\">                            all_number += int(numbers)</span><br><span class=\"line\">                        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                            print(e)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        print(e)</span><br><span class=\"line\">                ul = driver.find_element_by_css_selector(css_selector_jumpto)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 下一页按钮位置不同,用 Go</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>  <span class=\"comment\"># 下一次要Go的页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">                driver.find_element_by_css_selector(<span class=\"string\">\"#goPageNo\"</span>).send_keys(str(flag))  <span class=\"comment\"># 输入页码跳转</span></span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='page-btn']\"</span>).click()  <span class=\"comment\"># 点击 Go，仍然同是一个 window_handle</span></span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">                flag +=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># print(len(major_list))</span></span><br><span class=\"line\">        print(<span class=\"string\">\"专业数量： \"</span> + str(majors))</span><br><span class=\"line\">        print(<span class=\"string\">\"  共招生: \"</span> + str(all_number))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> majors, all_number</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n<ol start=\"6\">\n<li><p>保存数据</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 保存数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_data</span><span class=\"params\">(data_list)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">\"../major_info.txt\"</span>, <span class=\"string\">\"w\"</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> data_list:</span><br><span class=\"line\">            f.write(line + <span class=\"string\">\"\\r\"</span>)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>关闭浏览器</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.close()</span><br><span class=\"line\">driver.quit()</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"数据可视化分析\"><a href=\"#数据可视化分析\" class=\"headerlink\" title=\"数据可视化分析\"></a>数据可视化分析</h3><p>数据可视化我们选择 <a href=\"http://pyecharts.org/#/zh-cn/intro\" target=\"_blank\" rel=\"noopener\">pyecharts</a> ,原因在于它的高度抽象，极大的简化了我们对数据进行可视化的操作难度。</p>\n<p>该项目中我们主要在三处使用了可视化相关操作，分别是：</p>\n<ol>\n<li>对相关高校在各省分布的全国地图绘制</li>\n<li>对选择城市开设目标专业的高校招生情况的折线图绘制</li>\n<li>对目标高校开设目标专业的招生情况柱状图绘制</li>\n</ol>\n<p>数据可视化的关键在于 <strong>数据的格式化</strong> ，剔除无关数据，保证完整的数据关系</p>\n<p>以绘制全国地图为例，在得到各个包含各个省市名称的列表之后，需要对这些名称进行格式化处理，只保留主要关键字：北京市-&gt;北京、新疆维吾尔族自治区 -&gt; 新疆、黑龙江省 -&gt; 黑龙江 等</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">realcity = []</span><br><span class=\"line\">            <span class=\"comment\"># 处理城市名，只保留两字或三字名称</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> citys <span class=\"keyword\">in</span> city_name:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"string\">\"黑龙江\"</span> <span class=\"keyword\">in</span> citys:</span><br><span class=\"line\">                    a = <span class=\"string\">\"黑龙江\"</span></span><br><span class=\"line\">                <span class=\"keyword\">elif</span> <span class=\"string\">\"内蒙古\"</span> <span class=\"keyword\">in</span> citys:</span><br><span class=\"line\">                    a = <span class=\"string\">\"内蒙古\"</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    a = citys[<span class=\"number\">4</span>:<span class=\"number\">6</span>]</span><br><span class=\"line\">                realcity.append(a)</span><br><span class=\"line\">            <span class=\"comment\"># print(realcity)</span></span><br><span class=\"line\">            <span class=\"comment\"># 将数据处理成列表</span></span><br><span class=\"line\">            list1 = [[realcity[i], school_counts[i]] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(realcity))]</span><br></pre></td></tr></table></figure>\n\n<p>再将城市名称列表与数量列表合并之后，即可绘制地图</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map_1 = Map()</span><br><span class=\"line\">            map_1.set_global_opts(</span><br><span class=\"line\">                title_opts=opts.TitleOpts(title=<span class=\"string\">\"2020高校分布\"</span>),</span><br><span class=\"line\">                visualmap_opts=opts.VisualMapOpts(max_=<span class=\"number\">40</span>)  <span class=\"comment\"># 最大数据范围</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            map_1.add(<span class=\"string\">\"2020高校分布\"</span>, list1, maptype=<span class=\"string\">\"china\"</span>)</span><br><span class=\"line\">            map_1.render(<span class=\"string\">'SchoolMap.html'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>其他两个例子同理</p>\n<h2 id=\"功能划分\"><a href=\"#功能划分\" class=\"headerlink\" title=\"功能划分\"></a>功能划分</h2><p>有了可视化之后，我们就可以尝试将代码功能划分的更细致。主要实现三个功能：</p>\n<ol>\n<li>根据输入的门类类别代码，学科类别代码来绘制符合条件的高校在全国各省的分布情况</li>\n<li>根据输入的省份、门类类别代码、学科类别代码来绘制符合条件的高校对应专业的拟招生人数等信息</li>\n<li>根据输入的高校名称、学科类别代码来绘制该高校开设的专业数量和对应的拟招生人数</li>\n</ol>\n<h3 id=\"面向对象\"><a href=\"#面向对象\" class=\"headerlink\" title=\"面向对象\"></a>面向对象</h3><p>将功能抽象为三个类，分别为：<code>SchoolMap</code> 、 <code>ReserachDirections</code> 、 <code>RDsBySchoolName</code> </p>\n<p><code>SchoolMap</code> 负责实现功能一，主要代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 返回当前所选择城市开设目标专业的高校数量</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">count_city</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        counts = <span class=\"number\">0</span></span><br><span class=\"line\">        self.FlagOfProcess = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                counts = len(numbers)</span><br><span class=\"line\">            <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                self.FlagOfProcess = <span class=\"literal\">False</span></span><br><span class=\"line\">                print(<span class=\"string\">\"查找失败，请检查当前页面是否为空！\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> (pagenumber &lt; <span class=\"number\">7</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                counts += len(numbers)</span><br><span class=\"line\">                ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 下一页按钮位置不同,用 Go</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>  <span class=\"comment\"># 下一次要Go的页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                <span class=\"comment\"># 定位页码</span></span><br><span class=\"line\">                counts += len(numbers)</span><br><span class=\"line\">                driver.find_element_by_css_selector(<span class=\"string\">\"#goPageNo\"</span>).send_keys(str(flag))  <span class=\"comment\"># 输入页码跳转</span></span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='page-btn']\"</span>).click()  <span class=\"comment\"># 点击 Go，仍然同是一个 window_handle</span></span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">                flag += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> counts</span><br></pre></td></tr></table></figure>\n\n<p><code>ReserachDirections</code> 主要实现功能二，主要代码为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获得某个院校在目标专业下的研究方向的数量，返回数量列表</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_info</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 当前 Tab 里有多少个页面</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        majors = <span class=\"number\">0</span></span><br><span class=\"line\">        all_number = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 定位跳转</span></span><br><span class=\"line\">        css_selector_jumpto = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-row.clearfix \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-page-box ul.ch-page \"</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">            major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">            majors += len(major)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(<span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                    numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                    all_number += int(numbers)</span><br><span class=\"line\">                    print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(pagenumber &lt; <span class=\"number\">7</span> ):</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                            number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(</span><br><span class=\"line\">                                <span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                            numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                            print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\">                            all_number += int(numbers)</span><br><span class=\"line\">                        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                            print(e)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        print(e)</span><br><span class=\"line\">                ul = driver.find_element_by_css_selector(css_selector_jumpto)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 下一页按钮位置不同,用 Go</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>  <span class=\"comment\"># 下一次要Go的页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">                driver.find_element_by_css_selector(<span class=\"string\">\"#goPageNo\"</span>).send_keys(str(flag))  <span class=\"comment\"># 输入页码跳转</span></span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='page-btn']\"</span>).click()  <span class=\"comment\"># 点击 Go，仍然同是一个 window_handle</span></span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">                flag +=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># print(len(major_list))</span></span><br><span class=\"line\">        print(<span class=\"string\">\"专业数量： \"</span> + str(majors))</span><br><span class=\"line\">        print(<span class=\"string\">\"  共招生: \"</span> + str(all_number))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> majors, all_number</span><br></pre></td></tr></table></figure>\n\n<p><code>RDsBySchoolName</code> 主要负责功能三，主要代码为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_list</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        major_number_list = []</span><br><span class=\"line\">        admission_list = []</span><br><span class=\"line\">        label_list = []</span><br><span class=\"line\">        value_list = []</span><br><span class=\"line\"></span><br><span class=\"line\">        ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='zsml-zy-filter']\"</span>)</span><br><span class=\"line\">        li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">        print(<span class=\"string\">\"当前院校专业数量：\"</span> + str(len(li)))</span><br><span class=\"line\"></span><br><span class=\"line\">        input_selector = <span class=\"string\">\"/html[1]/body[1]/div[2]/div[3]/div[1]/div[2]/div[2]/form[1]/ul[1]/li[&#123;&#125;]/input[1]\"</span></span><br><span class=\"line\">        label_selector = <span class=\"string\">\"/html[1]/body[1]/div[2]/div[3]/div[1]/div[2]/div[2]/form[1]/ul[1]/li[&#123;&#125;]/label[1]\"</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> check_box <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(li)+<span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                value = driver.find_element_by_xpath(input_selector.format(check_box)).get_attribute(<span class=\"string\">\"value\"</span>)</span><br><span class=\"line\">                label = driver.find_element_by_xpath(label_selector.format(check_box)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                driver.find_element_by_xpath(input_selector.format(check_box)).click()</span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='blue-btn-s']\"</span>).click()</span><br><span class=\"line\">                label_list.append(label)</span><br><span class=\"line\">                value_list.append(value)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 得到每个专业下的研究方向数量与拟招生人数</span></span><br><span class=\"line\">                majors, all_number = self.get_major_info(driver)</span><br><span class=\"line\">                major_number_list.append(majors)</span><br><span class=\"line\">                admission_list.append(all_number)</span><br><span class=\"line\"></span><br><span class=\"line\">                print(<span class=\"string\">\" 当前专业：\"</span> + label)</span><br><span class=\"line\">                print(<span class=\"string\">\" 研究方向数量： \"</span> + str(majors), <span class=\"string\">\"拟招生人数： \"</span> + str(all_number))</span><br><span class=\"line\">                <span class=\"comment\"># 两次点击取消选择</span></span><br><span class=\"line\">                driver.find_element_by_xpath(input_selector.format(check_box)).click()</span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='blue-btn-s']\"</span>).click()</span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                print(e)</span><br><span class=\"line\">        print(value_list, label_list)</span><br><span class=\"line\">        print(major_number_list, admission_list)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> label_list, major_number_list, admission_list</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 得到研究方向数量与拟招生人数</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_info</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 当前 Tab 里有多少个页面</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        majors = <span class=\"number\">0</span></span><br><span class=\"line\">        all_number = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 定位跳转</span></span><br><span class=\"line\">        css_selector_jumpto = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-row.clearfix \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-page-box ul.ch-page \"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">            major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            majors += len(major)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(<span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                    numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                    all_number += int(numbers)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># print(\"这一页的研究方向数量\" + str(len(major)))</span></span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                            number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(</span><br><span class=\"line\">                                <span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                            numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                            <span class=\"comment\"># print(\"  拟招生：\" + numbers)</span></span><br><span class=\"line\">                            all_number += int(numbers)</span><br><span class=\"line\">                        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                            print(e)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">                ul = driver.find_element_by_css_selector(css_selector_jumpto)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> majors, all_number</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h2><p><strong>CSCrawler.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># encoding: utf-8</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">@author: Brian</span></span><br><span class=\"line\"><span class=\"string\">@file: CSCrawler.py</span></span><br><span class=\"line\"><span class=\"string\">@time: 2020/6/30 14:42</span></span><br><span class=\"line\"><span class=\"string\">@desc: 程序的主入口函数</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> SchoolMapByPyEcharts <span class=\"keyword\">import</span> SchoolMap</span><br><span class=\"line\"><span class=\"keyword\">from</span> ResearchDirectionsByPyEcharts <span class=\"keyword\">import</span> ReserachDirections</span><br><span class=\"line\"><span class=\"keyword\">from</span> RDsBySchoolName <span class=\"keyword\">import</span> RDsBySchoolName</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CSCrawler</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, url, yjxkdm)</span>:</span></span><br><span class=\"line\">        self.url = url</span><br><span class=\"line\">        self.yjxkdm = yjxkdm</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">SchoolMap</span><span class=\"params\">(self, mldm)</span>:</span></span><br><span class=\"line\">        school_map = SchoolMap(self.url, mldm, self.yjxkdm)</span><br><span class=\"line\">        driver = school_map.set_driver()</span><br><span class=\"line\">        city_name, school_counts = school_map.select_major(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        school_map.visulize(city_name, school_counts)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ResearchDirection</span><span class=\"params\">(self, count, mldm)</span>:</span></span><br><span class=\"line\">        researdirection = ReserachDirections(self.url, count, mldm, self.yjxkdm)</span><br><span class=\"line\">        driver = researdirection.set_driver()</span><br><span class=\"line\"></span><br><span class=\"line\">        x, y1, y2, flag = researdirection.select_option(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        researdirection.stacked_area_chart(x, y1, y2, flag)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">RDsBySchoolName</span><span class=\"params\">(self, schoolname)</span>:</span></span><br><span class=\"line\">        rds = RDsBySchoolName(self.url, schoolname, self.yjxkdm)</span><br><span class=\"line\">        driver = rds.set_driver()</span><br><span class=\"line\">        x, y1, y2, flag = rds.select_school(driver)</span><br><span class=\"line\">        rds.stacked_area_chart(x, y1, y2, flag)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">\"\"</span></span><br><span class=\"line\">          <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">          -------欢迎来到研招网专业目录信息爬虫项目-------</span></span><br><span class=\"line\"><span class=\"string\">                        你想做什么?</span></span><br><span class=\"line\"><span class=\"string\">                [1]: 目标专业的全国分布地图</span></span><br><span class=\"line\"><span class=\"string\">                [2]: 目标省份内个高校对相关专业的招收情况</span></span><br><span class=\"line\"><span class=\"string\">                [3]: 目标院校对应专业的研究方向与拟招生人数情况</span></span><br><span class=\"line\"><span class=\"string\">                [4]: 退出程序</span></span><br><span class=\"line\"><span class=\"string\">          -----------请在下方输入相关操作代码------------</span></span><br><span class=\"line\"><span class=\"string\">          \"\"\"</span></span><br><span class=\"line\">          <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    flag = <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(flag):</span><br><span class=\"line\">        code = input(<span class=\"string\">\"请输入操作代码：\"</span>).strip()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(code == str(<span class=\"number\">1</span>)):</span><br><span class=\"line\">            print(<span class=\"string\">\"正在加载目标专业的全国分布地图的程序...\"</span>)</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">            门类类别：</span></span><br><span class=\"line\"><span class=\"string\">                专业学位：</span></span><br><span class=\"line\"><span class=\"string\">                (zyxw)专业学位</span></span><br><span class=\"line\"><span class=\"string\">                ['(0251)金融', '(0252)应用统计', '(0253)税务', '(0254)国际商务', '(0255)保险', '(0256)资产评估',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0257)审计', '(0351)法律', '(0352)社会工作', '(0353)警务', '(0451)教育', '(0452)体育',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0453)汉语国际教育', '(0454)应用心理', '(0551)翻译', '(0552)新闻与传播', '(0553)出版',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0651)文物与博物馆', '(0851)建筑学', '(0853)城市规划', '(0854)电子信息', '(0855)机械',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0856)材料与化工', '(0857)资源与环境', '(0858)能源动力', '(0859)土木水利', '(0860)生物与医药',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0861)交通运输', '(0951)农业', '(0952)兽医', '(0953)风景园林', '(0954)林业', '(1051)临床医学',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1052)口腔医学', '(1053)公共卫生', '(1054)护理', '(1055)药学', '(1056)中药学', '(1057)中医',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1151)军事', '(1251)工商管理', '(1252)公共管理', '(1253)会计', '(1254)旅游管理', '(1255)图书情报',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1256)工程管理', '(1351)艺术']</span></span><br><span class=\"line\"><span class=\"string\">                学术学位：</span></span><br><span class=\"line\"><span class=\"string\">                (01)哲学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0101)哲学']</span></span><br><span class=\"line\"><span class=\"string\">                (02)经济学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0201)理论经济学', '(0202)应用经济学', '(0270)统计学']</span></span><br><span class=\"line\"><span class=\"string\">                (03)法学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0301)法学', '(0302)政治学', '(0303)社会学', '(0304)民族学', '(0305)马克思主义理论', '(0306)公安学']</span></span><br><span class=\"line\"><span class=\"string\">                (04)教育学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0401)教育学', '(0402)心理学', '(0403)体育学', '(0471)']</span></span><br><span class=\"line\"><span class=\"string\">                (05)文学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0501)中国语言文学', '(0502)外国语言文学', '(0503)新闻传播学']</span></span><br><span class=\"line\"><span class=\"string\">                (06)历史学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0601)考古学', '(0602)中国史', '(0603)世界史']</span></span><br><span class=\"line\"><span class=\"string\">                (07)理学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0701)数学', '(0702)物理学', '(0703)化学', '(0704)天文学', '(0705)地理学', '(0706)大气科学', '(0707)海洋科学',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0708)地球物理学', '(0709)地质学', '(0710)生物学', '(0711)系统科学', '(0712)科学技术史', '(0713)生态学', '</span></span><br><span class=\"line\"><span class=\"string\">                 (0714)统计学', '(0771)心理学', '(0772)力学', '(0773)材料科学与工程', '(0774)电子科学与技术', '(0775)计算机科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0776)环境科学与工程', '(0777)生物医学工程', '(0778)基础医学', '(0779)公共卫生与预防医学', '(0780)药学',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0781)中药学', '(0782)医学技术', '(0783)护理学', '(0784)', '(0785)', '(0786)']</span></span><br><span class=\"line\"><span class=\"string\">                (08)工学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0801)力学', '(0802)机械工程', '(0803)光学工程', '(0804)仪器科学与技术', '(0805)材料科学与工程', '(0806)冶金工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0807)动力工程及工程热物理', '(0808)电气工程', '(0809)电子科学与技术', '(0810)信息与通信工程', '(0811)控制科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0812)计算机科学与技术', '(0813)建筑学', '(0814)土木工程', '(0815)水利工程', '(0816)测绘科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                '(0817)化学工程与技术', '(0818)地质资源与地质工程', '(0819)矿业工程', '(0820)石油与天然气工程', '(0821)纺织科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0822)轻工技术与工程', '(0823)交通运输工程', '(0824)船舶与海洋工程', '(0825)航空宇航科学与技术', '(0826)兵器科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                '(0827)核科学与技术', '(0828)农业工程', '(0829)林业工程', '(0830)环境科学与工程', '(0831)生物医学工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0832)食品科学与工程', '(0833)城乡规划学', '(0834)风景园林学', '(0835)软件工程', '(0836)生物工程', '(0837)安全科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0838)公安技术', '(0839)网络空间安全', '(0870)科学技术史', '(0871)管理科学与工程', '(0872)设计学']</span></span><br><span class=\"line\"><span class=\"string\">                (09)农学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0901)作物学', '(0902)园艺学', '(0903)农业资源与环境', '(0904)植物保护', '(0905)畜牧学', '(0906)兽医学', '(0907)林学',</span></span><br><span class=\"line\"><span class=\"string\">                '(0908)水产', '(0909)草学', '(0970)科学技术史', '(0971)环境科学与工程', '(0972)食品科学与工程', '(0973)风景园林学']</span></span><br><span class=\"line\"><span class=\"string\">                (10)医学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1001)基础医学', '(1002)临床医学', '(1003)口腔医学', '(1004)公共卫生与预防医学', '(1005)中医学', '(1006)中西医结合',</span></span><br><span class=\"line\"><span class=\"string\">                '(1007)药学', '(1008)中药学', '(1009)特种医学', '(1010)医学技术', '(1011)护理学', '(1071)科学技术史', '(1072)生物医学工程',</span></span><br><span class=\"line\"><span class=\"string\">                 '(1073)', '(1074)']</span></span><br><span class=\"line\"><span class=\"string\">                (11)军事学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1101)军事思想及军事历史', '(1102)战略学', '(1103)战役学', '(1104)战术学', '(1105)军队指挥学', '(1106)军事管理学',</span></span><br><span class=\"line\"><span class=\"string\">                '(1107)军队政治工作学', '(1108)军事后勤学', '(1109)军事装备学', '(1110)军事训练学']</span></span><br><span class=\"line\"><span class=\"string\">                (12)管理学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1201)管理科学与工程', '(1202)工商管理', '(1203)农林经济管理', '(1204)公共管理', '(1205)图书情报与档案管理']</span></span><br><span class=\"line\"><span class=\"string\">                (13)艺术学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1301)艺术学理论', '(1302)音乐与舞蹈学', '(1303)戏剧与影视学', '(1304)美术学', '(1305)设计学']</span></span><br><span class=\"line\"><span class=\"string\">            \"\"\"</span></span><br><span class=\"line\">                  <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"请根据上方对应关系输入门类类别代码、学科类别代码进行图表生成：\"</span>.center(<span class=\"number\">50</span>, <span class=\"string\">'-'</span>))</span><br><span class=\"line\">            print(<span class=\"string\">\"例如:zyxw 0854 将会绘制开设 专业学位 电子信息 的高校在全国的分布信息\"</span>.center(<span class=\"number\">60</span>, <span class=\"string\">'-'</span>))</span><br><span class=\"line\">            mldm = str(input(<span class=\"string\">\"请输入门类类别代码： \"</span>)).strip()</span><br><span class=\"line\">            yjxkdm = str(input(<span class=\"string\">\"请输入学科类别代码： \"</span>)).strip()</span><br><span class=\"line\">            url = <span class=\"string\">\"https://yz.chsi.com.cn/zsml/queryAction.do\"</span></span><br><span class=\"line\">            crawler = CSCrawler(url,yjxkdm)</span><br><span class=\"line\">            crawler.SchoolMap(mldm)</span><br><span class=\"line\">            print(<span class=\"string\">\"正在收集数据...\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(code == str(<span class=\"number\">2</span>)):</span><br><span class=\"line\">            print(<span class=\"string\">\"正在加载目标省份内个高校对相关专业的招收情况的程序...\"</span>)</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">            城市代码：</span></span><br><span class=\"line\"><span class=\"string\">                ['(11)北京市', '(12)天津市', '(13)河北省', '(14)山西省', '(15)内蒙古自治区', '(21)辽宁省', '(22)吉林省', </span></span><br><span class=\"line\"><span class=\"string\">                '(23)黑龙江省', '(31)上海市', '(32)江苏省', '(33)浙江省', '(34)安徽省', '(35)福建省', '(36)江西省', '</span></span><br><span class=\"line\"><span class=\"string\">                (37)山东省', '(41)河南省', '(42)湖北省', '(43)湖南省', '(44)广东省', '(45)广西壮族自治区', '(46)海南省', </span></span><br><span class=\"line\"><span class=\"string\">                '(50)重庆市', '(51)四川省', '(52)贵州省', '(53)云南省', '(54)西藏自治区', '(61)陕西省', '(62)甘肃省', </span></span><br><span class=\"line\"><span class=\"string\">                '(63)青海省', '(64)宁夏回族自治区', '(65)新疆维吾尔自治区']</span></span><br><span class=\"line\"><span class=\"string\">            门类类别：</span></span><br><span class=\"line\"><span class=\"string\">                专业学位：</span></span><br><span class=\"line\"><span class=\"string\">                (zyxw)专业学位</span></span><br><span class=\"line\"><span class=\"string\">                ['(0251)金融', '(0252)应用统计', '(0253)税务', '(0254)国际商务', '(0255)保险', '(0256)资产评估',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0257)审计', '(0351)法律', '(0352)社会工作', '(0353)警务', '(0451)教育', '(0452)体育',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0453)汉语国际教育', '(0454)应用心理', '(0551)翻译', '(0552)新闻与传播', '(0553)出版',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0651)文物与博物馆', '(0851)建筑学', '(0853)城市规划', '(0854)电子信息', '(0855)机械',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0856)材料与化工', '(0857)资源与环境', '(0858)能源动力', '(0859)土木水利', '(0860)生物与医药',</span></span><br><span class=\"line\"><span class=\"string\">                          '(0861)交通运输', '(0951)农业', '(0952)兽医', '(0953)风景园林', '(0954)林业', '(1051)临床医学',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1052)口腔医学', '(1053)公共卫生', '(1054)护理', '(1055)药学', '(1056)中药学', '(1057)中医',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1151)军事', '(1251)工商管理', '(1252)公共管理', '(1253)会计', '(1254)旅游管理', '(1255)图书情报',</span></span><br><span class=\"line\"><span class=\"string\">                          '(1256)工程管理', '(1351)艺术']</span></span><br><span class=\"line\"><span class=\"string\">                学术学位：</span></span><br><span class=\"line\"><span class=\"string\">                (01)哲学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0101)哲学']</span></span><br><span class=\"line\"><span class=\"string\">                (02)经济学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0201)理论经济学', '(0202)应用经济学', '(0270)统计学']</span></span><br><span class=\"line\"><span class=\"string\">                (03)法学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0301)法学', '(0302)政治学', '(0303)社会学', '(0304)民族学', '(0305)马克思主义理论', '(0306)公安学']</span></span><br><span class=\"line\"><span class=\"string\">                (04)教育学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0401)教育学', '(0402)心理学', '(0403)体育学', '(0471)']</span></span><br><span class=\"line\"><span class=\"string\">                (05)文学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0501)中国语言文学', '(0502)外国语言文学', '(0503)新闻传播学']</span></span><br><span class=\"line\"><span class=\"string\">                (06)历史学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0601)考古学', '(0602)中国史', '(0603)世界史']</span></span><br><span class=\"line\"><span class=\"string\">                (07)理学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0701)数学', '(0702)物理学', '(0703)化学', '(0704)天文学', '(0705)地理学', '(0706)大气科学', '(0707)海洋科学',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0708)地球物理学', '(0709)地质学', '(0710)生物学', '(0711)系统科学', '(0712)科学技术史', '(0713)生态学', '</span></span><br><span class=\"line\"><span class=\"string\">                 (0714)统计学', '(0771)心理学', '(0772)力学', '(0773)材料科学与工程', '(0774)电子科学与技术', '(0775)计算机科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0776)环境科学与工程', '(0777)生物医学工程', '(0778)基础医学', '(0779)公共卫生与预防医学', '(0780)药学',</span></span><br><span class=\"line\"><span class=\"string\">                 '(0781)中药学', '(0782)医学技术', '(0783)护理学', '(0784)', '(0785)', '(0786)']</span></span><br><span class=\"line\"><span class=\"string\">                (08)工学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0801)力学', '(0802)机械工程', '(0803)光学工程', '(0804)仪器科学与技术', '(0805)材料科学与工程', '(0806)冶金工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0807)动力工程及工程热物理', '(0808)电气工程', '(0809)电子科学与技术', '(0810)信息与通信工程', '(0811)控制科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0812)计算机科学与技术', '(0813)建筑学', '(0814)土木工程', '(0815)水利工程', '(0816)测绘科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                '(0817)化学工程与技术', '(0818)地质资源与地质工程', '(0819)矿业工程', '(0820)石油与天然气工程', '(0821)纺织科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0822)轻工技术与工程', '(0823)交通运输工程', '(0824)船舶与海洋工程', '(0825)航空宇航科学与技术', '(0826)兵器科学与技术',</span></span><br><span class=\"line\"><span class=\"string\">                '(0827)核科学与技术', '(0828)农业工程', '(0829)林业工程', '(0830)环境科学与工程', '(0831)生物医学工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0832)食品科学与工程', '(0833)城乡规划学', '(0834)风景园林学', '(0835)软件工程', '(0836)生物工程', '(0837)安全科学与工程',</span></span><br><span class=\"line\"><span class=\"string\">                '(0838)公安技术', '(0839)网络空间安全', '(0870)科学技术史', '(0871)管理科学与工程', '(0872)设计学']</span></span><br><span class=\"line\"><span class=\"string\">                (09)农学</span></span><br><span class=\"line\"><span class=\"string\">                ['(0901)作物学', '(0902)园艺学', '(0903)农业资源与环境', '(0904)植物保护', '(0905)畜牧学', '(0906)兽医学', '(0907)林学',</span></span><br><span class=\"line\"><span class=\"string\">                '(0908)水产', '(0909)草学', '(0970)科学技术史', '(0971)环境科学与工程', '(0972)食品科学与工程', '(0973)风景园林学']</span></span><br><span class=\"line\"><span class=\"string\">                (10)医学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1001)基础医学', '(1002)临床医学', '(1003)口腔医学', '(1004)公共卫生与预防医学', '(1005)中医学', '(1006)中西医结合',</span></span><br><span class=\"line\"><span class=\"string\">                '(1007)药学', '(1008)中药学', '(1009)特种医学', '(1010)医学技术', '(1011)护理学', '(1071)科学技术史', '(1072)生物医学工程',</span></span><br><span class=\"line\"><span class=\"string\">                 '(1073)', '(1074)']</span></span><br><span class=\"line\"><span class=\"string\">                (11)军事学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1101)军事思想及军事历史', '(1102)战略学', '(1103)战役学', '(1104)战术学', '(1105)军队指挥学', '(1106)军事管理学',</span></span><br><span class=\"line\"><span class=\"string\">                '(1107)军队政治工作学', '(1108)军事后勤学', '(1109)军事装备学', '(1110)军事训练学']</span></span><br><span class=\"line\"><span class=\"string\">                (12)管理学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1201)管理科学与工程', '(1202)工商管理', '(1203)农林经济管理', '(1204)公共管理', '(1205)图书情报与档案管理']</span></span><br><span class=\"line\"><span class=\"string\">                (13)艺术学</span></span><br><span class=\"line\"><span class=\"string\">                ['(1301)艺术学理论', '(1302)音乐与舞蹈学', '(1303)戏剧与影视学', '(1304)美术学', '(1305)设计学']</span></span><br><span class=\"line\"><span class=\"string\">            \"\"\"</span></span><br><span class=\"line\">                  <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"请根据上方对应关系输入城市代码、门类类别代码、学科类别代码进行图表生成：\"</span>.center(<span class=\"number\">50</span>, <span class=\"string\">'-'</span>))</span><br><span class=\"line\">            print(<span class=\"string\">\"例如:41 zyxw 0854 将会查询 河南省 专业学位 电子信息 的相关信息\"</span>.center(<span class=\"number\">60</span>, <span class=\"string\">'-'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">            url = <span class=\"string\">\"https://yz.chsi.com.cn/zsml/queryAction.do\"</span></span><br><span class=\"line\">            count = str(input(<span class=\"string\">\"请输入城市代码： \"</span>)).strip()</span><br><span class=\"line\">            mldm = str(input(<span class=\"string\">\"请输入门类类别代码： \"</span>)).strip()</span><br><span class=\"line\">            yjxkdm = str(input(<span class=\"string\">\"请输入学科类别代码： \"</span>)).strip()</span><br><span class=\"line\">            crawler = CSCrawler(url, yjxkdm)</span><br><span class=\"line\">            crawler.ResearchDirection(count,mldm)</span><br><span class=\"line\">            print(<span class=\"string\">\"正在收集数据...\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(code == str(<span class=\"number\">3</span>)):</span><br><span class=\"line\">            print(<span class=\"string\">\"正在记载目标院校对应专业的研究方向与拟招生人数情况的程序...\"</span>)</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"\"</span></span><br><span class=\"line\">                  <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        请分行输入完整的学校名称与学科类别代码，如：</span></span><br><span class=\"line\"><span class=\"string\">            学校名称：北京大学</span></span><br><span class=\"line\"><span class=\"string\">            专业类别代码：0202\"\"\"</span></span><br><span class=\"line\">                  )</span><br><span class=\"line\">            schoolname = str(input(<span class=\"string\">\"请输入学校名称： \"</span>)).strip()</span><br><span class=\"line\">            yjxkdm = str(input(<span class=\"string\">\"请输入学科类别代码： \"</span>)).strip()</span><br><span class=\"line\">            url = <span class=\"string\">\"https://yz.chsi.com.cn/zsml/queryAction.do\"</span></span><br><span class=\"line\">            crawler = CSCrawler(url, yjxkdm)</span><br><span class=\"line\">            crawler.RDsBySchoolName(schoolname)</span><br><span class=\"line\"></span><br><span class=\"line\">            print(<span class=\"string\">\"正在收集数据...\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(code == str(<span class=\"number\">4</span>)):</span><br><span class=\"line\">            print(<span class=\"string\">\"正在退出...\"</span>)</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"对不起，暂不支持此操作！请重新输入...\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>SchoolMapByPyEcharts.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># encoding: utf-8</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">@author: Brian</span></span><br><span class=\"line\"><span class=\"string\">@file: SchoolMapByPyEcharts.py</span></span><br><span class=\"line\"><span class=\"string\">@time: 2020/6/26 15:06</span></span><br><span class=\"line\"><span class=\"string\">@desc: 重新选择爬取方法，更好的为可视化提供数据</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.chrome.options <span class=\"keyword\">import</span> Options</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> Select</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts <span class=\"keyword\">import</span> options <span class=\"keyword\">as</span> opts</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts.charts <span class=\"keyword\">import</span> Map</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts.commons.utils <span class=\"keyword\">import</span> JsCode</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SchoolMap</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, url, mldm, yjxkdm)</span>:</span></span><br><span class=\"line\">        self.url = url</span><br><span class=\"line\">        self.mldm = mldm</span><br><span class=\"line\">        self.yjxkdm = yjxkdm</span><br><span class=\"line\">        self.FlagOfProcess = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 配置 driver</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_driver</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        chrome_options = Options()</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--headless\"</span>)</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--disable-gpu\"</span>)</span><br><span class=\"line\">        driver = webdriver.Chrome(executable_path=<span class=\"string\">\"E:/Program Files/chromedriver_win32/chromedriver.exe\"</span>,</span><br><span class=\"line\">                                  chrome_options=chrome_options)</span><br><span class=\"line\">        driver.get(self.url)</span><br><span class=\"line\">        driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 将设置屏幕大小独立出来，方便每次跳转完使用</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_height_width</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        width = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollWidth\"</span>)</span><br><span class=\"line\">        height = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollHeight\"</span>)</span><br><span class=\"line\">        driver.set_window_size(width, height)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 如果需要翻页就翻页</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">paging</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">        li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前页面翻页元素长度：\" + str(len(li)))</span></span><br><span class=\"line\">        <span class=\"comment\"># 第一页右下角的标签数量最大为10，小于10时没有 Go 输入跳转框</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(len(li) &lt; <span class=\"number\">10</span>):</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-2</span>].text)</span><br><span class=\"line\">        <span class=\"comment\"># print(pagenumber)</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-3</span>].text)</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前页数：\" + str(pagenumber))</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pagenumber</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 复选框条件选择，通过城市，门类、学科类别来区分</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">select_option</span><span class=\"params\">(self, driver, count)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># https://selenium-python-zh.readthedocs.io/en/latest/api.html</span></span><br><span class=\"line\">        <span class=\"comment\"># 使用 Select 处理下拉框的选项</span></span><br><span class=\"line\">        <span class=\"comment\"># 先通过 Xpath 找到 select 标签，然后通过 value 找到对应值即可选择</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># print(\"当前正在选择的城市代码为： \" + count)</span></span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='ssdm']\"</span>)).select_by_value(count)</span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='mldm']\"</span>)).select_by_value(self.mldm)</span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='yjxkdm']\"</span>)).select_by_value(self.yjxkdm)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 找到查询按钮进行点击</span></span><br><span class=\"line\">            driver.find_element_by_xpath(<span class=\"string\">\"//input[@name='button']\"</span>).click()</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 点击完还是在一个 tab 里， handle 也一样</span></span><br><span class=\"line\">            <span class=\"comment\"># 条件选择完之后开始统计数量</span></span><br><span class=\"line\">            counts = self.count_city(driver)</span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"选择条件出现错误，请检查门类代码与学科类别代码对应关系是否正确！程序即将退出...\"</span>.rjust(<span class=\"number\">50</span>, <span class=\"string\">'*'</span>))</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前城市的学校数量：\" + str(counts))</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> counts</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 返回当前所选择城市开设目标专业的高校数量</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">count_city</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        counts = <span class=\"number\">0</span></span><br><span class=\"line\">        self.FlagOfProcess = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                counts = len(numbers)</span><br><span class=\"line\">            <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                self.FlagOfProcess = <span class=\"literal\">False</span></span><br><span class=\"line\">                print(<span class=\"string\">\"查找失败，请检查当前页面是否为空！\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> (pagenumber &lt; <span class=\"number\">7</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                counts += len(numbers)</span><br><span class=\"line\">                ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 下一页按钮位置不同,用 Go</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>  <span class=\"comment\"># 下一次要Go的页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                <span class=\"comment\"># 定位页码</span></span><br><span class=\"line\">                counts += len(numbers)</span><br><span class=\"line\">                driver.find_element_by_css_selector(<span class=\"string\">\"#goPageNo\"</span>).send_keys(str(flag))  <span class=\"comment\"># 输入页码跳转</span></span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='page-btn']\"</span>).click()  <span class=\"comment\"># 点击 Go，仍然同是一个 window_handle</span></span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">                flag += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> counts</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 返回所有城市代码，然后遍历城市，得到高校数量</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">select_major</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 记录所有的城市代码</span></span><br><span class=\"line\">        city_value = []</span><br><span class=\"line\">        <span class=\"comment\"># 记录所有城市名字</span></span><br><span class=\"line\">        city_name = []</span><br><span class=\"line\">        <span class=\"comment\"># 城市的高校数量</span></span><br><span class=\"line\">        school_counts = []</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> len(driver.window_handles) == <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 选择省市</span></span><br><span class=\"line\">        options = driver.find_element_by_css_selector(<span class=\"string\">\"#ssdm\"</span>)</span><br><span class=\"line\">        option = options.find_elements_by_xpath(<span class=\"string\">\"option\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> city <span class=\"keyword\">in</span> option[<span class=\"number\">1</span>::]:</span><br><span class=\"line\">            city_name.append(city.get_attribute(<span class=\"string\">\"textContent\"</span>))</span><br><span class=\"line\">            city_value.append(city.get_attribute(<span class=\"string\">\"value\"</span>))</span><br><span class=\"line\">        <span class=\"comment\"># print(city_name, city_value)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 遍历城市代码，传入统计高校数量的函数</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> city_value:</span><br><span class=\"line\">            counts = self.select_option(driver, count)</span><br><span class=\"line\">            school_counts.append(counts)</span><br><span class=\"line\">        <span class=\"comment\"># print(school_counts)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        driver.close()</span><br><span class=\"line\">        driver.quit()</span><br><span class=\"line\">        print(<span class=\"string\">\"正在准备绘制图表...\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> city_name, school_counts</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 数据可视化</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">visulize</span><span class=\"params\">(self, city_name, school_counts,)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(self.FlagOfProcess):</span><br><span class=\"line\">            realcity = []</span><br><span class=\"line\">            <span class=\"comment\"># 处理城市名，只保留两字或三字名称</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> citys <span class=\"keyword\">in</span> city_name:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"string\">\"黑龙江\"</span> <span class=\"keyword\">in</span> citys:</span><br><span class=\"line\">                    a = <span class=\"string\">\"黑龙江\"</span></span><br><span class=\"line\">                <span class=\"keyword\">elif</span> <span class=\"string\">\"内蒙古\"</span> <span class=\"keyword\">in</span> citys:</span><br><span class=\"line\">                    a = <span class=\"string\">\"内蒙古\"</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    a = citys[<span class=\"number\">4</span>:<span class=\"number\">6</span>]</span><br><span class=\"line\">                realcity.append(a)</span><br><span class=\"line\">            <span class=\"comment\"># print(realcity)</span></span><br><span class=\"line\">            <span class=\"comment\"># 将数据处理成列表</span></span><br><span class=\"line\">            list1 = [[realcity[i], school_counts[i]] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(realcity))]</span><br><span class=\"line\">            <span class=\"comment\"># print(list1)</span></span><br><span class=\"line\"></span><br><span class=\"line\">            map_1 = Map()</span><br><span class=\"line\">            map_1.set_global_opts(</span><br><span class=\"line\">                title_opts=opts.TitleOpts(title=<span class=\"string\">\"2020高校分布\"</span>),</span><br><span class=\"line\">                visualmap_opts=opts.VisualMapOpts(max_=<span class=\"number\">40</span>)  <span class=\"comment\"># 最大数据范围</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            map_1.add(<span class=\"string\">\"2020高校分布\"</span>, list1, maptype=<span class=\"string\">\"china\"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># map_1.add_js_funcs(\"window.confirm()\")</span></span><br><span class=\"line\">            map_1.render(<span class=\"string\">'SchoolMap.html'</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"绘制成功，请在同级目录下查看 SchoolMap.html 文件！\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"出现错误，停止绘制图表！\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>ResearchDirectionsByPyEcharts.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># encoding: utf-8</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">@author: Brian</span></span><br><span class=\"line\"><span class=\"string\">@file: ResearchDirectionsByPyEcharts.py</span></span><br><span class=\"line\"><span class=\"string\">@time: 2020/6/27 15:38</span></span><br><span class=\"line\"><span class=\"string\">@desc: 对每个城市的高校开设的研究方向进行处理，并打印结果中的985&amp;211院校</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.chrome.options <span class=\"keyword\">import</span> Options</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> Select</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts.charts <span class=\"keyword\">import</span> Line</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts <span class=\"keyword\">import</span> options <span class=\"keyword\">as</span> opts</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReserachDirections</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, url, count, mldm, yjxkdm)</span>:</span></span><br><span class=\"line\">        self.url = url</span><br><span class=\"line\">        self.count = count</span><br><span class=\"line\">        self.mldm = mldm</span><br><span class=\"line\">        self.yjxkdm = yjxkdm</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 配置 driver</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_driver</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        chrome_options = Options()</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--headless\"</span>)</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--disable-gpu\"</span>)</span><br><span class=\"line\">        driver = webdriver.Chrome(executable_path=<span class=\"string\">\"E:/Program Files/chromedriver_win32/chromedriver.exe\"</span>,</span><br><span class=\"line\">                                  chrome_options=chrome_options)</span><br><span class=\"line\">        driver.get(self.url)</span><br><span class=\"line\">        driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 将设置屏幕大小独立出来，方便每次跳转完使用</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_height_width</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        width = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollWidth\"</span>)</span><br><span class=\"line\">        height = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollHeight\"</span>)</span><br><span class=\"line\">        driver.set_window_size(width, height)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 如果需要翻页就翻页</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">paging</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">        li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前页面翻页元素长度：\" + str(len(li)))</span></span><br><span class=\"line\">        <span class=\"comment\"># 第一页右下角的标签数量最大为10，小于10时没有 Go 输入跳转框</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(len(li) &lt; <span class=\"number\">10</span>):</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-2</span>].text)</span><br><span class=\"line\">        <span class=\"comment\"># print(pagenumber)</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-3</span>].text)</span><br><span class=\"line\">        print(<span class=\"string\">\"当前页数：\"</span> + str(pagenumber))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pagenumber</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 获得当前条件下的所有高校名称,返回名称列表</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_school_name</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        name_list = []</span><br><span class=\"line\">        major_numbers_list = []</span><br><span class=\"line\">        number_list = []</span><br><span class=\"line\">        original_window = driver.current_window_handle</span><br><span class=\"line\">        flag = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(numbers)+<span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    school_name = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[1]//form[1]//a[1]\"</span>.format(line)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                    print(school_name)</span><br><span class=\"line\">                    name_list.append(school_name)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 跳转到每个学校对应的研究方向信息页面</span></span><br><span class=\"line\">                    driver.find_element_by_link_text(school_name).click()</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> window_handle <span class=\"keyword\">in</span> driver.window_handles:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> window_handle != original_window:</span><br><span class=\"line\">                            driver.switch_to.window(window_handle)</span><br><span class=\"line\">                            <span class=\"keyword\">break</span></span><br><span class=\"line\">                    driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 得到该学校各个研究方向的列表</span></span><br><span class=\"line\">                    major_list ,number = self.get_major_info(driver)</span><br><span class=\"line\">                    major_numbers_list.append(major_list)</span><br><span class=\"line\">                    number_list.append(number)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 关闭信息页面，转到学校列表页面</span></span><br><span class=\"line\">                    driver.close()</span><br><span class=\"line\">                    driver.switch_to.window(original_window)</span><br><span class=\"line\">                    driver = self.set_height_width(driver)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                    flag = <span class=\"literal\">False</span></span><br><span class=\"line\">                    print(<span class=\"string\">\"查找失败，请检查当前页面是否为空！\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> (pagenumber &lt; <span class=\"number\">7</span>):</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                numbers = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(numbers)+<span class=\"number\">1</span>):</span><br><span class=\"line\">                    school_name = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[1]//form[1]//a[1]\"</span>.format(line)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                    name_list.append(school_name)</span><br><span class=\"line\">                    print(school_name)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 跳转到每个学校对应的研究方向信息页面</span></span><br><span class=\"line\">                    driver.find_element_by_link_text(school_name).click()</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> window_handle <span class=\"keyword\">in</span> driver.window_handles:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> window_handle != original_window:</span><br><span class=\"line\">                            driver.switch_to.window(window_handle)</span><br><span class=\"line\">                            <span class=\"keyword\">break</span></span><br><span class=\"line\">                    driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 得到该学校各个研究方向的列表</span></span><br><span class=\"line\">                    major_list, number = self.get_major_info(driver)</span><br><span class=\"line\">                    major_numbers_list.append(major_list)</span><br><span class=\"line\">                    number_list.append(number)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 关闭信息页面，转到学校列表页面</span></span><br><span class=\"line\">                    driver.close()</span><br><span class=\"line\">                    driver.switch_to.window(original_window)</span><br><span class=\"line\">                    driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">                ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># print(name_list)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> name_list, major_numbers_list, number_list, flag</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 获得某个院校在目标专业下的研究方向的数量，返回数量列表</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_info</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 当前 Tab 里有多少个页面</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        majors = <span class=\"number\">0</span></span><br><span class=\"line\">        all_number = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 定位跳转</span></span><br><span class=\"line\">        css_selector_jumpto = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-row.clearfix \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-page-box ul.ch-page \"</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">            major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">            majors += len(major)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(<span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                    numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                    all_number += int(numbers)</span><br><span class=\"line\">                    print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(pagenumber &lt; <span class=\"number\">7</span> ):</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                            number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(</span><br><span class=\"line\">                                <span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                            numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                            print(<span class=\"string\">\"  拟招生：\"</span> + numbers)</span><br><span class=\"line\">                            all_number += int(numbers)</span><br><span class=\"line\">                        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                            print(e)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        print(e)</span><br><span class=\"line\">                ul = driver.find_element_by_css_selector(css_selector_jumpto)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 下一页按钮位置不同,用 Go</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>  <span class=\"comment\"># 下一次要Go的页码</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    print(<span class=\"string\">\"这一页的专业数量\"</span> + str(len(major)))</span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">                driver.find_element_by_css_selector(<span class=\"string\">\"#goPageNo\"</span>).send_keys(str(flag))  <span class=\"comment\"># 输入页码跳转</span></span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='page-btn']\"</span>).click()  <span class=\"comment\"># 点击 Go，仍然同是一个 window_handle</span></span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\">                flag +=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># print(len(major_list))</span></span><br><span class=\"line\">        print(<span class=\"string\">\"专业数量： \"</span> + str(majors))</span><br><span class=\"line\">        print(<span class=\"string\">\"  共招生: \"</span> + str(all_number))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> majors, all_number</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 复选框条件选择，选择城市、门类、学科类别</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">select_option</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">        school_list = []</span><br><span class=\"line\">        flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        list_211 = [<span class=\"string\">'清华大学'</span>, <span class=\"string\">'北京大学'</span>, <span class=\"string\">'中国人民大学'</span>, <span class=\"string\">'北京工业大学'</span>, <span class=\"string\">'北京理工大学'</span>, <span class=\"string\">'北京航空航天大学'</span>, <span class=\"string\">'北京化工大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'北京邮电大学'</span>, <span class=\"string\">'对外经济贸易大学'</span>, <span class=\"string\">'中国传媒大学'</span>, <span class=\"string\">'中央民族大学'</span>, <span class=\"string\">'中国矿业大学'</span>, <span class=\"string\">'中央财经大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'中国政法大学'</span>, <span class=\"string\">'中央音乐学院'</span>, <span class=\"string\">'北京体育大学'</span>, <span class=\"string\">'北京外国语大学'</span>, <span class=\"string\">'北京交通大学'</span>, <span class=\"string\">'北京科技大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'北京林业大学'</span>, <span class=\"string\">'中国农业大学'</span>, <span class=\"string\">'北京中医药大学'</span>, <span class=\"string\">'华北电力大学'</span>, <span class=\"string\">'北京师范大学'</span>, <span class=\"string\">'中国地质大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'复旦大学'</span>, <span class=\"string\">'华东师范大学'</span>, <span class=\"string\">'上海外国语大学'</span>, <span class=\"string\">'上海大学'</span>, <span class=\"string\">'同济大学'</span>, <span class=\"string\">'华东理工大学'</span>, <span class=\"string\">'东华大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'上海财经大学'</span>, <span class=\"string\">'上海交通大学'</span>, <span class=\"string\">'南开大学'</span>, <span class=\"string\">'天津大学'</span>, <span class=\"string\">'天津医科大学'</span>, <span class=\"string\">'河北工业大学'</span>, <span class=\"string\">'重庆大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'西南大学'</span>, <span class=\"string\">'太原理工大学'</span>, <span class=\"string\">'内蒙古大学'</span>, <span class=\"string\">'大连理工大学'</span>, <span class=\"string\">'东北大学'</span>, <span class=\"string\">'辽宁大学'</span>, <span class=\"string\">'大连海事大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'吉林大学'</span>, <span class=\"string\">'东北师范大学'</span>, <span class=\"string\">'延边大学'</span>, <span class=\"string\">'东北农业大学'</span>, <span class=\"string\">'东北林业大学'</span>, <span class=\"string\">'哈尔滨工业大学'</span>, <span class=\"string\">'哈尔滨工程大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'南京大学'</span>, <span class=\"string\">'东南大学'</span>, <span class=\"string\">'苏州大学'</span>, <span class=\"string\">'河海大学'</span>, <span class=\"string\">'中国药科大学'</span>, <span class=\"string\">'南京师范大学'</span>, <span class=\"string\">'南京理工大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'南京航空航天大学'</span>, <span class=\"string\">'江南大学'</span>, <span class=\"string\">'南京农业大学'</span>, <span class=\"string\">'浙江大学'</span>, <span class=\"string\">'安徽大学'</span>, <span class=\"string\">'合肥工业大学'</span>, <span class=\"string\">'中国科学技术大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'厦门大学'</span>, <span class=\"string\">'福州大学'</span>, <span class=\"string\">'南昌大学'</span>, <span class=\"string\">'山东大学'</span>, <span class=\"string\">'中国海洋大学'</span>, <span class=\"string\">'中国石油大学'</span>, <span class=\"string\">'郑州大学'</span>, <span class=\"string\">'武汉大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'华中科技大学'</span>, <span class=\"string\">'华中师范大学'</span>, <span class=\"string\">'华中农业大学'</span>, <span class=\"string\">'中南财经政法大学'</span>, <span class=\"string\">'武汉理工大学'</span>, <span class=\"string\">'湖南大学'</span>, <span class=\"string\">'中南大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'湖南师范大学'</span>, <span class=\"string\">'中山大学'</span>, <span class=\"string\">'暨南大学'</span>, <span class=\"string\">'华南理工大学'</span>, <span class=\"string\">'华南师范大学'</span>, <span class=\"string\">'广西大学'</span>, <span class=\"string\">'四川大学'</span>, <span class=\"string\">'西南交通大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'电子科技大学'</span>, <span class=\"string\">'西南财经大学'</span>, <span class=\"string\">'四川农业大学'</span>, <span class=\"string\">'云南大学'</span>, <span class=\"string\">'贵州大学'</span>, <span class=\"string\">'西北大学'</span>, <span class=\"string\">'西安交通大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'西北工业大学'</span>, <span class=\"string\">'陕西师范大学'</span>, <span class=\"string\">'西北农林科大'</span>, <span class=\"string\">'西安电子科技大学'</span>, <span class=\"string\">'长安大学'</span>, <span class=\"string\">'兰州大学'</span>, <span class=\"string\">'新疆大学'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'石河子大学'</span>, <span class=\"string\">'海南大学'</span>, <span class=\"string\">'宁夏大学'</span>, <span class=\"string\">'青海大学'</span>, <span class=\"string\">'西藏大学'</span>, <span class=\"string\">'第二军医大学'</span>, <span class=\"string\">'第四军医大学'</span>, <span class=\"string\">'国防科学技术大学'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># https://selenium-python-zh.readthedocs.io/en/latest/api.html</span></span><br><span class=\"line\">        <span class=\"comment\"># 使用 Select 处理下拉框的选项</span></span><br><span class=\"line\">        <span class=\"comment\"># 先通过 Xpath 找到 select 标签，然后通过 value 找到对应值即可选择</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># print(\"当前正在选择的城市代码为： \" + self.count)</span></span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='ssdm']\"</span>)).select_by_value(self.count)</span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='mldm']\"</span>)).select_by_value(self.mldm)</span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='yjxkdm']\"</span>)).select_by_value(self.yjxkdm)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 找到查询按钮进行点击,进入高校列表界面</span></span><br><span class=\"line\">            <span class=\"comment\"># 点击完还是在一个 tab 里， handle 也一样</span></span><br><span class=\"line\">            driver.find_element_by_xpath(<span class=\"string\">\"//input[@name='button']\"</span>).click()</span><br><span class=\"line\">            self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 得到高校列表</span></span><br><span class=\"line\">            school_name_list, major_numbers_list, number_list, flag= self.get_school_name(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> school <span class=\"keyword\">in</span> school_name_list:</span><br><span class=\"line\">                school = school[<span class=\"number\">7</span>::]</span><br><span class=\"line\">                school_list.append(school)</span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"选择条件出现错误，请检查门类代码与学科类别代码对应关系是否正确！程序即将退出...\"</span>.rjust(<span class=\"number\">50</span>, <span class=\"string\">'*'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        empty = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> school_list:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> list_211:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> i == j:</span><br><span class=\"line\"></span><br><span class=\"line\">                    empty.append(i)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">        print(<span class=\"string\">\"当前条件下，985&amp;211 院校有：\"</span>)</span><br><span class=\"line\">        print(empty)</span><br><span class=\"line\"></span><br><span class=\"line\">        driver.close()</span><br><span class=\"line\">        driver.quit()</span><br><span class=\"line\">        <span class=\"comment\"># print(school_list, major_numbers_list, number_list)</span></span><br><span class=\"line\">        <span class=\"comment\"># ['黑龙江大学', '哈尔滨工业大学', '哈尔滨理工大学', '哈尔滨工程大学', '黑龙江科技大学', '东北石油大学', '黑龙江八一农垦大学', '东北林业大学', '哈尔滨师范大学', '齐齐哈尔大学']</span></span><br><span class=\"line\">        <span class=\"comment\">#  [8, 21, 15, 59, 6, 10, 2, 3, 10, 6]</span></span><br><span class=\"line\">        <span class=\"comment\">#  [78, 1549, 123, 201, 153, 149, 331, 221, 115, 520]</span></span><br><span class=\"line\"></span><br><span class=\"line\">        print(<span class=\"string\">\"正在准备绘制图表...\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> school_name_list, major_numbers_list, number_list, flag</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">stacked_area_chart</span><span class=\"params\">(self, x_data, y1_data, y2_data, flag)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag):</span><br><span class=\"line\">            (</span><br><span class=\"line\">                Line()</span><br><span class=\"line\">                    .add_xaxis(xaxis_data=x_data)</span><br><span class=\"line\">                    .add_yaxis(</span><br><span class=\"line\">                    series_name=<span class=\"string\">\"研究方向数量\"</span>,</span><br><span class=\"line\">                    stack=<span class=\"string\">\"总量\"</span>,</span><br><span class=\"line\">                    y_axis=y1_data,</span><br><span class=\"line\">                    areastyle_opts=opts.AreaStyleOpts(opacity=<span class=\"number\">0.5</span>),</span><br><span class=\"line\">                    label_opts=opts.LabelOpts(is_show=<span class=\"literal\">False</span>),</span><br><span class=\"line\">                )</span><br><span class=\"line\">                    .add_yaxis(</span><br><span class=\"line\">                    series_name=<span class=\"string\">\"拟招生人数\"</span>,</span><br><span class=\"line\">                    stack=<span class=\"string\">\"总量\"</span>,</span><br><span class=\"line\">                    y_axis=y2_data,</span><br><span class=\"line\">                    areastyle_opts=opts.AreaStyleOpts(opacity=<span class=\"number\">0.5</span>),</span><br><span class=\"line\">                    label_opts=opts.LabelOpts(is_show=<span class=\"literal\">False</span>),</span><br><span class=\"line\">                )</span><br><span class=\"line\"></span><br><span class=\"line\">                    .set_global_opts(</span><br><span class=\"line\">                    title_opts=opts.TitleOpts(title=<span class=\"string\">\"高校研究方向折线图\"</span>),</span><br><span class=\"line\">                    tooltip_opts=opts.TooltipOpts(trigger=<span class=\"string\">\"axis\"</span>, axis_pointer_type=<span class=\"string\">\"cross\"</span>),</span><br><span class=\"line\">                    yaxis_opts=opts.AxisOpts(</span><br><span class=\"line\">                        type_=<span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">                        axistick_opts=opts.AxisTickOpts(is_show=<span class=\"literal\">True</span>),</span><br><span class=\"line\">                        splitline_opts=opts.SplitLineOpts(is_show=<span class=\"literal\">True</span>),</span><br><span class=\"line\">                    ),</span><br><span class=\"line\"></span><br><span class=\"line\">                    xaxis_opts=opts.AxisOpts(type_=<span class=\"string\">\"category\"</span>, boundary_gap=<span class=\"literal\">False</span>, name_rotate=<span class=\"number\">60</span>, name_gap=<span class=\"number\">20</span>),</span><br><span class=\"line\">                )</span><br><span class=\"line\">                    .render(<span class=\"string\">\"ReserachDirections.html\"</span>)</span><br><span class=\"line\">            )</span><br><span class=\"line\">            print(<span class=\"string\">\"绘制成功，请在同级目录下查看 ReserachDirections.html 文件！\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"出现错误，停止绘制图表！\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>RDsBySchoolName.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># encoding: utf-8</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">@author: Brian</span></span><br><span class=\"line\"><span class=\"string\">@file: RDsBySchoolName.py</span></span><br><span class=\"line\"><span class=\"string\">@time: 2020/7/1 14:20</span></span><br><span class=\"line\"><span class=\"string\">@desc: 通过学校名字来获得相关信息</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.chrome.options <span class=\"keyword\">import</span> Options</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> Select</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts.charts <span class=\"keyword\">import</span> Line</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts.charts <span class=\"keyword\">import</span> Bar</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyecharts <span class=\"keyword\">import</span> options <span class=\"keyword\">as</span> opts</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RDsBySchoolName</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, url, schoolname, yjxkdm)</span>:</span></span><br><span class=\"line\">        self.url = url</span><br><span class=\"line\">        self.schoolname = schoolname</span><br><span class=\"line\">        self.yjxkdm = yjxkdm</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 配置 driver</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_driver</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        chrome_options = Options()</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--headless\"</span>)</span><br><span class=\"line\">        chrome_options.add_argument(<span class=\"string\">\"--disable-gpu\"</span>)</span><br><span class=\"line\">        driver = webdriver.Chrome(executable_path=<span class=\"string\">\"E:/Program Files/chromedriver_win32/chromedriver.exe\"</span>,</span><br><span class=\"line\">                                  chrome_options=chrome_options)</span><br><span class=\"line\">        driver.get(self.url)</span><br><span class=\"line\">        driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 将设置屏幕大小独立出来，方便每次跳转完使用</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">set_height_width</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        width = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollWidth\"</span>)</span><br><span class=\"line\">        height = driver.execute_script(<span class=\"string\">\"return document.documentElement.scrollHeight\"</span>)</span><br><span class=\"line\">        driver.set_window_size(width, height)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> driver</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 如果需要翻页就翻页</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">paging</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='ch-page']\"</span>)</span><br><span class=\"line\">        li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前页面翻页元素长度：\" + str(len(li)))</span></span><br><span class=\"line\">        <span class=\"comment\"># 第一页右下角的标签数量最大为10，小于10时没有 Go 输入跳转框</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(len(li) &lt; <span class=\"number\">10</span>):</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-2</span>].text)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            pagenumber = int(li[<span class=\"number\">-3</span>].text)</span><br><span class=\"line\">        <span class=\"comment\"># print(\"当前页面页数：\" + str(pagenumber))</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pagenumber</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 通过学校名与专业选择学校</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">select_school</span><span class=\"params\">(self, driver,)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 专业列表,研究方向数量列表，拟招生人数列表</span></span><br><span class=\"line\">        label_list = []</span><br><span class=\"line\">        major_number_list = []</span><br><span class=\"line\">        admission_list = []</span><br><span class=\"line\">        original_window = driver.current_window_handle</span><br><span class=\"line\">        flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            driver.find_element_by_xpath(<span class=\"string\">\"//input[@id='dwmc']\"</span>).send_keys(self.schoolname)</span><br><span class=\"line\">            Select(driver.find_element_by_xpath(<span class=\"string\">\"//select[@id='yjxkdm']\"</span>)).select_by_value(self.yjxkdm)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 找到查询按钮进行点击,进入高校列表界面</span></span><br><span class=\"line\">            <span class=\"comment\"># 点击完还是在一个 tab 里， handle 也一样</span></span><br><span class=\"line\">            driver.find_element_by_xpath(<span class=\"string\">\"//input[@name='button']\"</span>).click()</span><br><span class=\"line\"></span><br><span class=\"line\">            school_name = driver.find_element_by_xpath(<span class=\"string\">\"//tr[1]//td[1]//form[1]//a[1]\"</span>).get_attribute(</span><br><span class=\"line\">                <span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">            print(school_name)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 跳转到每个学校对应的研究方向信息页面</span></span><br><span class=\"line\">            driver.find_element_by_link_text(school_name).click()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> window_handle <span class=\"keyword\">in</span> driver.window_handles:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> window_handle != original_window:</span><br><span class=\"line\">                    driver.switch_to.window(window_handle)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">            driver = self.set_height_width(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">            label_list, major_number_list, admission_list = self.get_major_list(driver)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            flag = <span class=\"literal\">False</span></span><br><span class=\"line\">            print(<span class=\"string\">\"选择条件出现错误，请检查学校名称与学科类别代码是否正确，或是该院校未开设该专业！程序即将退出...\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        driver.close()</span><br><span class=\"line\">        driver.quit()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> label_list, major_number_list, admission_list, flag</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_list</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        major_number_list = []</span><br><span class=\"line\">        admission_list = []</span><br><span class=\"line\">        label_list = []</span><br><span class=\"line\">        value_list = []</span><br><span class=\"line\"></span><br><span class=\"line\">        ul = driver.find_element_by_xpath(<span class=\"string\">\"//ul[@class='zsml-zy-filter']\"</span>)</span><br><span class=\"line\">        li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">        print(<span class=\"string\">\"当前院校专业数量：\"</span> + str(len(li)))</span><br><span class=\"line\"></span><br><span class=\"line\">        input_selector = <span class=\"string\">\"/html[1]/body[1]/div[2]/div[3]/div[1]/div[2]/div[2]/form[1]/ul[1]/li[&#123;&#125;]/input[1]\"</span></span><br><span class=\"line\">        label_selector = <span class=\"string\">\"/html[1]/body[1]/div[2]/div[3]/div[1]/div[2]/div[2]/form[1]/ul[1]/li[&#123;&#125;]/label[1]\"</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> check_box <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(li)+<span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                value = driver.find_element_by_xpath(input_selector.format(check_box)).get_attribute(<span class=\"string\">\"value\"</span>)</span><br><span class=\"line\">                label = driver.find_element_by_xpath(label_selector.format(check_box)).get_attribute(<span class=\"string\">\"textContent\"</span>)</span><br><span class=\"line\">                driver.find_element_by_xpath(input_selector.format(check_box)).click()</span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='blue-btn-s']\"</span>).click()</span><br><span class=\"line\">                label_list.append(label)</span><br><span class=\"line\">                value_list.append(value)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 得到每个专业下的研究方向数量与拟招生人数</span></span><br><span class=\"line\">                majors, all_number = self.get_major_info(driver)</span><br><span class=\"line\">                major_number_list.append(majors)</span><br><span class=\"line\">                admission_list.append(all_number)</span><br><span class=\"line\"></span><br><span class=\"line\">                print(<span class=\"string\">\" 当前专业：\"</span> + label)</span><br><span class=\"line\">                print(<span class=\"string\">\" 研究方向数量： \"</span> + str(majors), <span class=\"string\">\"拟招生人数： \"</span> + str(all_number))</span><br><span class=\"line\">                <span class=\"comment\"># 两次点击取消选择</span></span><br><span class=\"line\">                driver.find_element_by_xpath(input_selector.format(check_box)).click()</span><br><span class=\"line\">                driver.find_element_by_xpath(<span class=\"string\">\"//input[@class='blue-btn-s']\"</span>).click()</span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                print(e)</span><br><span class=\"line\">        print(value_list, label_list)</span><br><span class=\"line\">        print(major_number_list, admission_list)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> label_list, major_number_list, admission_list</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 得到研究方向数量与拟招生人数</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_major_info</span><span class=\"params\">(self, driver)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># 当前 Tab 里有多少个页面</span></span><br><span class=\"line\">        pagenumber = self.paging(driver)</span><br><span class=\"line\">        majors = <span class=\"number\">0</span></span><br><span class=\"line\">        all_number = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 定位跳转</span></span><br><span class=\"line\">        css_selector_jumpto = <span class=\"string\">\"body.ch-sticky:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.main-wrapper:nth-child(2) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.container.clearfix:nth-child(5) \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-row.clearfix \"</span> \\</span><br><span class=\"line\">                              <span class=\"string\">\"div.zsml-page-box ul.ch-page \"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pagenumber == <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"comment\"># 不用下一页操作</span></span><br><span class=\"line\">            major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">            majors += len(major)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(<span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                    numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                    all_number += int(numbers)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 找到下一页按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (pagenumber):</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    major = driver.find_elements_by_xpath(<span class=\"string\">\"//tbody//tr\"</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># print(\"这一页的研究方向数量\" + str(len(major)))</span></span><br><span class=\"line\">                    majors += len(major)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, len(major) + <span class=\"number\">1</span>):</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                            number = driver.find_element_by_xpath(<span class=\"string\">\"//tr[&#123;&#125;]//td[7]//a[1]\"</span>.format(i)).get_attribute(</span><br><span class=\"line\">                                <span class=\"string\">\"data-title\"</span>)</span><br><span class=\"line\">                            numbers = re.sub(<span class=\"string\">r\"[^0-9]\"</span>, <span class=\"string\">\"\"</span>, number)</span><br><span class=\"line\">                            <span class=\"comment\"># print(\"  拟招生：\" + numbers)</span></span><br><span class=\"line\">                            all_number += int(numbers)</span><br><span class=\"line\">                        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                            print(e)</span><br><span class=\"line\">                <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                    print(e)</span><br><span class=\"line\">                ul = driver.find_element_by_css_selector(css_selector_jumpto)</span><br><span class=\"line\">                li = ul.find_elements_by_xpath(<span class=\"string\">\"li\"</span>)</span><br><span class=\"line\">                li[<span class=\"number\">-1</span>].click()</span><br><span class=\"line\">                pagenumber -= <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> majors, all_number</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 数据可视化</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">stacked_area_chart</span><span class=\"params\">(self, x_data, y1_data, y2_data, flag)</span>:</span></span><br><span class=\"line\">        schoolname = self.schoolname</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag):</span><br><span class=\"line\">            (</span><br><span class=\"line\">                Bar()</span><br><span class=\"line\">                    .add_xaxis(xaxis_data=x_data)</span><br><span class=\"line\">                    .add_yaxis(<span class=\"string\">\"专业下研究方向数量\"</span>, y1_data)</span><br><span class=\"line\">                    .add_yaxis(<span class=\"string\">\"各专业拟招生人数\"</span>, y2_data)</span><br><span class=\"line\">                    .set_global_opts(</span><br><span class=\"line\">                    xaxis_opts=opts.AxisOpts(axislabel_opts=opts.LabelOpts(rotate=<span class=\"number\">-15</span>)),</span><br><span class=\"line\">                    title_opts=opts.TitleOpts(title=schoolname + <span class=\"string\">\"专业信息折线图\"</span>, subtitle=<span class=\"string\">\"下属研究方向与拟招生人数\"</span>),</span><br><span class=\"line\">                )</span><br><span class=\"line\">                    .render(<span class=\"string\">\"ReserachDirections.html\"</span>)</span><br><span class=\"line\">            )</span><br><span class=\"line\">            print(<span class=\"string\">\"绘制成功，请在同级目录下查看 ReserachDirections.html 文件！\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"出现错误，停止绘制图表！\"</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><p><a href=\"https://blog.csdn.net/J080624/article/details/84171917\" target=\"_blank\" rel=\"noopener\">AJAX-XMLHtppRequest 的前世今生</a></p>\n<p><a href=\"https://blog.csdn.net/qq_33689414/article/details/78631009\" target=\"_blank\" rel=\"noopener\">Selenium和PhantomJS介绍</a></p>\n<p><a href=\"https://programmer.group/python-crawler-8-selenium-and-phantomjs-for-dynamic-html-processing.html\" target=\"_blank\" rel=\"noopener\">Pyhon爬虫教程</a></p>\n<p><a href=\"http://pyecharts.org/#/zh-cn/intro\" target=\"_blank\" rel=\"noopener\">pyecharts官网</a></p>\n","text":"使用 Selenium 编写爬虫动态爬取网站Intro传统的浏览器请求响应方式是：我们在一个网站上点击了一个请求资源的按钮，就会对服务器发起一次请求，然后响应再返回到浏览器。该请求是一个完整的 HTML 页面，因此当浏览器用到新的 HTML 页面重绘时，可能会看到闪烁，这一方面增","link":"","raw":null,"photos":[],"categories":[{"name":"工具","slug":"工具","count":1,"path":"api/categories/工具.json"}],"tags":[{"name":"爬虫","slug":"爬虫","count":1,"path":"api/tags/爬虫.json"}]}]}