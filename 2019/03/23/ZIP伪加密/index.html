<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>ZIP&#39;s things | Hexo</title>
  <meta name="keywords" content=" zip , misc ">
  <meta name="description" content="ZIP&#39;s things | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="php 弱类型总结字符与数字的比较&amp;lt;?php  $a=1; if($a=TRUE)     echo &amp;quot;1111\n&amp;quot;; if($a=&amp;#39;a&amp;#39;)     echo &amp;quot;1111\n&amp;quot;;  结果 1111 1111联想到之前P神的文章，TRUE+TRUE=2 $_=(&amp;#39;&amp;gt;&amp;#39;&amp;gt;&amp;#39;&amp;lt;&amp;#39;)+(&amp;#3">
<meta name="keywords" content="php,弱类型">
<meta property="og:type" content="article">
<meta property="og:title" content="black_magic">
<meta property="og:url" content="https://github.com/BrainLyh/2019/08/19/Black_magic/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="php 弱类型总结字符与数字的比较&amp;lt;?php  $a=1; if($a=TRUE)     echo &amp;quot;1111\n&amp;quot;; if($a=&amp;#39;a&amp;#39;)     echo &amp;quot;1111\n&amp;quot;;  结果 1111 1111联想到之前P神的文章，TRUE+TRUE=2 $_=(&amp;#39;&amp;gt;&amp;#39;&amp;gt;&amp;#39;&amp;lt;&amp;#39;)+(&amp;#3">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-19T11:18:36.793Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="black_magic">
<meta name="twitter:description" content="php 弱类型总结字符与数字的比较&amp;lt;?php  $a=1; if($a=TRUE)     echo &amp;quot;1111\n&amp;quot;; if($a=&amp;#39;a&amp;#39;)     echo &amp;quot;1111\n&amp;quot;;  结果 1111 1111联想到之前P神的文章，TRUE+TRUE=2 $_=(&amp;#39;&amp;gt;&amp;#39;&amp;gt;&amp;#39;&amp;lt;&amp;#39;)+(&amp;#3">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/gruvbox-dark.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Luc1fer</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"></use>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/BrainLyh" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:brainsemail@163.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=12128&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=125977062" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(24)</small></div></li>
    
        
            
            <li><div data-rel="WP">WP<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="ctf">ctf<small>(14)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="渗透测试">渗透测试<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="docker">docker<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="比赛回顾">比赛回顾<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="wp">wp<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="24">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://www.gtfly.top/">gtfly</a></li>
            
            <li><a target="_blank" href="https://www.leavesongs.com/">P神</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">WP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">php</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">命令执行</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">LSB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">MISC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">隐写</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">mysql load data</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">工具</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">渗透测试</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">SQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">redis</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">ssrf</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Xdebuf</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">ctf</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">RSA</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">xxe</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">serialize</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">比赛回顾</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">弱类型</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">哈希长度扩展攻击</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">zip</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">misc</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="WP "
           href="/2018/03/23/CSAW CTF 2016 mfw Writeup/"
           data-tag="WP"
           data-author="" >
            <span class="post-title" title="CSAW CTF 2016 mfw Writeup">CSAW CTF 2016 mfw Writeup</span>
            <span class="post-date" title="2018-03-23 15:13:47">2018/03/23</span>
        </a>
        
        <a  class="ctf "
           href="/2019/03/23/Command-Execution/"
           data-tag="php,命令执行"
           data-author="" >
            <span class="post-title" title="命令执行漏洞(Command Execution)">命令执行漏洞(Command Execution)</span>
            <span class="post-date" title="2019-03-23 15:13:47">2019/03/23</span>
        </a>
        
        <a  class="WP "
           href="/2017/03/23/HackLu Flatscience WP/"
           data-tag="WP"
           data-author="" >
            <span class="post-title" title="HackLu FlatScience WP">HackLu FlatScience WP</span>
            <span class="post-date" title="2017-03-23 15:13:47">2017/03/23</span>
        </a>
        
        <a  class="ctf "
           href="/2018/03/23/LSB隐写/"
           data-tag="LSB,MISC,隐写"
           data-author="" >
            <span class="post-title" title="LSB图片隐写">LSB图片隐写</span>
            <span class="post-date" title="2018-03-23 15:13:47">2018/03/23</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/07/MySQL LOAD DATA/"
           data-tag="mysql load data"
           data-author="" >
            <span class="post-title" title="MYSQL LOAD DATA">MYSQL LOAD DATA</span>
            <span class="post-date" title="2019-08-07 22:14:02">2019/08/07</span>
        </a>
        
        <a  class="渗透测试 "
           href="/2018/02/23/Nessus使用指南/"
           data-tag="工具,渗透测试"
           data-author="" >
            <span class="post-title" title="Nessus 使用指南">Nessus 使用指南</span>
            <span class="post-date" title="2018-02-23 15:13:47">2018/02/23</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/02/SQL入门/"
           data-tag="SQL"
           data-author="" >
            <span class="post-title" title="SQL入门">SQL入门</span>
            <span class="post-date" title="2019-08-02 09:43:50">2019/08/02</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/16/SSRF/"
           data-tag="redis,ssrf"
           data-author="" >
            <span class="post-title" title="redis与ssrf">redis与ssrf</span>
            <span class="post-date" title="2019-08-16 16:11:22">2019/08/16</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/17/Xdebug/"
           data-tag="Xdebuf,ctf"
           data-author="" >
            <span class="post-title" title="Xdebug">Xdebug</span>
            <span class="post-date" title="2019-08-17 23:23:45">2019/08/17</span>
        </a>
        
        <a  class="WP "
           href="/2019/07/26/peaCTF-WP/"
           data-tag="WP,RSA"
           data-author="" >
            <span class="post-title" title="peaCTF WP">peaCTF WP</span>
            <span class="post-date" title="2019-07-26 15:13:47">2019/07/26</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/10/redis/"
           data-tag="redis,ssrf"
           data-author="" >
            <span class="post-title" title="redis与ssrf">redis与ssrf</span>
            <span class="post-date" title="2019-08-10 15:44:26">2019/08/10</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/17/xxe/"
           data-tag="xxe"
           data-author="" >
            <span class="post-title" title="xxe">xxe</span>
            <span class="post-date" title="2019-08-17 15:23:51">2019/08/17</span>
        </a>
        
        <a  class="docker "
           href="/2019/08/02/ubuntu配置docker/"
           data-tag="docker"
           data-author="" >
            <span class="post-title" title="Ubuntu 16.04 配置docker">Ubuntu 16.04 配置docker</span>
            <span class="post-date" title="2019-08-02 16:15:29">2019/08/02</span>
        </a>
        
        <a  class="ctf "
           href="/2019/03/23/序列化与反序列化/"
           data-tag="php,serialize"
           data-author="" >
            <span class="post-title" title="序列化与反序列化">序列化与反序列化</span>
            <span class="post-date" title="2019-03-23 15:13:47">2019/03/23</span>
        </a>
        
        <a  class="渗透测试 "
           href="/2018/03/23/渗透测试-信息收集/"
           data-tag="渗透测试"
           data-author="" >
            <span class="post-title" title="渗透测试-信息收集">渗透测试-信息收集</span>
            <span class="post-date" title="2018-03-23 15:13:47">2018/03/23</span>
        </a>
        
        <a  class="比赛回顾 "
           href="/2018/07/22/ISCC线下赛回顾/"
           data-tag="比赛回顾"
           data-author="" >
            <span class="post-title" title="2019 ISCC线下赛回顾">2019 ISCC线下赛回顾</span>
            <span class="post-date" title="2018-07-22 15:00:00">2018/07/22</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/19/Black_magic/"
           data-tag="php,弱类型"
           data-author="" >
            <span class="post-title" title="black_magic">black_magic</span>
            <span class="post-date" title="2019-08-19 18:59:50">2019/08/19</span>
        </a>
        
        <a  class="WP "
           href="/2018/03/23/HITCON-Babytrick/"
           data-tag="WP,SQL,serialize"
           data-author="" >
            <span class="post-title" title="HITCON-babytrick">HITCON-babytrick</span>
            <span class="post-date" title="2018-03-23 15:13:47">2018/03/23</span>
        </a>
        
        <a  class="wp "
           href="/2019/08/16/De1ctf/"
           data-tag="ssrf,RSA"
           data-author="" >
            <span class="post-title" title="De1ctf">De1ctf</span>
            <span class="post-date" title="2019-08-16 20:00:50">2019/08/16</span>
        </a>
        
        <a  class="WP "
           href="/2019/08/01/JarvisOJ/"
           data-tag="WP,SQL,serialize,哈希长度扩展攻击"
           data-author="" >
            <span class="post-title" title="JarvisOJ WP">JarvisOJ WP</span>
            <span class="post-date" title="2019-08-01 19:37:28">2019/08/01</span>
        </a>
        
        <a  class="ctf "
           href="/2018/05/23/RSA/"
           data-tag="RSA"
           data-author="" >
            <span class="post-title" title="RSA">RSA</span>
            <span class="post-date" title="2018-05-23 15:13:47">2018/05/23</span>
        </a>
        
        <a  class="ctf "
           href="/2019/03/23/ZIP伪加密/"
           data-tag="zip,misc"
           data-author="" >
            <span class="post-title" title="ZIP&#39;s things">ZIP&#39;s things</span>
            <span class="post-date" title="2019-03-23 15:13:47">2019/03/23</span>
        </a>
        
        <a  class="ctf "
           href="/2019/08/01/session_unserialize/"
           data-tag="php,serialize"
           data-author="" >
            <span class="post-title" title="Session_unserlize">Session_unserlize</span>
            <span class="post-date" title="2019-08-01 19:33:07">2019/08/01</span>
        </a>
        
        <a  class="ctf "
           href="/2019/07/28/SQL/"
           data-tag="SQL"
           data-author="" >
            <span class="post-title" title="SQL">SQL</span>
            <span class="post-date" title="2019-07-28 15:13:47">2019/07/28</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-ZIP伪加密" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">ZIP&#39;s things</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="ctf">ctf</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color4">zip</a>
            
            <a href="javascript:" class="color5">misc</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-08-10 15:57:28'>2019-03-23 15:13</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-压缩源文件数据区"><span class="toc-text">1 压缩源文件数据区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#文件头结构"><span class="toc-text">文件头结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件数据"><span class="toc-text">文件数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据描述符"><span class="toc-text">数据描述符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-压缩源文件目录区"><span class="toc-text">2.压缩源文件目录区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-压缩源文件目录结束标志"><span class="toc-text">3.压缩源文件目录结束标志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-ZIP伪加密"><span class="toc-text">0x02 ZIP伪加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-ZIP明文攻击"><span class="toc-text">0x03 ZIP明文攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-ZIP掩码攻击"><span class="toc-text">0x03 ZIP掩码攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-CRC32碰撞"><span class="toc-text">0x04 CRC32碰撞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-其他乱七八糟的"><span class="toc-text">0x05 其他乱七八糟的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#关于fcrackzip"><span class="toc-text">关于fcrackzip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于图片格式问题"><span class="toc-text">关于图片格式问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件头总结"><span class="toc-text">文件头总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zip文件格式"><span class="toc-text">zip文件格式</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>##0x01 zip文件组成 ##</p>
<p><strong>压缩源文件数据区+压缩源文件目录区+压缩源文件目录结束标志</strong></p>
<h3 id="1-压缩源文件数据区"><a href="#1-压缩源文件数据区" class="headerlink" title="1 压缩源文件数据区"></a>1 压缩源文件数据区</h3><p>在这个数据区中每个压缩文件的源文件/目录都是一条记录，记录格式如下[文件头+文件数据+数据描述符]</p>
<h4 id="文件头结构"><a href="#文件头结构" class="headerlink" title="文件头结构"></a>文件头结构</h4><hr>
<pre><code>          组成    　                长度
      文件头标记                  4 bytes  (0x04034b50)
      解压文件所需 pkware 版本    2 bytes
     全局方式位标记              2 bytes
    压缩方式                    2 bytes
    最后修改文件时间             2 bytes
    最后修改文件日期             2 bytes
    CRC-32校验                  4 bytes
    压缩后尺寸                  4 bytes
    未压缩尺寸                  4 bytes
    文件名长度                  2 bytes
      扩展记录长度                2 bytes
    文件名                     （不定长度）
    扩展字段                   （不定长度）</code></pre><h4 id="文件数据"><a href="#文件数据" class="headerlink" title="文件数据"></a>文件数据</h4><p>就是数据</p>
<h4 id="数据描述符"><a href="#数据描述符" class="headerlink" title="数据描述符"></a>数据描述符</h4><hr>
<pre><code> 　　　组成    　长度
CRC-32校验                  4 bytes
压缩后尺寸                   4 bytes
未压缩尺寸                   4 bytes</code></pre><p>这个数据描述符只在全局方式位标记的第三位设为1时才存在，紧接在压缩数据的最后一个字节后。</p>
<h3 id="2-压缩源文件目录区"><a href="#2-压缩源文件目录区" class="headerlink" title="2.压缩源文件目录区"></a>2.压缩源文件目录区</h3><p>在这个数据区中每一条记录对应在压缩源文件区中的一条数据</p>
<hr>
<pre><code>   　　　组成               　            长度
　　目录中文件文件头标记             4 bytes  (0x02014b50)
　　压缩使用的　pkware 版本          2 bytes
　　解压文件所需 pkware 版本         2 bytes
　　全局方式位标记                   2 bytes
　　压缩方式                        2 bytes
　　最后修改文件时间                 2 bytes
　　最后修改文件日期                 2 bytes
　　ＣＲＣ－３２校验                 4 bytes
　　压缩后尺寸                      4 bytes
　　未压缩尺寸                      4 bytes
　　文件名长度                      2 bytes
　　扩展字段长度                    2 bytes
　　文件注释长度                    2 bytes
　　磁盘开始号                      2 bytes
　　内部文件属性                    2 bytes
　　外部文件属性                    4 bytes
    局部头部偏移量                  4 bytes
　　文件名                       （不定长度）
　　扩展字段                     （不定长度）
    文件注释                     （不定长度）</code></pre><h3 id="3-压缩源文件目录结束标志"><a href="#3-压缩源文件目录结束标志" class="headerlink" title="3.压缩源文件目录结束标志"></a>3.压缩源文件目录结束标志</h3><hr>
<pre><code>　　　组成               　          长度
    目录结束标记                    4 bytes  (0x02014b50)
    当前磁盘编号                    2 bytes
    目录区开始磁盘编号              2 bytes
　　本磁盘上纪录总数                 2 bytes
　　目录区中纪录总数                 2 bytes
　　目录区尺寸大小                   4 bytes
　　目录区对第一张磁盘的偏移量        4 bytes
　　ZIP 文件注释长度                 2 bytes

　　ZIP 文件注释                   （不定长度）</code></pre><p>这里可以注意到文件目录结束标志只有22位，如果超出这部分则可能是隐藏数据(今天真的是被桂电的MISC给虐哭了/(ㄒoㄒ)/~~)。</p>
<h2 id="0x02-ZIP伪加密"><a href="#0x02-ZIP伪加密" class="headerlink" title="0x02 ZIP伪加密"></a>0x02 ZIP伪加密</h2><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kazyuumnj30gx0de41x.jpg" alt></p>
<p>压缩源文件数据区–头文件标志：50 4B 03 04</p>
<p>压缩源文件目录区：</p>
<ul>
<li>目录中文件文件头标志：50 4B 01 02</li>
<li>压缩使用的pkware:     3F 00</li>
<li>紧跟着是解压文件所需要的pkware版本：14 00</li>
<li>全局方式位标记：00 00(更改这里进行伪加密，改为09 00就会提示有密码，实际上只要是以奇数结尾即可)</li>
</ul>
<p>压缩源文件目录结束标志：50 4B 05 06</p>
<p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kb023lp3j30gx0d4jug.jpg" alt></p>
<p>如何判断伪加密？</p>
<p>无加密</p>
<p>压缩源文件数据区的全局加密应当为00 00<br>且压缩源文件目录区的全局方式位标记应当为00 00</p>
<p>假加密</p>
<p>压缩源文件数据区的全局加密应当为00 00<br>且压缩源文件目录区的全局方式位标记应当为09 00</p>
<p>真加密</p>
<p>压缩源文件数据区的全局加密应当为09 00<br>且压缩源文件目录区的全局方式位标记应当为09 00</p>
<h2 id="0x03-ZIP明文攻击"><a href="#0x03-ZIP明文攻击" class="headerlink" title="0x03 ZIP明文攻击"></a>0x03 ZIP明文攻击</h2><p>如果一个压缩包你不知道密码，但是压缩包里有一个已知文件（文件大小大于12Byte），因为同一个压缩包里的文件都是采用同一个密钥加密，所以可以用已知文件来找密钥。</p>
<p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5kb052ll8j30g70fhwhx.jpg" alt></p>
<h2 id="0x03-ZIP掩码攻击"><a href="#0x03-ZIP掩码攻击" class="headerlink" title="0x03 ZIP掩码攻击"></a>0x03 ZIP掩码攻击</h2><p>已知密码的某几位进行构造，这里以桂电的MISC为例，前面我们已经解开两层加密，得到了最后的111.zip,<br>里面有</p>
<p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5kb0bwn1ej305b02bt8i.jpg" alt></p>
<p>打开.sh文件是这样的内容</p>
<pre><code>#!/bin/bash
#
zip -e --password=`python -c &quot;print(__import__(&#39;time&#39;).time())&quot;` flag.zip flag</code></pre><p>跑一下命令</p>
<pre><code>&gt;&gt;&gt; print(__import__(&#39;time&#39;).time())
1558685006.11</code></pre><p>大概形式知道了尝试掩码攻击</p>
<p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kb0ltqooj30fh0f0gp8.jpg" alt></p>
<p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kb0oiik6j30f206d0tr.jpg" alt></p>
<h2 id="0x04-CRC32碰撞"><a href="#0x04-CRC32碰撞" class="headerlink" title="0x04 CRC32碰撞"></a>0x04 CRC32碰撞</h2><p>CRC本身是循环冗余校验码的意思，CRC32则表示产生一个32bit（8位十六进制数）的校验值</p>
<p>在生成该校验值的时候源数据每一位都参与了运算，因此即使数据块中只有一位发生改变也会得到不同的CRC32值，利用这个原理我们可以直接爆破出加密文件的内容。<br>这里做测试用我们创建了一个内容只有‘1234’的txt文件并进行压缩，得到压缩的CRC值，写脚本进行爆破</p>
<pre><code>import binascii

crc=0x9BE3E0A3
for i in range(1000,9999+1):
if (binascii.crc32(str(i)) &amp; 0xffffffff) == crc:
    print i</code></pre><p>由于内容较短几秒就碰撞出文件内容。</p>
<p>在PY2.x版本中。binascii.crc32中所计算出的CRC值域为[-2^31,2^31-1]之间的有符号整数，为了与一般的CRC结果对比，需要将其转换为无符号整数，所以加上 &amp; 0xfffffffff来进行转换</p>
<pre><code>&gt;&gt;&gt; str1=0x4D2
&gt;&gt;&gt; str2=str1 &amp; 0xffff
&gt;&gt;&gt; print str2
1234</code></pre><p>如果是py3.x版本计算结果为无符号整数，就不用加了。 </p>
<h2 id="0x05-其他乱七八糟的"><a href="#0x05-其他乱七八糟的" class="headerlink" title="0x05 其他乱七八糟的"></a>0x05 其他乱七八糟的</h2><h3 id="关于fcrackzip"><a href="#关于fcrackzip" class="headerlink" title="关于fcrackzip"></a>关于fcrackzip</h3><p>作为kali自带的工具，可以使用它来进行爆破工作，这里还是用桂电的MISC-222.zip为例</p>
<p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5kb0955f3j30ls0fndvz.jpg" alt></p>
<p>由菜单可知-b 是爆破，-c 指定字符集,-l指定长度,-u 用解压的方式淘汰掉错误的密码。当然我们也可以跑字典</p>
<pre><code># fcrackzip -D -p /字典位置/xxx.txt  -u crack_this.zip</code></pre><h3 id="关于图片格式问题"><a href="#关于图片格式问题" class="headerlink" title="关于图片格式问题"></a>关于图片格式问题</h3><p>png文件署名域</p>
<ul>
<li>十进制数：137 80 78 71 13 10 26 10</li>
<li>十六进制：89 50 4e 47 0d 0a 1a 0a</li>
</ul>
<h3 id="文件头总结"><a href="#文件头总结" class="headerlink" title="文件头总结"></a>文件头总结</h3><pre><code>JPEG (jpg)，                        　　文件头：FFD8FF　　　　　　　　　　　　　　　　　　　　　　　 文件尾：FF D9　　　　　　　　　　　　　　　
PNG (png)，                       　　 文件头：89504E47　　　　　　　　　　　　　　　　　　　　　　文件尾：AE 42 60 82
GIF (gif)，                           　　文件头：47494638　　　　　　　　　　　　　　　　　　　　　　文件尾：00 3B                                                                 ZIP Archive (zip)，                     文件头：504B0304　　　　　　　　　　　　　　　　　　　　　　文件尾：50 4B

TIFF (tif)，                           　  文件头：49492A00　　　　　　　　　　　　　　　　　　　　　　文件尾：
Windows Bitmap (bmp)，      　  文件头：424D　　　　　　　　　　　　　　　　　　　　　　　　 文件尾：
CAD (dwg)，                        　  文件头：41433130　　　　　　　　　　　　　　　　　　　　　　文件尾：
Adobe Photoshop (psd)，          文件头：38425053　　　　　　　　　　　　　　　　　　　　　　文件尾：
Rich Text Format (rtf)，             文件头：7B5C727466　　　　　　　　　　　　　　　　　　　　  文件尾：
XML (xml)，                              文件头：3C3F786D6C　　　　　　　　　　　　　　　　　　　　 文件尾：
HTML (html)，                           文件头：68746D6C3E
Email [thorough only] (eml)，     文件头：44656C69766572792D646174653A
Outlook Express (dbx)，            文件头：CFAD12FEC5FD746F
Outlook (pst)，                         文件头：2142444E
MS Word/Excel (xls.or.doc)，      文件头：D0CF11E0
MS Access (mdb)，                    文件头：5374616E64617264204A
WordPerfect (wpd)，                  文件头：FF575043
Adobe Acrobat (pdf)，               文件头：255044462D312E
Quicken (qdf)，                         文件头：AC9EBD8F
Windows Password (pwl)，         文件头：E3828596

RAR Archive (rar)，                    文件头：52617221
Wave (wav)，                            文件头：57415645
AVI (avi)，                                 文件头：41564920
Real Audio (ram)，                     文件头：2E7261FD
Real Media (rm)，                       文件头：2E524D46
MPEG (mpg)，                           文件头：000001BA
MPEG (mpg)，                           文件头：000001B3
Quicktime (mov)，                     文件头：6D6F6F76
Windows Media (asf)，               文件头：3026B2758E66CF11
MIDI (mid)，                              文件头：4D546864</code></pre><h3 id="zip文件格式"><a href="#zip文件格式" class="headerlink" title="zip文件格式"></a>zip文件格式</h3><p>翻译作者的文章链接<br><a href="https://blog.csdn.net/luoye7422/article/details/41878969" target="_blank" rel="noopener">https://blog.csdn.net/luoye7422/article/details/41878969</a></p>
<p>参考链接</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/4d8cace82028" title="图片格式详解" target="_blank" rel="noopener">https://www.jianshu.com/p/4d8cace82028</a><br>更详细解释：<a href="https://blog.csdn.net/u012611878/article/details/52215985" target="_blank" rel="noopener">https://blog.csdn.net/u012611878/article/details/52215985</a><br><a href="https://blog.csdn.net/xiangshangbashaonian/article/details/80156865" target="_blank" rel="noopener">https://blog.csdn.net/xiangshangbashaonian/article/details/80156865</a></p>
</blockquote>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 brainsemail@163.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>ZIP&#39;s things</p>
    
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="Luc1fer">Luc1fer</a></p>
    <p><span class="copy-title">发布时间:</span>2019-03-23, 15:13:47</p>
    <p><span class="copy-title">最后更新:</span>2019-08-10, 15:57:28</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2019/03/23/ZIP伪加密/" title="ZIP&#39;s things">https://github.com/BrainLyh/2019/03/23/ZIP伪加密/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 Yelog</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="//cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#WP','#php','#命令执行','#LSB','#MISC','#隐写','#mysql load data','#工具','#渗透测试','#SQL','#redis','#ssrf','#Xdebuf','#ctf','#RSA','#xxe','#docker','#serialize','#比赛回顾','#弱类型','#哈希长度扩展攻击','#zip','#misc',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.5;
        background: url("http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kej6ap1bj31hc0u0wn6.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
